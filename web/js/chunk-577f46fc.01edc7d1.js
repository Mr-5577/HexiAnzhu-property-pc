(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-577f46fc"],{"4dea":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{attrs:{id:"alone"}},[e("div",{staticClass:"top"},[e("div",{staticClass:"main"},[e("div",{staticClass:"common-left"},[e("span",{staticClass:"common-chose-info",on:{click:function(e){return t.$refs.showFilterVillage.showDialog()}}},[e("i",{staticClass:"iconfont icondaqu"}),t._v(" "+t._s(t.choseVillageInfo.name)+" ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"请输入业主姓名、电话、房号"},domProps:{value:t.searchVal},on:{input:function(e){e.target.composing||(t.searchVal=e.target.value)}}}),e("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(e){return t.keySearch()}}},[t._v(" 查询 ")])],1),e("div",{staticClass:"common-right"},[e("el-button",{attrs:{type:"primary",plain:"",round:"",icon:"iconfont iconzu3638"},on:{click:t.viewLog}},[t._v(" 变更日志 ")])],1)])]),e("div",{staticClass:"main-wp"},[e("div",{staticClass:"select-wp"},[e("el-select",{attrs:{placeholder:"请选择资源类型"},on:{change:t.tableLoad},model:{value:t.typeVal,callback:function(e){t.typeVal=e},expression:"typeVal"}},t._l(t.typeOptions,(function(t){return e("el-option",{key:t.model_type,attrs:{label:t.text,value:t.model_type}})})),1),e("el-select",{staticClass:"sub",attrs:{clearable:"",multiple:"","collapse-tags":"",filterable:"",placeholder:"选择科目搜索"},on:{change:t.subChange},model:{value:t.subVal,callback:function(e){t.subVal=e},expression:"subVal"}},t._l(t.subOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.tableData,cusColums:t.columns,cusConf:t.conf,ispaging:!0,check:!0},on:{sizeChange:t.sizeChange,currentChange:t.currentChange,edit:t.tableEdit,selectionChange:t.selectionChange}}),this.$menu.getters.judgeRole("Btn-zAMDbYPFhCdNfK3qs1jeLTrQ")?e("el-button",{staticClass:"empty",attrs:{type:"primary",disabled:0==t.tableSelected.length,round:""},on:{click:t.batchSetting}},[t._v(" 批量设置("+t._s(t.tableSelected.length)+") ")]):t._e()],1)]),e("filter-village",{ref:"showFilterVillage",attrs:{vid:t.choseVillageInfo.vid},on:{choseInfo:t.filterVillage}}),e("el-dialog",{staticClass:"chargeDialog",attrs:{visible:t.showChargeDialog,title:t.isBatch?"计费标准批量设置":"计费标准设置",width:"35%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showChargeDialog=e}}},[e("el-scrollbar",{staticStyle:{height:"100%"}},[e("el-form",{ref:"editForm",attrs:{model:t.editForm,rules:t.rules,"hide-required-asterisk":!0}},[e("el-form-item",{attrs:{label:"计费科目",prop:"subValue"}},[e("el-input",{attrs:{readonly:"",placeholder:"请输入计费科目"},model:{value:t.editForm.subValue,callback:function(e){t.$set(t.editForm,"subValue",e)},expression:"editForm.subValue"}})],1),e("el-form-item",{attrs:{label:"基本单价(元)",prop:"priceValue"}},[e("el-input",{attrs:{type:"number",placeholder:"请输入计费科目"},model:{value:t.editForm.priceValue,callback:function(e){t.$set(t.editForm,"priceValue",e)},expression:"editForm.priceValue"}})],1)],1)],1),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.editSubmit}},[t._v(" 提交保存 ")]),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showChargeDialog=!1}}},[t._v(" 取消 ")])],1)],1),e("el-dialog",{staticClass:"logDialog",attrs:{visible:t.showLogDialog,title:"变更日志",width:"50%","close-on-click-modal":!0},on:{"update:visible":function(e){t.showLogDialog=e}}},[e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.logTableData,cusColums:t.logColumns,cusConf:t.logConf,ispaging:!0},on:{sizeChange:t.logSizeChange,currentChange:t.logCurrentChange}})],1)])],1)},i=[],l=(a("5948"),a("7981")),o=a("ca01"),r={name:"alone",data(){return{urlObj:{villages:this.$api.state.System.village.list.url,aloneList:this.$api.state.Setting.aloneList.url,changeLog:this.$api.state.Setting.changeLog.url,infoEdit:this.$api.state.Setting.infoEdit.url,getResourceTypes:this.$api.state.Setting.getResourceTypes.url,buildOfVillage:this.$api.state.Public.buildOfVillage.url,unitOfBuild:this.$api.state.Public.unitOfBuild.url,subjectList:this.$api.state.Public.subjectList.url},searchVal:"",choseVillageInfo:{name:"全部项目",vid:0},tableData:[],columns:l.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},tableSelected:[],showLogDialog:!1,logTableData:[],logColumns:o.list,logConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},buildVal:"",buildOptions:[],unitVal:"",unitOptions:[],typeVal:"",typeOptions:[],subVal:"",subOptions:[],currentIndex:0,showChargeDialog:!1,editForm:{subValue:"",priceValue:""},rules:{subValue:[{required:!1,message:"请输入计费科目",trigger:"blur"}],priceValue:[{required:!0,message:"请输入基本单价",trigger:"blur"}]},isBatch:!1,isCommit:!1}},mounted(){let t=sessionStorage.getItem("vid"),e=sessionStorage.getItem("vname");t&&(this.choseVillageInfo.vid=t,this.choseVillageInfo.name=e),this.getTypeSubjects()},methods:{async getTypeSubjects(){let t=await this.$axios.post(this.urlObj.getResourceTypes),e=await this.$axios.post(this.urlObj.subjectList,{vid:this.choseVillageInfo.vid});if(200===t.Code)this.typeVal=t.Data&&t.Data.length>0?t.Data[0].model_type:"",this.typeOptions=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取资源类型数据失败！";this.$message({type:"error",message:e})}if(200===e.Code)this.subVal=e.Data&&e.Data.length>0?[e.Data[0].id]:[],this.subOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取科目数据失败！";this.$message({type:"error",message:t})}this.typeVal&&this.subVal&&this.tableLoad()},async getSubject(){let t={vid:this.choseVillageInfo.vid},e=await this.$axios.post(this.urlObj.subjectList,t);if(200===e.Code)this.subVal=e.Data&&e.Data.length>0?[e.Data[0].id]:[],this.subOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取科目数据失败！";this.$message({type:"error",message:t})}},filterVillage(t){this.choseVillageInfo.name=t.name,this.choseVillageInfo.vid=t.vid,this.buildVal="",this.buildOptions=[],this.unitVal="",this.unitOptions=[],this.subVal="",this.subOptions=[],this.choseVillageInfo.vid&&this.getSubject(),this.keySearch()},keySearch(){this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad()},tableLoad(){this.conf.loadStatus=!0;let t={vid:this.choseVillageInfo.vid,page:this.conf.curPage,limit:this.conf.limit,name:this.searchVal,bid:this.buildVal,unit:this.unitVal,subject:this.subVal,model_type:this.typeVal};this.$axios.post(this.urlObj.aloneList,t).then(t=>{200===t.Code?(t.Data.data.forEach(t=>{t.bjhide=1!=t.edit_auth}),this.conf.dataTotal=t.Data.total,this.tableData=t.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=t.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},selectionChange(t){this.tableSelected=t},subChange(t){if(t.length>0){let t=document.querySelector("#alone .select-wp .el-select__tags >.el-select__input");t.removeAttribute("placeholder")}else{let t=document.querySelector("#alone .select-wp .el-select__tags >.el-select__input");t.setAttribute("placeholder","选择科目搜索")}this.tableLoad()},getLogData(){this.logConf.loadStatus=!0;let t={vid:this.choseVillageInfo.vid,page:this.logConf.curPage,limit:this.logConf.limit};this.$axios.post(this.urlObj.changeLog,t).then(t=>{200===t.Code?(t.Data.data.forEach(t=>{t.operator=t.createuser?t.createuser.realname:"",t.tel=t.createuser?t.createuser.tel:"",t.roomnum=t.source?t.source.roomnum:""}),this.logConf.dataTotal=t.Data.total,this.logTableData=t.Data.data,this.logConf.loadStatus=!1,this.logConf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.logTableData=[],this.logConf.emptyText=t.Message,this.logConf.dataTotal=0,this.logConf.loadStatus=!1)}).catch(()=>{this.logTableData=[],this.logConf.emptyText="服务器连接失败...",this.logConf.dataTotal=0,this.logConf.loadStatus=!1})},sizeChange(t){this.conf.limit=t,this.tableLoad()},logSizeChange(t){this.logConf.limit=t,this.getLogData()},currentChange(t){this.conf.curPage=t,this.tableLoad()},logCurrentChange(t){this.logConf.curPage=t,this.getLogData()},viewLog(){this.showLogDialog=!0,this.getLogData()},tableEdit(t){this.isBatch=!1,this.currentIndex=t,this.$refs.editForm&&this.$refs.editForm.resetFields(),this.editForm.subValue=this.tableData[t].subject_village_name,this.editForm.priceValue=this.tableData[t].price,this.showChargeDialog=!0},batchSetting(){this.isBatch=!0,this.$refs.editForm&&this.$refs.editForm.resetFields();let t=[];this.tableSelected.forEach(e=>{t.includes(e.subject_village_name)||t.push(e.subject_village_name)}),this.editForm.subValue=t.join("、"),this.editForm.priceValue="",this.showChargeDialog=!0},editSubmit(){this.$refs.editForm.validate(t=>{if(t){this.isSubmit=!0;let t={};t=this.isBatch?{price_batch:this.tableSelected.map(t=>({id:t.id,price:this.editForm.priceValue}))}:{id:this.tableData[this.currentIndex].id,price:this.editForm.priceValue,resourcesmodel_type:this.tableData[this.currentIndex].resourcesmodel_type},this.$axios.post(this.urlObj.infoEdit,t).then(t=>{if(200===t.Code)this.$message({type:"success",message:this.isBatch?"批量设置成功！":"设置成功！"}),this.showChargeDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:this.isBatch?"批量设置失败！":"设置失败！";this.$message({type:"error",message:e})}this.isSubmit=!1}).catch(()=>{this.isSubmit=!1})}})}}},n=r,c=(a("56c2"),a("1805")),h=Object(c["a"])(n,s,i,!1,null,null,null);e["default"]=h.exports},"56c2":function(t,e,a){"use strict";a("671c")},"671c":function(t,e,a){},7981:function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"资源名称","prop":"resources_name","show":true},{"label":"资源类型","prop":"resourcesmodel_type_text","show":true},{"label":"业主姓名","prop":"realname","show":true},{"label":"业主电话","prop":"tel","show":true,"color":"#999"},{"label":"计费科目","prop":"subject_village_name","show":true,"color":"#999"},{"label":"基本单价","prop":"price","show":true,"color":"#ffcb3c"},{"label":"计量单位","prop":"unit_text","show":true,"color":"#69da61"},{"label":"计算公式","prop":"formula_text","show":true,"color":"#999"},{"label":"操作","width":"150","type":"button","show":true,"btns":[{"name":"编辑","type":"primary","size":"small","round":true,"action":"edit","hide":"bjhide","role":"edit","token":"Btn-zAMDbYPFhCdNfK3qs1jeLTrQ"}]}]}')},ca01:function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"描述","prop":"content","show":true,"color":"#999"},{"label":"操作人","prop":"operator","show":true},{"label":"修改日期","prop":"create_time","show":true,"color":"#999"}]}')}}]);