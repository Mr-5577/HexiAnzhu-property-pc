(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4b402775"],{"051f":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{attrs:{id:"questionnaire"}},[e("div",{staticClass:"main-wp"},[e("div",{staticClass:"title"},[t._v("问卷调查模板")]),t.$menu.getters.judgeRole("Btn-ROzxMU6stCmEau9HVoQBFekq")?e("el-button",{staticClass:"addbtn",attrs:{type:"primary",round:"",plain:"",icon:"iconfont iconxinzeng"},on:{click:t.addTemplate}},[t._v(" 新建模板 ")]):t._e(),e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.tableData,cusColums:t.columns,cusConf:t.conf,ispaging:!0},on:{sizeChange:t.sizeChange,currentChange:t.currentChange,examine:t.examine}})],1)],1),e("el-dialog",{staticClass:"addDialog",attrs:{visible:t.showAddDialog,title:"新增问卷模板",width:"80%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showAddDialog=e},close:t.addDialogClose}},[e("div",{staticClass:"dialog-wp"},[e("div",{staticClass:"left-wp"},[e("el-scrollbar",{staticStyle:{height:"100%"}},[e("div",{staticClass:"content"},[e("el-input",{attrs:{placeholder:"请输入问卷模板标题"},model:{value:t.tempTitle,callback:function(e){t.tempTitle=e},expression:"tempTitle"}}),e("div",{staticClass:"upload-wp"},[e("el-upload",{ref:"upload",attrs:{action:t.qiniuDatas.domain,"list-type":"picture-card","http-request":t.customUpload,limit:1,"on-preview":t.handlePictureCardPreview,"on-remove":t.handleRemove}},[e("i",{staticClass:"el-icon-plus"})]),e("span",[t._v("(顶部banner-建议尺寸702*320)")])],1),e("el-input",{attrs:{type:"textarea",resize:"none",rows:8,placeholder:"请输入问卷前言"},model:{value:t.tempRemark,callback:function(e){t.tempRemark=e},expression:"tempRemark"}}),e("el-input",{staticStyle:{"margin-top":"0"},attrs:{type:"textarea",resize:"none",rows:4,placeholder:"请输入结束语"},model:{value:t.overRemark,callback:function(e){t.overRemark=e},expression:"overRemark"}}),e("ul",[t._l(t.topicSelects,(function(s,a){return e("li",{key:a},[e("div",{staticClass:"name"},[t._v(" "+t._s(s.name)+" ")]),1==s.type?e("el-radio-group",t._l(s.problemAnswer,(function(s,a){return e("el-radio",{key:a,attrs:{label:s.label}},[t._v(" "+t._s(s.label)+" ")])})),1):t._e(),2==s.type?e("el-checkbox-group",{attrs:{disabled:""}},t._l(s.problemAnswer,(function(t,s){return e("el-checkbox",{key:s,attrs:{label:t.label}})})),1):t._e(),e("span",{staticClass:"del",on:{click:function(e){return t.topicDel(a)}}},[t._v("删除")])],1)})),t.$menu.getters.judgeRole("Btn-cjfqtUXNBvEmKHpInSZJQdux")?e("li",{staticClass:"add",on:{click:t.questAdd}},[e("i",{staticClass:"iconfont iconxinzeng"})]):t._e()],2)],1)])],1),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.topicLoading,expression:"topicLoading"}],staticClass:"right-wp"},[e("div",{staticClass:"title"},[t._v("问题库")]),e("el-scrollbar",{staticStyle:{height:"calc(100% - 4.5rem)"}},[e("div",{staticClass:"content"},[0==t.topicList.length?e("div",{staticClass:"empty"},[t._v("暂无数据！")]):e("ul",t._l(t.topicList,(function(s,a){return e("li",{key:a},[e("div",{staticClass:"name"},[e("span",{staticClass:"type"},[t._v(" "+t._s(1==s.type?"单选题":2==s.type?"多选题":"问答题")+" ")]),t._v(" | "),e("span",{staticClass:"text"},[t._v(" "+t._s(s.name)+" ")])]),1==s.type?e("el-radio-group",t._l(s.problemAnswer,(function(s,a){return e("el-radio",{key:a,attrs:{label:s.key}},[t._v(" "+t._s(s.label)+" ")])})),1):t._e(),2==s.type?e("el-checkbox-group",{attrs:{disabled:""}},t._l(s.problemAnswer,(function(t,s){return e("el-checkbox",{key:s,attrs:{label:t.label}})})),1):t._e(),t.showAdd(s)?e("span",{staticClass:"add-ico",on:{click:function(e){return t.topicAdd(s)}}},[e("i",{staticClass:"iconfont iconxinzeng"})]):t._e()],1)})),0)])]),e("el-pagination",{attrs:{"current-page":t.topicCurrentPage,"page-sizes":[20,50,100,300],"page-size":t.topicPageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.topicTotal},on:{"size-change":t.topicSizeChange,"current-change":t.topicCurrentChange}})],1)]),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.tempSubmit}},[t._v(" 确认提交 ")]),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showAddDialog=!1}}},[t._v(" 取消 ")])],1)]),e("el-dialog",{staticClass:"editDialog",attrs:{visible:t.showEditDialog,title:"新增问题",width:"50%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showEditDialog=e},close:function(e){t.showEditDialog=!1}}},[e("el-scrollbar",{staticStyle:{height:"100%"}},[e("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"hide-required-asterisk":!0}},[e("el-form-item",{attrs:{label:"问题类型",prop:"type"}},[e("el-select",{attrs:{clearable:"",placeholder:"请选择问题类型"},model:{value:t.ruleForm.type,callback:function(e){t.$set(t.ruleForm,"type",e)},expression:"ruleForm.type"}},[e("el-option",{attrs:{label:"单选",value:1}}),e("el-option",{attrs:{label:"多选",value:2}}),e("el-option",{attrs:{label:"问答题",value:3}})],1)],1),e("el-form-item",{staticClass:"content",attrs:{label:"问题内容",prop:"content"}},[e("el-input",{attrs:{placeholder:"请输入问题内容"},model:{value:t.ruleForm.content,callback:function(e){t.$set(t.ruleForm,"content",e)},expression:"ruleForm.content"}})],1),1==t.ruleForm.type||2==t.ruleForm.type?e("div",{staticClass:"check-wp"},[e("div",{staticClass:"title"},[t._v("问题选项设置")]),t._l(t.ruleForm.options,(function(s,a){return e("el-form-item",{key:a,attrs:{label:"选项"+(a+1),prop:"options."+a+".value",rules:{required:!0,message:"请输入选项名称",trigger:"blur"}}},[e("el-input",{attrs:{placeholder:"请输入选项名称"},model:{value:s.value,callback:function(e){t.$set(s,"value",e)},expression:"item.value"}}),t.ruleForm.options.length>2?e("i",{staticClass:"del el-icon-circle-close",on:{click:function(e){return t.delOption(a)}}}):t._e()],1)})),e("el-form-item",{staticClass:"add",attrs:{label:" "}},[e("span",{staticClass:"add-ico",on:{click:t.addOption}},[e("i",{staticClass:"iconfont iconxinzeng"})])])],2):t._e()],1)],1),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isTopicCommit,type:"primary",round:""},on:{click:t.topicSubmit}},[t._v(" 确认新增 ")]),e("el-button",{attrs:{loading:t.isTopicCommit,type:"info",round:""},on:{click:function(e){t.showEditDialog=!1}}},[t._v(" 取消 ")])],1)],1),e("el-dialog",{staticClass:"statDialog",attrs:{visible:t.showStatDialog,title:"问卷模板数据分析",width:"80%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showStatDialog=e},close:function(e){t.showStatDialog=!1}}},[e("div",{staticClass:"dialog-wp"},[e("div",{staticClass:"left-wp"},[e("el-scrollbar",{staticStyle:{height:"100%"}},[e("div",{staticClass:"content"},[e("div",{staticClass:"title"},[t._v("问卷评分汇总")]),e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.questTableData,cusColums:t.questColumns,cusConf:t.questConf,ispaging:!1}})],1),e("div",{staticClass:"select-title"},[e("div",{staticClass:"title"},[t._v("项目评分汇总")]),e("el-cascader",{attrs:{options:t.villageOptions,props:{multiple:!0},"collapse-tags":"","show-all-levels":!1},on:{change:t.villageChange},model:{value:t.villageVal,callback:function(e){t.villageVal=e},expression:"villageVal"}})],1),e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.proTableData,cusColums:t.proColumns,cusConf:t.proConf,ispaging:!1}})],1)])])],1),e("div",{staticClass:"right-wp"},[e("div",{staticClass:"title"},[t._v("参与用户汇总")]),e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.userTableData,cusColums:t.userColumns,cusConf:t.userConf,ispaging:!0},on:{sizeChange:t.userSizeChange,currentChange:t.userCurrentChange,examine:t.userExamine}})],1)])]),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.exportData}},[t._v(" 导出数据 ")]),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showStatDialog=!1}}},[t._v(" 返回 ")])],1)]),e("el-image",{ref:"preview",attrs:{src:t.imgSrc,"preview-src-list":t.imgList,"z-index":1e4}})],1)},i=[],o=(s("5948"),s("3f1e")),l=s("404c"),r=s("e2bb"),n=s("f31f");var c={name:"questionnaire",data(){return{urlObj:{bigarea:this.$api.state.Public.bigarea.url,village:this.$api.state.Public.village.url,areaVillage:this.$api.state.Public.areaVillage.url,uploadToken:this.$api.state.Public.uploadToken.url,questList:this.$api.state.Custom.questList.url,topicList:this.$api.state.Custom.topicList.url,questAdd:this.$api.state.Custom.questAdd.url,problemAdd:this.$api.state.Custom.problemAdd.url,getCommentCount:this.$api.state.Custom.getCommentCount.url,getComment:this.$api.state.Custom.getComment.url,questexport:this.$api.state.Custom.questexport.url},tableData:[],columns:o.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},cindex:"",showAddDialog:!1,topicLoading:!1,tempTitle:"",tempRemark:"",overRemark:"",qiniuDatas:"",fileInfo:[],imgSrc:"",imgList:[],topicSelects:[],topicList:[],topicCurrentPage:1,topicPageSize:20,topicTotal:0,isCommit:!1,showEditDialog:!1,ruleForm:{type:"",content:"",options:[{value:""},{value:""}]},rules:{type:[{required:!0,message:"请选择问题类型",trigger:"change"}],content:[{required:!0,message:"请输入问题内容",trigger:"blur"}]},isTopicCommit:!1,showStatDialog:!1,questTableData:[],questColumns:l.list,questConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},proTableData:[],proColumns:l.list,proConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},userTableData:[],userColumns:r.list,userConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},villageVal:[],villageOptions:[]}},computed:{vid(){return this.$store.state.vid}},watch:{vid(){this.tableLoad()}},mounted(){this.tableLoad(),this.getUploadToken()},methods:{getAreaData(){this.$axios.post(this.urlObj.areaVillage).then(t=>{if(200===t.Code){this.villageOptions=t.Data;let e=Number(sessionStorage.getItem("bid")),s=Number(sessionStorage.getItem("cid"));this.villageVal=[[e,s,Number(this.vid)]]}else{let e=t.Message?t.Message:"获取大区、项目数据失败！";this.$message({type:"error",message:e})}})},tableLoad(){this.conf.loadStatus=!0;let t={page:this.conf.curPage,limit:this.conf.limit};this.$axios.post(this.urlObj.questList,t).then(t=>{200===t.Code?(this.conf.dataTotal=t.Data.total,this.tableData=t.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.datas=[],this.conf.emptyText=t.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.datas=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},sizeChange(t){this.conf.limit=t,this.tableLoad()},currentChange(t){this.conf.curPage=t,this.tableLoad()},addTemplate(){this.tempTitle="",this.tempRemark="",this.overRemark="",this.fileInfo=[],this.imgSrc="",this.imgList=[],this.topicList=[],this.topicSelects=[],this.topicCurrentPage=1,this.topicPageSize=20,this.topicTotal=0,this.isCommit=!1,this.showAddDialog=!0,this.getTopicData()},addDialogClose(){this.$refs.upload.clearFiles(),this.fileInfo=[],this.imgSrc="",this.imgList=[],this.showAddDialog=!1},getTopicData(t){this.topicLoading=!0;let e={page:this.topicCurrentPage,limit:this.topicPageSize};this.$axios.post(this.urlObj.topicList,e).then(e=>{if(200===e.Code){if(this.topicTotal=e.Data.total?e.Data.total:0,this.topicList=e.Data.data?e.Data.data:[],t){let e=this.topicList.find(e=>e.id==t);e&&this.topicSelects.push(e)}}else{let t=e.Message?e.Message:"获取题库数据失败！";this.$message({type:"error",message:t})}this.topicLoading=!1})},topicSizeChange(t){this.topicPageSize=t,this.getTopicData()},topicCurrentChange(t){this.topicCurrentPage=t,this.getTopicData()},getUploadToken(){this.$axios.post(this.urlObj.uploadToken).then(t=>{200===t.Code&&(this.qiniuDatas=t.Data)})},customUpload(t){t.url=this.$refs.upload.uploadFiles[0].url;let e=Object(n["a"])(t,this.qiniuDatas);e.observable.subscribe({next:t=>{},error:t=>{},complete:t=>{this.fileInfo=[e.fileInfo]}})},handleRemove(){this.fileInfo=[]},handlePictureCardPreview(t){this.imgSrc=t.url,this.imgList=[t.url],this.$nextTick(()=>{this.$refs.preview.clickHandler()})},showAdd(t){let e=this.topicSelects.map(t=>t.id);return!e.includes(t.id)},topicAdd(t){let e=this.topicSelects.map(t=>t.id);e.includes(t.id)||this.topicSelects.push(t)},topicDel(t){this.topicSelects.splice(t,1)},questAdd(){this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.ruleForm={type:"",content:"",options:[{value:""},{value:""}]},this.showEditDialog=!0},addOption(){this.ruleForm.options.push({value:""})},delOption(t){this.ruleForm.options.splice(t,1)},topicSubmit(){this.$refs.ruleForm.validate(t=>{if(t){this.isTopicCommit=!0;let t={type:this.ruleForm.type,name:this.ruleForm.content,answer:this.ruleForm.options.map(t=>({label:t.value}))};this.$axios.post(this.urlObj.problemAdd,t).then(t=>{if(200===t.Code)this.$message({message:"题库添加成功！",type:"success"}),this.showEditDialog=!1,this.getTopicData(t.Data.id);else{let e=t.Message?t.Message:"添加题库失败！";this.$message({message:e,type:"error"})}this.isTopicCommit=!1}).catch(()=>{this.isTopicCommit=!1})}})},tempSubmit(){let t=this.topicSelects.map(t=>t.id);if(!this.tempTitle)return void this.$message({message:"请填写问卷模板标题！",type:"warning"});if(0===t.length)return void this.$message({message:"请选择问卷题库！",type:"warning"});this.isCommit=!0;let e={name:this.tempTitle,header:this.tempRemark,footer:this.overRemark,url:this.fileInfo[0].qiniu_key,problem_id:t};this.$axios.post(this.urlObj.questAdd,e).then(t=>{if(200===t.Code)this.$message({message:"问卷模板添加成功！",type:"success"}),this.showAddDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:"问卷模板添加失败！";this.$message({message:e,type:"error"})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})},examine(t){this.cindex=t,this.showStatDialog=!0,this.getAreaData(),this.getGatherData(),this.getVillageGather([this.vid]),this.getUserGather()},getGatherData(){this.questConf.loadStatus=!0;let t={id:this.tableData[this.cindex].id};this.$axios.post(this.urlObj.getCommentCount,t).then(t=>{200===t.Code?(this.questTableData=t.Data,this.questConf.loadStatus=!1,this.questConf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.questTableData=[],this.questConf.emptyText=t.Message,this.questConf.dataTotal=0,this.questConf.loadStatus=!1)}).catch(()=>{this.questTableData=[],this.questConf.emptyText="服务器连接失败...",this.questConf.dataTotal=0,this.questConf.loadStatus=!1})},getVillageGather(t){this.proConf.loadStatus=!0;let e={id:this.tableData[this.cindex].id,vid:t};this.$axios.post(this.urlObj.getCommentCount,e).then(t=>{200===t.Code?(this.proTableData=t.Data,this.proConf.loadStatus=!1,this.proConf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.proTableData=[],this.proConf.emptyText=t.Message,this.proConf.dataTotal=0,this.proConf.loadStatus=!1)}).catch(()=>{this.proTableData=[],this.proConf.emptyText="服务器连接失败...",this.proConf.dataTotal=0,this.proConf.loadStatus=!1})},villageChange(t){let e=t.map(t=>t[t.length-1]);this.getVillageGather(e),this.getUserGather()},getUserGather(){this.userConf.loadStatus=!0;let t={id:this.tableData[this.cindex].id,vid:this.villageVal.length>0?this.villageVal.map(t=>t[t.length-1]):[this.vid]};this.$axios.post(this.urlObj.getComment,t).then(t=>{200===t.Code?(t.Data.data&&t.Data.data.length>0&&t.Data.data.forEach((t,e)=>{t.index=(this.userConf.curPage-1)*this.userConf.limit+e+1,t.vname=t.village.villagename?t.village.villagename:"",t.userName=t.owner.realname?t.owner.realname:"",t.roomNum=t.rooms.roomnum?t.rooms.roomnum:"",t.userTel=t.owner.tel?t.owner.tel:""}),this.userTableData=t.Data.data,this.userConf.loadStatus=!1,this.userConf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.userTableData=[],this.userConf.emptyText=t.Message,this.userConf.dataTotal=0,this.userConf.loadStatus=!1)}).catch(()=>{this.userTableData=[],this.userConf.emptyText="服务器连接失败...",this.userConf.dataTotal=0,this.userConf.loadStatus=!1})},userSizeChange(t){this.userConf.limit=t,this.getUserGather()},userCurrentChange(t){this.userConf.curPage=t,this.getUserGather()},userExamine(t){let e=this.userTableData[t],s=`id=${this.tableData[this.cindex].id}&vid=${e.vid}&owner_id=${e.owner_id}&rooms_id=${e.rooms_id}`;window.open("http://q.ygddzy.cn/#/readHome?"+encodeURIComponent(s))},exportData(){let t={vid:this.villageVal.map(t=>t[t.length-1]),id:this.tableData[this.cindex].id};this.$axios.post(this.urlObj.questexport,t).then(t=>{if(200===t.Code)this.exportRecordExcel(t.Data);else{let e=t.Message?t.Message:"短信发送记录导出失败！";this.$message({type:"error",message:e})}}).catch(()=>{})},exportRecordExcel(t){let e="",a=[],i=[];e="短信发送记录",a=["项目","姓名","房号","电话"],i=t.map(t=>{let e=[t.villagename,t.realname,t.roomnum,t.tel];return t.problem.forEach((t,s)=>{0===s&&a.push(t.problem_name),e.push(t.problem_answer)}),e});try{Promise.all([s.e("chunk-3a869cfb"),s.e("chunk-2a5081b0"),s.e("chunk-3a96421c")]).then((()=>{let{export_json_to_excel:t}=s("628d");t(a,i,e)}).bind(null,s)).catch(s.oe),this.$notify({type:"success",title:"温馨提示",message:"导出报表成功",duration:1500})}catch(o){this.$notify({type:"error",title:"温馨提示",message:"导出报表失败",duration:1500})}}}},u=c,p=(s("acb6"),s("1805")),h=Object(p["a"])(u,a,i,!1,null,null,null);e["default"]=h.exports},2824:function(t,e,s){},"3f1e":function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"问卷模板","prop":"name","show":true},{"label":"链接地址","prop":"url","show":true,"color":"#999"},{"label":"数据统计","prop":"","width":300,"type":"button","show":true,"btns":[{"name":"查看","type":"primary","size":"small","round":true,"action":"examine","role":"examine","token":"empty"}]}]}')},"404c":function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"编号","prop":"problem_id","show":true,"color":"#999"},{"label":"问题内容","prop":"problem_name","show":true},{"label":"调研分析","prop":"grade_str","show":true,"color":"#999","width":400}]}')},acb6:function(t,e,s){"use strict";s("2824")},e2bb:function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"序号","prop":"index","show":true},{"label":"项目","prop":"vname","show":true,"color":"#999"},{"label":"姓名","prop":"userName","show":true,"color":"#999"},{"label":"房号","prop":"roomNum","show":true,"color":"#999"},{"label":"电话","prop":"userTel","show":true,"color":"#999"},{"label":"操作","prop":"","width":100,"type":"button","show":true,"btns":[{"name":"详情","type":"primary","size":"small","round":true,"action":"examine","role":"examine","token":"empty"}]}]}')}}]);