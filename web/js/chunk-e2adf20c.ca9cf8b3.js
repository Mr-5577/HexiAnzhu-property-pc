(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e2adf20c"],{"01af":function(e,t,s){"use strict";s("502b")},"40a5":function(e,t,s){"use strict";s("e90e")},"502b":function(e,t,s){},5532:function(e,t,s){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"user-bind"}},[t("el-autocomplete",{ref:"searchInput",staticClass:"us-search",attrs:{"popper-class":"my-autocomplete",debounce:0,"fetch-suggestions":e.querySearchAsync,placeholder:"请输入姓名或电话号码搜索"},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function({item:s}){return[t("div",{staticClass:"tr-item"},[t("span",{staticClass:"td-item"},[e._v(e._s(s.realname))]),t("span",{staticClass:"td-item"},[e._v(e._s(s.sex?s.sex:"未知"))]),t("span",{staticClass:"td-item"},[e._v(e._s(s.tel))])]),e.allUserList.length>1&&s.id==e.allUserList[e.allUserList.length-1].id?t("div",{staticClass:"load-more",on:{click:function(t){return t.stopPropagation(),e.loadMore.apply(null,arguments)}}},[e._v(" "+e._s(e.nomore?"没有更多了":"点击加载更多")+" ")]):e._e(),e.allUserList.length<=1?t("div",{staticClass:"load-more",on:{click:function(t){return t.stopPropagation(),e.loadMore.apply(null,arguments)}}},[e._v(" 暂无数据！ ")]):e._e()]}}]),model:{value:e.autoValue,callback:function(t){e.autoValue=t},expression:"autoValue"}},[t("i",{staticClass:"iconfont iconzu3664 el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})])],1)},i=[],l={name:"UserBind",props:{vid:{type:[Number,String]}},data(){return{autoValue:"",currentUser:{},allUserList:[],nomore:!1}},mounted(){},methods:{async querySearchAsync(e,t){let s={keywords:e,page:1,limit:20,vid:this.vid},a=await this.$axios.post(this.$api.state.Means.userSearch.url,s);if(200===a.Code){let e={id:0,realname:"姓名",sex:"性别",tel:"电话号码"};a.Data.data.unshift(e),this.allUserList=a.Data.data,this.nomore=!1,t(a.Data.data)}else this.$refs.searchInput.$children[0].blur()},async loadMore(){if(!this.nomore){let e={keywords:this.autoValue,page:Math.ceil(this.allUserList.length/20)+1,limit:20,vid:this.vid},t=await this.$axios.post(this.$api.state.Means.userSearch.url,e);200===t.Code&&(t.Data.data.length>0?(this.allUserList=this.allUserList.concat(t.Data.data),this.$refs.searchInput.suggestions=this.allUserList):this.nomore=!0)}},handleSelect(e){this.currentUser=e,this.$emit("userSelected",e)}}},r=l,o=(s("01af"),s("1805")),n=Object(o["a"])(r,a,i,!1,null,null,null);t["a"]=n.exports},"6ae0":function(e,t,s){},b48e:function(e,t,s){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],attrs:{id:"area-village-select","element-loading-text":"数据加载中，请稍等"}},[t("div",{staticClass:"select-content"},[t("div",{staticClass:"title"},[e._v(e._s(e.title))]),t("div",{staticClass:"select-item"},[t("div",{staticClass:"name"},[e._v("选择大区")]),t("el-select",{attrs:{clearable:"",placeholder:"请选择大区"},on:{change:e.areaChange},model:{value:e.areaValue,callback:function(t){e.areaValue=t},expression:"areaValue"}},e._l(e.areaOptions,(function(e){return t("el-option",{key:e.deptid,attrs:{label:e.deptname,value:e.deptid}})})),1)],1),t("div",{staticClass:"select-item"},[t("div",{staticClass:"name"},[e._v("选择项目")]),t("el-select",{attrs:{clearable:"",multiple:e.multiple,placeholder:"请选择项目","no-data-text":e.villageLoading?"加载中...":"无数据"},model:{value:e.villageValue,callback:function(t){e.villageValue=t},expression:"villageValue"}},e._l(e.villageOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("div",{staticClass:"btn-wp"},[t("el-button",{attrs:{type:"primary",round:""},on:{click:e.registerStart}},[e._v(" "+e._s(e.btnName)+" ")])],1)])])},i=[],l={name:"AreaVillageSelect",props:{title:{type:String,default:""},btnName:{type:String,default:"开始登记"},multiple:{type:Boolean,default:!1}},data(){return{urlObj:{bigarea:this.$api.state.Public.bigarea.url,village:this.$api.state.Public.village.url},isRegister:!1,areaValue:"",areaOptions:[],villageLoading:!1,villageValue:this.multiple?[]:"",villageOptions:[],isLoading:!1}},created(){this.isLoading=!0,this.getAreaData()},methods:{getAreaData(){this.$axios.post(this.urlObj.bigarea,{vill_limit:!0}).then(e=>{if(200===e.Code){let t=sessionStorage.getItem("bid");t?(this.areaValue=Number(t),this.getVillageData(!0)):this.isLoading=!1,this.areaOptions=e.Data}else this.$message({type:"error",message:"大区数据获取失败！"}),this.isLoading=!1}).catch(e=>{this.$message({type:"error",message:"大区数据获取失败！"}),this.isLoading=!1})},areaChange(){this.villageOptions=[],this.villageValue=this.multiple?[]:"",this.areaValue&&this.getVillageData()},getVillageData(e){this.villageLoading=!0,this.$axios.post(this.urlObj.village,{id:this.areaValue}).then(t=>{if(200===t.Code){if(e){let e=sessionStorage.getItem("vid");e&&(this.villageValue=this.multiple?[Number(e)]:Number(e))}this.villageOptions=t.Data}else this.$message({type:"error",message:"项目数据获取失败！"});this.villageLoading=!1,this.isLoading=!1}).catch(e=>{this.$message({type:"error",message:"项目数据获取失败！"}),this.villageLoading=!1,this.isLoading=!1})},registerStart(){let e="",t=this.multiple?this.villageValue.length>0:this.villageValue;if(this.areaValue||t)if(this.areaValue){if(t){let e={aid:this.areaValue,vid:this.villageValue};return void this.$emit("registerPass",e)}e="请选择项目！"}else e="请选择大区！";else e="请选择大区和项目！";this.$message({type:"warning",message:e})}}},r=l,o=(s("40a5"),s("1805")),n=Object(o["a"])(r,a,i,!1,null,null,null);t["a"]=n.exports},c2de:function(e,t,s){"use strict";s("6ae0")},e90e:function(e,t,s){},f519:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"rentcar"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isRegister,expression:"!isRegister"}],staticClass:"pre-selection"},[t("area-village-select",{attrs:{title:"月租车登记"},on:{registerPass:e.registerPass}})],1),e.isRegister&&e.isLoading?t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"loading"}):e._e(),e.isRegister&&!e.isLoading?t("div",{staticClass:"main-wp"},[t("el-button",{staticClass:"query",attrs:{icon:"el-icon-search"},on:{click:function(t){e.isRegister=!1}}},[e._v(" 重新查询 ")]),t("div",{staticClass:"left-wp"},[t("div",{staticClass:"title"},[e._v("月租车登记")]),e.typeList&&0!=e.typeList.length?t("el-scrollbar",{staticStyle:{height:"calc(100% - 4.5rem)"}},[t("ul",{staticClass:"type-list"},e._l(e.typeList,(function(s,a){return t("li",{key:a,class:["type-item",s.active?"active":""],on:{click:function(t){return e.typeClick(s)}}},[t("i",{directives:[{name:"show",rawName:"v-show",value:s.active,expression:"item.active"}],staticClass:"el-icon-caret-right"}),t("div",{staticClass:"name"},[e._v(e._s(s.resourcestype.name))]),t("span",{staticClass:"num-wp"},[t("div",{staticClass:"num"},[e._v(e._s(s.num))]),t("div",{staticClass:"text"},[e._v("总计车位(个)")])]),t("span",{staticClass:"num-wp"},[t("div",{staticClass:"num"},[e._v(e._s(s.surplus_num))]),t("div",{staticClass:"text"},[e._v("剩余车位(个)")])])])})),0)]):t("div",{staticClass:"empty"},[e._v(" 暂无数据！ ")])],1),t("div",{staticClass:"right-wp"},[t("el-scrollbar",{staticStyle:{height:"100%"}},[0===e.typeList.length?t("div",{staticClass:"empty"},[e._v(" 请在左侧选择月租车位类型 ")]):t("div",[t("user-bind",{attrs:{vid:e.vid},on:{userSelected:e.userSelected}}),t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"客户姓名",prop:"uname"}},[t("el-input",{attrs:{placeholder:"请输入客户姓名",readonly:""},model:{value:e.ruleForm.uname,callback:function(t){e.$set(e.ruleForm,"uname",t)},expression:"ruleForm.uname"}})],1),t("el-form-item",{attrs:{label:"身份证号码",prop:"idcard"}},[t("el-input",{attrs:{placeholder:"请输入身份证号码",readonly:""},model:{value:e.ruleForm.idcard,callback:function(t){e.$set(e.ruleForm,"idcard",t)},expression:"ruleForm.idcard"}})],1),t("el-form-item",{attrs:{label:"客户类型",prop:"utype"}},[t("el-input",{attrs:{placeholder:"请输入客户类型",readonly:""},model:{value:e.ruleForm.utype,callback:function(t){e.$set(e.ruleForm,"utype",t)},expression:"ruleForm.utype"}})],1),t("el-form-item",{attrs:{label:"使用方式",prop:"method"}},[t("el-input",{attrs:{placeholder:"请输入使用方式",readonly:""},model:{value:e.ruleForm.method,callback:function(t){e.$set(e.ruleForm,"method",t)},expression:"ruleForm.method"}})],1),t("el-form-item",{attrs:{label:"联系电话",prop:"utel"}},[t("el-input",{attrs:{placeholder:"请输入联系电话"},model:{value:e.ruleForm.utel,callback:function(t){e.$set(e.ruleForm,"utel",t)},expression:"ruleForm.utel"}})],1),t("el-form-item",{attrs:{label:"收费科目",prop:"subject"}},[t("el-select",{attrs:{clearable:"",multiple:"","collapse-tags":"",placeholder:"请选择收费科目"},model:{value:e.ruleForm.subject,callback:function(t){e.$set(e.ruleForm,"subject",t)},expression:"ruleForm.subject"}},e._l(e.subOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"启用日期",prop:"stime"}},[t("el-date-picker",{attrs:{type:"date",align:"center","value-format":"timestamp",placeholder:"请选择启用日期"},model:{value:e.ruleForm.stime,callback:function(t){e.$set(e.ruleForm,"stime",t)},expression:"ruleForm.stime"}})],1),t("div",{staticClass:"title"},[e._v("绑定车牌")]),t("ul",{staticClass:"info-wp"},[e._l(e.ruleForm.plateInfo,(function(s,a){return t("li",{key:a},[e.ruleForm.plateInfo.length>1?t("i",{staticClass:"del el-icon-circle-close",on:{click:function(t){return e.delPlate(a)}}}):e._e(),t("el-form-item",{attrs:{label:"车牌号"+(a+1),prop:"plateInfo."+a+".plates",rules:{required:!0,message:"请输入车牌号",trigger:"blur"}}},[t("el-input",{attrs:{placeholder:"请输入车牌号"},model:{value:s.plates,callback:function(t){e.$set(s,"plates",t)},expression:"item.plates"}})],1)],1)})),t("li",{staticClass:"ico-wp"},[t("div",{staticClass:"info-item"},[t("i",{staticClass:"iconfont iconxinzeng",on:{click:e.addPlate}})])])],2),t("el-form-item",{staticClass:"remark",attrs:{label:"备注",prop:"remark"}},[t("el-input",{attrs:{type:"textarea",resize:"none",rows:3,placeholder:"请输入备注信息"},model:{value:e.ruleForm.remark,callback:function(t){e.$set(e.ruleForm,"remark",t)},expression:"ruleForm.remark"}})],1)],1),t("div",{staticClass:"btn-wp"},[e.$menu.getters.judgeRole("Btn-JXSZOSKbENpn0gaVbwxS0mfW")?t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.registerConfirm}},[e._v(" 确认登记 ")]):e._e()],1)],1)])],1)],1):e._e()])},i=[],l=(s("5948"),s("5532")),r=s("b48e"),o={name:"rentcar",components:{userBind:l["a"],areaVillageSelect:r["a"]},data(){return{urlObj:{monthParkInfo:this.$api.state.Means.monthParkInfo.url,addMonthCar:this.$api.state.Means.addMonthCar.url},aid:"",vid:"",isRegister:!1,isLoading:!1,typeList:"",remarkValue:"",isCommit:!1,ruleForm:{oid:"",uname:"",idcard:"",utype:"",method:"",utel:"",subject:[],stime:"",plateInfo:[{plates:""}],remark:""},rules:{uname:[{required:!0,message:"请输入客户姓名",trigger:"change"}],idcard:[{required:!0,message:"请输入身份证号码",trigger:"change"}],utype:[{required:!0,message:"请输入客户类型",trigger:"change"}],method:[{required:!0,message:"请输入使用方式",trigger:"change"}],utel:[{required:!0,message:"请输入联系电话",trigger:"change"}],subject:[{required:!0,message:"请选择收费科目",trigger:"change"}],stime:[{required:!0,message:"请选择启用日期",trigger:"change"}],remark:[{required:!1,message:"请输入备注信息",trigger:"blur"}]},typeOptions:[],subOptions:[]}},watch:{isRegister(e){if(e){let e=document.getElementById("means");e.classList.add("register")}else{let e=document.getElementById("means");e.classList.remove("register")}}},created(){},methods:{registerPass(e){this.aid=e.aid,this.vid=e.vid,this.isRegister=!0,this.typeList="",this.getMonthParkInfo()},getSubjectData(e){if(e){let t={vid:this.vid,resource_type_id:e};this.$axios.post(this.$api.state.Public.subjectbytype.url,t).then(e=>{if(200===e.Code)this.subOptions=e.Data;else{let t=e.Message?e.Message:"科目数据获取失败！";this.$message({type:"error",message:t})}}).catch(e=>{this.$message({type:"error",message:"科目数据获取失败！"})})}},getMonthParkInfo(){this.isLoading=!0,this.$axios.post(this.urlObj.monthParkInfo,{vid:this.vid}).then(e=>{if(200===e.Code)e.Data.forEach(e=>{e.active=!1}),e.Data.length>0&&(e.Data[0].active=!0,this.getSubjectData(e.Data[0].resources_type_id)),this.typeList=e.Data;else{let t=e.Message?e.Message:"月租车位信息获取失败！";this.$message({type:"error",message:t})}this.isLoading=!1}).catch(e=>{this.$message({type:"error",message:"月租车位信息获取失败！"}),this.isLoading=!1})},userSelected(e){this.ruleForm.oid=e.id,this.ruleForm.uname=e.realname,this.ruleForm.idcard=e.idcard,this.ruleForm.utype=e.owner_type.name,this.ruleForm.method="租用",this.ruleForm.utel=e.tel},addPlate(){let e={plates:""};this.ruleForm.plateInfo.push(e)},delPlate(e){this.ruleForm.plateInfo.splice(e,1)},registerConfirm(){this.$refs.ruleForm.validate(e=>{if(e){this.isCommit=!0;let e={oid:this.ruleForm.oid,vid:this.vid,starttime:this.ruleForm.stime/1e3,resources_type_id:this.typeList.find(e=>e.active).resources_type_id,non_owner_tel:this.ruleForm.utel,subject_village_arr:this.ruleForm.subject,remark:this.ruleForm.remark,plates:this.ruleForm.plateInfo.map(e=>e.plates)};this.registerRequst(e)}})},registerRequst(e){this.isCommit=!0,this.$axios.post(this.urlObj.addMonthCar,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:"登记成功！"}),this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.getMonthParkInfo();else{let t=e.Message?e.Message:"确认登记失败！";this.$message({type:"error",message:t})}this.isCommit=!1}).catch(e=>{this.$message({type:"error",message:"确认登记失败！"}),this.isCommit=!1})},typeClick(e){e.active||(this.typeList.forEach(e=>{e.active=!1}),e.active=!0,this.subOptions=[],this.ruleForm.plateInfo=[{plates:""}],this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.getSubjectData(e.resources_type_id))}}},n=o,u=(s("c2de"),s("1805")),c=Object(u["a"])(n,a,i,!1,null,null,null);t["default"]=c.exports}}]);