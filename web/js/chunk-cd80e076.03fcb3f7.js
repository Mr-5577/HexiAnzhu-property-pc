(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cd80e076"],{"1dc8":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"订单号","prop":"sn","show":true,"color":"#999","width":210},{"label":"资源名称","prop":"resources_name","show":true,"color":"#69da61"},{"label":"科目名称","prop":"subject_name","show":true,"color":"#999"},{"label":"客户姓名","prop":"owner_name","show":true},{"label":"联系电话","prop":"owner_tel","show":true,"color":"#999"},{"label":"交费周期","prop":"cycle","show":true,"color":"#999"},{"label":"金额","prop":"money","show":true,"color":"#ffcb3c"},{"label":"交费方式","prop":"payment_name","show":true},{"label":"交费时间","prop":"pay_time","show":true,"color":"#999"}]}')},"82bc":function(e,t,a){"use strict";a("9905")},9905:function(e,t,a){},ddab:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"charge-manage"}},[t("div",{staticClass:"top"},[t("div",{staticClass:"main"},[t("div",{staticClass:"common-left"},[t("span",{staticClass:"common-chose-info",on:{click:function(t){return e.$refs.showFilterVillage.showDialog()}}},[t("i",{staticClass:"iconfont icondaqu"}),e._v(" "+e._s(e.choseVillageInfo.name)+" ")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"请输入姓名/房号/车牌号/车位"},domProps:{value:e.searchVal},on:{input:function(t){t.target.composing||(e.searchVal=t.target.value)}}}),t("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.keySearch(!0)}}},[e._v(" 查询 ")])],1),t("div",{staticClass:"common-right"},[e.$menu.getters.judgeRole("Btn-3iFJEwSDprZnzw93tgxfs06X")?t("span",{on:{click:e.getExportData}},[t("workIcon",{staticClass:"common-right-icon",attrs:{name:"export",title:"导出"}})],1):e._e()])])]),t("div",{staticClass:"main-wp"},[t("div",{staticClass:"select-wp"},[t("el-select",{attrs:{clearable:"",placeholder:"请选择欠费科目"},on:{change:e.subjectChange},model:{value:e.subjectVal,callback:function(t){e.subjectVal=t},expression:"subjectVal"}},e._l(e.subOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),"rooms"==e.isRoom?t("el-select",{attrs:{clearable:"",placeholder:"请选择楼栋"},on:{change:e.buildChange},model:{value:e.buildVal,callback:function(t){e.buildVal=t},expression:"buildVal"}},e._l(e.buildOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.block,value:e.id}})})),1):e._e(),"rooms"==e.isRoom?t("el-select",{attrs:{clearable:"",placeholder:"请选择单元"},on:{change:e.tableLoad},model:{value:e.unitVal,callback:function(t){e.unitVal=t},expression:"unitVal"}},e._l(e.unitOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.unit,value:e.id}})})),1):e._e(),t("el-select",{attrs:{clearable:"",placeholder:"请选择缴费方式"},on:{change:e.tableLoad},model:{value:e.paymentVal,callback:function(t){e.paymentVal=t},expression:"paymentVal"}},e._l(e.paymentOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),t("el-date-picker",{attrs:{type:"daterange",align:"center","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:e.tableLoad},model:{value:e.dateValue,callback:function(t){e.dateValue=t},expression:"dateValue"}})],1),t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.tableData,cusColums:e.columns,cusConf:e.conf,ispaging:!0},on:{sizeChange:e.sizeChange,currentChange:e.currentChange}})],1)]),t("filter-village",{ref:"showFilterVillage",attrs:{vid:e.choseVillageInfo.vid},on:{choseInfo:e.filterVillage}})],1)},i=[],l=(a("5948"),a("1dc8")),o=a("4698"),n={name:"chargeManage",components:{workIcon:o["a"]},data(){return{urlObj:{searchpaycost:this.$api.state.Charge.searchpaycost.url,buildOfVillage:this.$api.state.Public.buildOfVillage.url,unitOfBuild:this.$api.state.Public.unitOfBuild.url,villageend:this.$api.state.Charge.villageend.url,checksubjecttype:this.$api.state.Charge.checksubjecttype.url,getpaymenttype:this.$api.state.Charge.getpaymenttype.url},searchVal:"",choseVillageInfo:{name:"全部项目",vid:0},subjectVal:"",subOptions:[],isRoom:!1,buildVal:"",buildOptions:[],unitVal:"",unitOptions:[],paymentVal:"",paymentOptions:[],dateValue:[],tableData:[],columns:l.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0}}},mounted(){let e=sessionStorage.getItem("vid"),t=sessionStorage.getItem("vname");e&&(this.choseVillageInfo.vid=e,this.choseVillageInfo.name=t),this.tableLoad(),this.getSubjectList(),this.getBuildList(),this.getPaymentType()},methods:{getSubjectList(){let e={vid:this.choseVillageInfo.vid};this.$axios.post(this.urlObj.villageend,e).then(e=>{if(200===e.Code)this.subOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取科目数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getBuildList(){let e={vid:this.choseVillageInfo.vid};this.$axios.post(this.urlObj.buildOfVillage,e).then(e=>{if(200===e.Code)this.buildOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取楼栋数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getUnitList(){let e={bid:this.buildVal};this.$axios.post(this.urlObj.unitOfBuild,e).then(e=>{if(200===e.Code)this.unitOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取单元数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getPaymentType(){let e={vid:this.choseVillageInfo.vid};this.$axios.post(this.urlObj.getpaymenttype,e).then(e=>{if(200===e.Code)this.paymentOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取支付方式失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},tableLoad(){this.conf.loadStatus=!0;let e={page:this.conf.curPage,limit:this.conf.limit,vid:this.choseVillageInfo.vid,subject_id:this.subjectVal,stime:this.dateValue&&this.dateValue[0]?this.dateValue[0]/1e3:"",etime:this.dateValue&&this.dateValue[0]?this.dateValue[0]/1e3:"",keywords:this.searchVal,payment_id:this.paymentVal,is_excel:0};"rooms"==this.isRoom&&(e.bid=this.buildVal,e.unit=this.unitVal),this.$axios.post(this.urlObj.searchpaycost,e).then(e=>{200===e.Code?(this.conf.dataTotal=e.Data.total,this.tableData=e.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=e.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},keySearch(){this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad(!0)},filterVillage(e){this.choseVillageInfo.name=e.name,this.choseVillageInfo.vid=e.vid,this.isRoom="",this.searchVal="",this.subjectVal="",this.subOptions=[],this.buildVal="",this.buildOptions=[],this.unitVal="",this.unitOptions=[],this.paymentVal="",this.paymentOptions=[],this.dateValue=[],this.keySearch(),this.getSubjectList(),this.getBuildList(),this.getPaymentType()},sizeChange(e){this.conf.limit=e,this.tableLoad()},currentChange(e){this.conf.curPage=e,this.tableLoad()},subjectChange(e){e?this.$axios.post(this.urlObj.checksubjecttype,{id:e}).then(e=>{if(200===e.Code)this.isRoom=e.Data,this.tableLoad();else{let t=e.Message?e.Message:"验证资源类型失败！";this.$message({message:t,type:"error"})}}).catch(()=>{}):(this.isRoom=!1,this.tableLoad())},buildChange(e){this.unitVal="",this.unitOptions=[],e&&this.getUnitList(),this.tableLoad()},getExportData(){let e={page:this.conf.curPage,limit:this.conf.limit,vid:this.choseVillageInfo.vid,subject_id:this.subjectVal,stime:this.dateValue&&this.dateValue[0]?this.dateValue[0]/1e3:"",etime:this.dateValue&&this.dateValue[0]?this.dateValue[0]/1e3:"",keywords:this.searchVal,payment_id:this.paymentVal,is_excel:1};"rooms"==this.isRoom&&(e.bid=this.buildVal,e.unit=this.unitVal),this.$axios.post(this.urlObj.searchpaycost,e).then(e=>{if(200===e.Code)this.exportExcel(e.Data);else{let t=e.Message?e.Message:"获取收费数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},exportExcel(e){let t="收费数据表",s=["订单号","资源名称","科目名称","客户姓名","联系电话","交费周期","金额","交费方式","交费时间"],i=e.map(e=>{let t=[e.sn,e.resources_name,e.subject_name,e.owner_name,e.owner_tel,e.cycle,e.money,e.payment_name,e.pay_time];return t});try{Promise.all([a.e("chunk-3a869cfb"),a.e("chunk-2a5081b0"),a.e("chunk-3a96421c")]).then((()=>{let{export_json_to_excel:e}=a("628d");e(s,i,t)}).bind(null,a)).catch(a.oe),this.$notify({type:"success",title:"温馨提示",message:"导出报表成功",duration:1500})}catch(l){this.$notify({type:"error",title:"温馨提示",message:"导出报表失败",duration:1500})}}}},c=n,h=(a("82bc"),a("1805")),r=Object(h["a"])(c,s,i,!1,null,null,null);t["default"]=r.exports}}]);