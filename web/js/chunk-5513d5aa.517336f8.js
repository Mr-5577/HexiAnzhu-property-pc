(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5513d5aa"],{"1e96":function(t,e,s){"use strict";s("4756")},4756:function(t,e,s){},"5df5":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{attrs:{id:"address-book"}},[e("div",{staticClass:"top"},[e("div",{staticClass:"main"},[e("div",{staticClass:"common-left"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"请输入关键字查询"},domProps:{value:t.searchVal},on:{change:t.keySearch,input:function(e){e.target.composing||(t.searchVal=e.target.value)}}}),e("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.keySearch}},[t._v(" 查询 ")])],1)])]),e("div",{staticClass:"main-wp"},[e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.tableData,cusColums:t.columns,cusConf:t.conf,ispaging:!0},on:{sizeChange:t.sizeChange,currentChange:t.currentChange,setAuth:t.setAuth,personAuth:t.personAuth,groupAuth:t.groupAuth,resetPass:t.resetPass}})],1)]),e("el-dialog",{staticClass:"editDialog",attrs:{visible:t.showDialog,title:"range"==t.optype?"权限范围设置":"person"==t.optype?"个人权限设置":"group"==t.optype?"分组权限设置":"",width:"60%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showDialog=e}}},[e("el-scrollbar",{directives:[{name:"loading",rawName:"v-loading",value:t.isloading,expression:"isloading"}],staticStyle:{height:"100%"}},[0===t.currentList.length?e("div",{staticClass:"empty"},[t._v("暂无数据！")]):"range"==t.optype?e("div",{staticClass:"tab-wp"},[e("div",{staticClass:"tab-tr"},[e("div",{staticClass:"th"},[t._v("一级分类")]),e("div",{staticClass:"th"},[t._v("二级分类")])]),e("div",{staticClass:"all-check"},[e("el-checkbox",{on:{change:e=>t.allChange(e,"r_id")},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v(" 全选/反选 ")])],1),t._l(t.currentList,(function(s,a){return e("div",{key:a,staticClass:"tab-tr"},[e("div",{staticClass:"tab-td"},[e("el-checkbox",{on:{change:e=>t.handleCheckAll(e,s,"r_id")},model:{value:s.is_check,callback:function(e){t.$set(s,"is_check",e)},expression:"item.is_check"}},[t._v(" "+t._s(s.r_name)+" ")])],1),e("div",{staticClass:"tab-td"},[e("el-checkbox-group",{on:{change:e=>t.handleChecked(e,s)},model:{value:s.checkids,callback:function(e){t.$set(s,"checkids",e)},expression:"item.checkids"}},t._l(s.child,(function(s){return e("el-checkbox",{key:s.r_id,attrs:{label:s.r_id}},[t._v(" "+t._s(s.r_name)+" ")])})),1)],1)])}))],2):"person"==t.optype?e("div",{staticClass:"tab-wp"},[e("div",{staticClass:"tab-tr"},[e("div",{staticClass:"th"},[t._v("权限菜单")]),e("div",{staticClass:"th"},[t._v("权限节点")])]),e("div",{staticClass:"all-check"},[e("el-checkbox",{on:{change:e=>t.allChange(e,"nid")},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v(" 全选/反选 ")])],1),t._l(t.currentList,(function(s,a){return e("div",{key:a,staticClass:"tab-tr"},[e("div",{staticClass:"tab-td"},[e("el-checkbox",{on:{change:e=>t.handleCheckAll(e,s,"nid")},model:{value:s.is_check,callback:function(e){t.$set(s,"is_check",e)},expression:"item.is_check"}},[t._v(" "+t._s(s.node_name)+" ")])],1),e("div",{staticClass:"tab-td"},[e("el-checkbox-group",{on:{change:e=>t.handleChecked(e,s)},model:{value:s.checkids,callback:function(e){t.$set(s,"checkids",e)},expression:"item.checkids"}},t._l(s.child,(function(s){return e("el-checkbox",{key:s.nid,attrs:{label:s.nid}},[t._v(" "+t._s(s.node_name)+" ")])})),1)],1)])}))],2):"group"==t.optype?e("div",{staticClass:"tab-wp"},[e("div",{staticClass:"tab-tr"},[e("div",{staticClass:"th"},[t._v("分组名称")]),e("div",{staticClass:"th"},[t._v("权限信息")])]),t._l(t.currentList,(function(s,a){return e("div",{key:a,staticClass:"tab-tr"},[e("div",{staticClass:"tab-td"},[e("el-checkbox",{model:{value:s.is_check,callback:function(e){t.$set(s,"is_check",e)},expression:"item.is_check"}},[t._v(" "+t._s(s.group_name)+" ")])],1),e("div",{staticClass:"tab-td"},t._l(s.node_arr,(function(s,a){return e("p",{key:a},[t._v(" "+t._s((s.node_name?s.node_name:"")+(s.node_info?"【"+s.node_info+"】":""))+" ")])})),0)])}))],2):t._e()]),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.editSave}},[t._v(" 保存修改 ")]),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showDialog=!1}}},[t._v(" 取消 ")])],1)],1)],1)},i=[],o=(s("5948"),s("b415")),l={name:"addressBook",data(){return{urlObj:{villageend:this.$api.state.Charge.villageend.url,userlist:this.$api.state.Addressbook.userlist.url,getuservillage:this.$api.state.Addressbook.getuservillage.url,saverange:this.$api.state.Addressbook.saverange.url,getusernode:this.$api.state.Addressbook.getusernode.url,savenode:this.$api.state.Addressbook.savenode.url,getusergroup:this.$api.state.Addressbook.getusergroup.url,savenodegroup:this.$api.state.Addressbook.savenodegroup.url,resetpass:this.$api.state.Addressbook.resetpass.url},searchVal:"",tableData:[],columns:o.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},currentObj:null,optype:"range",showDialog:!1,isloading:!1,currentList:[],checkAll:!1,isCommit:!1}},created(){this.tableLoad()},methods:{keySearch(){this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad()},tableLoad(){this.conf.loadStatus=!0;let t={page:this.conf.curPage,limit:this.conf.limit,keywords:this.searchVal};this.$axios.post(this.urlObj.userlist,t).then(t=>{200===t.Code?(t.Data.data.forEach((t,e)=>{t.index=(this.conf.curPage-1)*this.conf.limit+e+1}),this.conf.dataTotal=t.Data.total,this.tableData=t.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=t.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},sizeChange(t){this.conf.limit=t,this.tableLoad()},currentChange(t){this.conf.curPage=t,this.tableLoad()},setAuth(t){this.optype="range",this.currentObj=this.tableData[t],this.currentList=[],this.showDialog=!0,this.getRangeData()},personAuth(t){this.optype="person",this.currentObj=this.tableData[t],this.currentList=[],this.showDialog=!0,this.getPersonData()},groupAuth(t){this.optype="group",this.currentObj=this.tableData[t],this.currentList=[],this.showDialog=!0,this.getGroupData()},resetPass(t){this.optype="reset",this.currentObj=this.tableData[t],this.$confirm(`确定要重置用户【${this.currentObj.realname}】的密码吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$axios.post(this.urlObj.resetpass,{uid:this.currentObj.uid}).then(t=>{if(200===t.Code)this.$message({type:"success",message:"重置密码成功！"});else{let e=t.Message?t.Message:"重置密码失败！";this.$message({type:"error",message:e})}}).catch(()=>{})}).catch(()=>{})},getRangeData(){this.isloading=!0,this.$axios.post(this.urlObj.getuservillage,{uid:this.currentObj.uid}).then(t=>{if(200===t.Code){let e=[];t.Data&&t.Data.length>0&&t.Data.forEach(t=>{t.is_check&&e.push(t);let s=[];t.child.forEach(t=>{t.is_check&&s.push(t.r_id)}),t.checkids=s}),this.currentList=t.Data?t.Data:[],this.checkAll=e.length===this.currentList.length}else{let e=t.Message?t.Message:"获取权限范围数据失败！";this.$message({type:"error",message:e})}this.isloading=!1}).catch(()=>{this.isloading=!1})},getPersonData(){this.isloading=!0,this.$axios.post(this.urlObj.getusernode,{uid:this.currentObj.uid}).then(t=>{if(200===t.Code){let e=[];t.Data&&t.Data.length>0&&t.Data.forEach(t=>{t.is_check&&e.push(t);let s=[];t.child&&t.child.length>0&&t.child.forEach(t=>{t.is_check&&s.push(t.nid)}),t.checkids=s}),this.currentList=t.Data?t.Data:[],this.checkAll=e.length===this.currentList.length}else{let e=t.Message?t.Message:"获取个人权限数据失败！";this.$message({type:"error",message:e})}this.isloading=!1})},getGroupData(){this.isloading=!0,this.$axios.post(this.urlObj.getusergroup,{uid:this.currentObj.uid}).then(t=>{if(200===t.Code)this.currentList=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取分组权限数据失败！";this.$message({type:"error",message:e})}this.isloading=!1}).catch(()=>{this.isloading=!1})},handleCheckAll(t,e,s){e.checkids=t?e.child.map(t=>t[s]):[];let a=this.currentList.filter(t=>t.is_check);this.checkAll=a.length===this.currentList.length},handleChecked(t,e){e.is_check=t.length===e.child.length;let s=this.currentList.filter(t=>t.is_check);this.checkAll=s.length===this.currentList.length},allChange(t,e){t?this.currentList.forEach(s=>{s.is_check=t;let a=[];s.child.forEach(s=>{s.is_check=t,a.push(s[e])}),s.checkids=a}):this.currentList.forEach(e=>{e.is_check=t,e.checkids=[],e.child.forEach(e=>{e.is_check=t})})},editSave(){"range"===this.optype?this.rangeRequest():"person"===this.optype?this.personRequest():"group"===this.optype&&this.groupRequest()},rangeRequest(){this.isCommit=!0;let t=[];this.currentList.forEach(e=>{t=t.concat(e.checkids)});let e={uid:this.currentObj.uid,range_arr:t};this.$axios.post(this.urlObj.saverange,e).then(t=>{if(200===t.Code)this.$message({type:"success",message:"权限范围修改成功！"}),this.showDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:"权限范围修改失败！";this.$message({type:"error",message:e})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})},personRequest(){this.isCommit=!0;let t=[];this.currentList.forEach(e=>{t=t.concat(e.checkids)});let e={uid:this.currentObj.uid,node_arr:t};this.$axios.post(this.urlObj.savenode,e).then(t=>{if(200===t.Code)this.$message({type:"success",message:"个人权限修改成功！"}),this.showDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:"个人权限修改失败！";this.$message({type:"error",message:e})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})},groupRequest(){this.isCommit=!0;let t=[];this.currentList.forEach(e=>{e.is_check&&t.push(e.ngid)});let e={uid:this.currentObj.uid,nodegroup:t};this.$axios.post(this.urlObj.savenodegroup,e).then(t=>{if(200===t.Code)this.$message({type:"success",message:"分组权限修改成功！"}),this.showDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:"分组权限修改失败！";this.$message({type:"error",message:e})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}}},c=l,r=(s("1e96"),s("1805")),h=Object(r["a"])(c,a,i,!1,null,null,null);e["default"]=h.exports},b415:function(t){t.exports=JSON.parse('{"list":[{"label":"序号","prop":"index","show":true,"width":100},{"label":"姓名","prop":"realname","show":true,"width":100},{"label":"区域","prop":"dpb_deptname","show":true,"width":120,"color":"#999"},{"label":"公司","prop":"dpc_deptname","show":true,"color":"#999","width":200},{"label":"项目","prop":"dpp_deptname","show":true,"width":180},{"label":"部门","prop":"dp_deptname","show":true,"width":150},{"label":"岗位","prop":"posname","show":true,"color":"#999","width":150},{"label":"手机号码","prop":"mobile","show":true,"width":150,"color":"#999"},{"label":"权限分组","prop":"ngname","show":true,"width":180},{"label":"操作","width":400,"prop":"","type":"button","show":true,"fixed":"right","btns":[{"name":"权限范围","type":"primary","size":"small","round":true,"action":"setAuth","role":"setAuth","token":"empty"},{"name":"个人权限","type":"primary empty","size":"small","round":true,"action":"personAuth","role":"personAuth","token":"empty"},{"name":"分组权限","type":"warning","size":"small","round":true,"action":"groupAuth","role":"groupAuth","token":"empty"},{"name":"重置密码","type":"warning empty","size":"small","round":true,"action":"resetPass","role":"resetPass","token":"empty"}]}]}')}}]);