(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3ad7e275"],{"4a92":function(e,t,a){},"95e7":function(e,t,a){"use strict";a("4a92")},"99e5":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"invoice"}},[t("div",{staticClass:"top"},[t("div",{staticClass:"main"},[t("div",{staticClass:"common-left"},[1==e.modelVal?t("span",{staticClass:"common-chose-info",on:{click:function(t){return e.$refs.showFilterVillage.showDialog()}}},[t("workIcon",{attrs:{name:"build"}}),e._v(" "+e._s(e.choseVillageInfo.name)+" "),e.choseVillageInfo.vid?t("i",{staticClass:"close el-icon-circle-close",on:{click:function(t){t.stopPropagation(),e.choseVillageInfo={name:"全部项目",vid:0}}}}):e._e()],1):e._e(),t("el-select",{attrs:{placeholder:"请选择模式"},on:{change:e.modelChange},model:{value:e.modelVal,callback:function(t){e.modelVal=t},expression:"modelVal"}},[t("el-option",{attrs:{label:"明细模式",value:1}}),t("el-option",{attrs:{label:"汇总模式",value:2}})],1),t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"请输入票据单号"},domProps:{value:e.searchVal},on:{input:function(t){t.target.composing||(e.searchVal=t.target.value)}}}),t("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.keySearch(!0)}}},[e._v(" 查询 ")])],1),t("div",{staticClass:"common-right"},[this.$menu.getters.judgeRole("Btn-uqWieVe7m32wKriBWaItkTG6")?t("el-button",{attrs:{type:"primary",round:"",plain:"",icon:"iconfont iconxiugai"},on:{click:function(t){return e.dialogInit("entering")}}},[e._v(" 录入发票 ")]):e._e(),t("span",{staticClass:"ex-icon",on:{click:function(t){return e.$refs.cusTable.exportExcel()}}},[t("workIcon",{staticClass:"common-right-icon",attrs:{name:"export",title:"导出"}})],1)],1)])]),t("div",{staticClass:"main-wp"},[t("div",{staticClass:"select-wp"},[1==e.modelVal?t("el-select",{attrs:{clearable:"",placeholder:"请选择发票状态"},on:{change:e.tableLoad},model:{value:e.statusVal,callback:function(t){e.statusVal=t},expression:"statusVal"}},e._l(e.statusOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):e._e(),t("el-select",{attrs:{clearable:"",placeholder:"请选择审核状态"},on:{change:e.tableLoad},model:{value:e.auditVal,callback:function(t){e.auditVal=t},expression:"auditVal"}},[t("el-option",{attrs:{label:"未审核",value:1}}),t("el-option",{attrs:{label:"已通过",value:2}}),t("el-option",{attrs:{label:"已驳回",value:3}})],1),t("el-select",{attrs:{clearable:"",placeholder:"请选择发票面值"},on:{change:e.tableLoad},model:{value:e.faceVal,callback:function(t){e.faceVal=t},expression:"faceVal"}},e._l(e.faceOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),1==e.modelVal?t("el-date-picker",{attrs:{type:"daterange","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:e.tableLoad},model:{value:e.dateVal,callback:function(t){e.dateVal=t},expression:"dateVal"}}):e._e(),1==e.modelVal&&this.$menu.getters.judgeRole("Btn-XmjOfoiI0fW0gzqC1Lveo3fY")?t("el-button",{attrs:{type:"primary",round:""},on:{click:function(t){return e.dialogInit("custom")}}},[e._v(" 自定义发放 ")]):e._e()],1),t("div",{staticClass:"table-wp"},[t("cus-table",{ref:"cusTable",attrs:{title:1==e.modelVal?"定额发票明细表":"定额发票汇总表",datas:e.tableData,cusColums:e.columns,cusConf:e.conf,check:!0,ispaging:!0},on:{sizeChange:e.sizeChange,currentChange:e.currentChange,enterPass:e.enterPass,enterReject:e.enterReject,cancelPass:e.cancelPass,cancelReject:e.cancelReject,send:e.invoiceSend,turnover:e.turnOver,selectionChange:e.selectionChange,auditPass:e.auditPass,auditReject:e.auditReject}}),1==e.modelVal?t("div",{staticClass:"btn-wp"},[t("el-scrollbar",{staticStyle:{width:"100%",height:"2.75rem"}},[this.$menu.getters.judgeRole("Btn-XmjOfoiI0fW0gzqC1Lveo3fY")?t("el-button",{attrs:{type:"primary",disabled:0==e.tableSelected.length,round:""},on:{click:e.batchSend}},[e._v(" 发放已选("+e._s(e.tableSelected.length)+")本 ")]):e._e(),this.$menu.getters.judgeRole("Btn-O3YVRDw40KkuuSnt4osbqk49")?t("el-button",{staticClass:"empty",attrs:{disabled:0==e.tableSelected.length,type:"primary",round:""},on:{click:e.batchTurn}},[e._v(" 移交已选("+e._s(e.tableSelected.length)+")本 ")]):e._e(),this.$menu.getters.judgeRole("Btn-YtoO8p5SN3qFjwyyinA36YZV")?t("el-button",{staticClass:"empty",attrs:{disabled:0==e.tableSelected.length,type:"primary",round:""},on:{click:e.batchAudit}},[e._v(" 录入审批("+e._s(e.tableSelected.length)+")本 ")]):e._e(),this.$menu.getters.judgeRole("Btn-Up6M61GGH2Pk8yq2vsNPpAVJ")?t("el-button",{staticClass:"empty",attrs:{disabled:0==e.tableSelected.length,type:"primary",round:""},on:{click:e.cancelAudit}},[e._v(" 缴销审批("+e._s(e.tableSelected.length)+")本 ")]):e._e()],1)],1):t("div",{staticClass:"btn-wp"},[this.$menu.getters.judgeRole("Btn-XmjOfoiI0fW0gzqC1Lveo3fY")?t("el-button",{staticClass:"empty",attrs:{type:"primary",disabled:0==e.tableSelected.length,round:""},on:{click:function(t){return e.auditHandle(!0)}}},[e._v(" 批量通过(共"+e._s(e.tableSelected.length)+")本 ")]):e._e(),this.$menu.getters.judgeRole("Btn-O3YVRDw40KkuuSnt4osbqk49")?t("el-button",{staticClass:"empty",attrs:{disabled:0==e.tableSelected.length,type:"warning",round:""},on:{click:function(t){return e.auditHandle(!1)}}},[e._v(" 批量驳回(共"+e._s(e.tableSelected.length)+")本 ")]):e._e()],1)],1)]),t("filter-village",{ref:"showFilterVillage",attrs:{vid:e.choseVillageInfo.vid},on:{choseInfo:e.filterVillage}}),t("el-dialog",{class:["entering"==e.type?"entering":"custom"==e.type?"custom":"grant"],attrs:{visible:e.showDialog,title:e.dialogTitle,width:"36%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showDialog=t}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("div",{staticClass:"form-wp"},[t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"hide-required-asterisk":!0}},["entering"==e.type||"custom"==e.type?t("el-form-item",{attrs:{label:"发票代码",prop:"code"}},[t("el-input",{attrs:{placeholder:"请输入发票代码"},on:{change:e.checkbill},model:{value:e.ruleForm.code,callback:function(t){e.$set(e.ruleForm,"code",t)},expression:"ruleForm.code"}})],1):e._e(),"entering"==e.type?t("el-form-item",{attrs:{label:"发票面值",prop:"faceValue"}},[t("el-input",{attrs:{type:"number",placeholder:"请输入发票面值"},model:{value:e.ruleForm.faceValue,callback:function(t){e.$set(e.ruleForm,"faceValue",t)},expression:"ruleForm.faceValue"}})],1):e._e(),"custom"==e.type?t("el-form-item",{attrs:{label:"发票面值",prop:"faceVal"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择发票面值"},on:{change:e.checkbill},model:{value:e.ruleForm.faceVal,callback:function(t){e.$set(e.ruleForm,"faceVal",t)},expression:"ruleForm.faceVal"}},e._l(e.faceOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"entering"==e.type||"custom"==e.type?t("el-form-item",{attrs:{label:"首张单号",prop:"first"}},[t("el-input",{attrs:{placeholder:"请输入首张单号"},on:{change:e.checkbill},model:{value:e.ruleForm.first,callback:function(t){e.$set(e.ruleForm,"first",t)},expression:"ruleForm.first"}})],1):e._e(),"entering"==e.type||"custom"==e.type?t("el-form-item",{attrs:{label:"末张单号",prop:"last"}},[t("el-input",{attrs:{placeholder:"请输入末张单号"},on:{change:e.checkbill},model:{value:e.ruleForm.last,callback:function(t){e.$set(e.ruleForm,"last",t)},expression:"ruleForm.last"}})],1):e._e(),"entering"==e.type?t("el-form-item",{attrs:{label:"本数",prop:"number"}},[t("el-input",{attrs:{type:"number",placeholder:"请输入发票本数"},model:{value:e.ruleForm.number,callback:function(t){e.$set(e.ruleForm,"number",t)},expression:"ruleForm.number"}})],1):e._e(),"entering"==e.type?t("el-form-item",{attrs:{label:"发放大区",prop:"area"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择发放大区"},model:{value:e.ruleForm.area,callback:function(t){e.$set(e.ruleForm,"area",t)},expression:"ruleForm.area"}},e._l(e.areaOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),"entering"==e.type?t("el-form-item",{attrs:{label:"审核人员",prop:"auditor"}},[t("el-select",{attrs:{clearable:"",filterable:"",remote:"",placeholder:"请输入审核人姓名","remote-method":e.remoteMethod,loading:e.isLoading},model:{value:e.ruleForm.auditor,callback:function(t){e.$set(e.ruleForm,"auditor",t)},expression:"ruleForm.auditor"}},e._l(e.auditorOptions,(function(e){return t("el-option",{key:e.uid,attrs:{label:`${e.company.shortname?e.company.shortname:e.company.deptname} - ${e.realname} - ${e.position.posname}`,value:e.uid}})})),1)],1):e._e(),"entering"!=e.type?t("el-form-item",{attrs:{label:"发放项目",prop:"village"}},[t("el-select",{attrs:{placeholder:"请选择发放项目",clearable:""},on:{change:e.villageChange},model:{value:e.ruleForm.village,callback:function(t){e.$set(e.ruleForm,"village",t)},expression:"ruleForm.village"}},e._l(e.villageOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.villagename,value:e.id}})})),1)],1):e._e(),"entering"!=e.type?t("el-form-item",{attrs:{label:"领用人员",prop:"user"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择领用人员"},model:{value:e.ruleForm.user,callback:function(t){e.$set(e.ruleForm,"user",t)},expression:"ruleForm.user"}},e._l(e.userOptions,(function(e){return t("el-option",{key:e.uid,attrs:{label:e.realname,value:e.uid}})})),1)],1):e._e()],1),"custom"==e.type?t("div",{staticClass:"num-wp"},[t("div",{staticClass:"sheet"},[e._v(" 总计本数: "),t("span",[e._v(e._s(e.sheetNum))])]),t("div",{staticClass:"total"},[e._v(" 总计数量: "),t("span",[e._v(e._s(e.total))])])]):e._e()],1)]),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.formSubmit}},[e._v(" 提交保存 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showDialog=!1}}},[e._v(" 取消 ")])],1)],1),t("el-dialog",{staticClass:"auditDialog",attrs:{visible:e.showAuditDialog,title:e.isAlone?"发票审批":"批量审批",width:"36%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showAuditDialog=t}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[e.isAlone?e._e():t("div",{staticClass:"title"},[e._v(" 确定"+e._s(e.isPass?"通过":"驳回")+" "),t("span",[e._v("已选"+e._s(e.tableSelected.length)+"本")]),e._v(" 发票吗？ ")]),t("div",{staticClass:"name"},[e._v("审核附言")]),t("el-input",{attrs:{type:"textarea",resize:"none",rows:4},model:{value:e.auditRemark,callback:function(t){e.auditRemark=t},expression:"auditRemark"}})],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.auditSubmit}},[e._v(" "+e._s(e.isPass?"确认通过":"确认驳回")+" ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showAuditDialog=!1}}},[e._v(" 取消 ")])],1)],1)],1)},i=[],l=(a("5948"),a("4698")),r=a("a8e5"),o=a("af42"),n={name:"invoice",components:{workIcon:l["a"]},data(){return{urlObj:{invoiceList:this.$api.state.Setting.invoiceList.url,mainlist:this.$api.state.Setting.mainlist.url,addquo:this.$api.state.Setting.addquo.url,examinemain:this.$api.state.Setting.examinemain.url,getfacevalue:this.$api.state.Charge.getfacevalue.url,addBill:this.$api.state.Setting.addBill.url,grantBill:this.$api.state.Setting.grantBill.url,customGrant:this.$api.state.Setting.customGrant.url,searchuser:this.$api.state.Setting.searchuser.url,getcollaruser:this.$api.state.Setting.getcollaruser.url,getAreas:this.$api.state.Public.getAreas.url,userVillage:this.$api.state.Public.userVillage.url,checkbill:this.$api.state.Setting.checkbill.url,examine:this.$api.state.Setting.examine.url,transferuser:this.$api.state.Setting.transferuser.url,examinecancel:this.$api.state.Setting.examinecancel.url},choseVillageInfo:{name:"全部项目",vid:0},searchVal:"",modelVal:1,tableData:[],columns:r.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},statusVal:"",auditVal:"",statusOptions:[{value:0,label:"未领取"},{value:1,label:"已领取"},{value:2,label:"已提交"},{value:3,label:"已缴销"}],faceVal:"",faceOptions:[],dateVal:"",type:"",showDialog:!1,dialogTitle:"",ruleForm:{code:"",faceValue:"",faceVal:"",first:"",last:"",number:"",area:"",auditor:"",village:"",user:""},rules:{code:[{required:!0,message:"请输入发票代码",trigger:"blur"}],faceValue:[{required:!0,message:"请输入发票面值",trigger:"blur"}],faceVal:[{required:!0,message:"请选择发票面值",trigger:"change"}],first:[{required:!0,message:"请输入首张单号",trigger:"blur"}],last:[{required:!0,message:"请输入末张单号",trigger:"blur"}],number:[{required:!0,message:"请输入发票本数",trigger:"blur"}],area:[{required:!0,message:"请选择发放大区",trigger:"change"}],auditor:[{required:!0,message:"请选择审核人员",trigger:"change"}],village:[{required:!0,message:"请选择发放项目",trigger:"change"}],user:[{required:!0,message:"请选择领用人员",trigger:"change"}]},tableSelected:[],auditorOptions:[],isLoading:!1,areaOptions:[],villageOptions:[],userOptions:[],isBatch:!1,currentData:"",isexist:!1,sheetNum:0,total:0,isCommit:!1,turnOverIds:[],showAuditDialog:!1,isAlone:!0,isPass:!0,auditIndex:"",auditRemark:""}},mounted(){this.tableLoad(),this.getFaceValue()},methods:{filterVillage(e){this.choseVillageInfo.name=e.name,this.choseVillageInfo.vid=e.vid,this.keySearch()},getFaceValue(){this.$axios.post(this.urlObj.getfacevalue).then(e=>{if(200===e.Code){let t=[];Object.keys(e.Data).forEach(a=>{let s={value:a,label:e.Data[a]};t.push(s)}),this.faceOptions=t}else{let t=e.Message?e.Message:"获取面值数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},checkbill(){if("custom"==this.type&&this.ruleForm.code&&this.ruleForm.faceVal&&this.ruleForm.first&&this.ruleForm.last){let e={face_value:this.ruleForm.faceVal,first:this.ruleForm.first,last:this.ruleForm.last,fpdm:this.ruleForm.code};this.$axios.post(this.urlObj.checkbill,e).then(e=>{if(200===e.Code)this.isexist=!0,this.sheetNum=e.Data.count,this.total=e.Data.num;else{let t=e.Message?e.Message:"发票不存在";this.$message({type:"error",message:t}),this.isexist=!1}})}},modelChange(){this.searchVal="",this.statusVal="",this.auditVal="",this.faceVal="",this.dateVal=[],this.tableData=[],this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad()},tableLoad(){this.conf.loadStatus=!0;let e=1==this.modelVal?this.urlObj.invoiceList:this.urlObj.mainlist,t={page:this.conf.curPage,limit:this.conf.limit,keywords:this.searchVal};1==this.modelVal?(this.columns=r.list,t.vid=this.choseVillageInfo.vid,(0===this.statusVal||this.statusVal)&&(t.status=this.statusVal),(0===this.faceVal||this.faceVal)&&(t.face_value=this.faceVal),this.dateVal&&this.dateVal[0]&&this.dateVal[1]&&(t.time={stime:this.dateVal[0]/1e3,etime:this.dateVal[1]/1e3}),this.auditVal&&(t.examine_status=this.auditVal)):(this.columns=o.list,this.auditVal&&(t.status=this.auditVal),(0===this.faceVal||this.faceVal)&&(t.face_value=this.faceVal)),this.$axios.post(e,t).then(e=>{200===e.Code?(e.Data.data&&e.Data.data.length>0&&(1==this.modelVal?e.Data.data.forEach(e=>{e.gname=e.grantor?e.grantor.realname:"-",e.vname=e.village?e.village.villagename:"-",e.user=e.examiner?e.examiner.realname:"-",e.passHide=0!=e.examine_status||0==e.examine_bottom,e.rejectHide=0!=e.examine_status||0==e.examine_bottom,e.sendHide=0!=e.status||1!=e.examine_status,e.turnHide=1!=e.status,e.cpassHide=2!=e.status,e.crejectHide=2!=e.status}):e.Data.data.forEach(e=>{e.areaName=e.area&&e.area.deptname?e.area.deptname:"",e.rname=e.recorder&&e.recorder.realname?e.recorder.realname:"",e.ename=e.examiner&&e.examiner.realname?e.examiner.realname:"",e.statusColor=0==e.status?"#ffcb3c":1==e.status?"#69da61":2==e.status?"#f56c6c":"#333",e.passHide=0!=e.status||0==e.examine_bottom,e.rejectHide=0!=e.status||0==e.examine_bottom})),this.conf.dataTotal=e.Data.total,this.tableData=e.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=e.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},keySearch(){this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad(!0)},sizeChange(e){this.conf.limit=e,this.tableLoad()},currentChange(e){this.conf.curPage=e,this.tableLoad()},selectionChange(e){this.tableSelected=e},auditRequest(e,t){let a={ids:t,status:e};this.$axios.post(this.urlObj.examine,a).then(t=>{if(200===t.Code)this.$message({type:"success",message:1==e?"录入申请已通过！":"录入申请已驳回！"}),this.tableLoad();else{let a=1==e?"录入申请通过失败！":"录入申请拒绝失败！",s=t.Message?t.Message:a;this.$message({type:"error",message:s})}}).catch(()=>{})},cancelRequest(e,t){let a={ids:t,status:e};this.$axios.post(this.urlObj.examinecancel,a).then(t=>{if(200===t.Code)this.$message({type:"success",message:1==e?"缴销申请已通过！":"缴销申请已驳回！"}),this.tableLoad();else{let a=1==e?"缴销申请通过失败！":"缴销申请拒绝失败！",s=t.Message?t.Message:a;this.$message({type:"error",message:s})}}).catch(()=>{})},invoiceSend(e){this.isBatch=!1,this.currentData=this.tableData[e],this.dialogInit("grant")},enterPass(e){this.$confirm("确定要通过当前录入申请吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.auditRequest(1,[this.tableData[e].id])}).catch(()=>{})},enterReject(e){this.$confirm("确定要驳回当前录入申请吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.auditRequest(2,[this.tableData[e].id])}).catch(()=>{})},cancelPass(e){this.$confirm("确定要通过当前缴销申请吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.cancelRequest(1,[this.tableData[e].id])}).catch(()=>{})},cancelReject(e){this.$confirm("确定要驳回当前缴销申请吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.cancelRequest(2,[this.tableData[e].id])}).catch(()=>{})},turnOver(e){this.turnOverIds=[this.tableData[e].id],this.dialogInit("turn")},batchSend(){this.isBatch=!0,this.dialogInit("grant")},batchTurn(){this.turnOverIds=this.tableSelected.map(e=>e.id),this.dialogInit("turn")},batchAudit(){this.$confirm("此操作将对发票的录入进行批量处理，点击按钮继续","提示",{distinguishCancelAndClose:!0,confirmButtonText:"批量通过",cancelButtonText:"批量驳回",type:"warning"}).then(()=>{let e=this.tableSelected.map(e=>e.id);this.auditRequest(1,e)}).catch(e=>{if("cancel"==e){let e=this.tableSelected.map(e=>e.id);this.auditRequest(2,e)}})},cancelAudit(){this.$confirm("此操作将对发票的缴销进行批量处理，点击按钮继续","提示",{distinguishCancelAndClose:!0,confirmButtonText:"批量通过",cancelButtonText:"批量驳回",type:"warning"}).then(()=>{let e=this.tableSelected.map(e=>e.id);this.cancelRequest(1,e)}).catch(e=>{if("cancel"==e){let e=this.tableSelected.map(e=>e.id);this.cancelRequest(2,e)}})},getAreaList(){this.$axios.post(this.urlObj.getAreas).then(e=>{if(200===e.Code)this.areaOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取大区数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getVillageList(){this.$axios.post(this.urlObj.userVillage).then(e=>{if(200===e.Code)this.villageOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取项目数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},remoteMethod(e){""!==e?(this.isLoading=!0,this.$axios.post(this.urlObj.searchuser,{keywords:e}).then(e=>{if(200===e.Code)this.auditorOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"搜索审核人员失败！";this.$message({message:t,type:"error"})}this.isLoading=!1}).catch(()=>{this.isLoading=!1})):this.auditorOptions=[]},getUserList(e){this.$axios.post(this.urlObj.getcollaruser,{vid:e}).then(e=>{if(200===e.Code)this.userOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取领用人员数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},villageChange(e){this.ruleForm.user="",this.userOptions=[],e&&this.getUserList(e)},dialogInit(e){switch(this.type=e,this.auditorOptions=[],this.areaOptions=[],this.villageOptions=[],this.userOptions=[],this.sheetNum=0,this.total=0,e){case"entering":this.dialogTitle="录入发票",this.getAreaList();break;case"custom":this.dialogTitle="自定义发放",this.getVillageList();break;case"grant":this.dialogTitle="发票发放",this.getVillageList();break;case"turn":this.dialogTitle="发票移交",this.getVillageList();break}this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.showDialog=!0},formSubmit(){this.$refs.ruleForm.validate(e=>{if(e){this.isCommit=!0;let e="",t={};switch(this.type){case"entering":t={fpdm:this.ruleForm.code,face_value:this.ruleForm.faceValue,first:this.ruleForm.first,last:this.ruleForm.last,copies:this.ruleForm.number,collar_area:this.ruleForm.area,examine_uid:this.ruleForm.auditor},e=this.urlObj.addquo;break;case"custom":if(!this.isexist)return this.$message({type:"warning",message:"票据不存在！"}),void(this.isCommit=!1);t={fpdm:this.ruleForm.code,face_value:this.ruleForm.faceVal,first:this.ruleForm.first,last:this.ruleForm.last,vid:this.ruleForm.village,uid:this.ruleForm.user},e=this.urlObj.customGrant;break;case"grant":let a=[];a=this.isBatch?this.tableSelected.map(e=>e.id):[this.currentData.id],t={ids:a,vid:this.ruleForm.village,uid:this.ruleForm.user},e=this.urlObj.grantBill;break;case"turn":t={ids:this.turnOverIds,vid:this.ruleForm.village,uid:this.ruleForm.user},e=this.urlObj.transferuser;break}this.submitRequest(e,t)}})},submitRequest(e,t){this.$axios.post(e,t).then(e=>{if(200===e.Code)this.$message({message:"entering"==this.type?"发票录入成功！":"custom"==this.type?"自定义发放成功！":"turn"==this.type?"发票移交成功！":"发票发放成功！",type:"success"}),this.showDialog=!1,this.tableLoad();else{let t="entering"==this.type?"发票录入失败！":"custom"==this.type?"自定义发放失败！":"turn"==this.type?"发票移交失败！":"发票发放失败！",a=e.Message?e.Message:t;this.$message({message:a,type:"error"})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})},auditPass(e){this.auditIndex=e,this.isAlone=!0,this.isPass=!0,this.auditRemark="",this.showAuditDialog=!0},auditReject(e){this.auditIndex=e,this.isAlone=!0,this.isPass=!1,this.auditRemark="",this.showAuditDialog=!0},auditHandle(e){this.isAlone=!1,this.isPass=e,this.auditRemark="",this.tableSelected.every(e=>0==e.status)&&0!=this.tableSelected[0].examine_bottom?this.showAuditDialog=!0:this.$message({type:"warning",message:"存在已审批的数据或不具备审批权限！"})},auditSubmit(){this.isCommit=!0;let e=[];e=this.isAlone?[this.tableData[this.auditIndex].id]:this.tableSelected.map(e=>e.id);let t={ids:e,status:this.isPass?1:2,status_remarks:this.auditRemark};this.$axios.post(this.urlObj.examinemain,t).then(e=>{if(200===e.Code)this.$message({message:this.isPass?"审批已通过！":"审批已驳回！",type:"success"}),this.showAuditDialog=!1,this.tableLoad();else{let t=e.Message?e.Message:this.isPass?"审批通过失败！":"审批驳回失败！";this.$message({message:t,type:"error"})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}}},c=n,u=(a("95e7"),a("1805")),h=Object(u["a"])(c,s,i,!1,null,null,null);t["default"]=h.exports},a8e5:function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"发票编码","prop":"fpdm","show":true},{"label":"首张单号","prop":"first","show":true,"color":"#999"},{"label":"末张单号","prop":"last","show":true,"color":"#999"},{"label":"面值","prop":"face_value","show":true},{"label":"数量","prop":"num","show":true,"color":"#69da61"},{"label":"金额","prop":"count_money","show":true,"color":"#ffcb3c"},{"label":"状态","prop":"status_text","show":true},{"label":"发放人","prop":"gname","show":true,"color":"#999"},{"label":"领用时间","prop":"collar_time","show":true,"color":"#999"},{"label":"领用项目","prop":"vname","show":true},{"label":"录入审核人","prop":"user","show":true},{"label":"操作","prop":"","width":200,"type":"button","show":true,"btns":[{"name":"通过","type":"primary empty","size":"small","round":true,"action":"enterPass","role":"enterPass","hide":"passHide","token":"Btn-YtoO8p5SN3qFjwyyinA36YZV"},{"name":"驳回","type":"danger empty","size":"small","round":true,"action":"enterReject","role":"enterReject","hide":"rejectHide","token":"Btn-YtoO8p5SN3qFjwyyinA36YZV"},{"name":"通过","type":"primary empty","size":"small","round":true,"action":"cancelPass","role":"cancelPass","hide":"cpassHide","token":"Btn-Up6M61GGH2Pk8yq2vsNPpAVJ"},{"name":"驳回","type":"danger empty","size":"small","round":true,"action":"cancelReject","role":"cancelReject","hide":"crejectHide","token":"Btn-Up6M61GGH2Pk8yq2vsNPpAVJ"},{"name":"发放","type":"primary","size":"small","round":true,"action":"send","role":"send","hide":"sendHide","token":"Btn-XmjOfoiI0fW0gzqC1Lveo3fY"},{"name":"移交","type":"warning","size":"small","round":true,"action":"turnover","role":"turnover","hide":"turnHide","token":"Btn-O3YVRDw40KkuuSnt4osbqk49"}]}]}')},af42:function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"发票编码","prop":"fpdm","show":true},{"label":"首张单号","prop":"first","show":true,"color":"#999"},{"label":"末张单号","prop":"last","show":true,"color":"#999"},{"label":"面值","prop":"face_value","show":true,"color":"#ffcb3c"},{"label":"本数","prop":"num","show":true},{"label":"发放大区","prop":"areaName","show":true,"color":"#999"},{"label":"录入人","prop":"rname","show":true,"color":"#999"},{"label":"审核人","prop":"ename","show":true,"color":"#999"},{"label":"审核状态","prop":"status_text","show":true,"cstcolor":"statusColor"},{"label":"审核备注","prop":"status_remarks","show":true,"color":"#999"},{"label":"操作","prop":"","width":200,"type":"button","show":true,"btns":[{"name":"通过","type":"primary empty","size":"small","round":true,"action":"auditPass","role":"auditPass","hide":"passHide","token":"empty"},{"name":"驳回","type":"danger empty","size":"small","round":true,"action":"auditReject","role":"auditReject","hide":"rejectHide","token":"empty"}]}]}')}}]);