(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-48ab8d1e"],{"0f90":function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var o=null;function s(){try{var t=navigator.userAgent;if(null!=t.match(/Windows\sPhone/i))return!0;if(null!=t.match(/iPhone|iPod/i))return!0;if(null!=t.match(/Android/i))return!0;if(null!=t.match(/Edge\D?\d+/i))return!0;var e=t.match(/Trident\D?\d+/i),a=t.match(/MSIE\D?\d+/i),o=t.match(/OPR\D?\d+/i),s=t.match(/Firefox\D?\d+/i),l=t.match(/x64/i);if(null==e&&null==a&&null!==l)return!0;if(null!==s){if(s=s[0].match(/\d+/),s[0]>=41||null!==l)return!0}else if(null!==o){if(o=o[0].match(/\d+/),o[0]>=32)return!0}else if(null==e&&null==a){var i=t.match(/Chrome\D?\d+/i);if(null!==i&&(i=i[0].match(/\d+/),i[0]>=41))return!0}return!1}catch(n){return!0}}if(s()){var l=document.head||document.getElementsByTagName("head")[0]||document.documentElement,i=document.createElement("script");i.src="http://localhost:8000/CLodopfuncs.js?priority=1",l.insertBefore(i,l.firstChild),i=document.createElement("script"),i.src="http://localhost:18000/CLodopfuncs.js?priority=0",l.insertBefore(i,l.firstChild)}function n(t,e){var a,l="<br><font color='#FF00FF'>打印控件未安装!点击这里<a href='http://www.lodop.net/download.html' target='_blank'>执行安装</a>,安装后请刷新页面或重新进入。</font>",i="<br><font color='#FF00FF'>打印控件需要升级!点击这里<a href='http://www.lodop.net/download.html' target='_blank'>执行升级</a>,升级后请重新进入。</font>",n="<br><font color='#FF00FF'>打印控件未安装!点击这里<a href='http://www.lodop.net/download.html' target='_blank'>执行安装</a>,安装后请刷新页面或重新进入。</font>",r="<br><font color='#FF00FF'>打印控件需要升级!点击这里<a href='http://www.lodop.net/download.html' target='_blank'>执行升级</a>,升级后请重新进入。</font>",c="<br><br><font color='#FF00FF'>（注意：如曾安装过Lodop旧版附件npActiveXPLugin,请在【工具】->【附加组件】->【扩展】中先卸它）</font>",h="<br><br><font color='#FF00FF'>(如果此前正常，仅因浏览器升级或重安装而出问题，需重新执行以上安装）</font>",d="<br><font color='#FF00FF'>CLodop云打印服务(localhost本地)未安装启动!点击这里<a href='http://www.lodop.net/download.html' target='_blank'>执行安装</a>,安装后请刷新页面。</font>",p="<br><font color='#FF00FF'>CLodop云打印服务需升级!点击这里<a href='http://www.lodop.net/download.html' target='_blank'>执行升级</a>,升级后请刷新页面。</font>";try{var u=navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident")>=0;if(s()){try{a=getCLodop()}catch(f){}if(!a&&"complete"!==document.readyState)return void alert("C-Lodop没准备好，请稍后再试！");if(!a)return void(u?document.write(d):document.body.innerHTML=d+document.body.innerHTML);CLODOP.CVERSION<"3.0.2.8"&&(u?document.write(p):document.body.innerHTML=p+document.body.innerHTML),e&&e.parentNode&&e.parentNode.removeChild(e),t&&t.parentNode&&t.parentNode.removeChild(t)}else{var m=u&&navigator.userAgent.indexOf("x64")>=0;if(void 0!=t||void 0!=e?a=u?t:e:null==o?(a=document.createElement("object"),a.setAttribute("width",0),a.setAttribute("height",0),a.setAttribute("style","position:absolute;left:0px;top:-100px;width:0px;height:0px;"),u?a.setAttribute("classid","clsid:2105C259-1E0C-4534-8141-A753534CB4CA"):a.setAttribute("type","application/x-print-lodop"),document.documentElement.appendChild(a),o=a):a=o,null==a||"undefined"==typeof a.VERSION)return navigator.userAgent.indexOf("Chrome")>=0&&(document.body.innerHTML=h+document.body.innerHTML),navigator.userAgent.indexOf("Firefox")>=0&&(document.body.innerHTML=c+document.body.innerHTML),m?document.write(n):u?document.write(l):document.body.innerHTML=l+document.body.innerHTML,a}return a.VERSION<"6.2.2.0"?(s()||(m?document.write(r):u?document.write(i):document.body.innerHTML=i+document.body.innerHTML),a):a}catch(f){alert("getLodop出错:"+f)}}},"1fdc":function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"首张单号","prop":"first","show":true,"color":"#999"},{"label":"末张单号","prop":"last","show":true},{"label":"面值","prop":"face_value","show":true,"color":"#999"},{"label":"数量","prop":"num","show":true},{"label":"金额","prop":"total_money","show":true,"color":"#ffcb3c"},{"label":"状态","prop":"status_text","show":true},{"label":"撤销人","prop":"cxname","show":true},{"label":"撤销时间","prop":"create_time","show":true,"color":"#999"},{"label":"操作","prop":"","type":"button","show":true,"btns":[{"name":"撤回","type":"danger","size":"small","round":true,"action":"revocation","role":"revocation","token":"Btn-1wbUQ2QYJQWnMaBiniM1OSou"}]}]}')},"3ed1":function(t,e,a){},"562b":function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"首张单号","prop":"first","show":true,"color":"#999"},{"label":"末张单号","prop":"last","show":true},{"label":"面值","prop":"face_value","show":true,"color":"#999"},{"label":"数量","prop":"num","show":true},{"label":"金额","prop":"total_money","show":true,"color":"#ffcb3c"},{"label":"项目","prop":"vname","show":true},{"label":"缴销日期","prop":"create_time","show":true,"color":"#999","width":180}]}')},"784c":function(t,e,a){"use strict";a("3ed1")},"91a0":function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"首张单号","prop":"first","show":true,"color":"#999"},{"label":"末张单号","prop":"last","show":true,"color":"#999"},{"label":"使用单号","prop":"use_number","show":true,"color":"#999"},{"label":"面值","prop":"face_value","show":true},{"label":"数量","prop":"num","show":true},{"label":"剩余数量","prop":"stock_num","show":true,"color":"#69da61"},{"label":"金额","prop":"count_money","show":true,"color":"#ffcb3c"},{"label":"状态","prop":"status_text","show":true},{"label":"领用项目","prop":"vname","show":true},{"label":"操作","prop":"","type":"button","width":300,"show":true,"btns":[{"name":"部分缴销","type":"primary empty","size":"small","round":true,"action":"bfcancellation","role":"bfcancellation","disabled":"bfdisabled","token":"Btn-yE9wmlXH5tclG8F2wS6oeW13"},{"name":"明细","type":"primary empty","size":"small","round":true,"action":"detail","role":"detail","token":"Btn-dlirNH8tLNbxLiQVYexBUriH"},{"name":"缴销","type":"primary","size":"small","round":true,"action":"cancellation","role":"cancellation","disabled":"jxdisabled","token":"Btn-nYTlsoB4VJibZJmDODzqWg6V"}]}]}')},a560:function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"首张单号","prop":"first","show":true,"color":"#999"},{"label":"末张单号","prop":"last","show":true},{"label":"面值","prop":"face_value","show":true,"color":"#999"},{"label":"数量","prop":"num","show":true},{"label":"金额","prop":"total_money","show":true,"color":"#ffcb3c"},{"label":"项目","prop":"vname","show":true},{"label":"操作时间","prop":"create_time","show":true,"color":"#999","width":180}]}')},c74a:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{attrs:{id:"bill-pay"}},[e("div",{staticClass:"top"},[e("div",{staticClass:"main"},[e("div",{staticClass:"common-left"},[e("span",{staticClass:"common-chose-info",on:{click:function(e){return t.$refs.showFilterVillage.showDialog()}}},[e("i",{staticClass:"iconfont icondaqu"}),t._v(" "+t._s(t.choseVillageInfo.name)+" ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"请输入票据单号"},domProps:{value:t.searchVal},on:{input:function(e){e.target.composing||(t.searchVal=e.target.value)}}}),e("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.tableLoad}},[t._v(" 查询 ")])],1),e("div",{staticClass:"common-right"},[t.$menu.getters.judgeRole("Btn-BEvf6KBNl34enXRkLe4JGYyw")?e("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.viewRecord}},[t._v(" 缴销记录 ")]):t._e(),e("span",{on:{click:t.exportExcel}},[e("workIcon",{staticClass:"common-right-icon",attrs:{name:"export",title:"导出"}})],1)],1)])]),e("div",{staticClass:"main-wp"},[e("div",{staticClass:"select-wp"},[e("el-select",{attrs:{clearable:"",placeholder:"请选择状态"},on:{change:t.tableLoad},model:{value:t.statusVal,callback:function(e){t.statusVal=e},expression:"statusVal"}},t._l(t.statusOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),e("el-select",{attrs:{clearable:"",placeholder:"请选择面值"},on:{change:t.tableLoad},model:{value:t.faceVal,callback:function(e){t.faceVal=e},expression:"faceVal"}},t._l(t.faceOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),e("el-date-picker",{attrs:{type:"daterange","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:t.tableLoad},model:{value:t.dateValue,callback:function(e){t.dateValue=e},expression:"dateValue"}})],1),e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.tableData,cusColums:t.columns,cusConf:t.conf,ispaging:!0,check:!0},on:{sizeChange:t.sizeChange,currentChange:t.currentChange,selectionChange:t.selectionChange,bfcancellation:t.bfcancellation,detail:t.showDetail,cancellation:t.cancellation}}),e("div",{staticClass:"btn-wp"},[t.$menu.getters.judgeRole("Btn-nYTlsoB4VJibZJmDODzqWg6V")?e("el-button",{staticClass:"empty",attrs:{disabled:0===t.tableSelected.length,type:"primary",round:""},on:{click:function(e){return t.batchCancellation()}}},[t._v(" "+t._s(`缴销已选(${t.tableSelected.length})本`)+" ")]):t._e()],1)],1)]),e("filter-village",{ref:"showFilterVillage",attrs:{vid:t.choseVillageInfo.vid},on:{choseInfo:t.filterVillage}}),e("el-dialog",{staticClass:"bfjxDialog",attrs:{visible:t.showBfjxDialog,title:"部分缴销",width:"28%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showBfjxDialog=e}}},[e("div",{staticClass:"title"},[t._v("缴销单号")]),e("el-input",{attrs:{placeholder:"请输入已使用的单号"},model:{value:t.cancellationOdd,callback:function(e){t.cancellationOdd=e},expression:"cancellationOdd"}}),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.bfjxConfirm}},[t._v(" 提交保存 ")]),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showBfjxDialog=!1}}},[t._v(" 取消 ")])],1)],1),e("el-dialog",{staticClass:"detailDialog",attrs:{visible:t.showDetailDialog,title:"缴销明细",width:"50%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showDetailDialog=e}}},[e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.popTableData,cusColums:t.popColumns,cusConf:t.popConf,ispaging:!0},on:{sizeChange:t.popSizeChange,currentChange:t.popCurrentChange,revocation:t.revocation}})],1)]),e("el-dialog",{staticClass:"recordDialog",attrs:{visible:t.showRecordDialog,title:"缴销记录",width:"50%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showRecordDialog=e}}},[e("div",{staticClass:"date-filter"},[e("el-date-picker",{attrs:{clearable:!1,type:"datetimerange","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.dateFilter,callback:function(e){t.dateFilter=e},expression:"dateFilter"}}),e("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.searchTable}},[t._v(" 查询 ")]),t.showSearchTable?e("el-button",{staticClass:"common-button",attrs:{type:"primary"},on:{click:t.addRecord}},[t._v(" 提交 ")]):t._e()],1),e("div",{staticClass:"table-wp"},[t.showSearchTable?e("cus-table",{attrs:{datas:t.searchTableData,cusColums:t.searchColumns,cusConf:t.searchConf}}):e("cus-table",{attrs:{datas:t.recordTableData,cusColums:t.recordColumns,cusConf:t.recordConf,ispaging:!0},on:{sizeChange:t.recordSizeChange,currentChange:t.recordCurrentChange,detail:t.recordInfo,revocation:t.recordDevocation,print:t.recordPrint}})],1)]),e("el-dialog",{staticClass:"infoDialog",attrs:{visible:t.showInfoDialog,title:"记录明细",width:"55%","close-on-click-modal":!0},on:{"update:visible":function(e){t.showInfoDialog=e}}},[e("el-scrollbar",{staticStyle:{height:"100%"}},[e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.rcdInfoData,cusColums:t.rcdInfoColumns,cusConf:t.rcdInfoConf}})],1),e("div",{staticClass:"total"},[t._v(" 费用合计： "),e("span",{staticClass:"money"},[t._v(t._s(t.totalMoney)+"元")]),e("span",{staticClass:"num"},[t._v(" 共 "),e("span",{staticStyle:{color:"#3ebb75"}},[t._v(t._s(t.rcdInfoData.length))]),t._v(" 条记录 ")])])])],1)],1)},s=[],l=(a("5948"),a("4698")),i=a("91a0"),n=a("1fdc"),r=a("df69"),c=a("562b"),h=a("a560"),d=a("0f90"),p={name:"billPay",components:{workIcon:l["a"]},data(){return{urlObj:{cancellist:this.$api.state.Charge.cancellist.url,getfacevalue:this.$api.state.Charge.getfacevalue.url,cancelsection:this.$api.state.Charge.cancelsection.url,cancellog:this.$api.state.Charge.cancellog.url,batchCancel:this.$api.state.Charge.batchCancel.url,removecancel:this.$api.state.Charge.removecancel.url,cancelcountlog:this.$api.state.Charge.cancelcountlog.url,searchcancel:this.$api.state.Charge.searchcancel.url,addcancelcount:this.$api.state.Charge.addcancelcount.url,removecount:this.$api.state.Charge.removecount.url,cancelcountinfo:this.$api.state.Charge.cancelcountinfo.url},choseVillageInfo:{name:"全部项目",vid:0},searchVal:"",tableData:[],columns:i.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},statusVal:"",statusOptions:[{value:1,label:"未缴销"},{value:2,label:"缴销中"},{value:3,label:"已缴销"}],faceVal:"",faceOptions:[],dateValue:[],tableSelected:[],currentIndex:0,isBatch:!1,showBfjxDialog:!1,cancellationOdd:"",isCommit:!1,showDetailDialog:!1,popTableData:[],popColumns:n.list,popConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},showRecordDialog:!1,recordTableData:[],recordColumns:r.list,recordConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},dateFilter:[],searchDate:{stime:"",etime:""},showSearchTable:!1,searchTableData:[],searchColumns:c.list,searchConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},showInfoDialog:!1,rcdInfoData:[],rcdInfoColumns:h.list,rcdInfoConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},totalMoney:"0.00"}},mounted(){let t=sessionStorage.getItem("vid"),e=sessionStorage.getItem("vname");t&&(this.choseVillageInfo.vid=t,this.choseVillageInfo.name=e),this.getFaceValue(),this.tableLoad()},methods:{filterVillage(t){this.choseVillageInfo.name=t.name,this.choseVillageInfo.vid=t.vid,this.searchVal="",this.statusVal="",this.faceVal="",this.dateValue=[],this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad()},getFaceValue(){this.$axios.post(this.urlObj.getfacevalue).then(t=>{if(200===t.Code){let e=[];Object.keys(t.Data).forEach(a=>{let o={value:a,label:t.Data[a]};e.push(o)}),this.faceOptions=e}else{let e=t.Message?t.Message:"获取面值数据失败！";this.$message({message:e,type:"error"})}}).catch(()=>{})},tableLoad(){this.conf.loadStatus=!0;let t={page:this.conf.curPage,limit:this.conf.limit,keywords:this.searchVal,vid:this.choseVillageInfo.vid,face_value:this.faceVal};this.statusVal&&(t.c_status=this.statusVal),this.dateValue&&this.dateValue[0]&&this.dateValue[1]&&(t.time={stime:this.dateValue[0]/1e3,etime:this.dateValue[1]/1e3}),this.$axios.post(this.urlObj.cancellist,t).then(t=>{200===t.Code?(t.Data.data&&t.Data.data.length>0&&t.Data.data.forEach(t=>{t.vname=t.village.villagename,2==t.status||3==t.status?(t.bfdisabled=!0,t.jxdisabled=!0):1==t.status&&Number(t.stock_num)>0?(t.bfdisabled=!1,t.jxdisabled=!1):(t.bfdisabled=!0,t.jxdisabled=!1)}),this.conf.dataTotal=t.Data.total,this.tableData=t.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=t.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},sizeChange(t){this.conf.limit=t,this.tableLoad()},currentChange(t){this.conf.curPage=t,this.tableLoad()},tableChange(){this.conf.curPage=1,this.tableLoad()},selectionChange(t){this.tableSelected=t},bfcancellation(t){this.currentIndex=t,this.cancellationOdd="",this.showBfjxDialog=!0},bfjxConfirm(){if(this.cancellationOdd){this.isCommit=!0;let t={id:this.tableData[this.currentIndex].id,use_number:this.cancellationOdd};this.$axios.post(this.urlObj.cancelsection,t).then(t=>{if(200===t.Code)this.$message({message:"部分缴销成功！",type:"success"}),this.showBfjxDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:"部分缴销失败！";this.$message({message:e,type:"error"})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}else this.$message({type:"warning",message:"请输入缴销单号！"})},showDetail(t){this.currentIndex=t,this.showDetailDialog=!0,this.popTableLoad()},cancellation(t){this.$confirm("确定要缴销整本发票吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let e={ids:[this.tableData[t].id]};this.cancelRequest(e)}).catch(()=>{})},batchCancellation(){this.$confirm("确定要缴销当前选择的发票吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let t={ids:this.tableSelected.map(t=>t.id)};this.cancelRequest(t)}).catch(()=>{})},cancelRequest(t){this.$axios.post(this.urlObj.batchCancel,t).then(t=>{if(200===t.Code)this.$message({message:"缴销成功！",type:"success"}),this.tableLoad();else{let e=t.Message?t.Message:"缴销失败！";this.$message({message:e,type:"error"})}}).catch(()=>{})},popTableLoad(){this.popConf.loadStatus=!0;let t={page:this.popConf.curPage,limit:this.popConf.limit,id:this.tableData[this.currentIndex].id};this.$axios.post(this.urlObj.cancellog,t).then(t=>{200===t.Code?(t.Data.data&&t.Data.data.length>0&&t.Data.data.forEach(t=>{t.cxname=t.creater.realname}),this.popConf.dataTotal=t.Data.total,this.popTableData=t.Data.data,this.popConf.loadStatus=!1,this.popConf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.popTableData=[],this.popConf.emptyText=t.Message,this.popConf.dataTotal=0,this.popConf.loadStatus=!1)}).catch(()=>{this.popTableData=[],this.popConf.emptyText="服务器连接失败...",this.popConf.dataTotal=0,this.popConf.loadStatus=!1})},popSizeChange(t){this.popConf.limit=t,this.popTableLoad()},popCurrentChange(t){this.popConf.curPage=t,this.popTableLoad()},revocation(t){this.$confirm("确定要撤回当前缴销明细吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let e={id:this.popTableData[t].id};this.$axios.post(this.urlObj.removecancel,e).then(t=>{if(200===t.Code)this.$message({message:"缴销明细撤回成功！",type:"success"}),this.popTableLoad();else{let e=t.Message?t.Message:"缴销明细撤回失败！";this.$message({message:e,type:"error"})}}).catch(()=>{})}).catch(()=>{})},viewRecord(){this.dateFilter=[],this.showSearchTable=!1,this.showRecordDialog=!0,this.recordTableLoad()},searchTable(){this.dateFilter&&this.dateFilter[0]&&this.dateFilter[1]?(this.searchDate.stime=this.dateFilter[0]/1e3,this.searchDate.etime=this.dateFilter[1]/1e3,this.showSearchTable=!0,this.searchTableLoad()):this.$message({type:"warning",message:"请选择时间范围！"})},addRecord(){if(this.searchTableData.length>0){let t={vid:this.choseVillageInfo.vid,time:this.searchDate};this.$axios.post(this.urlObj.addcancelcount,t).then(t=>{if(200===t.Code)this.$message({message:"提交成功！",type:"success"}),this.showSearchTable=!1,this.recordTableLoad();else{let e=t.Message?t.Message:"提交失败！";this.$message({message:e,type:"error"})}}).catch(()=>{})}else this.showSearchTable=!1,this.recordTableLoad()},recordTableLoad(){this.recordConf.loadStatus=!0;let t={page:this.recordConf.curPage,limit:this.recordConf.limit};this.$axios.post(this.urlObj.cancelcountlog,t).then(t=>{200===t.Code?(t.Data.data&&t.Data.data.length>0&&t.Data.data.forEach(t=>{t.cname=t.creater.realname}),this.recordConf.dataTotal=t.Data.total,this.recordTableData=t.Data.data,this.recordConf.loadStatus=!1,this.recordConf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.recordTableData=[],this.recordConf.emptyText=t.Message,this.recordConf.dataTotal=0,this.recordConf.loadStatus=!1)}).catch(()=>{this.recordTableData=[],this.recordConf.emptyText="服务器连接失败...",this.recordConf.dataTotal=0,this.recordConf.loadStatus=!1})},recordSizeChange(t){this.recordConf.limit=t,this.recordTableLoad()},recordCurrentChange(t){this.recordConf.curPage=t,this.recordTableLoad()},searchTableLoad(){this.searchConf.loadStatus=!0;let t={vid:this.choseVillageInfo.vid,time:{stime:this.dateFilter[0]/1e3,etime:this.dateFilter[1]/1e3}};this.$axios.post(this.urlObj.searchcancel,t).then(t=>{200===t.Code?(t.Data&&t.Data.length>0&&t.Data.forEach(t=>{t.vname=t.village.villagename}),this.searchTableData=t.Data,this.searchConf.loadStatus=!1,this.searchConf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.searchTableData=[],this.searchConf.emptyText=t.Message,this.searchConf.dataTotal=0,this.searchConf.loadStatus=!1)}).catch(()=>{this.searchTableData=[],this.searchConf.emptyText="服务器连接失败...",this.searchConf.dataTotal=0,this.searchConf.loadStatus=!1})},recordInfo(t){this.showInfoDialog=!0,this.rcdInfoConf.loadStatus=!0,this.$axios.post(this.urlObj.cancelcountinfo,{id:this.recordTableData[t].id}).then(t=>{if(200===t.Code){if(t.Data&&t.Data.length>0){let e=0;t.Data.forEach(t=>{t.vname=t.village.villagename,e=_.add(Number(e),Number(t.total_money))}),this.totalMoney=_.round(e,2)}this.rcdInfoData=t.Data,this.rcdInfoConf.loadStatus=!1,this.rcdInfoConf.emptyText=""}else 204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.rcdInfoData=[],this.rcdInfoConf.emptyText=t.Message,this.rcdInfoConf.dataTotal=0,this.rcdInfoConf.loadStatus=!1)}).catch(()=>{this.rcdInfoData=[],this.rcdInfoConf.emptyText="服务器连接失败...",this.rcdInfoConf.dataTotal=0,this.rcdInfoConf.loadStatus=!1})},recordDevocation(t){this.$confirm("确定要撤回当前缴销记录吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let e={id:this.recordTableData[t].id};this.$axios.post(this.urlObj.removecount,e).then(t=>{if(200===t.Code)this.$message({message:"缴销记录撤回成功！",type:"success"}),this.recordTableLoad();else{let e=t.Message?t.Message:"缴销记录撤回失败！";this.$message({message:e,type:"error"})}}).catch(()=>{})}).catch(()=>{})},recordPrint(t){let e=this.recordTableData[t];this.$axios.post(this.urlObj.cancelcountinfo,{id:e.id}).then(t=>{if(200===t.Code){let a="";t.Data.forEach(t=>{a+=`<tr><td>${t.first}</td><td>${t.last}</td><td>${t.face_value}</td><td>${t.num}</td>\n            <td>${t.total_money}</td><td>${t.village.villagename}</td><td>${t.create_time}</td></tr>`});let o=Object(d["a"])(),s="<style>table{width: 700px;border: 1px solid #aaa; border-collapse:collapse;};th{text-align: center;border: 1px solid #aaa!important;font-size: 29px;line-height:60px;height: 60px;}td{text-align: center;height: 30px;border: 1px solid #aaa;font-size: 14px;}</style>",l=s+'<div style="width: 700px;text-align: center;height: 30px;line-height: 30px;font-size: 18px;"><strong>'+this.choseVillageInfo.name+'&nbsp;&nbsp;交存明细</strong></div><div style="width: 700px;text-align: right;height: 40px;line-height: 40px;font-size: 13px;"><span>起止时间:'+e.stime+" 至 "+e.etime+'</span></div><table border="0" cellpadding="0" cellspacing="0" class="table table-striped table-bordered table-hover "  ><tr>\n              <th style="text-align: center;border: 1px solid #aaa!important;font-size: 14px;line-height:30px;height: 30px;">首张单号</th>\n              <th style="text-align: center;border: 1px solid #aaa!important;font-size: 14px;line-height:30px;height: 30px;">末张单号</th>\n              <th style="text-align: center;border: 1px solid #aaa!important;font-size: 14px;line-height:30px;height: 30px;">面值</th>\n              <th style="text-align: center;border: 1px solid #aaa!important;font-size: 14px;line-height:30px;height: 30px;">数量</th>\n              <th style="text-align: center;border: 1px solid #aaa!important;font-size: 14px;line-height:30px;height: 30px;">金额</th>\n              <th style="text-align: center;border: 1px solid #aaa!important;font-size: 14px;line-height:30px;height: 30px;">项目</th>\n              <th style="text-align: center;border: 1px solid #aaa!important;font-size: 14px;line-height:30px;height: 30px;">操作时间</th>\n            </tr>'+a+'</table><div style="width: 700px;text-align: left;height: 30px;line-height: 30px;font-size: 14px;"><strong>交存人:&nbsp;&nbsp;&nbsp;</strong><span>'+e.creater.realname+'</span><strong style="margin-left: 58%">时间:</strong>'+e.create_time+"</div>";o.ADD_PRINT_TEXT(),o.SET_PRINT_PAGESIZE(3,"","","A4"),o.ADD_PRINT_HTM(30,30,5,30,l),o.PREVIEW()}else{let e=t.Message?t.Message:"订单列表数据获取失败！";$message({type:"error",message:e})}})},exportExcel(){let t={page:this.conf.curPage,limit:this.conf.limit,keywords:this.searchVal,vid:this.choseVillageInfo.vid,face_value:this.faceVal,is_excel:1};this.statusVal&&(t.c_status=this.statusVal),this.dateValue&&this.dateValue[0]&&this.dateValue[1]&&(t.time={stime:this.dateValue[0]/1e3,etime:this.dateValue[1]/1e3}),this.$axios.post(this.urlObj.cancellist,t).then(t=>{if(200===t.Code){let e=t.Data&&t.Data.length>0?t.Data:[];this.exportDataHandle(e)}else{let e=t.Message?t.Message:"订单列表数据获取失败！";$message({type:"error",message:e})}})},exportDataHandle(t){try{Promise.all([a.e("chunk-3a869cfb"),a.e("chunk-2a5081b0"),a.e("chunk-3a96421c")]).then((()=>{let{export_json_to_excel:e}=a("628d"),o=["首张单号","末张单号","使用单号","面值","数量","剩余数量","金额","状态","领用项目"],s=[];t.forEach(t=>{let e=[t.first,t.last,t.use_number,t.face_value,t.num,t.stock_num,t.count_money,t.status_text,t.village.villagename];s.push(e)}),e(o,s,"定额发票缴销表")}).bind(null,a)).catch(a.oe),this.$notify({type:"success",title:"温馨提示",message:"导出报表成功",duration:1500})}catch(e){this.$notify({type:"error",title:"温馨提示",message:"导出报表失败",duration:1500})}}}},u=p,m=(a("784c"),a("1805")),f=Object(m["a"])(u,o,s,!1,null,null,null);e["default"]=f.exports},df69:function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"缴销人","prop":"cname","show":true},{"label":"缴销开始时间","prop":"stime","show":true,"color":"#999","width":160},{"label":"缴销结束时间","prop":"etime","show":true,"color":"#999","width":160},{"label":"金额","prop":"total_money","show":true,"color":"#ffcb3c"},{"label":"状态","prop":"status_text","show":true,"color":"#ffcb3c"},{"label":"打印","width":"60","type":"icon","icon":"print","show":true,"action":"print","token":"Btn-cQugT8AQaREoGSM1Oxm2XeF9"},{"label":"操作","prop":"","type":"button","width":200,"show":true,"btns":[{"name":"明细","type":"primary","size":"small","round":true,"action":"detail","role":"detail","token":"Btn-cQugT8AQaREoGSM1Oxm2XeF9"},{"name":"撤回","type":"danger","size":"small","round":true,"action":"revocation","role":"revocation","token":"Btn-1wbUQ2QYJQWnMaBiniM1OSou"}]}]}')}}]);