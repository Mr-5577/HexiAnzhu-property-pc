(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-39bb83e2"],{1227:function(e,t,s){"use strict";s("c688")},"46ec4":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"report-repair"}},[t("div",{staticClass:"top"},[t("div",{staticClass:"main"},[t("div",{staticClass:"common-left"},[t("span",{staticClass:"common-chose-info",on:{click:function(t){return e.$refs.showFilterVillage.showDialog()}}},[t("workIcon",{attrs:{name:"build"}}),e._v(" "+e._s(e.choseVillageInfo.name)+" "),e.choseVillageInfo.vid?t("i",{staticClass:"close el-icon-circle-close",on:{click:function(t){t.stopPropagation(),e.choseVillageInfo={name:"全部项目",vid:""},e.keySearch()}}}):e._e()],1),t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"请输入报事报修单号"},domProps:{value:e.searchVal},on:{input:function(t){t.target.composing||(e.searchVal=t.target.value)}}}),t("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.keySearch()}}},[e._v(" 查询 ")])],1),t("div",{staticClass:"common-right"},[e.$menu.getters.judgeRole("Btn-qf6daNAAxnS6rEWXkkU5OGEj")?t("el-button",{attrs:{type:"primary",round:"",plain:"",icon:"iconfont iconxinzeng"},on:{click:e.newReport}},[e._v(" 新增报事报修 ")]):e._e()],1)])]),t("div",{staticClass:"main-wp"},[t("div",{staticClass:"select-wp"},[t("el-select",{attrs:{clearable:"",placeholder:"请选择报修类型"},on:{change:e.tableLoad},model:{value:e.typeVal,callback:function(t){e.typeVal=t},expression:"typeVal"}},e._l(e.typeOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.typename,value:e.id}})})),1),t("el-select",{attrs:{clearable:"",placeholder:"请选择业务状态"},on:{change:e.tableLoad},model:{value:e.statusVal,callback:function(t){e.statusVal=t},expression:"statusVal"}},e._l(e.statusOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-date-picker",{attrs:{type:"date","picker-options":e.spickerOptions,placeholder:"请选择开始日期","value-format":"timestamp"},on:{change:e.tableLoad},model:{value:e.startTime,callback:function(t){e.startTime=t},expression:"startTime"}}),e._v(" ~ "),t("el-date-picker",{attrs:{type:"date","picker-options":e.epickerOptions,placeholder:"请选择截止日期","value-format":"timestamp"},on:{change:e.tableLoad},model:{value:e.endTime,callback:function(t){e.endTime=t},expression:"endTime"}}),t("el-button",{attrs:{type:"primary empty",round:""},on:{click:e.exportDetailExcel}},[e._v(" 导出Excel ")])],1),t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.tableData,cusColums:e.columns,cusConf:e.conf,ispaging:!0},on:{sizeChange:e.sizeChange,currentChange:e.currentChange,detail:e.showDetail,orderClose:e.orderClose}})],1)]),t("filter-village",{ref:"showFilterVillage",attrs:{vid:e.choseVillageInfo.vid},on:{choseInfo:e.filterVillage}}),t("el-dialog",{staticClass:"addDialog",attrs:{visible:e.showAddDialog,title:"新增报事报修",width:"36%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showAddDialog=t}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("div",{staticClass:"search-wp"},[t("el-autocomplete",{ref:"searchInput",staticClass:"report-search",attrs:{"popper-class":"my-autocomplete","fetch-suggestions":e.querySearchAsync,placeholder:"请输入业主姓名、手机号"},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function({item:s}){return[t("div",{staticClass:"tr-item"},[t("span",{staticClass:"td-item"},[e._v(e._s(s.realname))]),t("span",{staticClass:"td-item"},[e._v(e._s(s.tel))]),t("span",{staticClass:"td-item"},[e._v(e._s(s.roomnum))])]),e.allUserList.length<=1?t("div",{staticClass:"load-more"},[e._v(" 暂无数据！ ")]):e._e()]}}]),model:{value:e.autoValue,callback:function(t){e.autoValue=t},expression:"autoValue"}},[t("i",{staticClass:"iconfont iconzu3664 el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})])],1),t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"报修类型",prop:"type"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择报修类型"},on:{change:e.typeChange},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},e._l(e.typeOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.typename,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"业主姓名",prop:"uname"}},[t("el-input",{attrs:{placeholder:"请输入业主姓名",readonly:""},model:{value:e.ruleForm.uname,callback:function(t){e.$set(e.ruleForm,"uname",t)},expression:"ruleForm.uname"}})],1),t("el-form-item",{attrs:{label:"业主电话",prop:"tel"}},[t("el-input",{attrs:{placeholder:"请输入业主电话",readonly:""},model:{value:e.ruleForm.tel,callback:function(t){e.$set(e.ruleForm,"tel",t)},expression:"ruleForm.tel"}})],1),t("el-form-item",{attrs:{label:"业主房号",prop:"room"}},[t("el-input",{attrs:{placeholder:"请输入业主房号",readonly:""},model:{value:e.ruleForm.room,callback:function(t){e.$set(e.ruleForm,"room",t)},expression:"ruleForm.room"}})],1),t("el-form-item",{staticClass:"remark",attrs:{label:"情况描述",prop:"desc"}},[t("el-input",{attrs:{type:"textarea",resize:"none",rows:3,placeholder:"请输入具体情况描述"},model:{value:e.ruleForm.desc,callback:function(t){e.$set(e.ruleForm,"desc",t)},expression:"ruleForm.desc"}})],1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.formSubmit}},[e._v(" 提交保存 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showAddDialog=!1}}},[e._v(" 取消 ")])],1)],1),t("el-dialog",{staticClass:"detailDialog",attrs:{visible:e.showDetailDialog,title:"处理详情",width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showDetailDialog=t}}},[t("el-scrollbar",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticStyle:{height:"100%"}},[e.isLoading?e._e():t("div",{staticClass:"main-content"},[t("div",{staticClass:"title"},[e._v("单号："+e._s(e.detailObj.id))]),t("div",{staticClass:"order-content"},[t("div",{staticClass:"order-item"},[t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("业主姓名")]),t("span",{staticClass:"value"},[e._v(e._s(e.detailObj.name))])]),t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("业主电话")]),t("span",{staticClass:"value"},[e._v(e._s(e.detailObj.tel))])]),t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("业主房号")]),t("span",{staticClass:"value"},[e._v(e._s(e.detailObj.room))])])]),t("div",{staticClass:"order-item"},[t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("事件类型")]),t("span",{staticClass:"value"},[e._v(" "+e._s(e.detailObj.type?e.detailObj.type.typename:"")+" ")])]),t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("提交时间")]),t("span",{staticClass:"value"},[e._v(e._s(e.detailObj.create_time))])]),t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("业务状态")]),0==e.detailObj.status?t("span",{staticClass:"value",staticStyle:{color:"#ffc21a"}},[e._v(" 待接单 ")]):1==e.detailObj.status?t("span",{staticClass:"value",staticStyle:{color:"#3ebb75"}},[e._v(" 已处理 ")]):2==e.detailObj.status?t("span",{staticClass:"value",staticStyle:{color:"#ffc21a"}},[e._v(" 处理中 ")]):3==e.detailObj.status?t("span",{staticClass:"value",staticStyle:{color:"#ffc21a"}},[e._v(" 已接单 ")]):4==e.detailObj.status?t("span",{staticClass:"value",staticStyle:{color:"#3ebb75"}},[e._v(" 已回访 ")]):5==e.detailObj.status?t("span",{staticClass:"value",staticStyle:{color:"#ff6d6d"}},[e._v(" 已超期 ")]):e._e()])]),t("div",{staticClass:"order-item desc"},[t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("情况描述")]),t("span",{staticClass:"value"},[e._v(" "+e._s(e.detailObj.repaircon)+" ")])])])]),e.detailObj.handle_info&&e.detailObj.handle_info.creater?t("div",{staticClass:"order-wp"},[t("div",{staticClass:"title"},[e._v(" 派单情况 ")]),t("div",{staticClass:"so-content"},[t("div",{staticClass:"order-item"},[t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("派单人员")]),t("span",{staticClass:"value"},[e._v(" "+e._s(e.detailObj.handle_info?e.detailObj.handle_info.creater:"")+" ")])]),t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("处理人员")]),t("span",{staticClass:"value"},[e._v(" "+e._s(e.detailObj.handle_info?e.detailObj.handle_info.creater:"")+" ")])])]),t("div",{staticClass:"order-item so"},[t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("派单要求")]),t("span",{staticClass:"value"},[e._v(" "+e._s(e.detailObj.handle_info?e.detailObj.handle_info.dealrequirement:"")+" ")])]),t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("派单时间")]),t("span",{staticClass:"value"},[e._v(" "+e._s(e.detailObj.handle_info?e.detailObj.handle_info.dispatchtime:"")+" ")])])])])]):e._e(),e.detailObj.hasRecord?t("div",{staticClass:"record-wp"},[t("div",{staticClass:"title record",on:{click:function(t){e.showRecord=!e.showRecord}}},[e._v(" 处理跟进记录 "),e.showRecord?t("i",{staticClass:"el-icon-caret-top"}):t("i",{staticClass:"el-icon-caret-bottom"})]),e.showRecord?t("div",{staticClass:"records"},[e.detailObj.list.chuli&&e.detailObj.list.chuli.length>0?t("div",{staticClass:"record-content"},[t("div",{staticClass:"title"},[e._v("处理记录")]),e._l(e.detailObj.list.chuli,(function(s){return t("div",{key:s.id,staticClass:"content"},[t("div",{staticClass:"info-left"},[t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("处理人")]),t("span",{staticClass:"value"},[e._v(e._s(s.handleUser.realname))])]),t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("处理时间")]),t("span",{staticClass:"value"},[e._v(e._s(s.ctime))])]),t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("相关附件")]),s.file&&s.file.length>0?t("span",{staticClass:"value"},e._l(s.file,(function(s,a){return t("img",{key:a,attrs:{src:s,alt:""},on:{click:function(t){return e.imgPreview(s)}}})})),0):e._e()])]),t("div",{staticClass:"info-right"},[t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("处理结果")]),t("span",{staticClass:"value"},[e._v(" "+e._s(s.content)+" ")])])])])}))],2):e._e(),e.detailObj.list.genjin&&e.detailObj.list.genjin.length>0?t("div",{staticClass:"record-content"},[t("div",{staticClass:"title"},[e._v("跟进记录")]),e._l(e.detailObj.list.genjin,(function(s){return t("div",{key:s.id,staticClass:"content"},[t("div",{staticClass:"info-left"},[t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("跟进人")]),t("span",{staticClass:"value"},[e._v(e._s(s.handleUser.realname))])]),t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("跟进时间")]),t("span",{staticClass:"value"},[e._v(e._s(s.ctime))])]),t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("相关附件")]),s.file&&s.file.length>0?t("span",{staticClass:"value"},e._l(s.file,(function(s,a){return t("img",{key:a,attrs:{src:s,alt:""},on:{click:function(t){return e.imgPreview(s)}}})})),0):e._e()])]),t("div",{staticClass:"info-right"},[t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("跟进备注")]),t("span",{staticClass:"value"},[e._v(" "+e._s(s.content)+" ")])])])])}))],2):e._e(),e.detailObj.list.huifang&&e.detailObj.list.huifang.length>0?t("div",{staticClass:"record-content"},[t("div",{staticClass:"title"},[e._v("回访记录")]),e._l(e.detailObj.list.huifang,(function(s){return t("div",{key:s.id,staticClass:"content"},[t("div",{staticClass:"info-left"},[t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("回访人")]),t("span",{staticClass:"value"},[e._v(e._s(s.handleUser.realname))])]),t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("回访时间")]),t("span",{staticClass:"value"},[e._v(e._s(s.ctime))])]),t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("相关附件")]),s.file&&s.file.length>0?t("span",{staticClass:"value"},e._l(s.file,(function(s,a){return t("img",{key:a,attrs:{src:s,alt:""},on:{click:function(t){return e.imgPreview(s)}}})})),0):e._e()])]),t("div",{staticClass:"info-right"},[t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("回访备注")]),t("span",{staticClass:"value"},[e._v(" "+e._s(s.content)+" ")])])])])}))],2):e._e()]):e._e()]):e._e(),e.detailObj.score||e.detailObj.evaluate_content?t("div",{staticClass:"evaluate-wp"},[t("div",{staticClass:"title"},[e._v(" 业主评价 "),t("el-rate",{attrs:{disabled:"","show-score":"","text-color":"#ff9900"},model:{value:e.detailObj.score,callback:function(t){e.$set(e.detailObj,"score",t)},expression:"detailObj.score"}})],1),t("el-input",{attrs:{type:"textarea",resize:"none",rows:3,readonly:"",placeholder:"暂无评价内容"},model:{value:e.detailObj.evaluate_content,callback:function(t){e.$set(e.detailObj,"evaluate_content",t)},expression:"detailObj.evaluate_content"}})],1):e._e(),1!=e.detailObj.dispatch_auth||0!=e.detailObj.status&&3!=e.detailObj.status?e._e():t("div",{staticClass:"handle-wp"},[t("div",{staticClass:"head"},[e._v("选择处理人")]),t("el-select",{attrs:{filterable:"",placeholder:"请选择处理人"},model:{value:e.userVal,callback:function(t){e.userVal=t},expression:"userVal"}},e._l(e.userOptions,(function(e){return t("el-option",{key:e.uid,attrs:{label:e.posname+"-"+e.realname,value:e.uid}})})),1),t("div",{staticClass:"head"},[e._v("派单要求")]),t("el-input",{staticClass:"content",attrs:{type:"textarea",resize:"none",rows:3,placeholder:"请输入派单要求"},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}}),t("div",{staticClass:"btn-wp"},[e.$menu.getters.judgeRole("Btn-Xi6k5l674JlANH3j1h8ctXgL")?t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.sendOrders}},[e._v(" 去派单 ")]):e._e()],1)],1),1!=e.detailObj.reassignment_auth||2!=e.detailObj.status&&3!=e.detailObj.status?e._e():t("div",{staticClass:"handle-wp"},[t("div",{staticClass:"head"},[e._v("选择改派人")]),t("el-select",{attrs:{filterable:"",remote:"",placeholder:"输入姓名、电话号搜索","remote-method":e.remoteMethod,loading:e.loading},model:{value:e.reassign,callback:function(t){e.reassign=t},expression:"reassign"}},e._l(e.reassignOptions,(function(e){return t("el-option",{key:e.uid,attrs:{label:e.deptname+"-"+e.realname,value:e.uid}})})),1),t("div",{staticClass:"btn-wp"},[e.$menu.getters.judgeRole("Btn-aF3htIiAtZMrlPeLGvnA81ip")?t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.reassignOrder}},[e._v(" 改派订单 ")]):e._e()],1)],1),1==e.detailObj.returnvisit_auth&&1==e.detailObj.status?t("div",{staticClass:"handle-wp"},[t("div",{staticClass:"head"},[e._v("回访结果")]),t("el-input",{staticClass:"content",attrs:{type:"textarea",resize:"none",rows:3,placeholder:"请输入回访结果"},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}}),t("div",{staticClass:"btn-wp"},[e.$menu.getters.judgeRole("Btn-Mc1aCvqR8rOMM2ceXcI1xwkv")?t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.returnVisit}},[e._v(" 确认回访 ")]):e._e()],1)],1):e._e(),1!=e.detailObj.handle_auth||2!=e.detailObj.status&&3!=e.detailObj.status?e._e():t("div",{staticClass:"handle-wp"},[t("div",{staticClass:"file-upload"},[t("div",{staticClass:"head"},[e._v("上传附件")]),t("el-upload",{ref:"upload",attrs:{action:e.qiniuDatas.domain,"list-type":"picture-card","file-list":e.fileList,"http-request":e.customUpload,"on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove}},[t("i",{staticClass:"el-icon-plus"})]),t("el-dialog",{staticClass:"imgPreview",attrs:{visible:e.dialogVisible,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1),t("div",{staticClass:"head"},[e._v("处理结果")]),t("el-input",{staticClass:"content",attrs:{type:"textarea",resize:"none",rows:3,placeholder:"请输入处理结果"},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}}),t("div",{staticClass:"btn-wp"},[e.$menu.getters.judgeRole("Btn-8A7oKrEszJQpHcQ8pb2gM52y")?t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.handleFinish}},[e._v(" 完成处理 ")]):e._e()],1)],1)])])],1),t("el-image",{ref:"preview",attrs:{src:e.imgSrc,"preview-src-list":e.imgList,"z-index":1e4}})],1)},i=[],l=(s("5948"),s("f31f")),r=s("9b39"),o=s("4698"),n={name:"reportRepair",components:{workIcon:o["a"]},data(){return{urlObj:{repairlist:this.$api.state.Custom.repairlist.url,getrepairtype:this.$api.state.Custom.getrepairtype.url,searchrooms:this.$api.state.Custom.searchrooms.url,addrepair:this.$api.state.Custom.addrepair.url,repairdetail:this.$api.state.Custom.repairdetail.url,handleuser:this.$api.state.Custom.handleuser.url,repairdispatch:this.$api.state.Custom.repairdispatch.url,nmentusers:this.$api.state.Custom.nmentusers.url,repairchange:this.$api.state.Custom.repairchange.url,returnvisit:this.$api.state.Custom.returnvisit.url,repairhandle:this.$api.state.Custom.repairhandle.url,repairclose:this.$api.state.Custom.repairclose.url,uploadToken:this.$api.state.Public.uploadToken.url},choseVillageInfo:{name:"全部项目",vid:0},searchVal:"",startTime:"",endTime:"",tableData:[],columns:r.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},typeVal:"",typeOptions:[],statusVal:"",statusOptions:[{value:1,label:"待接单"},{value:2,label:"已处理"},{value:3,label:"处理中"},{value:4,label:"已接单"},{value:5,label:"已回访"},{value:6,label:"超期"}],showAddDialog:!1,ruleForm:{type:"",uname:"",tel:"",room:"",desc:""},rules:{type:[{required:!0,message:"请选择报修类型",trigger:"change"}],uname:[{required:!0,message:"请输入业主姓名",trigger:"change"}],tel:[{required:!0,message:"请输入业主电话",trigger:"change"}],room:[{required:!0,message:"请输入业主房号",trigger:"change"}],desc:[{required:!0,message:"请输入具体情况描述",trigger:"blur"}]},autoValue:"",allUserList:[],currentUser:{},isCommit:!1,showDetailDialog:!1,isLoading:!1,showRecord:!1,detailObj:"",userVal:"",userOptions:[],content:"",loading:!1,reassign:"",reassignOptions:[],qiniuDatas:"",fileInfo:[],fileList:[],dialogImageUrl:"",dialogVisible:!1,imgSrc:"",imgList:[]}},computed:{spickerOptions(){return{disabledDate:e=>{if(e)return!!this.endTime&&e.getTime()>this.endTime}}},epickerOptions(){return{disabledDate:e=>{if(e)return!!this.startTime&&e.getTime()<this.startTime}}}},mounted(){let e=sessionStorage.getItem("vid"),t=sessionStorage.getItem("vname");e&&(this.choseVillageInfo.vid=e,this.choseVillageInfo.name=t),this.tableLoad(),this.getTypeList()},methods:{filterVillage(e){this.choseVillageInfo.name=e.name,this.choseVillageInfo.vid=e.vid,this.searchVal="",this.typeVal="",this.statusVal="",this.startTime="",this.endTime="",this.keySearch()},getTypeList(){this.$axios.post(this.urlObj.getrepairtype,{type:1}).then(e=>{if(200===e.Code)this.typeOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取报事报修类型失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},tableLoad(){this.conf.loadStatus=!0;let e={page:this.conf.curPage,limit:this.conf.limit,keywords:this.searchVal,vid:this.choseVillageInfo.vid,type:this.typeVal,status:this.statusVal};this.startTime&&(e.starttime=this.startTime/1e3),this.endTime&&(e.endtime=this.endTime/1e3),this.$axios.post(this.urlObj.repairlist,e).then(e=>{200===e.Code?(e.Data.data&&e.Data.data.length>0&&e.Data.data.forEach(t=>{t.vname=t.village?t.village.villagename:"",t.tname=t.type?t.type.typename:"",1!=t.status&&4!=t.status&&1==e.Data.close_auth?t.bdhide=!1:t.bdhide=!0}),this.conf.dataTotal=e.Data.total,this.tableData=e.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.datas=[],this.conf.emptyText=e.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.datas=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},keySearch(){this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad()},sizeChange(e){this.conf.limit=e,this.tableLoad()},currentChange(e){this.conf.curPage=e,this.tableLoad()},typeChange(e){if(e){let t=this.typeOptions.find(t=>t.id==e);1===t.is_public?this.rules={type:[{required:!0,message:"请选择报修类型",trigger:"change"}],uname:[{required:!1,message:"请输入业主姓名",trigger:"change"}],tel:[{required:!1,message:"请输入业主电话",trigger:"change"}],room:[{required:!1,message:"请输入业主房号",trigger:"change"}],desc:[{required:!0,message:"请输入具体情况描述",trigger:"blur"}]}:this.rules={type:[{required:!0,message:"请选择报修类型",trigger:"change"}],uname:[{required:!0,message:"请输入业主姓名",trigger:"change"}],tel:[{required:!0,message:"请输入业主电话",trigger:"change"}],room:[{required:!0,message:"请输入业主房号",trigger:"change"}],desc:[{required:!0,message:"请输入具体情况描述",trigger:"blur"}]}}},newReport(){this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.showAddDialog=!0},async querySearchAsync(e,t){if(e){let s={keyword:e,vid:this.choseVillageInfo.vid},a=await this.$axios.post(this.urlObj.searchrooms,s);if(200===a.Code){a.Data=a.Data?a.Data:[];let e={id:0,realname:"姓名",tel:"电话号码",roomnum:"房号"};a.Data.unshift(e),this.allUserList=a.Data,this.nomore=!1,t(a.Data)}else this.$refs.searchInput.$children[0].blur()}else t([])},handleSelect(e){this.currentUser=e,this.ruleForm.uname=e.realname,this.ruleForm.tel=e.tel,this.ruleForm.room=e.roomnum},formSubmit(){this.$refs.ruleForm.validate(e=>{if(e){this.isCommit=!0;let e={vid:this.choseVillageInfo.vid,type:this.ruleForm.type,title:this.ruleForm.desc};this.currentUser.id&&(e.name=this.currentUser.realname?this.currentUser.realname:"",e.tel=this.currentUser.tel?this.currentUser.tel:"",e.room=this.currentUser.roomnum?this.currentUser.roomnum:"",e.unit=this.currentUser.unit?this.currentUser.unit:""),this.$axios.post(this.urlObj.addrepair,e).then(e=>{if(200===e.Code)this.$message({message:"新增报事报修成功！",type:"success"}),this.showAddDialog=!1,this.tableLoad();else{let t=e.Message?e.Message:"新增报事报修失败！";this.$message({message:t,type:"error"})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},showDetail(e){this.showRecord=!1,this.detailObj=[],this.userVal="",this.content="",this.reassign="",this.reassignOptions=[],this.showDetailDialog=!0,this.getDetailData(this.tableData[e].id),this.getHandleUser(),this.getUploadToken()},getDetailData(e){this.isLoading=!0,this.$axios.post(this.urlObj.repairdetail,{id:e}).then(e=>{if(200===e.Code)e.Data.hasRecord=e.Data.list.chuli&&e.Data.list.chuli.length>0||e.Data.list.genjin&&e.Data.list.genjin.length>0||e.Data.list.huifang&&e.Data.list.huifang.length>0,this.detailObj=e.Data;else{let t=e.Message?e.Message:"获取报修详情数据失败！";this.$message({type:"error",message:t})}this.isLoading=!1}).catch(()=>{this.isLoading=!1})},orderClose(e){this.$confirm("此操作将关闭当前报事报修订单，确定继续操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let t={id:this.tableData[e].id};this.$axios.post(this.urlObj.repairclose,t).then(e=>{if(200===e.Code)this.$message({message:"闭单成功！",type:"success"}),this.tableLoad();else{let t=e.Message?e.Message:"闭单失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})}).catch(()=>{})},getHandleUser(){this.$axios.post(this.urlObj.handleuser,{id:this.detailObj.id}).then(e=>{if(200===e.Code)this.userOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取处理人员数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},sendOrders(){if(this.userVal||this.content)if(this.userVal)if(this.content){let e={id:this.detailObj.id,handler_uid:this.userVal,content:this.content};this.$axios.post(this.urlObj.repairdispatch,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:"派单成功！"}),this.showDetailDialog=!1,this.tableLoad();else{let t=e.Message?e.Message:"派单失败！";this.$message({type:"error",message:t})}}).catch(()=>{})}else this.$message({type:"warning",message:"请填写派单要求！"});else this.$message({type:"warning",message:"请选择处理人！"});else this.$message({type:"warning",message:"处理人和派单要求不能为空！"})},remoteMethod(e){""!==e?(this.loading=!0,this.$axios.post(this.urlObj.nmentusers,{keywords:e}).then(e=>{if(200===e.Code)this.reassignOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取改派人员数据失败！";this.$message({type:"error",message:t})}this.loading=!1}).catch(()=>{this.loading=!1})):this.gaipaiOptions=[]},reassignOrder(){if(this.reassign){let e={id:this.detailObj.id,user_id:this.reassign};this.$axios.post(this.urlObj.repairchange,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:"订单改派成功！"}),this.showDetailDialog=!1,this.tableLoad();else{let t=e.Message?e.Message:"订单改派失败！";this.$message({type:"error",message:t})}}).catch(()=>{})}else this.$message({type:"warning",message:"请选择改派人员！"})},returnVisit(){if(this.content){let e={id:this.detailObj.id,content:this.content};this.$axios.post(this.urlObj.returnvisit,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:"回访成功！"}),this.showDetailDialog=!1,this.tableLoad();else{let t=e.Message?e.Message:"回访失败！";this.$message({type:"error",message:t})}}).catch(()=>{})}else this.$message({type:"warning",message:"请输入回访结果！"})},getUploadToken(){this.$axios.post(this.urlObj.uploadToken).then(e=>{200===e.Code&&(this.qiniuDatas=e.Data)})},customUpload(e){e.url=this.$refs.upload.uploadFiles[0].url;let t=Object(l["a"])(e,this.qiniuDatas);t.observable.subscribe({next:()=>{},error:()=>{},complete:()=>{t.fileInfo.uid=e.file.uid,this.fileInfo.push(t.fileInfo)}})},handleRemove(e){let t=this.fileInfo.findIndex(t=>t.uid==e.uid);-1!=t&&this.fileInfo.splice(t,1)},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},handleFinish(){if(this.content){let e=this.fileInfo.map(e=>e.qiniu_key),t={id:this.detailObj.id,content:this.content};e.length>0&&(t.img_arr=e),this.$axios.post(this.urlObj.repairhandle,t).then(e=>{if(200===e.Code)this.$message({type:"success",message:"订单已完成处理！"}),this.showDetailDialog=!1,this.tableLoad();else{let t=e.Message?e.Message:"订单完成处理失败！";this.$message({type:"error",message:t})}}).catch(()=>{})}else this.$message({type:"warning",message:"请输入处理结果！"})},imgPreview(e){this.imgSrc=e,this.imgList=[e],this.$nextTick(()=>{this.$refs.preview.clickHandler()})},exportDetailExcel(){try{let e={page:this.conf.curPage,limit:this.conf.limit,keywords:this.searchVal,vid:this.choseVillageInfo.vid,type:this.typeVal,status:this.statusVal,is_excel:1};this.startTime&&(e.starttime=this.startTime/1e3),this.endTime&&(e.endtime=this.endTime/1e3),this.$axios.post(this.urlObj.repairlist,e).then(e=>{if(200===e.Code){let t="报事报修数据表",a=["来源","项目","业主","房号","类型","内容","电话","状态","提交时间","处理时间","处理人","派单人","升级次数"],i=[];e.Data.forEach(e=>{let t=[e.from_text,e.village.villagename,e.name,e.room,e.type.typename,e.repaircon,e.tel,e.status_text,e.create_time,e.followtime,e.handler,e.distributeer,e.upgrade_num];i.push(t)}),Promise.all([s.e("chunk-3a869cfb"),s.e("chunk-2a5081b0"),s.e("chunk-3a96421c")]).then((()=>{let{export_json_to_excel:e}=s("628d");e(a,i,t)}).bind(null,s)).catch(s.oe),this.$notify({type:"success",title:"温馨提示",message:"导出报表成功",duration:1500})}else{let t=e.Message?e.Message:"报事报修数据获取失败！";this.$message({type:"error",message:t})}})}catch(e){this.$notify({type:"error",title:"温馨提示",message:"导出报表失败",duration:1500})}}}},c=n,d=(s("1227"),s("1805")),u=Object(d["a"])(c,a,i,!1,null,null,null);t["default"]=u.exports},"9b39":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"单号","prop":"id","show":true},{"label":"项目","prop":"vname","show":true,"color":"#999"},{"label":"业主姓名","prop":"name","show":true,"color":"#999"},{"label":"房号","prop":"room","show":true},{"label":"报修类型","prop":"tname","show":true,"color":"#999"},{"label":"联系电话","prop":"tel","show":true},{"label":"处理情况","prop":"status_text","show":true},{"label":"提交时间","prop":"create_time","show":true,"color":"#999"},{"label":"来源","prop":"from_text","show":true,"color":"#999"},{"label":"处理时间","prop":"followtime","show":true,"color":"#999"},{"label":"处理人","prop":"handler","show":true,"color":"#999"},{"label":"升级次数","prop":"upgrade_num","show":true,"color":"#3ebb75"},{"label":"操作","prop":"","width":170,"type":"button","show":true,"btns":[{"name":"详情","type":"primary","size":"small","round":true,"action":"detail","role":"detail","token":"empty"},{"name":"闭单","type":"warning","size":"small","hide":"bdhide","round":true,"action":"orderClose","role":"orderClose","token":"empty"}]}]}')},c688:function(e,t,s){}}]);