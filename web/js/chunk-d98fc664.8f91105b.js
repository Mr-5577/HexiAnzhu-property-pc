(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d98fc664"],{"5ad1":function(e,t,a){"use strict";var s=a("eeba"),i=a("5cbe"),o=a("d99f"),r=a("c3fa"),l=r("toStringTag"),n=Object,c="Arguments"===o(function(){return arguments}()),u=function(e,t){try{return e[t]}catch(a){}};e.exports=s?o:function(e){var t,a,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(a=u(t=n(e),l))?a:c?o(t):"Object"===(s=o(t))&&i(t.callee)?"Arguments":s}},"5e5c1":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"资源名称","prop":"resources_name","show":true,"width":140},{"label":"资源类型","prop":"resources_type","show":true,"width":120},{"label":"操作人","prop":"cname","show":true,"width":120},{"label":"内容","prop":"content","show":true},{"label":"操作时间","prop":"create_time","show":true}]}')},6003:function(e,t,a){},"68f1":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.uploading||e.commiting,expression:"uploading || commiting"}],attrs:{id:"hydropower","element-loading-text":e.uploading?"正在导入数据":e.commiting?"数据提交中，请稍等":"数据加载中"}},[t("a",{ref:"adom",staticStyle:{display:"none"},attrs:{href:e.aurl,target:"_blank"}}),t("div",{staticClass:"top"},[t("div",{staticClass:"main"},[t("div",{staticClass:"common-left"},[t("span",{staticClass:"common-chose-info",on:{click:function(t){return e.$refs.showFilterVillage.showDialog()}}},[t("i",{staticClass:"iconfont icondaqu"}),e._v(" "+e._s(e.choseVillageInfo.name)+" ")]),t("el-date-picker",{attrs:{type:"date",clearable:!1,editable:!1,align:"center","value-format":"timestamp",placeholder:"请选择抄表日期"},model:{value:e.dateVal,callback:function(t){e.dateVal=t},expression:"dateVal"}}),t("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.tableLoad}},[e._v(" 查询 ")])],1),t("div",{staticClass:"common-right"},[e.$menu.getters.judgeRole("Btn-7kQxYQRWP5Dfj1zrTpZOlUzX")?t("el-button",{attrs:{type:"primary",plain:"",round:"",icon:"iconfont iconxiugai"},on:{click:e.enterHandle}},[e._v(" 初始录入 ")]):e._e(),t("el-button",{attrs:{type:"primary",plain:"",round:"",icon:"iconfont iconzu3638"},on:{click:e.logHandle}},[e._v(" 变更日志 ")])],1)])]),t("div",{staticClass:"main-wp"},[t("div",{staticClass:"select-wp"},[t("el-select",{attrs:{placeholder:"请选择资源类型"},on:{change:e.tableLoad},model:{value:e.resourceVal,callback:function(t){e.resourceVal=t},expression:"resourceVal"}},e._l(e.resourceOptions,(function(e){return t("el-option",{key:e.type,attrs:{label:e.name,value:e.type}})})),1),t("el-select",{attrs:{clearable:"",placeholder:"请选择楼栋"},on:{change:e.tableLoad},model:{value:e.buildVal,callback:function(t){e.buildVal=t},expression:"buildVal"}},e._l(e.buildOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.block,value:e.id}})})),1),t("el-input",{attrs:{placeholder:"输入姓名/房号/车牌号或车位"},on:{change:e.tableLoad},model:{value:e.keywords,callback:function(t){e.keywords=t},expression:"keywords"}}),t("div",{staticClass:"btn-wp"},[e.$menu.getters.judgeRole("Btn-jeWfh3BU6iUEooViPnc83fq2")?t("el-upload",{ref:"upload",attrs:{action:"/charge/importwaterbyexcel",limit:1,"file-list":e.fileList,"show-file-list":!1,"http-request":e.customUpload,accept:".xls,.xlsx",disabled:!e.dateVal}},[t("el-button",{attrs:{type:"primary",round:""}},[e._v("批量导入")])],1):e._e(),e.$menu.getters.judgeRole("Btn-0OLB4Mh6HteARORP8cNGgZZO")?t("el-button",{attrs:{type:"primary empty",round:""},on:{click:e.downloadTemp}},[e._v(" 下载模板 ")]):e._e()],1)],1),t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.tableData,cusColums:e.columns,cusConf:e.conf,ispaging:!0,check:e.$menu.getters.judgeRole("Btn-eq62SfOVcLO1mcxiFQ5Lfbfs")},on:{sizeChange:e.sizeChange,currentChange:e.currentChange,checkRecord:e.checkRecord,edit:e.sourceEdit,textChange:e.textChange,nameChange:e.nameChange,commit:e.degCommit,selectionChange:e.selectionChange}}),t("div",{staticClass:"btn-wp"},[e.$menu.getters.judgeRole("Btn-eq62SfOVcLO1mcxiFQ5Lfbfs")?t("el-button",{attrs:{type:"primary empty",round:"",disabled:0===e.tableSelected.length},on:{click:e.batchCommit}},[e._v(" 批量提交已选("+e._s(e.tableSelected.length)+") ")]):e._e()],1)],1)]),t("filter-village",{ref:"showFilterVillage",attrs:{vid:e.choseVillageInfo.vid},on:{choseInfo:e.filterVillage}}),t("el-dialog",{staticClass:"enterDialog",attrs:{visible:e.showEnterDialog,title:"初始度数录入",width:"38%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showEnterDialog=t}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("div",{staticClass:"search-wp"},[t("el-autocomplete",{ref:"searchInput",staticClass:"hy-search",attrs:{"popper-class":"my-autocomplete","fetch-suggestions":e.querySearchAsync,placeholder:"请输入业主姓名/手机号/房号/车牌号或车位"},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function({item:a}){return[t("div",{staticClass:"tr-item"},[t("span",{staticClass:"td-item"},[e._v(e._s(a.username))]),t("span",{staticClass:"td-item"},[e._v(e._s(a.tel))]),t("span",{staticClass:"td-item"},[e._v(e._s(a.title))])]),e.allUserList.length<=1?t("div",{staticClass:"load-more"},[e._v(" 暂无数据！ ")]):e._e()]}}]),model:{value:e.autoValue,callback:function(t){e.autoValue=t},expression:"autoValue"}},[t("i",{staticClass:"iconfont iconzu3664 el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})])],1),t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"资源名称",prop:"resourceName"}},[t("el-input",{attrs:{readonly:!0,placeholder:"请输入资源名称"},model:{value:e.ruleForm.resourceName,callback:function(t){e.$set(e.ruleForm,"resourceName",t)},expression:"ruleForm.resourceName"}})],1),t("el-form-item",{attrs:{label:"客户姓名",prop:"uname"}},[t("el-input",{attrs:{readonly:!0,placeholder:"请输入客户姓名"},model:{value:e.ruleForm.uname,callback:function(t){e.$set(e.ruleForm,"uname",t)},expression:"ruleForm.uname"}})],1),t("el-form-item",{attrs:{label:"资源类型",prop:"resourceType"}},[t("el-select",{attrs:{placeholder:"请选择资源类型",clearable:""},on:{change:e.typeChange},model:{value:e.ruleForm.resourceType,callback:function(t){e.$set(e.ruleForm,"resourceType",t)},expression:"ruleForm.resourceType"}},e._l(e.resourceOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"三表名称",prop:"threeName"}},[t("el-input",{attrs:{placeholder:"请输入三表名称"},model:{value:e.ruleForm.threeName,callback:function(t){e.$set(e.ruleForm,"threeName",t)},expression:"ruleForm.threeName"}})],1),t("el-form-item",{attrs:{label:"倍率",prop:"rate"}},[t("el-input",{attrs:{min:1,type:"number",oninput:"value=value.replace(/[^\\d]/g,'')",placeholder:"请输入倍率"},model:{value:e.ruleForm.rate,callback:function(t){e.$set(e.ruleForm,"rate",e._n(t))},expression:"ruleForm.rate"}})],1),t("el-form-item",{attrs:{label:"缴费科目",prop:"subject"}},[t("el-select",{attrs:{clearable:"",multiple:"","collapse-tags":"",placeholder:"请选择缴费科目"},model:{value:e.ruleForm.subject,callback:function(t){e.$set(e.ruleForm,"subject",t)},expression:"ruleForm.subject"}},e._l(e.subOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"起始读数",prop:"number"}},[t("el-input",{attrs:{placeholder:"请输入起始读数"},model:{value:e.ruleForm.number,callback:function(t){e.$set(e.ruleForm,"number",t)},expression:"ruleForm.number"}})],1),t("el-form-item",{attrs:{label:"抄表日期",prop:"readTime"}},[t("el-date-picker",{attrs:{type:"date",align:"center","value-format":"timestamp",placeholder:"请选择抄表日期"},model:{value:e.ruleForm.readTime,callback:function(t){e.$set(e.ruleForm,"readTime",t)},expression:"ruleForm.readTime"}})],1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.formSubmit}},[e._v(" 提交保存 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showEnterDialog=!1}}},[e._v(" 取消 ")])],1)],1),t("el-dialog",{staticClass:"editDialog",attrs:{visible:e.showEditDialog,title:"编辑三表信息",width:"32%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showEditDialog=t}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.editRules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"三表名称",prop:"threeName"}},[t("el-input",{attrs:{placeholder:"请输入三表名称"},model:{value:e.editForm.threeName,callback:function(t){e.$set(e.editForm,"threeName",t)},expression:"editForm.threeName"}})],1),t("el-form-item",{attrs:{label:"倍率",prop:"rate"}},[t("el-input",{attrs:{min:1,type:"number",oninput:"value=value.replace(/[^\\d]/g,'')",placeholder:"请输入倍率"},model:{value:e.editForm.rate,callback:function(t){e.$set(e.editForm,"rate",e._n(t))},expression:"editForm.rate"}})],1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.editSubmit}},[e._v(" 提交保存 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showEditDialog=!1}}},[e._v(" 取消 ")])],1)],1),t("el-dialog",{staticClass:"recordDialog",attrs:{visible:e.showRecordDialog,title:"水电使用记录",width:"80%","close-on-click-modal":!0},on:{"update:visible":function(t){e.showRecordDialog=t}}},[t("div",{staticClass:"filter-wp"},[t("el-date-picker",{attrs:{type:"month","picker-options":e.spickerOptions,placeholder:"开始月份","value-format":"yyyy-MM"},on:{change:e.popTableLoad},model:{value:e.startTime,callback:function(t){e.startTime=t},expression:"startTime"}}),e._v(" ~ "),t("el-date-picker",{attrs:{type:"month","picker-options":e.epickerOptions,placeholder:"结束月份","value-format":"yyyy-MM"},on:{change:e.popTableLoad},model:{value:e.endTime,callback:function(t){e.endTime=t},expression:"endTime"}})],1),t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.popTableData,cusColums:e.popColumns,cusConf:e.popConf,ispaging:!0},on:{sizeChange:e.popSizeChange,currentChange:e.popCurrentChange,delRecord:e.delRecord}}),t("el-button",{attrs:{type:"primary",plain:"",round:"",icon:"iconfont iconzu3638"},on:{click:e.recordLogHandle}},[e._v(" 变更日志 ")])],1)]),t("el-dialog",{staticClass:"logDialog",attrs:{visible:e.showLogDialog,title:"变更日志",width:"50%","close-on-click-modal":!0},on:{"update:visible":function(t){e.showLogDialog=t}}},[t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.logTableData,cusColums:e.logColumns,cusConf:e.logConf,ispaging:!0},on:{sizeChange:e.logSizeChange,currentChange:e.logCurrentChange}})],1)])],1)},i=[],o=(a("5948"),a("c9d7"),a("b6b0"),a("e2d1"),a("7ba7")),r=a("e5bb"),l=a("cfb98"),n=a("5e5c1"),c={name:"hydropower",data(){return{urlObj:{subjectbytype:this.$api.state.Public.subjectbytype.url,buildOfVillage:this.$api.state.Public.buildOfVillage.url,waterresourcestype:this.$api.state.Charge.waterresourcestype.url,searchwater:this.$api.state.Charge.searchwater.url,watersearchtype:this.$api.state.Charge.watersearchtype.url,inputwaternumber:this.$api.state.Charge.inputwaternumber.url,watercostlist:this.$api.state.Charge.watercostlist.url,watercostdel:this.$api.state.Charge.watercostdel.url,searchdatabyweg:this.$api.state.Charge.searchdatabyweg.url,initwater:this.$api.state.Charge.initwater.url,editwatername:this.$api.state.Charge.editwatername.url,editwater:this.$api.state.Charge.editwater.url,waterexcel:this.$api.state.Charge.waterexcel.url,waterbyexcel:this.$api.state.Charge.waterbyexcel.url,batchwaterel:this.$api.state.Charge.batchwaterel.url,logData:this.$api.state.Means.logData.url,logdataall:this.$api.state.Means.logdataall.url},choseVillageInfo:{name:"全部项目",vid:0},dateVal:"",resourceVal:"",resourceOptions:[],buildVal:"",buildOptions:[],keywords:"",tableData:[],columns:o.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},currentIndex:"",showEnterDialog:!1,autoValue:"",currentUser:{},ruleForm:{resourceName:"",uname:"",resourceType:"",threeName:"",rate:1,subject:[],number:"",readTime:""},rules:{resourceName:[{required:!0,message:"请填写资源名称",trigger:"change"}],uname:[{required:!0,message:"请填写客户姓名",trigger:"change"}],resourceType:[{required:!0,message:"请选择资源类型",trigger:"change"}],threeName:[{required:!0,message:"请输入三表名称",trigger:"blur"}],rate:[{required:!0,message:"请输入倍率",trigger:"blur"}],subject:[{required:!0,message:"请选择缴费科目",trigger:"change"}],number:[{required:!0,message:"请填写起始读数",trigger:"blur"}],readTime:[{required:!0,message:"请选择抄表日期",trigger:"change"}]},typeOptions:[],subOptions:[],isCommit:!1,showRecordDialog:!1,popTableData:[],popColumns:r.list,popConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},showEditDialog:!1,editForm:{threeName:"",rate:1},editRules:{threeName:[{required:!0,message:"请输入三表名称",trigger:"blur"}],rate:[{required:!0,message:"请输入倍率",trigger:"blur"}]},aurl:"",uploading:!1,fileList:[],commiting:!1,tableSelected:[],showLogDialog:!1,logTableData:[],logColumns:l.list,logConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},startTime:"",endTime:""}},computed:{spickerOptions(){return{disabledDate:e=>{if(e)return!!this.endTime&&e.getTime()>new Date(this.endTime).getTime()}}},epickerOptions(){return{disabledDate:e=>{if(e)return!!this.startTime&&e.getTime()<new Date(this.startTime).getTime()}}}},mounted(){let e=sessionStorage.getItem("vid"),t=sessionStorage.getItem("vname");e&&(this.choseVillageInfo.vid=e,this.choseVillageInfo.name=t),this.dateVal=(new Date).getTime(),this.getResourceType(),this.getBuildList()},methods:{getResourceType(){this.$axios.post(this.urlObj.waterresourcestype).then(e=>{if(200===e.Code)this.resourceOptions=e.Data,this.resourceVal=e.Data&&e.Data.length>0?e.Data[0].type:"",this.tableLoad();else{let t=e.Message?e.Message:"获取资源类型数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getBuildList(){let e={vid:this.choseVillageInfo.vid};this.$axios.post(this.urlObj.buildOfVillage,e).then(e=>{if(200===e.Code)this.buildOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取楼栋数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},tableLoad(){this.conf.loadStatus=!0;let e={page:this.conf.curPage,limit:this.conf.limit,vid:this.choseVillageInfo.vid,type:this.resourceVal,bid:this.buildVal,keywords:this.keywords};this.$axios.post(this.urlObj.searchwater,e).then(e=>{200===e.Code?(e.Data.data&&e.Data.data.length>0&&e.Data.data.forEach(e=>{e.oname=e.owner?e.owner.realname:"",e.money="0.00",e.cnumber=""}),this.conf.dataTotal=e.Data.total,this.tableData=e.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=e.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},popTableLoad(){this.popConf.loadStatus=!0;let e={page:this.popConf.curPage,limit:this.popConf.limit,type:this.resourceVal,id:this.tableData[this.currentIndex].id,starttime:this.startTime?this.startTime.split("-").join(""):"",endtime:this.endTime?this.endTime.split("-").join(""):""};this.$axios.post(this.urlObj.watercostlist,e).then(e=>{200===e.Code?(this.popConf.dataTotal=e.Data.total,this.popTableData=e.Data.data,this.popConf.loadStatus=!1,this.popConf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.popTableData=[],this.popConf.emptyText=e.Message,this.popConf.dataTotal=0,this.popConf.loadStatus=!1)}).catch(()=>{this.popTableData=[],this.popConf.emptyText="服务器连接失败...",this.popConf.dataTotal=0,this.popConf.loadStatus=!1})},filterVillage(e){this.choseVillageInfo.name=e.name,this.choseVillageInfo.vid=e.vid,this.resourceVal="",this.buildVal="",this.keywords="",this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.getResourceType(),this.getBuildList()},sizeChange(e){this.conf.limit=e,this.tableLoad()},popSizeChange(e){this.popConf.limit=e,this.popTableLoad()},currentChange(e){this.conf.curPage=e,this.tableLoad()},popCurrentChange(e){this.popConf.curPage=e,this.popTableLoad()},nameChange(e){let t={type:this.resourceVal,id:this.tableData[e.index].id,name:e.value};this.$axios.post(this.urlObj.editwatername,t).then(e=>{if(200===e.Code)this.$message({message:"资源名称修改成功！",type:"success"});else{let t=e.Message?e.Message:"资源名称修改失败！";this.$message({message:t,type:"error"})}this.tableLoad()}).catch(()=>{})},textChange(e){let t=this.tableData[e.index],a=e.value-t.number;if(a<0)this.$message({type:"warning",message:"本次度数不能小于上次度数！"}),t.money="0.00",t.cnumber="";else{t.cnumber=e.value;let s=0;t.subject.forEach(e=>{s=_.add(Number(s),_.round(_.multiply(_.multiply(Number(a),Number(e.price)),Number(t.magnification)),1))}),t.money=s.toFixed(2)}},enterHandle(){this.autoValue="",this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.showEnterDialog=!0},async querySearchAsync(e,t){if(this.choseVillageInfo.vid)if(e){let a={keywords:e,vid:this.choseVillageInfo.vid},s=await this.$axios.post(this.urlObj.searchdatabyweg,a);if(200===s.Code){let e={id:0,username:"姓名",tel:"电话号码",title:"资源名称"};s.Data.unshift(e),this.allUserList=s.Data,this.nomore=!1,t(s.Data)}else this.$refs.searchInput.$children[0].blur()}else t([]);else this.$refs.searchInput.close(),this.$message({type:"warning",message:"请选择项目后再搜索！"})},handleSelect(e){this.currentUser=e,this.ruleForm.resourceName=e.title,this.ruleForm.uname=e.username},typeChange(e){if(this.ruleForm.subject="",this.subOptions=[],e){let t={vid:this.choseVillageInfo.vid,resource_type_id:e};this.$axios.post(this.urlObj.subjectbytype,t).then(e=>{if(200===e.Code)this.subOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取缴费科目数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})}},formSubmit(){this.$refs.ruleForm.validate(e=>{if(e){this.isCommit=!0;let e=this.resourceOptions.findIndex(e=>e.id==this.ruleForm.resourceType),t={id:this.currentUser.id,oid:this.currentUser.oid,vid:this.choseVillageInfo.vid,type:this.resourceOptions[e].type,resources_type:this.currentUser.type,resources_type_id:this.resourceOptions[e].id,number:this.ruleForm.number,subject_id:this.ruleForm.subject,input_time:this.ruleForm.readTime/1e3,name:this.ruleForm.threeName,magnification:this.ruleForm.rate};this.$axios.post(this.urlObj.initwater,t).then(e=>{if(200===e.Code)this.$message({message:"录入成功！",type:"success"}),this.showEnterDialog=!1,this.tableLoad();else{let t=e.Message?e.Message:"录入失败！";this.$message({message:t,type:"error"})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},degCommit(e){if(this.currentIndex=e,this.tableData[e].cnumber){this.commiting=!0;let t={type:this.resourceVal,id:this.tableData[e].id,number:this.tableData[e].cnumber,time:parseInt(this.dateVal/1e3)};this.$axios.post(this.urlObj.inputwaternumber,t).then(e=>{if(200===e.Code)this.$message({message:"本次度数录入成功！",type:"success"}),this.tableLoad();else{let t=e.Message?e.Message:"录入本次度数失败！";this.$message({message:t,type:"error"})}this.commiting=!1}).catch(()=>{this.commiting=!1})}else this.$message({type:"warning",message:"请输入本次度数"})},batchCommit(){const e=e=>e.cnumber;if(this.tableSelected.every(e)){this.commiting=!0;let e=this.tableSelected.map(e=>({id:e.id,type:this.resourceVal,number:e.cnumber,time:parseInt(this.dateVal/1e3)}));this.$axios.post(this.urlObj.batchwaterel,{data:e}).then(e=>{if(200===e.Code){if(e.Data.error_num>0){let t="失败信息："+e.Data.error_msg.join(";");this.$message({message:t,type:"success"})}else this.$message({message:"批量提交成功！",type:"success"});this.tableLoad()}else{let t=e.Message?e.Message:"批量提交失败！";this.$message({message:t,type:"error"})}this.commiting=!1}).catch(()=>{this.commiting=!1})}else this.$message({type:"warning",message:"存在本次度数为空的数据"})},checkRecord(e){this.currentIndex=e,this.startTime="",this.endTime="",this.showRecordDialog=!0,this.popTableLoad()},sourceEdit(e){this.currentIndex=e,this.$refs.editForm&&this.$refs.editForm.resetFields(),this.editForm.threeName=this.tableData[e].name,this.editForm.rate=this.tableData[e].magnification?this.tableData[e].magnification:"",this.showEditDialog=!0},editSubmit(){this.$refs.editForm.validate(e=>{if(e){this.isCommit=!0;let e={id:this.tableData[this.currentIndex].id,type:this.tableData[this.currentIndex].type_text,name:this.editForm.threeName,magnification:this.editForm.rate};this.$axios.post(this.urlObj.editwater,e).then(e=>{if(200===e.Code)this.$message({message:"编辑成功！",type:"success"}),this.showEditDialog=!1,this.tableLoad();else{let t=e.Message?e.Message:"编辑失败！";this.$message({message:t,type:"error"})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},selectionChange(e){this.tableSelected=e},delRecord(e){this.$confirm("此操作将永久删除当前记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let t={id:this.popTableData[e].id};this.$axios.post(this.urlObj.watercostdel,t).then(e=>{if(200===e.Code)this.$message({message:"删除成功！",type:"success"}),this.popTableLoad();else{let t=e.Message?e.Message:"记录删除失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})}).catch(()=>{})},customUpload(e){this.uploading=!0;let t=new FormData;t.append("file",e.file),this.$axios({method:"post",url:this.urlObj.waterbyexcel,data:t,headers:{type:"upload"}}).then(e=>{if(200===e.Code){if(e.Data.error_num&&e.Data.error_num>0){let t="错误信息："+e.Data.error_msg.join(";");this.$message({type:"warning",message:t})}else this.$message({type:"success",message:"批量导入成功！"});this.tableLoad()}else{let t=e.Message?e.Message:"批量导入失败！";this.$message({type:"error",message:t})}this.uploading=!1,this.fileList=[],this.$refs.upload.clearFiles()}).catch(()=>{this.uploading=!1,this.fileList=[],this.$refs.upload.clearFiles()})},downloadTemp(){let e={vid:this.choseVillageInfo.vid,type:this.resourceVal,bid:this.buildVal,keywords:this.keywords};this.$axios({method:"post",url:this.urlObj.waterexcel,data:e,responseType:"blob"}).then(e=>{const t=new Blob([e]);if("download"in document.createElement("a")){const e=document.createElement("a");e.download="水电批量导入模板.xlsx",e.style.display="none",e.href=URL.createObjectURL(t),document.body.appendChild(e),e.click(),URL.revokeObjectURL(e.href),document.body.removeChild(e)}else navigator.msSaveBlob(t,fileName)}).catch(()=>{})},logHandle(){this.logTableData=[],this.logColumns=n.list,this.logConf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.showLogDialog=!0,this.logTableLoad()},recordLogHandle(){this.logTableData=[],this.logColumns=l.list,this.logConf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.showLogDialog=!0,this.logTableLoad(this.tableData[this.currentIndex].id)},logTableLoad(e){this.logConf.loadStatus=!0;let t=this.urlObj.logdataall,a={page:this.logConf.curPage,limit:this.logConf.limit,type:this.resourceVal};e?(a.id=e,t=this.urlObj.logData):a.vid=this.choseVillageInfo.vid,this.$axios.post(t,a).then(e=>{200===e.Code?(e.Data.data&&e.Data.data.length>0&&e.Data.data.forEach(e=>{e.cname=e.createuser.realname}),this.logConf.dataTotal=e.Data.total,this.logTableData=e.Data.data,this.logConf.loadStatus=!1,this.logConf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.logTableData=[],this.logConf.emptyText=e.Message,this.logConf.dataTotal=0,this.logConf.loadStatus=!1)}).catch(()=>{this.logTableData=[],this.logConf.emptyText="服务器连接失败...",this.logConf.dataTotal=0,this.logConf.loadStatus=!1})},logSizeChange(e){this.logConf.limit=e,this.logTableLoad()},logCurrentChange(e){this.logConf.curPage=e,this.logTableLoad()}}},u=c,h=(a("a632"),a("1805")),m=Object(h["a"])(u,s,i,!1,null,null,null);t["default"]=m.exports},"761a":function(e,t,a){"use strict";var s=a("a692"),i=a("223f");e.exports=function(e,t,a){return a.get&&s(a.get,t,{getter:!0}),a.set&&s(a.set,t,{setter:!0}),i.f(e,t,a)}},"7ba7":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button/input/icon","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"资源名称","prop":"name","show":true,"color":"#999"},{"label":"绑定资源","prop":"resources_name","show":true,"color":"#999"},{"label":"倍率","prop":"magnification","show":true},{"label":"客户姓名","prop":"oname","show":true},{"label":"上次度数","prop":"number","show":true,"color":"#999"},{"type":"input","inputType":"number","label":"本次度数","prop":"cnumber","show":true,"width":120,"token":"Btn-pmahQjbXdzzYUJ6n03csp02Q"},{"label":"本次金额","prop":"money","show":true,"color":"#ffcb3c"},{"label":"操作","prop":"","width":260,"type":"button","show":true,"token":"Btn-1cKZSiNgbDYCcLDFxjHCkSN8","btns":[{"name":"提交","type":"primary","size":"small","round":true,"action":"commit","role":"commit","token":"Btn-pmahQjbXdzzYUJ6n03csp02Q"},{"name":"编辑","type":"primary","size":"small","round":true,"class":"empty","action":"edit","role":"edit","token":"empty"},{"name":"查看记录","type":"primary","size":"small","round":true,"class":"sys-btn","action":"checkRecord","role":"checkRecord","token":"Btn-VWbcqF9jhzB2DbgMsO7gZjry"}]}]}')},"817c":function(e,t,a){"use strict";var s=TypeError;e.exports=function(e,t){if(e<t)throw new s("Not enough arguments");return e}},a632:function(e,t,a){"use strict";a("6003")},b6b0:function(e,t,a){"use strict";var s=a("e60e"),i=a("da01"),o=a("e360"),r=a("817c"),l=URLSearchParams,n=l.prototype,c=i(n.getAll),u=i(n.has),h=new l("a=1");!h.has("a",2)&&h.has("a",void 0)||s(n,"has",(function(e){var t=arguments.length,a=t<2?void 0:arguments[1];if(t&&void 0===a)return u(this,e);var s=c(this,e);r(t,1);var i=o(a),l=0;while(l<s.length)if(s[l++]===i)return!0;return!1}),{enumerable:!0,unsafe:!0})},c9d7:function(e,t,a){"use strict";var s=a("e60e"),i=a("da01"),o=a("e360"),r=a("817c"),l=URLSearchParams,n=l.prototype,c=i(n.append),u=i(n["delete"]),h=i(n.forEach),m=i([].push),p=new l("a=1&a=2&b=3");p["delete"]("a",1),p["delete"]("b",void 0),p+""!=="a=2"&&s(n,"delete",(function(e){var t=arguments.length,a=t<2?void 0:arguments[1];if(t&&void 0===a)return u(this,e);var s=[];h(this,(function(e,t){m(s,{key:t,value:e})})),r(t,1);var i,l=o(e),n=o(a),p=0,d=0,g=!1,b=s.length;while(p<b)i=s[p++],g||i.key===l?(g=!0,u(this,i.key)):d++;while(d<b)i=s[d++],i.key===l&&i.value===n||c(this,i.key,i.value)}),{enumerable:!0,unsafe:!0})},cfb98:function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"操作人","prop":"cname","show":true,"width":120},{"label":"内容","prop":"content","show":true},{"label":"操作时间","prop":"create_time","show":true}]}')},e2d1:function(e,t,a){"use strict";var s=a("aa1e"),i=a("da01"),o=a("761a"),r=URLSearchParams.prototype,l=i(r.forEach);s&&!("size"in r)&&o(r,"size",{get:function(){var e=0;return l(this,(function(){e++})),e},configurable:!0,enumerable:!0})},e360:function(e,t,a){"use strict";var s=a("5ad1"),i=String;e.exports=function(e){if("Symbol"===s(e))throw new TypeError("Cannot convert a Symbol value to a string");return i(e)}},e5bb:function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"开始日期","prop":"start_time","show":true},{"label":"截止日期","prop":"end_time","show":true},{"label":"科目名称","prop":"subject_text","show":true,"color":"#999"},{"label":"收费类型","prop":"type_name","show":true,"color":"#999"},{"label":"上次度数","prop":"last","show":true,"color":"#999"},{"label":"本次度数","prop":"this","show":true,"color":"#69da61"},{"label":"本次金额","prop":"money","show":true,"color":"#ffcb3c"},{"label":"状态","prop":"status_text","show":true,"color":"#999"},{"label":"操作","prop":"","type":"button","show":true,"btns":[{"name":"删除","type":"danger","size":"small","round":true,"class":"sys-btn","action":"delRecord","role":"delRecord","token":"Btn-iWnJYTmZMhvqlMipyZ4YrNTh"}]}]}')},eeba:function(e,t,a){"use strict";var s=a("c3fa"),i=s("toStringTag"),o={};o[i]="z",e.exports="[object z]"===String(o)}}]);