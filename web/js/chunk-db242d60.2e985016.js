(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-db242d60"],{"8b66":function(e,t,l){"use strict";l("fb1a")},c6f2:function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"设备编号","prop":"sn","show":true,"color":"#999","width":180},{"label":"设备类型","prop":"category","show":true},{"label":"标签","prop":"tags","show":true,"color":"#999"},{"label":"使用状态","prop":"status_text","show":true,"cstcolor":"statusColor","width":150},{"label":"录入人员","prop":"creator","show":true,"color":"#999","width":150},{"label":"录入时间","prop":"c_time","show":true,"color":"#999"}]}')},f77a:function(e,t,l){"use strict";l.r(t);var a=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"facility-manage"}},[t("div",{staticClass:"top"},[t("div",{staticClass:"main"},[t("div",{staticClass:"common-left"},[t("span",{staticClass:"common-chose-info",on:{click:function(t){return e.$refs.showFilterVillage.showDialog()}}},[t("i",{staticClass:"iconfont icondaqu"}),e._v(" "+e._s(e.choseVillageInfo.name)+" ")]),t("el-cascader",{attrs:{props:{value:"id",label:"name",checkStrictly:!0,lazy:!0,lazyLoad:e.lazyLoad},clearable:"",placeholder:"请选择设备类型"},on:{change:e.tableLoad},model:{value:e.deviceType,callback:function(t){e.deviceType=t},expression:"deviceType"}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"输入设备名称、设备编号查询"},domProps:{value:e.searchVal},on:{input:function(t){t.target.composing||(e.searchVal=t.target.value)}}}),t("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.keySearch}},[e._v(" 查询 ")]),t("el-button",{staticClass:"common-button",attrs:{type:"primary"},on:{click:function(t){e.showAddDeviceDialog=!0}}},[e._v(" 新增设备 ")])],1),t("div",{staticClass:"common-right"},[t("span",{on:{click:function(t){return e.$refs.cusTable.exportExcel()}}},[t("workIcon",{staticClass:"common-right-icon",attrs:{name:"export",title:"导出"}})],1),t("span",{directives:[{name:"print",rawName:"v-print",value:{id:"#tablePrint",popTitle:"合同列表"},expression:"{ id: '#tablePrint', popTitle: '合同列表' }"}],staticClass:"last-ico"},[t("workIcon",{staticClass:"common-right-icon",attrs:{name:"print",title:"打印"}})],1)])])]),t("div",{staticClass:"main-wp"},[t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.tableData,cusColums:e.columns,cusConf:e.conf,ispaging:!0},on:{sizeChange:e.sizeChange,currentChange:e.currentChange}})],1)]),t("filter-village",{ref:"showFilterVillage",attrs:{vid:e.choseVillageInfo.vid},on:{choseInfo:e.filterVillage}}),t("el-dialog",{staticClass:"importDialog",attrs:{visible:e.showAddDeviceDialog,title:"新增设备",width:"36%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showAddDeviceDialog=t},close:function(t){e.showAddDeviceDialog=!1}}},[t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"项目选择",prop:"village"}},[t("el-select",{staticClass:"village",attrs:{multiple:"","collapse-tags":"","popper-class":"customSelect",placeholder:"默认全部","popper-append-to-body":!0},model:{value:e.ruleForm.village,callback:function(t){e.$set(e.ruleForm,"village",t)},expression:"ruleForm.village"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.addDeviceSubmit}},[e._v(" 提交保存 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showAddDeviceDialog=!1}}},[e._v(" 取消 ")])],1)],1)],1)},i=[],s=(l("5948"),l("c6f2")),o=l("4698");var c={name:"facilityManage",components:{workIcon:o["a"]},data(){return{urlObj:{treeData:this.$api.state.Means.treeData.url,applist:this.$api.state.Application.applist.url,category:this.$api.state.DeviceManage.category.url,equipments:this.$api.state.DeviceManage.equipments.url},choseVillageInfo:{name:"全部项目",vid:0},deviceType:"",searchVal:"",tableData:[],columns:s.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},isCommit:!1,showAddDeviceDialog:!1,rules:{village:[{required:!1,message:"请选择项目",trigger:"change"}]},ruleForm:{village:[]},villageSelected:[]}},mounted(){let e=sessionStorage.getItem("vid"),t=sessionStorage.getItem("vname");e&&(this.choseVillageInfo.vid=e,this.choseVillageInfo.name=t),this.tableLoad(),this.getVillageData()},methods:{getVillageData(){this.$axios.post(this.urlObj.treeData).then(e=>{if(200===e.Code){let t="";e.Data&&e.Data.length>0&&(e.Data.forEach(e=>{let l="";e.children&&e.children.length>0&&e.children.forEach(t=>{t.id==this.vid?(l+=`<li id="${t.id}" pid="${e.id}" class="active">${t.label}</li>`,this.villageSelected=[{id:t.id,name:t.label}],this.ruleForm.village=[t.label],this.villageChange()):l+=`<li id="${t.id}" pid="${e.id}">${t.label}</li>`});let a="";a=1===e.children.length&&e.children[0].id==this.vid?`\n                  <div class="city">\n                    <div class="title">${e.label}</div>\n                    <ul>\n                      <li id="0" pid="${e.id}" class="active">全选</li>\n                      ${l}\n                    </ul>\n                  </div>\n                `:`\n                  <div class="city">\n                    <div class="title">${e.label}</div>\n                    <ul>\n                      <li id="0" pid="${e.id}">全选</li>\n                      ${l}\n                    </ul>\n                  </div>\n                `,t+=a}),console.log("this.ruleForm 111===",this.ruleForm));let l=document.querySelector(".el-select-dropdown.customSelect");l.style.width="45%",l.style.height="45%";let a=document.querySelector(".el-select-dropdown.customSelect .el-scrollbar");a.style.display="block",a.style.height="100%";let i=document.querySelector(".el-select-dropdown.customSelect .el-scrollbar .el-select-dropdown__wrap");i.style.height="100%",i.style.maxHeight="500px",i.style.overflowX="auto";let s=document.querySelector(".el-select-dropdown.customSelect .el-select-dropdown__empty");s.style.display="none";let o=document.querySelector(".el-select-dropdown.customSelect .el-scrollbar__view");e.Data&&1===e.Data.length&&1===e.Data[0].children.length&&e.Data[0].children[0].id==this.vid?o.innerHTML=`<div class="select-content active">\n              <div class="select-all">选择全部</div>\n              ${t}</div>`:o.innerHTML=`<div class="select-content">\n              <div class="select-all">选择全部</div>\n              ${t}</div>`,this.bindIncident()}else this.$message({type:"error",message:"项目数据获取失败！"})}).catch(()=>{})},bindIncident(){console.log("this.ruleForm ===",this.ruleForm),this.$nextTick(()=>{let e=document.querySelector(".select-content .select-all");e.addEventListener("click",()=>{e.classList.contains("active")?(e.classList.remove("active"),t.forEach(e=>{e.classList.remove("active")})):(e.classList.add("active"),t.forEach(e=>{e.classList.add("active")})),this.setVillage()},!1);let t=document.querySelectorAll(".select-content ul li");t.forEach(t=>{t.onclick=t=>{let l=t.target,a=l.getAttribute("pid");if("0"==l.getAttribute("id")){let t=document.querySelectorAll(`.select-content ul li[pid='${a}']`);if(l.classList.contains("active"))t.forEach(e=>{e.classList.remove("active")}),l.classList.remove("active"),e.classList.remove("active");else{t.forEach(e=>{e.classList.add("active")}),l.classList.add("active");let a=document.querySelectorAll(".select-content ul li"),i=!0;for(let e=0;e<a.length;e++)if(!a[e].classList.contains("active")){i=!1;break}i&&e.classList.add("active")}}else{let t=document.querySelector(`.select-content ul li[id='0'][pid='${a}']`);if(l.classList.contains("active"))l.classList.remove("active"),t.classList.remove("active"),e.classList.remove("active");else{l.classList.add("active");let i=document.querySelectorAll(`.select-content ul li[pid='${a}']`),s=!0;for(let e=1;e<i.length;e++)if(!i[e].classList.contains("active")){s=!1;break}s&&t.classList.add("active");let o=document.querySelectorAll(".select-content ul li"),c=!0;for(let e=0;e<o.length;e++)if(!o[e].classList.contains("active")){c=!1;break}c&&e.classList.add("active")}}this.setVillage()}})})},setVillage(){let e=document.querySelectorAll(".select-content ul li"),t=[];e.forEach(e=>{e.classList.contains("active")&&"0"!=e.getAttribute("id")&&t.push({id:e.getAttribute("id"),name:e.innerText})}),this.villageSelected=t,console.log("this.ruleForm.village===",this.ruleForm.village),this.ruleForm.village=t.map(e=>e.name),this.villageChange()},villageChange(){},addDeviceSubmit(){this.isCommit=!0,setTimeout(()=>{this.isCommit=!1},1200)},filterVillage(e){this.choseVillageInfo.name=e.name,this.choseVillageInfo.vid=e.vid,this.deviceType="",this.searchVal="",this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad()},lazyLoad(e,t){this.$axios.post(this.urlObj.category,{pid:e.value}).then(e=>{if(200===e.Code)t(e.Data);else{let t=e.Message?e.Message:"获取设备类型数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{this.$message({type:"error",message:"执行失败！"})})},tableLoad(){this.conf.loadStatus=!0;let e={page:this.conf.curPage,limit:this.conf.limit,vid:this.choseVillageInfo.vid,category:this.deviceType[this.deviceType.length-1],keywords:this.searchVal};this.$axios.post(this.urlObj.equipments,e).then(e=>{200===e.Code?(e.Data.list.forEach(e=>{e.statusColor=1==e.status?"#333":"#999"}),this.conf.dataTotal=e.Data.count,this.tableData=e.Data.list,this.conf.loadStatus=!1,this.conf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=e.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},keySearch(){this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad()},sizeChange(e){this.conf.limit=e,this.tableLoad()},currentChange(e){this.conf.curPage=e,this.tableLoad()}}},n=c,r=(l("8b66"),l("1805")),d=Object(r["a"])(n,a,i,!1,null,null,null);t["default"]=d.exports},fb1a:function(e,t,l){}}]);