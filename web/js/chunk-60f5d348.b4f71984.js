(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-60f5d348"],{"0ea6":function(t,e,a){"use strict";a("dc13")},b326:function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"项目名称","prop":"villagename","show":true},{"type":"img","width":200,"label":"图标","prop":"image_host","show":true},{"type":"checkbox","label":"默认开启","prop":"status","action":"toOpen","role":"toOpen","show":true,"token":"empty"},{"type":"input","width":100,"label":"排序","prop":"sort","show":true}]}')},dc13:function(t,e,a){},f6d1:function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"应用名称","prop":"name","show":true},{"type":"img","width":200,"label":"应用图标","prop":"image_host","show":true},{"label":"默认状态","prop":"status_text","show":true},{"label":"地址","prop":"url","show":true,"color":"#999"},{"label":"排序","prop":"sort","show":true},{"label":"操作","prop":"","width":180,"type":"button","show":true,"btns":[{"name":"详情","type":"warning","size":"small","round":true,"action":"showDetail","role":"showDetail","token":"empty"},{"name":"编辑","type":"primary","size":"small","round":true,"action":"edit","role":"edit","token":"Btn-coBlPrkp2q7EbakyhURojqOa"}]}]}')},fb0d:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{attrs:{id:"application-manage"}},[e("div",{staticClass:"top"},[e("div",{staticClass:"main"},[e("div",{staticClass:"common-left"},[e("el-select",{attrs:{clearable:"",placeholder:"请选择默认状态"},on:{change:t.tableLoad},model:{value:t.statusVal,callback:function(e){t.statusVal=e},expression:"statusVal"}},t._l(t.statusOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"请输入应用名称"},domProps:{value:t.searchVal},on:{input:function(e){e.target.composing||(t.searchVal=e.target.value)}}}),e("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.keySearch}},[t._v(" 查询 ")])],1),e("div",{staticClass:"common-right"},[t.$menu.getters.judgeRole("Btn-Rl9zIwyFw6fLHz1Rtz25Tgi1")?e("el-button",{attrs:{type:"primary",round:"",plain:"",icon:"iconfont iconxinzeng"},on:{click:t.addApp}},[t._v(" 新增应用 ")]):t._e()],1)])]),e("div",{staticClass:"main-wp"},[e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.tableData,cusColums:t.columns,cusConf:t.conf},on:{showDetail:t.showDetail,edit:t.appEdit,imgPreview:t.imgPreview}})],1)]),e("el-dialog",{staticClass:"detailDialog",attrs:{visible:t.showDetailDialog,title:"应用详情",width:"60%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showDetailDialog=e}}},[e("div",{staticClass:"table-wp"},[e("el-scrollbar",{staticStyle:{height:"100%"}},[e("cus-table",{attrs:{datas:t.detailTableData,cusColums:t.detailColumns,cusConf:t.detailConf},on:{toOpen:t.toOpen,textChange:t.textChange,imgPreview:t.imgPreview}})],1)],1),e("span",{attrs:{slot:"footer"},slot:"footer"},[t.$menu.getters.judgeRole("Btn-vQi75j121aqU0ijwaQBiQ8p3")?e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.detailEdit}},[t._v(" 保存修改 ")]):t._e(),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showDetailDialog=!1}}},[t._v(" 取消 ")])],1)]),e("el-dialog",{staticClass:"editDialog",attrs:{visible:t.showEditDialog,title:t.dialogTitle,width:"36%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showEditDialog=e},close:t.editDialogClose}},[e("el-scrollbar",{staticStyle:{height:"100%"}},[e("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"hide-required-asterisk":!0}},[e("el-form-item",{attrs:{label:"应用名称",prop:"appName"}},[e("el-input",{attrs:{placeholder:"请输入应用名称"},model:{value:t.ruleForm.appName,callback:function(e){t.$set(t.ruleForm,"appName",e)},expression:"ruleForm.appName"}})],1),e("el-form-item",{attrs:{label:"默认状态",prop:"defaultState"}},[e("el-select",{attrs:{clearable:"",placeholder:"请选择默认状态"},model:{value:t.ruleForm.defaultState,callback:function(e){t.$set(t.ruleForm,"defaultState",e)},expression:"ruleForm.defaultState"}},t._l(t.statusList,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:"是否外链",prop:"isOutside"}},[e("el-select",{attrs:{clearable:"",placeholder:"请选择是否外链"},model:{value:t.ruleForm.isOutside,callback:function(e){t.$set(t.ruleForm,"isOutside",e)},expression:"ruleForm.isOutside"}},[e("el-option",{attrs:{label:"是",value:1}}),e("el-option",{attrs:{label:"否",value:0}})],1)],1),e("el-form-item",{attrs:{label:"应用appid",prop:"appid"}},[e("el-input",{attrs:{placeholder:"请输入应用appid"},model:{value:t.ruleForm.appid,callback:function(e){t.$set(t.ruleForm,"appid",e)},expression:"ruleForm.appid"}})],1),e("el-form-item",{attrs:{label:"应用地址",prop:"appAdress"}},[e("el-input",{attrs:{placeholder:"请输入应用地址"},model:{value:t.ruleForm.appAdress,callback:function(e){t.$set(t.ruleForm,"appAdress",e)},expression:"ruleForm.appAdress"}})],1),e("el-form-item",{attrs:{label:"应用排序",prop:"appSort"}},[e("el-input",{attrs:{type:"number",placeholder:"请输入应用排序"},model:{value:t.ruleForm.appSort,callback:function(e){t.$set(t.ruleForm,"appSort",e)},expression:"ruleForm.appSort"}})],1)],1),e("div",{staticClass:"file-upload"},[e("div",{staticClass:"title"},[t._v("应用图标")]),e("el-upload",{ref:"upload",attrs:{action:t.qiniuDatas.domain,limit:1,"list-type":"picture-card","file-list":t.fileList,"http-request":t.customUpload,"on-preview":t.handlePictureCardPreview,"on-remove":t.handleRemove}},[e("i",{staticClass:"el-icon-plus"})])],1)],1),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.formSubmit}},[t._v(" 提交保存 ")]),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showEditDialog=!1}}},[t._v(" 取消 ")])],1)],1),e("el-image",{ref:"preview",attrs:{src:t.imgSrc,"preview-src-list":t.imgList,"z-index":1e4}})],1)},s=[],l=(a("5948"),a("f6d1")),o=a("b326"),r=a("f31f"),p={name:"applicationManage",data(){return{urlObj:{uploadToken:this.$api.state.Public.uploadToken.url,applist:this.$api.state.Application.applist.url,addapplication:this.$api.state.Application.addapplication.url,editapplication:this.$api.state.Application.editapplication.url,applicationvillage:this.$api.state.Application.applicationvillage.url,saveapplication:this.$api.state.Application.saveapplication.url},searchVal:"",tableData:[],columns:l.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:10,dataTotal:0},detailTableData:[],detailColumns:o.list,detailConf:{loadStatus:!1,emptyText:"",curPage:1,limit:10,dataTotal:0},statusVal:"",statusOptions:[{value:1,label:"关闭"},{value:2,label:"开启"}],type:"add",currentIndex:"",showDetailDialog:!1,showEditDialog:!1,dialogTitle:"新增应用",statusList:[{value:0,label:"关闭"},{value:1,label:"开启"}],ruleForm:{appName:"",defaultState:"",isOutside:"",appid:"",appAdress:"",appSort:""},rules:{appName:[{required:!0,message:"请输入应用名称",trigger:"blur"}],defaultState:[{required:!0,message:"请选择默认状态",trigger:"change"}],isOutside:[{required:!0,message:"请选择是否外链",trigger:"change"}],appid:[{required:!1,message:"请输入应用appid",trigger:"blur"}],appAdress:[{required:!1,message:"请输入应用地址",trigger:"blur"}],appSort:[{required:!0,message:"请选择应用排序",trigger:"blur"}]},qiniuDatas:"",fileInfo:[],fileList:[],isCommit:!1,imgSrc:"",imgList:[]}},mounted(){this.tableLoad(),this.getUploadToken()},methods:{getUploadToken(){this.$axios.post(this.urlObj.uploadToken).then(t=>{200===t.Code&&(this.qiniuDatas=t.Data)})},customUpload(t){t.url=this.$refs.upload.uploadFiles[0].url;let e=Object(r["a"])(t,this.qiniuDatas);e.observable.subscribe({next:t=>{},error:t=>{},complete:t=>{this.fileInfo=[e.fileInfo]}})},handleRemove(){this.fileInfo=[]},handlePictureCardPreview(t){this.imgSrc=t.url,this.imgList=[t.url],this.$nextTick(()=>{this.$refs.preview.clickHandler()})},imgPreview(t){this.handlePictureCardPreview({url:t.image_host})},tableLoad(){this.conf.loadStatus=!0;let t={keywords:this.searchVal,status:this.statusVal};this.$axios.post(this.urlObj.applist,t).then(t=>{200===t.Code?(t.Data&&t.Data.length>0&&t.Data.forEach(t=>{t.status_text=1==t.status?"开启":"关闭"}),this.tableData=t.Data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=t.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},detailTableLoad(t){this.detailConf.loadStatus=!0;let e={id:this.tableData[t].id};this.$axios.post(this.urlObj.applicationvillage,e).then(t=>{200===t.Code?(this.detailTableData=t.Data?t.Data:[],this.detailConf.loadStatus=!1,this.detailConf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.detailTableData=[],this.detailConf.emptyText=t.Message,this.detailConf.dataTotal=0,this.detailConf.loadStatus=!1)}).catch(()=>{this.detailTableData=[],this.detailConf.emptyText="服务器连接失败...",this.detailConf.dataTotal=0,this.detailConf.loadStatus=!1})},keySearch(){this.tableLoad()},showDetail(t){this.currentIndex=t,this.showDetailDialog=!0,this.detailTableLoad(t)},addApp(){this.type="add",this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.dialogTitle="新增应用",this.fileInfo=[],this.fileList=[],this.imgSrc="",this.imgList=[],this.showEditDialog=!0},appEdit(t){this.showEditDialog=!0,this.currentIndex=t,this.type="edit",this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.dialogTitle="编辑应用设置",this.ruleForm.appName=this.tableData[t].name,this.ruleForm.defaultState=this.tableData[t].status,this.ruleForm.isOutside=this.tableData[t].is_outside,this.ruleForm.appid=this.tableData[t].appid,this.ruleForm.appAdress=this.tableData[t].url,this.ruleForm.appSort=this.tableData[t].sort,this.tableData[t].image&&(this.fileInfo=[{qiniu_key:this.tableData[t].image}],this.fileList=[{name:"",url:this.tableData[t].image_host}]),this.imgSrc="",this.imgList=[]},formSubmit(){this.$refs.ruleForm.validate(t=>{if(t){this.isCommit=!0;let t=this.urlObj.addapplication,e={name:this.ruleForm.appName,status:this.ruleForm.defaultState,is_outside:this.ruleForm.isOutside,appid:this.ruleForm.appid?this.ruleForm.appid:"",url:this.ruleForm.appAdress,sort:this.ruleForm.appSort};this.fileInfo.length>0&&(e.image=this.fileInfo[0].qiniu_key),"edit"==this.type&&(t=this.urlObj.editapplication,e.id=this.tableData[this.currentIndex].id),this.$axios.post(t,e).then(t=>{if(200===t.Code){let t="edit"==this.type?"应用编辑成功！":"添加应用成功！";this.$message({type:"success",message:t}),this.showEditDialog=!1,this.tableLoad()}else{let e="edit"==this.type?"应用编辑失败！":"添加应用失败！",a=t.Message?t.Message:e;this.$message({type:"error",message:a})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},editDialogClose(){this.$refs.upload.clearFiles()},toOpen(t){this.detailTableData[t.index].status=t.value},textChange(t){this.detailTableData[t.index].sort=t.value},detailEdit(){if(this.detailTableData.length>0){let t=[];this.detailTableData.forEach(e=>{let a={vid:e.id,status:e.status,sort:e.sort,image:e.image};t.push(a)});let e={app_id:this.tableData[this.currentIndex].id,village:t};this.isCommit=!0,this.$axios.post(this.urlObj.saveapplication,e).then(t=>{if(200===t.Code)this.$message({type:"success",message:"保存成功！"}),this.showDetailDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:"保存失败！";this.$message({type:"error",message:e})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}}}},n=p,u=(a("0ea6"),a("1805")),d=Object(u["a"])(n,i,s,!1,null,null,null);e["default"]=d.exports}}]);