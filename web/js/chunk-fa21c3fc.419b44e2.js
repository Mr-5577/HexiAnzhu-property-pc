(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fa21c3fc"],{3524:function(t,e,s){},4251:function(t,e,s){"use strict";s("3524")},"72bd":function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"单号","prop":"id","show":true},{"label":"项目","prop":"vname","show":true,"color":"#999"},{"label":"业主姓名","prop":"name","show":true,"color":"#999"},{"label":"房号","prop":"room","show":true},{"label":"投诉类型","prop":"tname","show":true,"color":"#999"},{"label":"联系电话","prop":"tel","show":true},{"label":"处理情况","prop":"status_text","show":true},{"label":"提交时间","prop":"create_time","show":true,"color":"#999"},{"label":"来源","prop":"from_text","show":true,"color":"#999"},{"label":"处理时间","prop":"followtime","show":true,"color":"#999"},{"label":"处理人","prop":"handler","show":true,"color":"#999"},{"label":"升级次数","prop":"upgrade_num","show":true,"color":"#3ebb75"},{"label":"操作","prop":"","width":170,"type":"button","show":true,"btns":[{"name":"详情","type":"primary","size":"small","round":true,"action":"detail","role":"detail","token":"empty"},{"name":"闭单","type":"warning","size":"small","hide":"bdhide","round":true,"action":"orderClose","role":"orderClose","token":"empty"}]}]}')},d821:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{attrs:{id:"complaint-advice"}},[e("div",{staticClass:"top"},[e("div",{staticClass:"main"},[e("div",{staticClass:"common-left"},[e("span",{staticClass:"common-chose-info",on:{click:function(e){return t.$refs.showFilterVillage.showDialog()}}},[e("workIcon",{attrs:{name:"build"}}),t._v(" "+t._s(t.choseVillageInfo.name)+" "),t.choseVillageInfo.vid?e("i",{staticClass:"close el-icon-circle-close",on:{click:function(e){e.stopPropagation(),t.choseVillageInfo={name:"全部项目",vid:""},t.keySearch()}}}):t._e()],1),e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"请输入投诉建议单号"},domProps:{value:t.searchVal},on:{input:function(e){e.target.composing||(t.searchVal=e.target.value)}}}),e("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(e){return t.keySearch()}}},[t._v(" 查询 ")])],1),e("div",{staticClass:"common-right"},[t.$menu.getters.judgeRole("Btn-R7AFa88XmCPvBr9dm7YDvuHa")?e("el-button",{attrs:{type:"primary",round:"",plain:"",icon:"iconfont iconxinzeng"},on:{click:t.newReport}},[t._v(" 新增投诉建议 ")]):t._e()],1)])]),e("div",{staticClass:"main-wp"},[e("div",{staticClass:"select-wp"},[e("el-select",{attrs:{clearable:"",placeholder:"请选择投诉类型"},on:{change:t.tableLoad},model:{value:t.typeVal,callback:function(e){t.typeVal=e},expression:"typeVal"}},t._l(t.typeOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.typename,value:t.id}})})),1),e("el-select",{attrs:{clearable:"",placeholder:"请选择业务状态"},on:{change:t.tableLoad},model:{value:t.statusVal,callback:function(e){t.statusVal=e},expression:"statusVal"}},t._l(t.statusOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),e("el-date-picker",{attrs:{type:"date","picker-options":t.spickerOptions,placeholder:"请选择开始日期","value-format":"timestamp"},on:{change:t.tableLoad},model:{value:t.startTime,callback:function(e){t.startTime=e},expression:"startTime"}}),t._v(" ~ "),e("el-date-picker",{attrs:{type:"date","picker-options":t.epickerOptions,placeholder:"请选择截止日期","value-format":"timestamp"},on:{change:t.tableLoad},model:{value:t.endTime,callback:function(e){t.endTime=e},expression:"endTime"}}),e("el-button",{attrs:{type:"primary empty",round:""},on:{click:t.exportDetailExcel}},[t._v(" 导出Excel ")])],1),e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.tableData,cusColums:t.columns,cusConf:t.conf,ispaging:!0},on:{sizeChange:t.sizeChange,currentChange:t.currentChange,detail:t.showDetail,orderClose:t.orderClose}})],1)]),e("filter-village",{ref:"showFilterVillage",attrs:{vid:t.choseVillageInfo.vid},on:{choseInfo:t.filterVillage}}),e("el-dialog",{staticClass:"addDialog",attrs:{visible:t.showAddDialog,title:"新增投诉建议",width:"36%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showAddDialog=e}}},[e("el-scrollbar",{staticStyle:{height:"100%"}},[e("div",{staticClass:"search-wp"},[e("el-autocomplete",{ref:"searchInput",staticClass:"advice-search",attrs:{"popper-class":"my-autocomplete","fetch-suggestions":t.querySearchAsync,placeholder:"请输入业主姓名、手机号"},on:{select:t.handleSelect},scopedSlots:t._u([{key:"default",fn:function({item:s}){return[e("div",{staticClass:"tr-item"},[e("span",{staticClass:"td-item"},[t._v(t._s(s.realname))]),e("span",{staticClass:"td-item"},[t._v(t._s(s.tel))]),e("span",{staticClass:"td-item"},[t._v(t._s(s.roomnum))])]),t.allUserList.length<=1?e("div",{staticClass:"load-more"},[t._v(" 暂无数据！ ")]):t._e()]}}]),model:{value:t.autoValue,callback:function(e){t.autoValue=e},expression:"autoValue"}},[e("i",{staticClass:"iconfont iconzu3664 el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})])],1),e("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"hide-required-asterisk":!0}},[e("el-form-item",{attrs:{label:"投诉类型",prop:"type"}},[e("el-select",{attrs:{clearable:"",placeholder:"请选择投诉类型"},model:{value:t.ruleForm.type,callback:function(e){t.$set(t.ruleForm,"type",e)},expression:"ruleForm.type"}},t._l(t.typeOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.typename,value:t.id}})})),1)],1),e("el-form-item",{attrs:{label:"业主姓名",prop:"uname"}},[e("el-input",{attrs:{placeholder:"请输入业主姓名",readonly:""},model:{value:t.ruleForm.uname,callback:function(e){t.$set(t.ruleForm,"uname",e)},expression:"ruleForm.uname"}})],1),e("el-form-item",{attrs:{label:"业主电话",prop:"tel"}},[e("el-input",{attrs:{placeholder:"请输入业主电话",readonly:""},model:{value:t.ruleForm.tel,callback:function(e){t.$set(t.ruleForm,"tel",e)},expression:"ruleForm.tel"}})],1),e("el-form-item",{attrs:{label:"业主房号",prop:"room"}},[e("el-input",{attrs:{placeholder:"请输入业主房号",readonly:""},model:{value:t.ruleForm.room,callback:function(e){t.$set(t.ruleForm,"room",e)},expression:"ruleForm.room"}})],1),e("el-form-item",{staticClass:"remark",attrs:{label:"情况描述",prop:"desc"}},[e("el-input",{attrs:{type:"textarea",resize:"none",rows:3,placeholder:"请输入具体情况描述"},model:{value:t.ruleForm.desc,callback:function(e){t.$set(t.ruleForm,"desc",e)},expression:"ruleForm.desc"}})],1)],1)],1),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.formSubmit}},[t._v(" 提交保存 ")]),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showAddDialog=!1}}},[t._v(" 取消 ")])],1)],1),e("el-dialog",{staticClass:"detailDialog",attrs:{visible:t.showDetailDialog,title:"处理详情",width:"50%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showDetailDialog=e}}},[e("el-scrollbar",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticStyle:{height:"100%"}},[t.isLoading?t._e():e("div",{staticClass:"main-content"},[e("div",{staticClass:"title"},[t._v("单号："+t._s(t.detailObj.id))]),e("div",{staticClass:"order-content"},[e("div",{staticClass:"order-item"},[e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("业主姓名")]),e("span",{staticClass:"value"},[t._v(t._s(t.detailObj.name))])]),e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("业主电话")]),e("span",{staticClass:"value"},[t._v(t._s(t.detailObj.tel))])]),e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("业主房号")]),e("span",{staticClass:"value"},[t._v(t._s(t.detailObj.room))])])]),e("div",{staticClass:"order-item"},[e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("事件类型")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.detailObj.type?t.detailObj.type.typename:"")+" ")])]),e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("提交时间")]),e("span",{staticClass:"value"},[t._v(t._s(t.detailObj.create_time))])]),e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("业务状态")]),0==t.detailObj.status?e("span",{staticClass:"value",staticStyle:{color:"#ffc21a"}},[t._v(" 待接单 ")]):1==t.detailObj.status?e("span",{staticClass:"value",staticStyle:{color:"#3ebb75"}},[t._v(" 已处理 ")]):2==t.detailObj.status?e("span",{staticClass:"value",staticStyle:{color:"#ffc21a"}},[t._v(" 处理中 ")]):3==t.detailObj.status?e("span",{staticClass:"value",staticStyle:{color:"#ffc21a"}},[t._v(" 已接单 ")]):4==t.detailObj.status?e("span",{staticClass:"value",staticStyle:{color:"#3ebb75"}},[t._v(" 已回访 ")]):5==t.detailObj.status?e("span",{staticClass:"value",staticStyle:{color:"#ff6d6d"}},[t._v(" 已超期 ")]):t._e()])]),e("div",{staticClass:"order-item desc"},[e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("情况描述")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.detailObj.repaircon)+" ")])])])]),t.detailObj.handle_info&&t.detailObj.handle_info.creater?e("div",{staticClass:"order-wp"},[e("div",{staticClass:"title"},[t._v(" 派单情况 ")]),e("div",{staticClass:"so-content"},[e("div",{staticClass:"order-item"},[e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("派单人员")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.detailObj.handle_info?t.detailObj.handle_info.creater:"")+" ")])]),e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("处理人员")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.detailObj.handle_info?t.detailObj.handle_info.creater:"")+" ")])])]),e("div",{staticClass:"order-item so"},[e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("派单要求")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.detailObj.handle_info?t.detailObj.handle_info.dealrequirement:"")+" ")])]),e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("派单时间")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.detailObj.handle_info?t.detailObj.handle_info.dispatchtime:"")+" ")])])])])]):t._e(),t.detailObj.hasRecord?e("div",{staticClass:"record-wp"},[e("div",{staticClass:"title record",on:{click:function(e){t.showRecord=!t.showRecord}}},[t._v(" 处理跟进记录 "),t.showRecord?e("i",{staticClass:"el-icon-caret-top"}):e("i",{staticClass:"el-icon-caret-bottom"})]),t.showRecord?e("div",{staticClass:"records"},[t.detailObj.list.chuli&&t.detailObj.list.chuli.length>0?e("div",{staticClass:"record-content"},[e("div",{staticClass:"title"},[t._v("处理记录")]),t._l(t.detailObj.list.chuli,(function(s){return e("div",{key:s.id,staticClass:"content"},[e("div",{staticClass:"info-left"},[e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("处理人")]),e("span",{staticClass:"value"},[t._v(t._s(s.handleUser.realname))])]),e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("处理时间")]),e("span",{staticClass:"value"},[t._v(t._s(s.ctime))])]),e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("相关附件")]),s.file&&s.file.length>0?e("span",{staticClass:"value"},t._l(s.file,(function(s,a){return e("img",{key:a,attrs:{src:s,alt:""},on:{click:function(e){return t.imgPreview(s)}}})})),0):t._e()])]),e("div",{staticClass:"info-right"},[e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("处理结果")]),e("span",{staticClass:"value"},[t._v(" "+t._s(s.content)+" ")])])])])}))],2):t._e(),t.detailObj.list.genjin&&t.detailObj.list.genjin.length>0?e("div",{staticClass:"record-content"},[e("div",{staticClass:"title"},[t._v("跟进记录")]),t._l(t.detailObj.list.genjin,(function(s){return e("div",{key:s.id,staticClass:"content"},[e("div",{staticClass:"info-left"},[e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("跟进人")]),e("span",{staticClass:"value"},[t._v(t._s(s.handleUser.realname))])]),e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("跟进时间")]),e("span",{staticClass:"value"},[t._v(t._s(s.ctime))])]),e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("相关附件")]),s.file&&s.file.length>0?e("span",{staticClass:"value"},t._l(s.file,(function(s,a){return e("img",{key:a,attrs:{src:s,alt:""},on:{click:function(e){return t.imgPreview(s)}}})})),0):t._e()])]),e("div",{staticClass:"info-right"},[e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("跟进备注")]),e("span",{staticClass:"value"},[t._v(" "+t._s(s.content)+" ")])])])])}))],2):t._e(),t.detailObj.list.huifang&&t.detailObj.list.huifang.length>0?e("div",{staticClass:"record-content"},[e("div",{staticClass:"title"},[t._v("回访记录")]),t._l(t.detailObj.list.huifang,(function(s){return e("div",{key:s.id,staticClass:"content"},[e("div",{staticClass:"info-left"},[e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("回访人")]),e("span",{staticClass:"value"},[t._v(t._s(s.handleUser.realname))])]),e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("回访时间")]),e("span",{staticClass:"value"},[t._v(t._s(s.ctime))])]),e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("相关附件")]),s.file&&s.file.length>0?e("span",{staticClass:"value"},t._l(s.file,(function(s,a){return e("img",{key:a,attrs:{src:s,alt:""},on:{click:function(e){return t.imgPreview(s)}}})})),0):t._e()])]),e("div",{staticClass:"info-right"},[e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v("回访备注")]),e("span",{staticClass:"value"},[t._v(" "+t._s(s.content)+" ")])])])])}))],2):t._e()]):t._e()]):t._e(),t.detailObj.score||t.detailObj.evaluate_content?e("div",{staticClass:"evaluate-wp"},[e("div",{staticClass:"title"},[t._v(" 业主评价 "),e("el-rate",{attrs:{disabled:"","show-score":"","text-color":"#ff9900"},model:{value:t.detailObj.score,callback:function(e){t.$set(t.detailObj,"score",e)},expression:"detailObj.score"}})],1),e("el-input",{attrs:{type:"textarea",resize:"none",rows:3,readonly:"",placeholder:"暂无评价内容"},model:{value:t.detailObj.evaluate_content,callback:function(e){t.$set(t.detailObj,"evaluate_content",e)},expression:"detailObj.evaluate_content"}})],1):t._e(),1!=t.detailObj.dispatch_auth||0!=t.detailObj.status&&3!=t.detailObj.status?t._e():e("div",{staticClass:"handle-wp"},[e("div",{staticClass:"head"},[t._v("选择处理人")]),e("el-select",{attrs:{filterable:"",placeholder:"请选择处理人"},model:{value:t.userVal,callback:function(e){t.userVal=e},expression:"userVal"}},t._l(t.userOptions,(function(t){return e("el-option",{key:t.uid,attrs:{label:t.posname+"-"+t.realname,value:t.uid}})})),1),e("div",{staticClass:"head"},[t._v("派单要求")]),e("el-input",{staticClass:"content",attrs:{type:"textarea",resize:"none",rows:3,placeholder:"请输入派单要求"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),e("div",{staticClass:"btn-wp"},[t.$menu.getters.judgeRole("Btn-8JkLnO6FRvzCkldVmgwdcpdZ")?e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.sendOrders}},[t._v(" 去派单 ")]):t._e()],1)],1),1!=t.detailObj.reassignment_auth||2!=t.detailObj.status&&3!=t.detailObj.status?t._e():e("div",{staticClass:"handle-wp"},[e("div",{staticClass:"head"},[t._v("选择改派人")]),e("el-select",{attrs:{filterable:"",remote:"",placeholder:"输入姓名、电话号搜索","remote-method":t.remoteMethod,loading:t.loading},model:{value:t.reassign,callback:function(e){t.reassign=e},expression:"reassign"}},t._l(t.reassignOptions,(function(t){return e("el-option",{key:t.uid,attrs:{label:t.deptname+"-"+t.realname,value:t.uid}})})),1),e("div",{staticClass:"btn-wp"},[t.$menu.getters.judgeRole("Btn-bi50QaMjbVrlBxVUyE1bkEcu")?e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.reassignOrder}},[t._v(" 改派订单 ")]):t._e()],1)],1),1==t.detailObj.returnvisit_auth&&1==t.detailObj.status?e("div",{staticClass:"handle-wp"},[e("div",{staticClass:"head"},[t._v("是否满意")]),e("el-select",{attrs:{clearable:"",placeholder:"请选择默认状态"},on:{change:t.tableLoad},model:{value:t.isSatisfa,callback:function(e){t.isSatisfa=e},expression:"isSatisfa"}},t._l(t.satisfaOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),e("div",{staticClass:"head"},[t._v("回访结果")]),e("el-input",{staticClass:"content",attrs:{type:"textarea",resize:"none",rows:3,placeholder:"请输入回访结果"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),e("div",{staticClass:"btn-wp"},[t.$menu.getters.judgeRole("Btn-BOMEs53mDPDPM1Y0bs4HxEkc")?e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.returnVisit}},[t._v(" 确认回访 ")]):t._e()],1)],1):t._e(),1!=t.detailObj.handle_auth||2!=t.detailObj.status&&3!=t.detailObj.status?t._e():e("div",{staticClass:"handle-wp"},[e("div",{staticClass:"file-upload"},[e("div",{staticClass:"head"},[t._v("上传附件")]),e("el-upload",{ref:"upload",attrs:{action:t.qiniuDatas.domain,"list-type":"picture-card","file-list":t.fileList,"http-request":t.customUpload,"on-preview":t.handlePictureCardPreview,"on-remove":t.handleRemove}},[e("i",{staticClass:"el-icon-plus"})]),e("el-dialog",{staticClass:"imgPreview",attrs:{visible:t.dialogVisible,"append-to-body":!0},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1),e("div",{staticClass:"head"},[t._v("处理结果")]),e("el-input",{staticClass:"content",attrs:{type:"textarea",resize:"none",rows:3,placeholder:"请输入处理结果"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),e("div",{staticClass:"btn-wp"},[t.$menu.getters.judgeRole("Btn-Qwe5Kskc2SRgKobL9dzGuLEk")?e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.handleFinish}},[t._v(" 完成处理 ")]):t._e()],1)],1)])])],1),e("el-image",{ref:"preview",attrs:{src:t.imgSrc,"preview-src-list":t.imgList,"z-index":1e4}})],1)},i=[],l=(s("5948"),s("f31f")),o=s("72bd"),n=s("4698"),r={name:"complaintAdvice",components:{workIcon:n["a"]},data(){return{urlObj:{complaintlist:this.$api.state.Custom.complaintlist.url,getrepairtype:this.$api.state.Custom.getrepairtype.url,searchrooms:this.$api.state.Custom.searchrooms.url,addcomplaint:this.$api.state.Custom.addcomplaint.url,complaintdetail:this.$api.state.Custom.complaintdetail.url,complaintUser:this.$api.state.Custom.complaintUser.url,compdispatch:this.$api.state.Custom.compdispatch.url,nmentusers:this.$api.state.Custom.nmentusers.url,complaintchange:this.$api.state.Custom.complaintchange.url,complreturn:this.$api.state.Custom.complreturn.url,complainthandle:this.$api.state.Custom.complainthandle.url,complaintclose:this.$api.state.Custom.complaintclose.url,uploadToken:this.$api.state.Public.uploadToken.url},choseVillageInfo:{name:"全部项目",vid:0},searchVal:"",startTime:"",endTime:"",tableData:[],columns:o.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},typeVal:"",typeOptions:[],statusVal:"",statusOptions:[{value:1,label:"待接单"},{value:2,label:"已处理"},{value:3,label:"处理中"},{value:4,label:"已接单"},{value:5,label:"已回访"},{value:6,label:"超期"}],showAddDialog:!1,ruleForm:{type:"",uname:"",tel:"",room:"",desc:""},rules:{type:[{required:!0,message:"请选择投诉类型",trigger:"change"}],uname:[{required:!0,message:"请输入业主姓名",trigger:"change"}],tel:[{required:!0,message:"请输入业主电话",trigger:"change"}],room:[{required:!0,message:"请输入业主房号",trigger:"change"}],desc:[{required:!0,message:"请输入具体情况描述",trigger:"blur"}]},autoValue:"",allUserList:[],currentUser:{},isCommit:!1,showDetailDialog:!1,isLoading:!1,showRecord:!1,detailObj:"",userVal:"",userOptions:[],content:"",loading:!1,reassign:"",reassignOptions:[],isSatisfa:"",satisfaOptions:[{value:0,label:"不满意"},{value:1,label:"满意"}],qiniuDatas:"",fileInfo:[],fileList:[],dialogImageUrl:"",dialogVisible:!1,imgSrc:"",imgList:[]}},computed:{spickerOptions(){return{disabledDate:t=>{if(t)return!!this.endTime&&t.getTime()>this.endTime}}},epickerOptions(){return{disabledDate:t=>{if(t)return!!this.startTime&&t.getTime()<this.startTime}}}},mounted(){let t=sessionStorage.getItem("vid"),e=sessionStorage.getItem("vname");t&&(this.choseVillageInfo.vid=t,this.choseVillageInfo.name=e),this.tableLoad(),this.getTypeList()},methods:{filterVillage(t){this.choseVillageInfo.name=t.name,this.choseVillageInfo.vid=t.vid,this.searchVal="",this.typeVal="",this.statusVal="",this.startTime="",this.endTime="",this.keySearch()},getTypeList(){this.$axios.post(this.urlObj.getrepairtype,{type:2}).then(t=>{if(200===t.Code)this.typeOptions=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取投诉类型失败！";this.$message({type:"error",message:e})}}).catch(()=>{})},tableLoad(){this.conf.loadStatus=!0;let t={page:this.conf.curPage,limit:this.conf.limit,keywords:this.searchVal,vid:this.choseVillageInfo.vid,type:this.typeVal,status:this.statusVal};this.startTime&&(t.starttime=this.startTime/1e3),this.endTime&&(t.endtime=this.endTime/1e3),this.$axios.post(this.urlObj.complaintlist,t).then(t=>{200===t.Code?(t.Data.data&&t.Data.data.length>0&&t.Data.data.forEach(e=>{e.vname=e.village?e.village.villagename:"",e.tname=e.type?e.type.typename:"",1!=e.status&&4!=e.status&&1==t.Data.close_auth?e.bdhide=!1:e.bdhide=!0}),this.conf.dataTotal=t.Data.total,this.tableData=t.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.datas=[],this.conf.emptyText=t.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.datas=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},keySearch(){this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad()},sizeChange(t){this.conf.limit=t,this.tableLoad()},currentChange(t){this.conf.curPage=t,this.tableLoad()},newReport(){this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.showAddDialog=!0},async querySearchAsync(t,e){if(t){let s={keyword:t,vid:this.choseVillageInfo.vid},a=await this.$axios.post(this.urlObj.searchrooms,s);if(200===a.Code){a.Data=a.Data?a.Data:[];let t={id:0,realname:"姓名",tel:"电话号码",roomnum:"房号"};a.Data.unshift(t),this.allUserList=a.Data,this.nomore=!1,e(a.Data)}else this.$refs.searchInput.$children[0].blur()}else e([])},handleSelect(t){this.currentUser=t,this.ruleForm.uname=t.realname,this.ruleForm.tel=t.tel,this.ruleForm.room=t.roomnum},formSubmit(){this.$refs.ruleForm.validate(t=>{if(t){this.isCommit=!0;let t={vid:this.choseVillageInfo.vid,type:this.ruleForm.type,title:this.ruleForm.desc};this.currentUser.id&&(t.name=this.currentUser.realname?this.currentUser.realname:"",t.tel=this.currentUser.tel?this.currentUser.tel:"",t.room=this.currentUser.roomnum?this.currentUser.roomnum:"",t.unit=this.currentUser.unit?this.currentUser.unit:""),this.$axios.post(this.urlObj.addcomplaint,t).then(t=>{if(200===t.Code)this.$message({message:"新增投诉建议成功！",type:"success"}),this.showAddDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:"新增投诉建议失败！";this.$message({message:e,type:"error"})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},showDetail(t){this.showRecord=!1,this.detailObj="",this.userVal="",this.content="",this.reassign="",this.reassignOptions=[],this.showDetailDialog=!0,this.getDetailData(this.tableData[t].id),this.getUploadToken()},getDetailData(t){this.isLoading=!0,this.$axios.post(this.urlObj.complaintdetail,{id:t}).then(t=>{if(200===t.Code)t.Data.hasRecord=t.Data.list.chuli&&t.Data.list.chuli.length>0||t.Data.list.genjin&&t.Data.list.genjin.length>0||t.Data.list.huifang&&t.Data.list.huifang.length>0,this.detailObj=t.Data,this.getHandleUser();else{let e=t.Message?t.Message:"获取投诉详情数据失败！";this.$message({type:"error",message:e})}this.isLoading=!1}).catch(()=>{this.isLoading=!1})},orderClose(t){this.$confirm("此操作将关闭当前投诉建议订单，确定继续操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let e={id:this.tableData[t].id};this.$axios.post(this.urlObj.complaintclose,e).then(t=>{if(200===t.Code)this.$message({message:"闭单成功！",type:"success"}),this.tableLoad();else{let e=t.Message?t.Message:"闭单失败！";this.$message({message:e,type:"error"})}}).catch(()=>{})}).catch(()=>{})},getHandleUser(){this.$axios.post(this.urlObj.complaintUser,{id:this.detailObj.id}).then(t=>{if(200===t.Code)this.userOptions=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取处理人员数据失败！";this.$message({type:"error",message:e})}}).catch(()=>{})},sendOrders(){if(this.userVal||this.content)if(this.userVal)if(this.content){let t={id:this.detailObj.id,handler_uid:this.userVal,content:this.content};this.$axios.post(this.urlObj.compdispatch,t).then(t=>{if(200===t.Code)this.$message({type:"success",message:"派单成功！"}),this.showDetailDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:"派单失败！";this.$message({type:"error",message:e})}}).catch(()=>{})}else this.$message({type:"warning",message:"请填写派单要求！"});else this.$message({type:"warning",message:"请选择处理人！"});else this.$message({type:"warning",message:"处理人和派单要求不能为空！"})},remoteMethod(t){""!==t?(this.loading=!0,this.$axios.post(this.urlObj.nmentusers,{keywords:t}).then(t=>{if(200===t.Code)this.reassignOptions=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取改派人员数据失败！";this.$message({type:"error",message:e})}this.loading=!1}).catch(()=>{this.loading=!1})):this.gaipaiOptions=[]},reassignOrder(){if(this.reassign){let t={id:this.detailObj.id,user_id:this.reassign};this.$axios.post(this.urlObj.complaintchange,t).then(t=>{if(200===t.Code)this.$message({type:"success",message:"订单改派成功！"}),this.showDetailDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:"订单改派失败！";this.$message({type:"error",message:e})}}).catch(()=>{})}else this.$message({type:"warning",message:"请选择改派人员！"})},returnVisit(){if(this.content||this.isSatisfa||0===this.isSatisfa)if(this.content)if(0===this.isSatisfa||this.isSatisfa){let t={id:this.detailObj.id,content:this.content,is_satisfy:this.isSatisfa};this.$axios.post(this.urlObj.complreturn,t).then(t=>{if(200===t.Code)this.$message({type:"success",message:"回访成功！"}),this.showDetailDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:"回访失败！";this.$message({type:"error",message:e})}}).catch(()=>{})}else this.$message({type:"warning",message:"请选择是否满意！"});else this.$message({type:"warning",message:"请输入回访结果！"});else this.$message({type:"warning",message:"请填写回访结果、是否满意！"})},getUploadToken(){this.$axios.post(this.urlObj.uploadToken).then(t=>{200===t.Code&&(this.qiniuDatas=t.Data)})},customUpload(t){t.url=this.$refs.upload.uploadFiles[0].url;let e=Object(l["a"])(t,this.qiniuDatas);e.observable.subscribe({next:()=>{},error:()=>{},complete:()=>{e.fileInfo.uid=t.file.uid,this.fileInfo.push(e.fileInfo)}})},handleRemove(t){let e=this.fileInfo.findIndex(e=>e.uid==t.uid);-1!=e&&this.fileInfo.splice(e,1)},handlePictureCardPreview(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},handleFinish(){if(this.content){let t=this.fileInfo.map(t=>t.qiniu_key),e={id:this.detailObj.id,content:this.content};t.length>0&&(e.img_arr=t),this.$axios.post(this.urlObj.complainthandle,e).then(t=>{if(200===t.Code)this.$message({type:"success",message:"订单已完成处理！"}),this.showDetailDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:"订单完成处理失败！";this.$message({type:"error",message:e})}}).catch(()=>{})}else this.$message({type:"warning",message:"请输入处理结果！"})},imgPreview(t){this.imgSrc=t,this.imgList=[t],this.$nextTick(()=>{this.$refs.preview.clickHandler()})},exportDetailExcel(){try{let t={page:this.conf.curPage,limit:this.conf.limit,keywords:this.searchVal,vid:this.choseVillageInfo.vid,type:this.typeVal,status:this.statusVal,is_excel:1};this.startTime&&(t.starttime=this.startTime/1e3),this.endTime&&(t.endtime=this.endTime/1e3),this.$axios.post(this.urlObj.complaintlist,t).then(t=>{if(200===t.Code){let e="投诉建议数据表",a=["来源","项目","业主","房号","类型","内容","电话","状态","提交时间","处理时间","处理人","派单人","升级次数"],i=[];t.Data.forEach(t=>{let e=[t.from_text,t.village.villagename,t.name,t.room,t.type.typename,t.repaircon,t.tel,t.status_text,t.create_time,t.followtime,t.handler,t.distributeer,t.upgrade_num];i.push(e)}),Promise.all([s.e("chunk-3a869cfb"),s.e("chunk-2a5081b0"),s.e("chunk-3a96421c")]).then((()=>{let{export_json_to_excel:t}=s("628d");t(a,i,e)}).bind(null,s)).catch(s.oe),this.$notify({type:"success",title:"温馨提示",message:"导出报表成功",duration:1500})}else{let e=t.Message?t.Message:"投诉建议数据获取失败！";this.$message({type:"error",message:e})}})}catch(t){this.$notify({type:"error",title:"温馨提示",message:"导出报表失败",duration:1500})}}}},c=r,d=(s("4251"),s("1805")),u=Object(d["a"])(c,a,i,!1,null,null,null);e["default"]=u.exports}}]);