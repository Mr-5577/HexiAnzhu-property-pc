(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3aad5dee"],{"0138":function(t){t.exports=JSON.parse('{"list":[{"label":"领卡数量","prop":"number","show":true},{"label":"领卡时间","prop":"receive_time","show":true,"color":"#999"},{"label":"领用人员","prop":"user","show":true,"color":"#999"}]}')},2632:function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"项目","prop":"vname","show":true},{"label":"客户姓名","prop":"oname","show":true,"color":"#999"},{"label":"房号","prop":"roomnum","show":true,"color":"#999"},{"label":"卡号","prop":"code","show":true},{"label":"金额","prop":"card_money","show":true,"color":"#ffcb3c"},{"label":"操作人员","prop":"cname","show":true,"color":"#999"},{"label":"销售日期","prop":"create_time","show":true,"color":"#999","width":200}]}')},"458e":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{attrs:{id:"ic-standing"}},[e("div",{staticClass:"top"},[e("div",{staticClass:"main"},[e("div",{staticClass:"common-left"},[e("span",{staticClass:"common-chose-info",on:{click:function(e){return t.$refs.showFilterVillage.showDialog()}}},[e("i",{staticClass:"iconfont icondaqu"}),t._v(" "+t._s(t.choseVillageInfo.name)+" ")])]),e("div",{staticClass:"common-right"},[t.$menu.getters.judgeRole("Btn-D1B0D93857FE0020971B9991")?e("el-button",{staticClass:"common-button",attrs:{type:"warning",plain:"",icon:"iconfont iconxinzeng"},on:{click:t.addCard}},[t._v(" 新增领卡 ")]):t._e(),t.$menu.getters.judgeRole("Btn-D1B0D93857FE0020971B9992")?e("el-button",{staticClass:"common-button",attrs:{type:"primary",plain:"",icon:"iconfont iconzu3638"},on:{click:t.cardRecord}},[t._v(" 领卡记录 ")]):t._e()],1)])]),e("div",{staticClass:"main-wp"},[e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.tableData,cusColums:t.columns,cusConf:t.conf,ispaging:!0},on:{sizeChange:t.sizeChange,currentChange:t.currentChange}}),e("div",{staticClass:"number-wp"},[e("div",{staticClass:"num-item"},[e("span",{staticClass:"name"},[t._v("领回合计：")]),e("span",{staticClass:"value"},[t._v(t._s(t.total1))])]),e("div",{staticClass:"num-item"},[e("span",{staticClass:"name"},[t._v("销售合计：")]),e("span",{staticClass:"value"},[t._v(t._s(t.total2))])]),e("div",{staticClass:"num-item"},[e("span",{staticClass:"name"},[t._v("剩余张数：")]),e("span",{staticClass:"value yellow"},[t._v(t._s(t.total3))])])])],1)]),e("el-dialog",{staticClass:"addDialog",attrs:{visible:t.showAddDialog,title:"新增领卡",width:"30%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showAddDialog=e}}},[e("el-scrollbar",{staticStyle:{height:"100%"}},[e("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"hide-required-asterisk":!0}},[e("el-form-item",{attrs:{label:"领用人员",prop:"user"}},[e("el-input",{attrs:{readonly:"",placeholder:"请输入领用人员"},model:{value:t.ruleForm.user,callback:function(e){t.$set(t.ruleForm,"user",e)},expression:"ruleForm.user"}})],1),e("el-form-item",{attrs:{label:"领用时间",prop:"time"}},[e("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"请选择领用时间"},model:{value:t.ruleForm.time,callback:function(e){t.$set(t.ruleForm,"time",e)},expression:"ruleForm.time"}})],1),e("el-form-item",{attrs:{label:"领用数量",prop:"number"}},[e("el-input",{attrs:{type:"number",placeholder:"请输入领用数量"},model:{value:t.ruleForm.number,callback:function(e){t.$set(t.ruleForm,"number",e)},expression:"ruleForm.number"}})],1)],1)],1),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.formSubmit}},[t._v(" 确认领卡 ")]),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showAddDialog=!1}}},[t._v(" 取消 ")])],1)],1),e("el-dialog",{staticClass:"recordDialog",attrs:{visible:t.showRecordDialog,title:"领卡记录",width:"60%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showRecordDialog=e}}},[e("cus-table",{attrs:{datas:t.recordTableData,cusColums:t.recordColumns,cusConf:t.recordConf,ispaging:!1}})],1),e("filter-village",{ref:"showFilterVillage",attrs:{vid:t.choseVillageInfo.vid},on:{choseInfo:t.filterVillage}})],1)},o=[],i=(a("5948"),a("2632")),l=a("0138"),r={name:"icstanding",data(){return{urlObj:{standlist:this.$api.state.Means.standlist.url,addrecord:this.$api.state.Means.addrecord.url,recordlist:this.$api.state.Means.recordlist.url},choseVillageInfo:{name:"全部项目",vid:0},tableData:[],columns:i.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},showAddDialog:!1,ruleForm:{user:"",time:"",number:""},rules:{user:[{required:!0,message:"请输入领用人员",trigger:"blur"}],time:[{required:!0,message:"请选择领用时间",trigger:"change"}],number:[{required:!0,message:"请输入领用数量",trigger:"blur"}]},showRecordDialog:!1,recordTableData:[],recordColumns:l.list,recordConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},isCommit:!1,total1:0,total2:0,total3:0}},mounted(){let t=sessionStorage.getItem("vid"),e=sessionStorage.getItem("vname");t&&(this.choseVillageInfo.vid=t,this.choseVillageInfo.name=e),this.tableLoad()},methods:{filterVillage(t){this.choseVillageInfo.name=t.name,this.choseVillageInfo.vid=t.vid,this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad()},tableLoad(){this.conf.loadStatus=!0;let t={vid:this.choseVillageInfo.vid,page:this.conf.curPage,limit:this.conf.limit};this.$axios.post(this.urlObj.standlist,t).then(t=>{200===t.Code?(t.Data.list.forEach(t=>{t.vname=t.village.villagename,t.oname=t.owner.realname,t.roomnum=t.owner.rooms.map(t=>t.roomnum).join("、"),t.cname=t.creator.realname}),this.total1=t.Data.total_count,this.total2=t.Data.sale_count,this.total3=t.Data.available_count,this.tableData=t.Data.list,this.conf.dataTotal=t.Data.sale_count,this.conf.loadStatus=!1,this.conf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=t.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},sizeChange(t){this.conf.limit=t,this.tableLoad()},currentChange(t){this.conf.curPage=t,this.tableLoad()},recordTableLoad(){this.recordConf.loadStatus=!0;let t={vid:this.choseVillageInfo.vid};this.$axios.post(this.urlObj.recordlist,t).then(t=>{200===t.Code?(t.Data.forEach(t=>{t.user=t.receiver.realname}),this.recordTableData=t.Data,this.recordConf.loadStatus=!1,this.recordConf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.recordTableData=[],this.recordConf.emptyText=t.Message,this.recordConf.dataTotal=0,this.recordConf.loadStatus=!1)}).catch(()=>{this.recordTableData=[],this.recordConf.emptyText="服务器连接失败...",this.recordConf.dataTotal=0,this.recordConf.loadStatus=!1})},addCard(){this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.ruleForm.user=sessionStorage.getItem("realname"),this.ruleForm.time=new Date,this.showAddDialog=!0},cardRecord(){this.showRecordDialog=!0,this.recordTableLoad()},formSubmit(){this.$refs.ruleForm.validate(t=>{if(t){this.isCommit=!0;let t={vid:this.choseVillageInfo.vid,receiver:sessionStorage.getItem("uid"),receive_time:this.ruleForm.time,number:this.ruleForm.number};this.$axios.post(this.urlObj.addrecord,t).then(t=>{if(200===t.Code)this.$message({type:"success",message:"领卡成功！"}),this.showAddDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:"领卡失败！";this.$message({type:"error",message:e})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})}}},n=r,c=(a("d805"),a("1805")),d=Object(c["a"])(n,s,o,!1,null,null,null);e["default"]=d.exports},d805:function(t,e,a){"use strict";a("ea4b")},ea4b:function(t,e,a){}}]);