(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-71eead04"],{"54e9":function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"应用名称","prop":"name","show":true},{"type":"img","width":200,"label":"应用图标","prop":"image_host","show":true},{"label":"默认状态","prop":"status_text","show":true},{"label":"地址","prop":"url","show":true,"color":"#999"},{"label":"排序","prop":"sort","show":true},{"label":"操作","prop":"","width":180,"type":"button","show":true,"btns":[{"name":"编辑","type":"primary","size":"small","round":true,"action":"edit","role":"edit","token":"Btn-YLRw5xaTBbqiy3GMMx5cmEhF"}]}]}')},a60a:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{attrs:{id:"online-detail"}},[e("div",{staticClass:"top"},[e("div",{staticClass:"main"},[e("div",{staticClass:"common-left"},[e("span",{staticClass:"common-chose-info",on:{click:function(e){return t.$refs.showFilterVillage.showDialog()}}},[e("i",{staticClass:"iconfont icondaqu"}),t._v(" "+t._s(t.choseVillageInfo.name)+" ")]),e("el-select",{attrs:{clearable:"",placeholder:"请选择默认状态"},on:{change:t.tableLoad},model:{value:t.statusVal,callback:function(e){t.statusVal=e},expression:"statusVal"}},t._l(t.statusOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"请输入应用名称"},domProps:{value:t.searchVal},on:{input:function(e){e.target.composing||(t.searchVal=e.target.value)}}}),e("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(e){return t.keySearch(!0)}}},[t._v(" 查询 ")])],1)])]),e("div",{staticClass:"main-wp"},[e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.tableData,cusColums:t.columns,cusConf:t.conf},on:{edit:t.appEdit,imgPreview:t.imgPreview}})],1)]),e("filter-village",{ref:"showFilterVillage",attrs:{vid:t.choseVillageInfo.vid},on:{choseInfo:t.filterVillage}}),e("el-dialog",{staticClass:"editDialog",attrs:{visible:t.showEditDialog,title:"编辑应用",width:"36%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showEditDialog=e},close:t.editDialogClose}},[e("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"hide-required-asterisk":!0}},[e("el-form-item",{attrs:{label:"应用名称",prop:"appName"}},[e("el-input",{attrs:{placeholder:"请输入应用名称",readonly:""},model:{value:t.ruleForm.appName,callback:function(e){t.$set(t.ruleForm,"appName",e)},expression:"ruleForm.appName"}})],1),e("el-form-item",{attrs:{label:"默认状态",prop:"defaultState"}},[e("el-select",{attrs:{clearable:"",placeholder:"请选择默认状态"},model:{value:t.ruleForm.defaultState,callback:function(e){t.$set(t.ruleForm,"defaultState",e)},expression:"ruleForm.defaultState"}},t._l(t.statusList,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:"应用地址",prop:"appAdress"}},[e("el-input",{attrs:{placeholder:"请输入应用地址",readonly:""},model:{value:t.ruleForm.appAdress,callback:function(e){t.$set(t.ruleForm,"appAdress",e)},expression:"ruleForm.appAdress"}})],1),e("el-form-item",{attrs:{label:"应用排序",prop:"appSort"}},[e("el-input",{attrs:{type:"number",placeholder:"请输入应用排序"},model:{value:t.ruleForm.appSort,callback:function(e){t.$set(t.ruleForm,"appSort",e)},expression:"ruleForm.appSort"}})],1)],1),e("div",{staticClass:"file-upload"},[e("div",{staticClass:"title"},[t._v("应用图标")]),e("el-upload",{ref:"upload",attrs:{action:t.qiniuDatas.domain,limit:1,"list-type":"picture-card","file-list":t.fileList,"http-request":t.customUpload,"on-preview":t.handlePictureCardPreview,"on-remove":t.handleRemove}},[e("i",{staticClass:"el-icon-plus"})])],1),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.formSubmit}},[t._v(" 提交保存 ")]),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showEditDialog=!1}}},[t._v(" 取消 ")])],1)],1),e("el-image",{ref:"preview",attrs:{src:t.imgSrc,"preview-src-list":t.imgList,"z-index":1e4}})],1)},i=[],l=(a("5948"),a("54e9")),o=a("f31f"),r={name:"onlineDetail",data(){return{urlObj:{uploadToken:this.$api.state.Public.uploadToken.url,villageapplication:this.$api.state.Application.villageapplication.url,editvillageapp:this.$api.state.Application.editvillageapp.url},searchVal:"",choseVillageInfo:{name:"全部项目",vid:0},tableData:[],columns:l.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:10,dataTotal:0},statusVal:"",statusOptions:[{value:1,label:"关闭"},{value:2,label:"开启"}],currentIndex:"",showEditDialog:!1,statusList:[{value:0,label:"关闭"},{value:1,label:"开启"}],ruleForm:{appName:"",defaultState:"",appAdress:"",appSort:""},rules:{appName:[{required:!0,message:"请输入应用名称",trigger:"blur"}],defaultState:[{required:!0,message:"请选择默认状态",trigger:"change"}],appAdress:[{required:!1,message:"请输入应用地址",trigger:"blur"}],appSort:[{required:!0,message:"请选择应用排序",trigger:"blur"}]},qiniuDatas:"",fileInfo:[],fileList:[],isCommit:!1,imgSrc:"",imgList:[]}},mounted(){let t=sessionStorage.getItem("vid"),e=sessionStorage.getItem("vname");t&&(this.choseVillageInfo.vid=t,this.choseVillageInfo.name=e),this.tableLoad(),this.getUploadToken()},methods:{filterVillage(t){this.choseVillageInfo.name=t.name,this.choseVillageInfo.vid=t.vid,this.statusVal="",this.searchVal="",this.tableLoad()},getUploadToken(){this.$axios.post(this.urlObj.uploadToken).then(t=>{200===t.Code&&(this.qiniuDatas=t.Data)})},customUpload(t){t.url=this.$refs.upload.uploadFiles[0].url;let e=Object(o["a"])(t,this.qiniuDatas);e.observable.subscribe({next:t=>{},error:t=>{},complete:t=>{this.fileInfo=[e.fileInfo]}})},handleRemove(){this.fileInfo=[]},handlePictureCardPreview(t){this.imgSrc=t.url,this.imgList=[t.url],this.$nextTick(()=>{this.$refs.preview.clickHandler()})},imgPreview(t){this.handlePictureCardPreview({url:t.image_host})},tableLoad(){this.conf.loadStatus=!0;let t={vid:this.choseVillageInfo.vid,keywords:this.searchVal,status:this.statusVal};this.$axios.post(this.urlObj.villageapplication,t).then(t=>{200===t.Code?(t.Data&&t.Data.length>0&&t.Data.forEach(t=>{t.status_text=1==t.status?"开启":"关闭"}),this.tableData=t.Data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=t.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},keySearch(){this.tableLoad()},appEdit(t){this.showEditDialog=!0,this.currentIndex=t,this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.dialogTitle="编辑应用设置",this.ruleForm.appName=this.tableData[t].name,this.ruleForm.defaultState=this.tableData[t].status,this.ruleForm.appAdress=this.tableData[t].url,this.ruleForm.appSort=this.tableData[t].sort,this.tableData[t].image&&(this.fileInfo=[{qiniu_key:this.tableData[t].image}],this.fileList=[{name:"",url:this.tableData[t].image_host}]),this.imgSrc="",this.imgList=[]},formSubmit(){this.$refs.ruleForm.validate(t=>{if(t){this.isCommit=!0;let t={vid:this.choseVillageInfo.vid,application:[{app_id:this.tableData[this.currentIndex].id,status:this.ruleForm.defaultState,sort:this.ruleForm.appSort}]};this.fileInfo.length>0&&(t.application[0].image=this.fileInfo[0].qiniu_key),this.$axios.post(this.urlObj.editvillageapp,t).then(t=>{if(200===t.Code)this.$message({type:"success",message:"应用编辑成功！"}),this.showEditDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:"应用编辑失败！";this.$message({type:"error",message:e})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},editDialogClose(){this.$refs.upload.clearFiles()}}},n=r,u=(a("eae7"),a("1805")),p=Object(u["a"])(n,s,i,!1,null,null,null);e["default"]=p.exports},dfb9:function(t,e,a){},eae7:function(t,e,a){"use strict";a("dfb9")}}]);