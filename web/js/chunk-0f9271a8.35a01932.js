(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0f9271a8"],{1275:function(t,e,a){},"360d":function(t,e,a){"use strict";a("eeb0")},"5ab2":function(t,e,a){"use strict";a("1275")},"6d19":function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"待审计划","prop":"plan_count","show":true,"cstcolor":"statusColor","color":"#999"},{"label":"合同编号","prop":"co_sn","show":true,"cstcolor":"statusColor","width":180},{"label":"合同标题","prop":"co_title","show":true,"color":"#999","cstcolor":"statusColor","width":180},{"label":"对方单位","prop":"supname","show":true,"color":"#999","cstcolor":"statusColor","width":150},{"label":"所属项目","prop":"villagename","show":true,"color":"#999","cstcolor":"statusColor","width":150},{"label":"项目类别","prop":"vtype","show":true,"cstcolor":"statusColor","color":"#999"},{"label":"含税金额","prop":"co_money","show":true,"color":"#ffcb3c","cstcolor":"statusColor","width":100},{"label":"不含税金额","prop":"conottax_money","show":true,"color":"#999","cstcolor":"statusColor","width":100},{"label":"税率","prop":"con_rate","show":true,"cstcolor":"statusColor","color":"#69da61"},{"label":"税额","prop":"con_tax_amount","show":true,"color":"#999","cstcolor":"statusColor","width":100},{"label":"结算金额","prop":"co_balance","show":true,"color":"#ffcb3c","cstcolor":"statusColor","width":100},{"label":"已收款金额","prop":"plan_sum","show":true,"color":"#ffcb3c","cstcolor":"statusColor","width":100},{"label":"未收款金额","prop":"uncollected","show":true,"cstcolor":"statusColor","color":"#ffcb3c","width":100},{"label":"经办人","prop":"cname","show":true,"cstcolor":"statusColor","color":"#999"},{"label":"发起时间","prop":"co_createtime","show":true,"color":"#999","cstcolor":"statusColor","width":150},{"label":"开始日期","prop":"exec_start_time","show":true,"color":"#999","cstcolor":"statusColor","width":150},{"label":"结束日期","prop":"exec_end_time","show":true,"color":"#999","cstcolor":"statusColor","width":150},{"label":"操作","prop":"","width":260,"type":"button","show":true,"fixed":"right","btns":[{"name":"详情","type":"primary","size":"small","round":true,"action":"detail","role":"detail","token":"empty"},{"name":"日期","type":"primary","class":"empty","size":"small","round":true,"action":"setDate","role":"setDate","token":"Btn-DaBjOmn7CcU7907P9TfalsEt"},{"name":"类型","type":"warning","class":"empty","size":"small","round":true,"action":"setType","role":"setType","token":"Btn-nszP1Wzf38lWcncnTbUsQ4BJ"}]}]}')},dac9:function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"分摊项目","prop":"village_name","show":true},{"label":"分摊科目","prop":"subject_name","show":true},{"label":"分摊金额","prop":"money","show":true,"color":"#ffcb3c"},{"label":"分摊月份","prop":"month","show":true},{"label":"开始时间","prop":"starttime","show":true,"color":"#999"},{"label":"结束时间","prop":"endtime","show":true,"color":"#999"}]}')},e538:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{attrs:{id:"contract"}},[e("div",{staticClass:"msg-wp"},[e("i",{staticClass:"el-icon-warning"}),e("div",{attrs:{id:"content"},on:{mouseover:t.scrollOver,mouseout:t.scrollOut}},[e("ul",{attrs:{id:"msg1"}},t._l(t.contractList,(function(a){return e("li",{key:a.co_id,on:{click:function(e){return t.toDetail(a.co_id)}}},[t._v(" "+t._s(a.ptime+" "+a.villagename+"-合同编号-"+a.co_sn+"-有收款计划")+" ")])})),0)])]),e("div",{staticClass:"top"},[e("div",{staticClass:"main"},[e("div",{staticClass:"common-left"},[e("el-cascader",{attrs:{props:{value:"type_id",label:"ct_name",checkStrictly:!0,lazy:!0,lazyLoad:t.lazyLoad},clearable:"",placeholder:"请选择合同类型"},on:{change:t.tableLoad},model:{value:t.contractType,callback:function(e){t.contractType=e},expression:"contractType"}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"请输入合同单号/合同标题查询"},domProps:{value:t.searchVal},on:{input:function(e){e.target.composing||(t.searchVal=e.target.value)}}}),e("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(e){return t.keySearch(!0)}}},[t._v(" 查询 ")])],1),e("div",{staticClass:"common-right"},[t.$global.btnRoleAuth(t.$api.state.System.village.add.token,t.$menu.state.childRoleList)?e("el-button",{staticClass:"common-button",attrs:{type:"primary",plain:"",icon:"el-icon-plus"},on:{click:function(e){return t.$refs.showAddVillage.showDialog()}}},[t._v(" 新增项目 ")]):t._e(),e("el-dropdown",{attrs:{trigger:"click","hide-on-click":!1}},[e("workIcon",{staticClass:"common-right-icon",attrs:{name:"filtr",title:"筛选"}}),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.columns,(function(a,s){return e("el-dropdown-item",{key:s},[e("el-checkbox",{on:{change:t.checkChange},model:{value:a.show,callback:function(e){t.$set(a,"show",e)},expression:"v.show"}},[t._v(" "+t._s(a.label)+" ")])],1)})),1)],1),e("span",{on:{click:function(e){return t.$refs.cusTable.exportExcel()}}},[e("workIcon",{staticClass:"common-right-icon",attrs:{name:"export",title:"导出"}})],1),e("span",{directives:[{name:"print",rawName:"v-print",value:{id:"#tablePrint",popTitle:"合同列表"},expression:"{ id: '#tablePrint', popTitle: '合同列表' }"}],staticClass:"last-ico",on:{click:t.printHandle}},[e("workIcon",{staticClass:"common-right-icon",attrs:{name:"print",title:"打印"}})],1)],1)])]),e("div",{staticClass:"main-wp"},[e("div",{staticClass:"select-wp"},[e("el-select",{attrs:{clearable:"",placeholder:"请选择所属大区"},on:{change:t.areaChange},model:{value:t.areaVal,callback:function(e){t.areaVal=e},expression:"areaVal"}},t._l(t.areaOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1),e("el-select",{attrs:{clearable:"",placeholder:"请选择所属公司"},on:{change:t.companyChange},model:{value:t.companyVal,callback:function(e){t.companyVal=e},expression:"companyVal"}},t._l(t.companyOptions,(function(t){return e("el-option",{key:t.deptid,attrs:{label:t.deptname,value:t.deptid}})})),1),e("el-select",{attrs:{clearable:"",placeholder:"请选择所属项目"},on:{change:t.tableLoad},model:{value:t.villageVal,callback:function(e){t.villageVal=e},expression:"villageVal"}},t._l(t.villageOptions,(function(t){return e("el-option",{key:t.deptid,attrs:{label:t.deptname,value:t.deptid}})})),1),e("el-select",{attrs:{clearable:"",placeholder:"请选择状态"},on:{change:t.tableLoad},model:{value:t.statusVal,callback:function(e){t.statusVal=e},expression:"statusVal"}},[e("el-option",{attrs:{label:"未到期",value:1}}),e("el-option",{attrs:{label:"即将到期",value:2}}),e("el-option",{attrs:{label:"已到期",value:3}})],1)],1),e("div",{staticClass:"table-wp"},[e("cus-table",{ref:"cusTable",attrs:{title:"合同数据表",datas:t.tableData,cusColums:t.columns,cusConf:t.conf,ispaging:!0},on:{sizeChange:t.sizeChange,currentChange:t.currentChange,detail:t.showDetail,setDate:t.setDate,setType:t.setType}})],1)]),e("el-dialog",{staticClass:"setDialog",attrs:{visible:t.showSetDialog,title:1===t.otype?"设置起止日期":"设置合同类型",width:"32%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showSetDialog=e}}},[e("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"hide-required-asterisk":!0}},[1===t.otype?e("el-form-item",{attrs:{label:"开始日期",prop:"stime"}},[e("el-date-picker",{attrs:{type:"date","picker-options":t.spickerOptions,"value-format":"timestamp",placeholder:"请选择开始日期"},model:{value:t.ruleForm.stime,callback:function(e){t.$set(t.ruleForm,"stime",e)},expression:"ruleForm.stime"}})],1):t._e(),1===t.otype?e("el-form-item",{attrs:{label:"结束日期",prop:"etime"}},[e("el-date-picker",{attrs:{type:"date","picker-options":t.epickerOptions,"value-format":"timestamp",placeholder:"请选择结束日期"},model:{value:t.ruleForm.etime,callback:function(e){t.$set(t.ruleForm,"etime",e)},expression:"ruleForm.etime"}})],1):t._e(),2===t.otype?e("el-form-item",{attrs:{label:"合同类型",prop:"ctype"}},[e("el-select",{attrs:{clearable:"",placeholder:"请选择合同类型"},on:{change:t.ctypeChange},model:{value:t.ruleForm.ctype,callback:function(e){t.$set(t.ruleForm,"ctype",e)},expression:"ruleForm.ctype"}},t._l(t.ctypeOptions,(function(t){return e("el-option",{key:t.type_id,attrs:{label:t.ct_name,value:t.type_id}})})),1)],1):t._e(),2===t.otype?e("el-form-item",{attrs:{label:"二级类型",prop:"stype"}},[e("el-select",{attrs:{clearable:"",placeholder:"请选择二级类型"},model:{value:t.ruleForm.stype,callback:function(e){t.$set(t.ruleForm,"stype",e)},expression:"ruleForm.stype"}},t._l(t.stypeOptions,(function(t){return e("el-option",{key:t.type_id,attrs:{label:t.ct_name,value:t.type_id}})})),1)],1):t._e()],1),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.formSubmit}},[t._v(" 提交保存 ")]),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showSetDialog=!1}}},[t._v(" 取消 ")])],1)],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showPrint,expression:"showPrint"}],attrs:{id:"tablePrint"}},[e("table",[t._m(0),e("tbody",t._l(t.tableData,(function(a,s){return e("tr",{key:s},[e("td",[t._v(t._s(a.plan_count))]),e("td",[t._v(t._s(a.co_sn))]),e("td",[t._v(t._s(a.co_title))]),e("td",[t._v(t._s(a.supname))]),e("td",[t._v(t._s(a.vname))]),e("td",[t._v(t._s(a.vtype))]),e("td",[t._v(t._s(a.co_money))]),e("td",[t._v(t._s(a.conottax_money))]),e("td",[t._v(t._s(a.con_rate))]),e("td",[t._v(t._s(a.con_tax_amount))]),e("td",[t._v(t._s(a.co_balance))]),e("td",[t._v(t._s(a.plan_sum))]),e("td",[t._v(t._s(a.uncollected))]),e("td",[t._v(t._s(a.cname))]),e("td",[t._v(t._s(a.co_createtime))])])})),0)]),t.tableData.length?t._e():e("div",{staticClass:"table-empty"},[e("span",[t._v("暂无数据!")])])]),e("contract-detail",{ref:"contractDetail"})],1)},i=[function(){var t=this,e=t._self._c;t._self._setupProxy;return e("thead",{staticStyle:{display:"table-header-group","font-weight":"bold"}},[e("tr",[e("th",[t._v("待审计划")]),e("th",[t._v("合同编号")]),e("th",[t._v("合同标题")]),e("th",[t._v("对方单位")]),e("th",[t._v("所属项目")]),e("th",[t._v("项目类别")]),e("th",[t._v("含税金额")]),e("th",[t._v("不含税金额")]),e("th",[t._v("税率")]),e("th",[t._v("税额")]),e("th",[t._v("结算金额")]),e("th",[t._v("已收款金额")]),e("th",[t._v("未收款金额")]),e("th",[t._v("经办人")]),e("th",[t._v("发起时间")])])])}],l=(a("5948"),a("4698")),o=a("6d19"),r=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{attrs:{id:"contract-detail"}},[e("a",{ref:"adom",attrs:{href:t.aurl,target:"_blank"}}),e("el-dialog",{staticClass:"detailDialog",attrs:{visible:t.showDialog,title:"合同详情",width:"75%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showDialog=e}}},[e("el-scrollbar",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticStyle:{height:"100%"}},[e("div",{staticClass:"basic-info"},[e("h3",[t._v(" 合同基本情况 "),e("span",[t._v("未结清")])]),e("div",{staticClass:"content"},[e("div",{staticClass:"flex-cnt"},[e("div",{staticClass:"flex-item"},[e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("合同编号")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.co_sn?t.cntDetail.co_sn:"--")+" ")])]),e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("合同原始编号")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.old_co_sn?t.cntDetail.old_co_sn:"--")+" ")])]),e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("合同标题")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.co_title?t.cntDetail.co_title:"--")+" ")])]),e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("合同开始日期")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.exec_start_time?t.cntDetail.exec_start_time:"--")+" ")])])]),e("div",{staticClass:"flex-item"},[e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("所属大区")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.area?t.cntDetail.area.deptname:"--")+" ")])]),e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("所属公司")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.co_sn?t.cntDetail.co_sn:"--")+" ")])]),e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("所属项目")]),t.cntDetail.village_arr&&t.cntDetail.village_arr.join("、").length>17?e("el-tooltip",{attrs:{effect:"dark",content:t.cntDetail.village_arr?t.cntDetail.village_arr.join("、"):"",placement:"top"}},[e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.village_arr?t.cntDetail.village_arr.join("、"):"")+" ")])]):e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.village_arr?t.cntDetail.village_arr.join("、"):"")+" ")])],1),e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("合同结束日期")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.exec_end_time?t.cntDetail.exec_end_time:"--")+" ")])])]),e("div",{staticClass:"flex-item"},[e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("经办人")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.cuser?t.cntDetail.cuser.realname:"--")+" ")])]),e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("协办人")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.assist?t.cntDetail.assist.realname:"--")+" ")])]),e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("含税金额")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.co_money?t.cntDetail.co_money:"0")+"元 ")])])]),e("div",{staticClass:"flex-item"},[e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("不含税金额")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.conottax_money?t.cntDetail.conottax_money:"0")+"元 ")])]),e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("税率")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.con_rate?t.cntDetail.con_rate:"--")+" ")])]),e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("税额")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.con_tax_amount?t.cntDetail.con_tax_amount:"0")+"元 ")])])]),e("div",{staticClass:"flex-item"},[e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("结算金额")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.co_balance?t.cntDetail.co_balance:"0")+"元 ")])]),e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("已收金额")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.received_money?t.cntDetail.received_money:"0")+"元 ")])]),e("div",{staticClass:"item"},[e("span",{staticClass:"name"},[t._v("未收金额")]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.uncollected_money?t.cntDetail.uncollected_money:"0")+"元 ")])])])]),e("div",{staticClass:"explain"},[e("div",{staticClass:"name"},[t._v("情况说明")]),e("div",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.c_intro?t.cntDetail.c_intro:"--")+" ")])])])]),e("div",{staticClass:"supplier-info"},[e("h3",[t._v("供应商信息")]),e("div",{staticClass:"content"},[e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("供应商名称")]),e("div",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.supplier?t.cntDetail.supplier.sname:"--")+" ")])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("开户银行")]),e("div",{staticClass:"value gray"},[t._v(" "+t._s(t.cntDetail.supcard?t.cntDetail.supcard.bank:"--")+" ")])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("银行账户")]),e("div",{staticClass:"value gray"},[t._v(" "+t._s(t.cntDetail.supcard?t.cntDetail.supcard.cardnumber:"--")+" ")])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("联系人姓名")]),e("div",{staticClass:"value gray"},[t._v(" "+t._s(t.cntDetail.uname?t.cntDetail.uname:"--")+" ")])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("联系方式")]),e("div",{staticClass:"value gray"},[t._v(" "+t._s(t.cntDetail.tel?t.cntDetail.tel:"--")+" ")])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("信用编码/省份证号码")]),e("div",{staticClass:"value"},[t._v(" "+t._s(t.cntDetail.supplier?t.cntDetail.supplier.tax_person_number:"--")+" ")])])])]),e("div",{staticClass:"check-files"},[e("h3",[t._v("合同审核文件")]),0==t.auditFiles.length?e("div",{staticClass:"content"},[e("div",{staticClass:"tip"},[t._v("暂无文件！")])]):e("div",{staticClass:"content"},t._l(t.auditFiles,(function(a,s){return e("div",{key:s,staticClass:"file-item",on:{click:function(e){return t.fileClick(a)}}},[a.cf_name.length>6?e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:a.cf_name,placement:"bottom","open-delay":300}},[e("div",[a.cf_name.includes(".pdf")?e("div",{staticClass:"img"},[t._v(" PDF ")]):a.cf_name.includes(".doc")?e("div",{staticClass:"img",staticStyle:{"background-color":"#5a86e8"}},[t._v(" DOC ")]):e("div",{staticClass:"img"},[t._v("其他")]),e("div",{staticClass:"name"},[t._v(t._s(a.cf_name))])])]):e("div",[a.cf_name.includes(".pdf")?e("div",{staticClass:"img"},[t._v("PDF")]):a.cf_name.includes(".doc")?e("div",{staticClass:"img",staticStyle:{"background-color":"#5a86e8"}},[t._v(" DOC ")]):e("div",{staticClass:"img"},[t._v("其他")]),e("div",{staticClass:"name"},[t._v(t._s(a.cf_name))])])],1)})),0)]),e("div",{staticClass:"signed-files"},[e("h3",[t._v(" 合同签署文件 "),e("span",[t._v("合同签署文件盖章后由结算中心上传")])]),0===t.signeFiles.length?e("div",{staticClass:"content"},[e("div",{staticClass:"tip"},[t._v("暂无文件！")])]):e("div",{staticClass:"content"},[e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("文件名称")]),t._l(t.signeFiles,(function(a,s){return e("div",{key:s,staticClass:"value"},[t._v(" "+t._s(a.cf_name)+" ")])}))],2),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("上传人")]),t._l(t.signeFiles,(function(a,s){return e("div",{key:s,staticClass:"value gray"},[t._v(" "+t._s(a.adduser.realname)+" ")])}))],2),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("上传时间")]),t._l(t.signeFiles,(function(a,s){return e("div",{key:s,staticClass:"value gray"},[t._v(" "+t._s(a.cf_createtime)+" ")])}))],2),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("操作")]),t._l(t.signeFiles,(function(a,s){return e("a",{key:s,attrs:{href:a.host_url,target:"_blank"}},[e("el-button",{attrs:{type:"primary",size:"small",round:"",plain:""}},[t._v(" 下载 ")])],1)}))],2)])]),e("div",{staticClass:"payment-plan"},[e("h3",[t._v("收款列表")]),e("el-button",{staticClass:"refresh",attrs:{type:"primary",round:""},on:{click:t.refresh}},[t._v(" 刷新 ")]),e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.tableData,cusColums:t.columns,cusConf:t.conf},on:{pass:t.planPass,reject:t.planReject,detail:t.showDetail,gathering:t.showGather,refund:t.refundMoney,delPlan:t.delPlan,cancelPlan:t.cancelPlan,shareDetails:t.shareDetails,signGather:t.signGather}}),t.$menu.getters.judgeRole("Btn-6SRWQgTJSb6dBldeM4meBsFg")?e("div",{staticClass:"add-wp",on:{click:t.addPlan}},[e("i",{staticClass:"iconfont iconxinzeng"}),t._v(" 添加收款 ")]):t._e()],1)],1)])],1),e("el-dialog",{staticClass:"addDialog",attrs:{visible:t.showAddDialog,title:"添加收款计划",width:"46%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showAddDialog=e}}},[e("el-scrollbar",{staticStyle:{height:"100%"}},[e("el-form",{ref:"addForm",attrs:{model:t.addForm,rules:t.addRules,"hide-required-asterisk":!0}},[e("el-form-item",{attrs:{label:"计划收款项目",prop:"vname"}},[e("el-cascader",{attrs:{options:t.villageOptions,"show-all-levels":!1,placeholder:"请选择收款项目"},on:{change:t.villageChange},model:{value:t.addForm.village,callback:function(e){t.$set(t.addForm,"village",e)},expression:"addForm.village"}})],1),e("el-form-item",{attrs:{label:"计划收款科目",prop:"subject"}},[e("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择收款科目"},model:{value:t.addForm.subject,callback:function(e){t.$set(t.addForm,"subject",e)},expression:"addForm.subject"}},t._l(t.subOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),e("el-form-item",{attrs:{label:"计划收款金额",prop:"money"}},[e("el-input",{attrs:{placeholder:"请输入收款金额"},model:{value:t.addForm.money,callback:function(e){t.$set(t.addForm,"money",e)},expression:"addForm.money"}})],1),e("el-form-item",{attrs:{label:"计划收款次数",prop:"number"}},[e("el-input",{attrs:{type:"number",placeholder:"请输入收款次数"},model:{value:t.addForm.number,callback:function(e){t.$set(t.addForm,"number",e)},expression:"addForm.number"}})],1),e("el-form-item",{attrs:{label:"计划收款日期",prop:"dateVal"}},[e("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择收款日期","value-format":"timestamp"},model:{value:t.addForm.dateVal,callback:function(e){t.$set(t.addForm,"dateVal",e)},expression:"addForm.dateVal"}})],1),e("el-form-item",{attrs:{label:"计划收款周期",prop:"cycle"}},[e("el-select",{attrs:{clearable:"",placeholder:"请选择收款周期"},model:{value:t.addForm.cycle,callback:function(e){t.$set(t.addForm,"cycle",e)},expression:"addForm.cycle"}},t._l(t.cycleOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",{staticClass:"remark",attrs:{label:"备注信息",prop:"remark"}},[e("el-input",{attrs:{type:"textarea",rows:3,resize:"none",placeholder:"请输入备注信息"},model:{value:t.addForm.remark,callback:function(e){t.$set(t.addForm,"remark",e)},expression:"addForm.remark"}})],1)],1)],1),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.addSubmit}},[t._v(" 确认添加 ")]),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showAddDialog=!1}}},[t._v(" 取消 ")])],1)],1),e("el-dialog",{staticClass:"planDialog",attrs:{visible:t.showPlanDialog,title:"计划收款",width:"46%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showPlanDialog=e}}},[e("el-scrollbar",{staticStyle:{height:"100%"}},[e("el-form",{ref:"planForm",attrs:{model:t.ruleForm,rules:t.rules,"hide-required-asterisk":!0}},[e("el-form-item",{attrs:{label:"项目名称",prop:"vname"}},[e("el-input",{attrs:{placeholder:"请输入项目名称",readonly:""},model:{value:t.ruleForm.vname,callback:function(e){t.$set(t.ruleForm,"vname",e)},expression:"ruleForm.vname"}})],1),e("el-form-item",{attrs:{label:"客户名称",prop:"uname"}},[e("el-input",{attrs:{placeholder:"请输入客户名称"},model:{value:t.ruleForm.uname,callback:function(e){t.$set(t.ruleForm,"uname",e)},expression:"ruleForm.uname"}})],1),e("el-form-item",{attrs:{label:"收款时间",prop:"dateVal"}},[e("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",disabled:t.dateDisabled,placeholder:"选择收款时间","value-format":"timestamp"},model:{value:t.ruleForm.dateVal,callback:function(e){t.$set(t.ruleForm,"dateVal",e)},expression:"ruleForm.dateVal"}})],1),e("el-form-item",{attrs:{label:"应收金额",prop:"ymoney"}},[e("el-input",{attrs:{placeholder:"请输入应收金额",type:"number"},model:{value:t.ruleForm.ymoney,callback:function(e){t.$set(t.ruleForm,"ymoney",e)},expression:"ruleForm.ymoney"}})],1),e("el-form-item",{attrs:{label:"实收金额",prop:"smoney"}},[e("el-input",{attrs:{placeholder:"请输入实收金额",type:"number"},model:{value:t.ruleForm.smoney,callback:function(e){t.$set(t.ruleForm,"smoney",e)},expression:"ruleForm.smoney"}})],1),e("el-form-item",{attrs:{label:"收款方式",prop:"paymentTerm"}},[e("el-select",{attrs:{clearable:"",placeholder:"请选择收款方式"},model:{value:t.ruleForm.paymentTerm,callback:function(e){t.$set(t.ruleForm,"paymentTerm",e)},expression:"ruleForm.paymentTerm"}},t._l(t.payOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),e("el-form-item",{attrs:{label:"是否开票",prop:"bill"}},[e("el-select",{attrs:{clearable:"",placeholder:"请选择是否开票"},model:{value:t.ruleForm.bill,callback:function(e){t.$set(t.ruleForm,"bill",e)},expression:"ruleForm.bill"}},t._l(t.billOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),3==t.receiptType?e("el-form-item",{attrs:{label:"收据类型",prop:"receiptType"}},[e("el-select",{attrs:{placeholder:"请选择收据类型",clearable:""},model:{value:t.ruleForm.receiptType,callback:function(e){t.$set(t.ruleForm,"receiptType",e)},expression:"ruleForm.receiptType"}},[e("el-option",{attrs:{label:"电子收据",value:1}}),e("el-option",{attrs:{label:"纸质收据",value:2}})],1)],1):t._e(),2==t.receiptType||3==t.receiptType&&2==t.ruleForm.receiptType?e("el-form-item",{attrs:{label:"是否生成纸质收据",prop:"isPaper"}},[e("el-select",{attrs:{placeholder:"请选择是否生成纸质收据",clearable:""},model:{value:t.ruleForm.isPaper,callback:function(e){t.$set(t.ruleForm,"isPaper",e)},expression:"ruleForm.isPaper"}},[e("el-option",{attrs:{label:"否",value:0}}),e("el-option",{attrs:{label:"是",value:1}})],1)],1):t._e(),e("el-form-item",{staticClass:"remark",attrs:{label:"备注信息",prop:"remark"}},[e("el-input",{attrs:{type:"textarea",rows:3,resize:"none",placeholder:"请输入备注信息"},model:{value:t.ruleForm.remark,callback:function(e){t.$set(t.ruleForm,"remark",e)},expression:"ruleForm.remark"}})],1)],1)],1),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.submitForm}},[t._v(" 确认收款 ")]),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showPlanDialog=!1}}},[t._v(" 取消 ")])],1)],1),e("el-dialog",{staticClass:"infoDialog",attrs:{visible:t.showInfoDialog,title:"计划收款详情",width:"50%","close-on-click-modal":!0},on:{"update:visible":function(e){t.showInfoDialog=e}}},[e("el-scrollbar",{directives:[{name:"loading",rawName:"v-loading",value:t.detailLoading,expression:"detailLoading"}],staticStyle:{height:"100%"}},[t.planInfo.id?e("div",{staticClass:"plan-info"},[e("h3",[t._v("计划信息")]),e("div",{staticClass:"content"},[e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("科目")]),e("div",{staticClass:"value"},[t._v(" "+t._s(t.planInfo.subject?t.planInfo.subject.name:"--")+" ")])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("计划收款时间")]),e("div",{staticClass:"value gray"},[t._v(" "+t._s(t.planInfo.plan_date?t.planInfo.plan_date:"--")+" ")])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("计划收款金额")]),e("div",{staticClass:"value yellow"},[t._v(" "+t._s(t.planInfo.plan_money?t.planInfo.plan_money:"--")+" ")])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("创建人")]),e("div",{staticClass:"value gray"},[t._v(" "+t._s(t.planInfo.creater?t.planInfo.creater.realname:"--")+" ")])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("创建时间")]),e("div",{staticClass:"value gray"},[t._v(" "+t._s(t.planInfo.createtime?t.planInfo.createtime:"--")+" ")])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("当前状态")]),e("div",{staticClass:"value green"},[t._v(" "+t._s(0==t.planInfo.status?"未收款":1==t.planInfo.status?"已收款":2==t.planInfo.status?"已退款":"")+" ")])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("备注")]),e("div",{staticClass:"value gray"},[t._v(t._s(t.planInfo.bz))])])])]):t._e(),e("div",{staticClass:"charge-info"},[e("h3",[t._v("收款信息")]),t.planInfo.sn&&t.planInfo.sn.sn?e("div",{staticClass:"content"},[e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("收款时间")]),e("div",{staticClass:"value gray"},[t._v(t._s(t.planInfo.sn.pay_time))])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("收款金额")]),e("div",{staticClass:"value yellow"},[t._v(t._s(t.planInfo.sn.money))])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("订单号")]),e("div",{staticClass:"value gray"},[t._v(t._s(t.planInfo.sn.sn))])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"name"},[t._v("操作人")]),e("div",{staticClass:"value gray"},[t._v(t._s(t.planInfo.sn.creater.realname))])])]):e("div",{staticClass:"content"},[e("div",{staticClass:"tip"},[t._v("暂无收款信息！")])])])])],1),e("el-dialog",{staticClass:"shareDialog",attrs:{visible:t.showShareDialog,title:"分摊详情",width:"50%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showShareDialog=e}}},[e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.shareTableData,cusColums:t.shareColumns,cusConf:t.shareConf}})],1)])],1)},n=[],c=a("fde2"),m=a("dac9"),p={name:"contractDetail",data(){return{urlObj:{contractDetail:this.$api.state.Contract.contractDetail.url,contractVillage:this.$api.state.Contract.contractVillage.url,getsubject:this.$api.state.Charge.getsubject.url,addplan:this.$api.state.Contract.addplan.url,collectionplan:this.$api.state.Contract.collectionplan.url,detailplan:this.$api.state.Contract.detailplan.url,getpaymenttype:this.$api.state.Charge.getpaymenttype.url,examineplan:this.$api.state.Contract.examineplan.url,refundplan:this.$api.state.Contract.refundplan.url,delplan:this.$api.state.Contract.delplan.url,stopplan:this.$api.state.Contract.stopplan.url,subjectbydep:this.$api.state.Contract.subjectbydep.url,getreceipttype:this.$api.state.Charge.getreceipttype.url,getsubjectbyvillage:this.$api.state.Contract.getsubjectbyvillage.url,getdepandvillage:this.$api.state.Contract.getdepandvillage.url,plancost:this.$api.state.Contract.plancost.url,signplan:this.$api.state.Contract.signplan.url,createplancost:this.$api.state.Contract.createplancost.url},vname:"",showDialog:!1,isLoading:!1,contractId:"",cntDetail:{},auditFiles:[],signeFiles:[],tableData:[],columns:c.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:10,dataTotal:0},showAddDialog:!1,addForm:{village:"",subject:"",money:"",number:"",dateVal:"",cycle:"",remark:""},addRules:{village:[{required:!0,message:"请选择收款项目",trigger:"change"}],subject:[{required:!0,message:"请选择收款科目",trigger:"change"}],money:[{required:!0,message:"请输入收款金额",trigger:"blur"}],number:[{required:!0,message:"请输入收款次数",trigger:"blur"}],dateVal:[{required:!0,message:"请选择收款日期",trigger:"change"}],cycle:[{required:!0,message:"请选择收款周期",trigger:"change"}],remark:[{required:!1,message:"请输入备注信息",trigger:"blur"}]},villageOptions:[],subOptions:[],subProps:{checkStrictly:!0,value:"id",label:"name",children:"children"},cycleOptions:[{value:1,label:"季度"},{value:2,label:"半年"},{value:3,label:"年"},{value:4,label:"一次性"}],showPlanDialog:!1,planId:"",showInfoDialog:!1,ruleForm:{vname:"",uname:"",dateVal:"",ymoney:"",smoney:"",paymentTerm:"",bill:0,receiptType:1,isPaper:"",remark:""},rules:{vname:[{required:!0,message:"请输入项目名称",trigger:"blur"}],uname:[{required:!0,message:"请输入客户名称",trigger:"blur"}],dateVal:[{required:!0,message:"请选择收款时间",trigger:"change"}],ymoney:[{required:!0,message:"请输入应收金额",trigger:"blur"}],smoney:[{required:!0,message:"请输入实收金额",trigger:"blur"}],paymentTerm:[{required:!0,message:"请选择收款方式",trigger:"change"}],bill:[{required:!0,message:"请选择打印票据",trigger:"change"}],receiptType:[{required:!0,message:"请选择收据类型",trigger:"change"}],isPaper:[{required:!0,message:"请选择是否生成纸质收据",trigger:"change"}],remark:[{required:!1,message:"请输入备注信息",trigger:"blur"}]},detailLoading:!1,payOptions:[],billOptions:[{value:0,label:"否"},{value:1,label:"是"}],isCommit:!1,planInfo:{},dateDisabled:!0,aurl:"",receiptType:"",showShareDialog:!1,shareTableData:[],shareColumns:m.list,shareConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0}}},computed:{vid(){return this.$store.state.vid}},watch:{vid(){this.vname=sessionStorage.getItem("vname")}},mounted(){this.vname=sessionStorage.getItem("vname")},methods:{init(t){this.contractId=t,this.cntDetail={},this.auditFiles=[],this.signeFiles=[],this.tableData=[],this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:10,dataTotal:0},this.showDialog=!0,this.getContractDetail()},getContractDetail(){this.isLoading=!0,this.$axios.post(this.urlObj.contractDetail,{id:this.contractId}).then(t=>{if(200===t.Code)t.Data.file.forEach(t=>{1==t.cf_type1?this.auditFiles.push(t):this.signeFiles.push(t)}),t.Data.plan.forEach(t=>{t.subName=t.subject?t.subject.name:"--",t.cname=t.creater?t.creater.realname:"--",t.vname=t.village?t.village.deptname:"--",t.status_text=1==t.status?"已收款":2==t.status?"已退款":3==t.status?"已终止":"未收款",t.check_text=0==t.check?"审核中":1==t.check?"已通过":2==t.check?"已拒绝":"",t.passHide=0!=t.check||0==t.examine_node,t.returnHide=0!=t.check||0==t.examine_node,t.skhide=!(1==t.check&&0==t.status),t.tkhide=!(1==t.refund_subject&&1==t.status),t.delHide=!((0==t.check||2==t.check)&&0==t.status),t.zzHide=0!=t.status||1!=t.check}),this.cntDetail=t.Data?t.Data:{},this.tableData=t.Data&&t.Data.plan?t.Data.plan:"";else{let e=t.Message?t.Message:"获取合同详情数据失败！";this.$message({type:"error",message:e})}this.isLoading=!1}).catch(()=>{this.$message({type:"error",message:"执行失败！"}),this.isLoading=!1})},fileClick(t){this.$confirm("选择一个操作类型?","提示",{confirmButtonText:"下载",cancelButtonText:"预览",distinguishCancelAndClose:!0}).then(e=>{this.aurl=t.host_url,this.$nextTick(()=>{this.$refs.adom.click()})}).catch(e=>{"cancel"===e&&(this.aurl=t.view_url,this.$nextTick(()=>{this.$refs.adom.click()}))})},addPlan(){this.$refs.addForm&&this.$refs.addForm.resetFields(),this.addForm={village:"",subject:"",money:"",number:"",dateVal:"",cycle:"",remark:""},this.villageOptions=[],this.subOptions=[],this.getVillageList(),this.showAddDialog=!0},getVillageList(){let t={id:this.contractId};this.$axios.post(this.urlObj.getdepandvillage,t).then(t=>{if(200===t.Code)this.villageOptions=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取收款项目数据失败！";this.$message({type:"error",message:e})}}).catch(()=>{})},villageChange(t){this.addForm.subject="",this.subOptions=[],t&&this.getSubjects(t[t.length-1])},getSubjects(t){let e={vid:t};this.$axios.post(this.urlObj.getsubjectbyvillage,e).then(t=>{if(200===t.Code)this.subOptions=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取科目数据失败！";this.$message({type:"error",message:e})}}).catch(()=>{})},getPlanDetail(){this.detailLoading=!0;let t={id:this.planId};this.$axios.post(this.urlObj.detailplan,t).then(t=>{if(200===t.Code)this.planInfo=t.Data?t.Data:{},this.showPlanDialog&&(this.ruleForm.ymoney=t.Data.cost_money?t.Data.cost_money:0,this.ruleForm.smoney=t.Data.cost_money?t.Data.cost_money:0);else{let e=t.Message?t.Message:"获取计划详情数据失败！";this.$message({type:"error",message:e})}this.detailLoading=!1}).catch(()=>{this.detailLoading=!1})},getPayments(){let t={vid:this.vid};this.$axios.post(this.urlObj.getpaymenttype,t).then(t=>{if(200===t.Code)this.payOptions=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取收款方式失败！";this.$message({type:"error",message:e})}}).catch(()=>{})},addSubmit(){this.$refs.addForm.validate(t=>{if(t){this.isCommit=!0;let t={co_id:this.contractId,p_id:this.addForm.village[0],v_id:this.addForm.village[1],subject_id:this.addForm.subject,money:this.addForm.money,date:this.addForm.dateVal/1e3,cycle:this.addForm.cycle,num:this.addForm.number,remarks:this.addForm.remark};this.$axios.post(this.urlObj.addplan,t).then(t=>{if(200===t.Code)this.$message({type:"success",message:"添加收款计划成功！"}),this.showAddDialog=!1,this.init(this.contractId);else{let e=t.Message?t.Message:"添加收款计划失败！";this.$message({type:"error",message:e})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},showGather(t){this.planId=this.tableData[t].id,this.$refs.planForm&&this.$refs.planForm.resetFields(),this.ruleForm.vname=this.vname,this.ruleForm.uname=this.cntDetail.supplier?this.cntDetail.supplier.sname:"",this.ruleForm.dateVal=(new Date).getTime(),this.$menu.getters.judgeRole("Btn-YkAL5trW0MiaydUa6uxxsuCA")?this.dateDisabled=!1:this.dateDisabled=!0,this.showPlanDialog=!0,this.getPlanDetail(),this.getPayments(),this.getReceiptType()},getReceiptType(){let t={vid:this.vid};this.$axios.post(this.urlObj.getreceipttype,t).then(t=>{if(200===t.Code)this.receiptType=t.Data?t.Data.use_receipt_type:"";else{let e=t.Message?t.Message:"获取收据类型失败！";this.$message({message:e,type:"error"})}}).catch(()=>{})},showDetail(t){this.planId=this.tableData[t].id,this.showInfoDialog=!0,this.getPlanDetail()},submitForm(){this.$refs.planForm.validate(t=>{if(t){this.isCommit=!0;let t={id:this.planId,realname:this.ruleForm.uname,pay_time:this.ruleForm.dateVal/1e3,allmoney:this.ruleForm.ymoney,money:this.ruleForm.smoney,pay_type:this.ruleForm.paymentTerm,is_bill:this.ruleForm.bill,remark:this.ruleForm.remark};3==this.receiptType?(t.receipt_type=this.ruleForm.receiptType,2==this.ruleForm.receiptType&&(t.is_open_receiptpaper=this.ruleForm.isPaper)):2==this.receiptType&&(t.is_open_receiptpaper=this.ruleForm.isPaper),this.$axios.post(this.urlObj.collectionplan,t).then(t=>{if(200===t.Code)this.$message({type:"success",message:"确认收款成功！"}),this.showPlanDialog=!1,this.init(this.contractId);else{let e=t.Message?t.Message:"确认收款失败！";this.$message({type:"error",message:e})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},refundMoney(t){this.$confirm("确定要对当前计划进行退款吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let e={id:this.tableData[t].id};this.$axios.post(this.urlObj.refundplan,e).then(t=>{if(200===t.Code)this.$message({type:"success",message:"退款成功！"}),this.init(this.contractId);else{let e=t.Message?t.Message:"退款失败！";this.$message({type:"error",message:e})}}).catch(()=>{})}).catch(()=>{})},planPass(t){this.$confirm("确定要通过当前申请吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.planId=this.tableData[t].id,this.auditRequest(1)}).catch(()=>{})},planReject(t){this.$confirm("确定要驳回当前申请吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.planId=this.tableData[t].id,this.auditRequest(2)}).catch(()=>{})},auditRequest(t){let e={id:this.planId,check:t};this.$axios.post(this.urlObj.examineplan,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:1==t?"申请已通过！":"申请已驳回！"}),this.init(this.contractId);else{let a=1==t?"申请通过失败！":"申请驳回失败！",s=e.Message?e.Message:a;this.$message({type:"error",message:s})}}).catch(()=>{})},delPlan(t){this.$confirm("确定要删除当前计划吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let e={id:this.tableData[t].id};this.$axios.post(this.urlObj.delplan,e).then(t=>{if(200===t.Code)this.$message({type:"success",message:"计划删除成功！"}),this.init(this.contractId);else{let e=t.Message?t.Message:"计划删除失败！";this.$message({type:"error",message:e})}}).catch(()=>{})}).catch(()=>{})},cancelPlan(t){this.$confirm("确定要终止当前计划吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let e={id:this.tableData[t].id};this.$axios.post(this.urlObj.stopplan,e).then(t=>{if(200===t.Code)this.$message({type:"success",message:"计划终止成功！"}),this.init(this.contractId);else{let e=t.Message?t.Message:"计划终止失败！";this.$message({type:"error",message:e})}}).catch(()=>{})}).catch(()=>{})},shareDetails(t){this.shareTableData=[],this.showShareDialog=!0,this.shareConf.loadStatus=!0;let e={plan_id:this.tableData[t].id};this.$axios.post(this.urlObj.plancost,e).then(t=>{200===t.Code?(this.shareTableData=t.Data,this.shareConf.loadStatus=!1,this.shareConf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.shareTableData=[],this.shareConf.emptyText=t.Message,this.shareConf.dataTotal=0,this.shareConf.loadStatus=!1)}).catch(()=>{this.shareTableData=[],this.shareConf.emptyText="服务器连接失败...",this.shareConf.dataTotal=0,this.shareConf.loadStatus=!1})},signGather(t){this.$confirm("确定要把当前计划标记为已收款吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$axios.post(this.urlObj.signplan,{id:this.tableData[t].id}).then(t=>{if(200===t.Code)this.$message({type:"success",message:"标记已收款成功！"}),this.init(this.contractId);else{let e=t.Message?t.Message:"标记已收款失败！";this.$message({type:"error",message:e})}}).catch(()=>{})}).catch(()=>{})},refresh(){this.$axios.post(this.urlObj.createplancost,{co_id:this.contractId}).then(t=>{if(200===t.Code)this.$message({type:"success",message:"刷新成功！"}),this.init(this.contractId);else{let e=t.Message?t.Message:"刷新失败！";this.$message({type:"error",message:e})}}).catch(()=>{})}}},d=p,h=(a("360d"),a("1805")),u=Object(h["a"])(d,r,n,!1,null,null,null),g=u.exports,v={name:"contract",components:{workIcon:l["a"],ContractDetail:g},data(){return{urlObj:{contractType:this.$api.state.Contract.contractType.url,getAreas:this.$api.state.Public.getAreas.url,getCompany:this.$api.state.Public.getCompany.url,getVillage:this.$api.state.Public.getVillage.url,contractList:this.$api.state.Contract.contractList.url,expireList:this.$api.state.Contract.expireList.url,settime:this.$api.state.Contract.settime.url,edittype:this.$api.state.Contract.edittype.url},leftScroll:null,contractList:[],searchVal:"",tableData:[],columns:o.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},contractType:[],areaVal:"",areaOptions:[],companyVal:"",companyOptions:[],villageVal:"",villageOptions:[],statusVal:"",showPrint:!1,ruleForm:{stime:"",etime:"",ctype:"",stype:""},rules:{stime:[{required:!0,message:"请选择开始时间",trigger:"change"}],etime:[{required:!0,message:"请选择结束时间",trigger:"change"}],ctype:[{required:!0,message:"请选择合同类型",trigger:"change"}],stype:[{required:!0,message:"请选择二级类型",trigger:"change"}]},showSetDialog:!1,setIndex:"",otype:1,ctypeOptions:[],stypeOptions:[],isCommit:!1}},computed:{spickerOptions(){return{disabledDate:t=>{if(t){let e=this.ruleForm.etime;return!!e&&t.getTime()>e}}}},epickerOptions(){return{disabledDate:t=>{if(t){let e=this.ruleForm.stime;return!!e&&t.getTime()<e}}}}},mounted(){let t=document.getElementById("msg1");t.style.left="0px",this.leftScroll=setInterval(this.myScrollTop,50),this.getContractList(),this.getAreaData(),this.tableLoad()},destroyed(){clearInterval(this.leftScroll)},methods:{myScrollTop(){let t=document.getElementById("msg1");if(Math.abs(parseInt(t.style.left))>t.scrollWidth){let e=document.getElementById("content");t.style.left=e.clientWidth+"px"}else t.style.left=parseInt(t.style.left)-3+"px"},scrollOver(){clearInterval(this.leftScroll)},scrollOut(){this.leftScroll=setInterval(this.myScrollTop,50)},getContractList(){this.$axios.post(this.urlObj.expireList).then(t=>{if(200===t.Code)this.contractList=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取合同数据失败！";this.$message({type:"error",message:e})}}).catch(()=>{this.$message({type:"error",message:"执行失败！"})})},lazyLoad(t,e){this.$axios.post(this.urlObj.contractType,{pid:t.value}).then(t=>{if(200===t.Code)e(t.Data);else{let e=t.Message?t.Message:"获取合同类型数据失败！";this.$message({type:"error",message:e})}}).catch(()=>{this.$message({type:"error",message:"执行失败！"})})},getAreaData(){this.$axios.post(this.urlObj.getAreas).then(t=>{if(200===t.Code)this.areaOptions=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取大区数据失败！";this.$message({type:"error",message:e})}}).catch(()=>{this.$message({type:"error",message:"执行失败！"})})},getCompanyData(t){this.$axios.post(this.urlObj.getCompany,{bgid:t}).then(t=>{if(200===t.Code)this.companyOptions=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取公司数据失败！";this.$message({type:"error",message:e})}}).catch(()=>{this.$message({type:"error",message:"执行失败！"})})},getVillageData(t){this.$axios.post(this.urlObj.getVillage,{pid:t}).then(t=>{if(200===t.Code)this.villageOptions=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取项目数据失败！";this.$message({type:"error",message:e})}}).catch(()=>{this.$message({type:"error",message:"执行失败！"})})},areaChange(t){this.companyVal="",this.companyOptions=[],this.villageVal="",this.villageOptions=[],t&&this.getCompanyData(t),this.tableLoad()},companyChange(t){this.villageVal="",this.villageOptions=[],t&&this.getVillageData(t),this.tableLoad()},tableLoad(){this.conf.loadStatus=!0;let t={page:this.conf.curPage,limit:this.conf.limit,keywords:this.searchVal,type_id:this.contractType[0]?this.contractType[0]:"",type_s_id:this.contractType[1]?this.contractType[1]:"",a_id:this.areaVal,c_id:this.companyVal,p_id:this.villageVal,expire:this.statusVal};this.$axios.post(this.urlObj.contractList,t).then(t=>{200===t.Code?(t.Data.data.forEach(t=>{t.cname=t.cuser?t.cuser.realname:"",t.supname=t.supplier?t.supplier.sname:"",t.vtype=t.type?t.type.ct_name:"",t.villagename=t.village_arr?t.village_arr.join("、"):"",t.exec_start_time=t.exec_start_time?t.exec_start_time:"无",t.exec_end_time=t.exec_end_time?t.exec_end_time:"无";let e=new Date(1e3*t.co_createtime),a=e.getFullYear(),s=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,i=e.getDate()<10?"0"+e.getDate():e.getDate();t.co_createtime=a+"-"+s+"-"+i,3==t.expire&&(t.statusColor="rgb(245, 108, 108)")}),this.conf.dataTotal=t.Data.total,this.tableData=t.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=t.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},keySearch(){this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad()},sizeChange(t){this.conf.limit=t,this.tableLoad()},currentChange(t){this.conf.curPage=t,this.tableLoad()},showDetail(t){let e=this.tableData[t].co_id;this.$refs.contractDetail.init(e)},setDate(t){this.setIndex=t,this.otype=1,this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.showSetDialog=!0,this.tableData[t].starttime&&(this.ruleForm.stime=1e3*this.tableData[t].starttime),this.tableData[t].endtime&&(this.ruleForm.etime=1e3*this.tableData[t].endtime)},setType(t){this.setIndex=t,this.otype=2,this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.showSetDialog=!0,this.ruleForm.ctype=this.tableData[t].type_id?this.tableData[t].type_id:"",this.ruleForm.stype=this.tableData[t].type_s_id?this.tableData[t].type_s_id:"",this.getContractTypes(),this.ruleForm.stype&&this.getSecondTypes()},getContractTypes(){this.$axios.post(this.urlObj.contractType).then(t=>{if(200===t.Code)this.ctypeOptions=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取合同类型数据失败！";this.$message({type:"error",message:e})}}).catch(()=>{})},ctypeChange(t){this.ruleForm.stype="",this.stypeOptions=[],t&&this.getSecondTypes()},getSecondTypes(){this.$axios.post(this.urlObj.contractType,{pid:this.ruleForm.ctype}).then(t=>{if(200===t.Code)this.stypeOptions=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取二级类型数据失败！";this.$message({type:"error",message:e})}}).catch(()=>{})},formSubmit(){this.$refs.ruleForm.validate(t=>{if(t){this.isCommit=!0;let t="",e="";1===this.otype?(t=this.urlObj.settime,e={co_id:this.tableData[this.setIndex].co_id,starttime:this.ruleForm.stime/1e3,endtime:this.ruleForm.etime/1e3}):(t=this.urlObj.edittype,e={co_id:this.tableData[this.setIndex].co_id,type_id:this.ruleForm.ctype,type_s_id:this.ruleForm.stype}),this.$axios.post(t,e).then(t=>{if(200===t.Code){let t=1===this.otype?"起止日期设置成功！":"合同类型设置成功！";this.$message({type:"success",message:t}),this.showSetDialog=!1,this.tableLoad()}else{let e=t.Message?t.Message:"提交失败！";this.$message({type:"error",message:e})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},toDetail(t){this.$refs.contractDetail.init(t)},printHandle(){this.showPrint=!0,setTimeout(()=>{this.showPrint=!1},500)},checkChange(){let t=JSON.parse(JSON.stringify(this.columns));this.columns=t}}},y=v,_=(a("5ab2"),Object(h["a"])(y,s,i,!1,null,null,null));e["default"]=_.exports},eeb0:function(t,e,a){},fde2:function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"收款科目","prop":"subName","show":true},{"label":"收款金额","prop":"plan_money","show":true,"color":"#ffcb3c"},{"label":"收款日期","prop":"plan_date","show":true,"color":"#999"},{"label":"创建人","prop":"cname","show":true,"color":"#999"},{"label":"创建时间","prop":"createtime","show":true,"color":"#999"},{"label":"当前状态","prop":"status_text","show":true,"color":"#ffcb3c"},{"label":"项目","prop":"vname","show":true,"color":"#999"},{"label":"备注说明","prop":"bz","show":true,"color":"#999"},{"label":"占比","prop":"proportion","show":true,"color":"#ffcb3c"},{"label":"审核状态","prop":"check_text","show":true,"color":"#69da61"},{"label":"操作","prop":"","width":200,"type":"button","show":true,"btns":[{"name":"通过","type":"primary empty","size":"small","hide":"passHide","round":true,"action":"pass","role":"pass","token":"Btn-d45vDpV2JZDuFzrCi5DHBgaL"},{"name":"驳回","type":"danger empty","size":"small","hide":"returnHide","round":true,"action":"reject","role":"reject","token":"Btn-d45vDpV2JZDuFzrCi5DHBgaL"},{"name":"收款","type":"success","size":"small","hide":"skhide","round":true,"action":"gathering","role":"gathering","token":"Btn-bupsUoLwvLtR7l3aH1ts75jf"},{"name":"退款","type":"success","size":"small","hide":"tkhide","round":true,"action":"refund","role":"refund","token":"Btn-pZKCTGXGAL6XuqndkLdxCZHb"},{"name":"详情","type":"primary","size":"small","round":true,"action":"detail","role":"detail","token":"empty"},{"name":"删除","type":"danger","size":"small","hide":"delHide","round":true,"action":"delPlan","role":"delPlan","token":"Btn-USqKPQOpLKR6fLw0zKjMUmha"},{"name":"终止","type":"danger","size":"small","hide":"zzHide","round":true,"action":"cancelPlan","role":"cancelPlan","token":"Btn-UOjGrOY2G5N0kcaG32P62L5c"},{"name":"分摊详情","type":"primary","size":"small","hide":"ftHide","round":true,"action":"shareDetails","role":"shareDetails","token":"empty"},{"name":"标记收款","type":"warning","size":"small","round":true,"action":"signGather","role":"signGather","token":"Btn-mvVbPeuVL96GCDqpFNqMyiMv"}]}]}')}}]);