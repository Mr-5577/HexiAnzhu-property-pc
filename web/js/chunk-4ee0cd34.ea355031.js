(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4ee0cd34"],{"20af":function(e,t,s){},2390:function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"资源名称","prop":"name","width":"200","show":true},{"label":"资源类型","prop":"resourcesmodel_type_text","width":"200","show":true},{"label":"计费客户","prop":"owner_name","show":true,"color":"#999"},{"label":"操作","prop":"","width":120,"type":"button","show":true,"btns":[{"name":"删除","type":"danger","size":"small","round":true,"action":"delete","role":"delete","token":"Btn-JX43HgoLRlDnxhq5yvc9i8T2"}]}]}')},"34a6":function(e,t,s){"use strict";s("bea4")},"58ea":function(e,t,s){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"subject-tree"}},[t("div",{staticClass:"search-wrap"},[e.showSearch?t("el-input",{staticClass:"search",attrs:{placeholder:"请输入关键字搜索","suffix-icon":"iconfont iconzu3664"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}):t("div",{staticClass:"title"},[t("span",[e._v("科目列表")]),t("el-select",{on:{change:e.typeChange},model:{value:e.typeVal,callback:function(t){e.typeVal=t},expression:"typeVal"}},e._l(e.typeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-scrollbar",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],staticStyle:{height:"calc(100% - 4.05rem)"}},[t("div",{staticClass:"tree-wrap"},[t("el-tree",{ref:"subTree",staticClass:"filter-tree",attrs:{data:e.treeData,props:e.defaultProps,"node-key":e.treeType?"nodeid":"id",accordion:"","filter-node-method":e.filterNode,"show-checkbox":"","check-strictly":"","default-expanded-keys":e.defaultShowNodes,"default-checked-keys":e.defaultChecked},on:{"node-expand":e.handleNodeExpand,"node-collapse":e.handleNodeCollapse,"node-click":e.nodeClick,check:e.nodeCheck},scopedSlots:e._u([{key:"default",fn:function({node:s,data:a}){return t("span",{staticClass:"custom-tree-node"},[t("span",[e._v(e._s(s.label))]),"charge"==e.treeType&&!e.showSearch&&a.is_setting&&1==a.is_setting?t("span",{staticClass:"status",staticStyle:{color:"#3ebb75"}},[e._v(" 已设置 ")]):e._e(),"charge"!=e.treeType||e.showSearch||0!=a.is_setting?e._e():t("span",{staticClass:"status",staticStyle:{color:"#ccc"}},[e._v(" 未设置 ")])])}}])})],1)])],1)},i=[],r=(s("5948"),{name:"SubjectTree",props:{showSearch:{type:Boolean,default:!1},treeType:{type:String,default:""},vid:{type:[Number,String],default:0}},data(){return{urlObj:{treeData:this.$api.state.Setting.treeData.url,chargeTree:this.$api.state.Setting.chargeTree.url},treeLoading:!1,filterText:"",treeData:[],defaultProps:{children:"children",label:"name",isLeaf:"isLeaf"},typeVal:0,typeOptions:[{label:"全部科目",value:0},{label:"已设置",value:1},{label:"未设置",value:2}],defaultShowNodes:[],defaultChecked:[]}},watch:{filterText(e){this.$refs.subTree.filter(e)}},created(){this.getTreeData()},methods:{getTreeData(){this.treeLoading=!0;let e=this.urlObj.treeData,t={};"charge"==this.treeType?(e=this.urlObj.chargeTree,t.vid=this.vid):"relevance"==this.treeType&&(e=this.urlObj.chargeTree,t.vid=this.vid,t.charging_correlation=!0),this.$axios.post(e,t).then(e=>{if(200===e.Code)this.treeData=e.Data,this.$emit("setData",e.Data);else{let t=e.Message?e.Message:"数据获取失败！";this.$message({type:"error",message:t})}this.treeLoading=!1}).catch(e=>{this.$message({type:"error",message:"执行失败！"}),this.treeLoading=!1})},filterNode(e,t){return!e||("charge"!=this.treeType||this.showSearch?-1!==t.name.indexOf(e):1==e?1==t.is_setting:2!=e||0==t.is_setting)},nodeClick(e){this.$nextTick(()=>{e.disabled||(this.$refs.subTree.setCheckedNodes([e]),this.$emit("checkChange",e))})},nodeCheck(e){e.disabled||(this.$refs.subTree.setCheckedNodes([e]),this.$emit("checkChange",e))},typeChange(e){this.$refs.subTree.filter(e)},handleNodeExpand(e){let t="";t=this.treeType?e.nodeid:e.id;let s=this.defaultShowNodes.findIndex(e=>e==t);-1===s&&this.defaultShowNodes.push(t)},handleNodeCollapse(e){let t="";t=this.treeType?e.nodeid:e.id;let s=this.defaultShowNodes.findIndex(e=>e==t);this.defaultShowNodes.splice(s,1)},setDefaultChecked(e){this.defaultChecked=[e]}}}),l=r,o=(s("87a6"),s("1805")),c=Object(o["a"])(l,a,i,!1,null,null,null);t["a"]=c.exports},"5dd7":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"relevance"}},[t("div",{staticClass:"left-wp"},[t("div",{staticClass:"top"},[t("subject-tree",{attrs:{vid:e.vid,showSearch:!0,treeType:"relevance"},on:{checkChange:e.checkChange}})],1),t("div",{staticClass:"bottom"},[this.$menu.getters.judgeRole("Btn-ISsm5DMfxd0nJ3ZbXtuep9iQ")?t("el-button",{attrs:{type:"primary",round:""},on:{click:e.batchHandle}},[e._v(" 批量关联设置 ")]):e._e()],1)]),e.currentSub.id?t("div",{staticClass:"right-wp"},[t("div",{staticClass:"title"},[e._v("已设置资源列表")]),t("div",{staticClass:"search-wp"},[t("el-select",{attrs:{clearable:"",placeholder:"请选择资源类型"},on:{change:e.tableLoad},model:{value:e.typeVal,callback:function(t){e.typeVal=t},expression:"typeVal"}},e._l(e.typeOptions,(function(e){return t("el-option",{key:e.model_type,attrs:{label:e.text,value:e.model_type}})})),1),t("el-input",{attrs:{placeholder:"请输入资源名称搜索","prefix-icon":"el-icon-search"},on:{change:e.tableLoad},model:{value:e.keywords,callback:function(t){e.keywords=t},expression:"keywords"}})],1),t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.tableData,cusColums:e.columns,cusConf:e.conf,ispaging:!0,check:!0},on:{sizeChange:e.sizeChange,currentChange:e.currentChange,selectionChange:e.selectionChange,delete:e.resourceDel}})],1),this.$menu.getters.judgeRole("Btn-JX43HgoLRlDnxhq5yvc9i8T2")?t("el-button",{staticClass:"empty",attrs:{type:"primary",round:"",disabled:0==e.tableSelected.length},on:{click:e.batchDel}},[e._v(" 批量删除 ")]):e._e()],1):t("div",{staticClass:"right-wp"},[t("div",{staticClass:"tip"},[e._v("请选择科目！")])]),t("el-dialog",{staticClass:"detailDialog",attrs:{visible:e.showDialog,title:"批量设置关联",width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showDialog=t}}},[t("div",{staticClass:"main-wp"},[e.showDialog?t("div",{staticClass:"left"},[t("subject-tree",{attrs:{vid:e.vid,showSearch:!0,treeType:"relevance"},on:{checkChange:e.subChange}})],1):e._e(),t("div",{staticClass:"right"},[t("div",{staticClass:"search-wrap"},[t("el-input",{staticClass:"search",attrs:{placeholder:"请输入关键字搜索","suffix-icon":"iconfont iconzu3664"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),t("el-scrollbar",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],staticStyle:{height:"calc(100% - 4.05rem)"}},[t("div",{staticClass:"tree-wrap"},[t("el-tree",{ref:"resourceTree",staticClass:"filter-tree",attrs:{data:e.treeData,props:e.defaultProps,"node-key":"node_id",accordion:"","default-checked-keys":e.checkedKeys,"filter-node-method":e.filterNode,"show-checkbox":""}})],1)])],1)]),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.confirm}},[e._v(" 批量关联 ")]),t("el-button",{attrs:{type:"info",round:""},on:{click:function(t){e.showDialog=!1}}},[e._v(" 取消 ")])],1)])],1)},i=[],r=(s("5948"),s("58ea")),l=s("2390"),o={name:"relevance",components:{subjectTree:r["a"]},data(){return{urlObj:{treeData:this.$api.state.Setting.treeData.url,resources:this.$api.state.Setting.resources.url,delResources:this.$api.state.Setting.delResources.url,relevanceSub:this.$api.state.Setting.relevanceSub.url,sourceInfo:this.$api.state.Setting.sourceInfo.url,getResourceTypes:this.$api.state.Setting.getResourceTypes.url},currentSub:"",tableData:[],columns:l.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:10,dataTotal:0},showDialog:!1,treeLoading:!1,filterText:"",treeData:[],defaultProps:{children:"children",label:"name",isLeaf:"isLeaf"},popCurrentSub:"",checkedKeys:[],checked:[],tableSelected:[],isCommit:!1,typeVal:"",typeOptions:[],keywords:""}},computed:{vid(){return this.$store.state.vid}},watch:{filterText(e){this.$refs.resourceTree.filter(e)},vid(){this.tableLoad()}},created(){this.getResouceType()},methods:{getResouceType(){this.$axios.post(this.urlObj.getResourceTypes).then(e=>{if(200===e.Code)this.typeOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"资源类型获取失败！";this.$message({type:"error",message:t})}})},checkChange(e){this.currentSub=e,this.tableLoad()},tableLoad(){this.conf.loadStatus=!0;let e={page:this.conf.curPage,limit:this.conf.limit,vid:this.vid,subject_id:this.currentSub.id,model_type:this.typeVal,name:this.keywords};this.$axios.post(this.urlObj.resources,e).then(e=>{200===e.Code?(this.conf.dataTotal=e.Data.total,this.tableData=e.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=e.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},sizeChange(e){this.conf.limit=e,this.tableLoad()},currentChange(e){this.conf.curPage=e,this.tableLoad()},batchHandle(){this.filterText="",this.treeData=[],this.showDialog=!0},subChange(e){if(this.popCurrentSub=e,this.treeData=[],1==e.is_end){let t={vid:this.vid,type:e.subject_type,subject_village_id:e.id,resource_type_id:e.resource_type_id};this.getVillageTree(t)}},getTreeKeys(e){for(var t in e)e[t].checked&&this.checked.push(e[t].node_id),e[t].children&&this.getTreeKeys(e[t].children)},getVillageTree(e){this.treeLoading=!0,this.$axios.post(this.urlObj.sourceInfo,e).then(e=>{if(200===e.Code)this.treeData=e.Data?e.Data:[],this.checked=[],this.getTreeKeys(this.treeData),this.checkedKeys=this.checked;else{let t=e.Message?e.Message:"数据获取失败！";this.$message({type:"error",message:t})}this.treeLoading=!1}).catch(e=>{this.$message({type:"error",message:"执行失败！"}),this.treeLoading=!1})},filterNode(e,t){return!e||!!t.name&&-1!==t.name.indexOf(e)},confirm(){let e=this.$refs.resourceTree,t=e.getCheckedNodes(),s=[];if(t.forEach(e=>{if(e.is_end&&1==e.is_end){let t={id:e.id,oid:e.oid?e.oid:0,resourcesType:e.resourcesType?e.resourcesType:"",resources_type_id:e.resources_type_id?e.resources_type_id:0};s.push(t)}}),this.popCurrentSub.id&&s.length>0){this.isCommit=!0;let e={vid:this.vid,type:this.popCurrentSub.subject_type,subject_village_id:this.popCurrentSub.id,resources:s,resources_type_id:this.popCurrentSub.resource_type_id};this.batchRelevance(e)}else this.popCurrentSub.id?0==s.length&&this.$message({type:"warning",message:"至少选择一个资源！"}):this.$message({type:"warning",message:"请选择科目和资源！"})},batchRelevance(e){this.$axios.post(this.urlObj.relevanceSub,e).then(e=>{if(200===e.Code)this.$message({message:"批量关联成功！",type:"success"});else{let t=e.Message?e.Message:"批量关联失败！";this.$message({message:t,type:"error"})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})},selectionChange(e){this.tableSelected=e},resourceDel(e){this.$confirm("确定删除当前资源吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let t={id:[this.tableData[e].id]};this.delRequest(t)}).catch(()=>{})},batchDel(){this.$confirm("确定要批量删除当前选择的资源吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let e=this.tableSelected.map(e=>e.id);this.delRequest({id:e})}).catch(()=>{})},delRequest(e){this.$axios.post(this.urlObj.delResources,e).then(e=>{if(200===e.Code)this.$message({message:"删除成功！",type:"success"}),this.tableLoad();else{let t=e.Message?e.Message:"删除失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})}}},c=o,n=(s("34a6"),s("1805")),h=Object(n["a"])(c,a,i,!1,null,null,null);t["default"]=h.exports},"87a6":function(e,t,s){"use strict";s("20af")},bea4:function(e,t,s){}}]);