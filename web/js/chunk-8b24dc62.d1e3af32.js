(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8b24dc62"],{"070db":function(e,t,s){},8465:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAuJJREFUWEftmM9u00AQxr9xHM7lCShPQHtDiJhUanKt+wQtT9BU2IhbmxsiQZgnoH2ChqtdqWmCEDfyBg1PQHqlbgc5kdv0j3fH9hYJQW5RZnZ++WZndnYJhj61yFsDk0vAEghL02UZIyaMiS56g9X3+0VCURGneZ/a4WuXLvgDCIvKtRhjtmh7uPqulydmKUAn8nYA2s0TkBl7w2bnpdSnMKATebsA7UgDzdvlgSwEOE0r80ERuNSHidYl6S4E6IT+iXbPael5Ytnx4/5KMFGZ5gY0od6liuDtYaMbmAUMvT0i2tAKJDBg8Odho+saBvT7RHghiC8yGTQ6yizmTrET+SyKLDT69wBroTcioidCgbRmxhWsmSwSxvGw2ambLpJNInzSSiMw4PtoM0ncWuSNCfRIwKAyObXss0XjjXoKaOCoA7g9aHS1g0buNpNKUmYvMvP+sNndlGSgMOBUyQIFk8BVqnFLl9oUvhRgmm7wRSDYk6cAB5K0zitbGjBZrH7UWjg/q7ogdgm0dmP2OwZxr2LHe1LVjANK9lJRGyMKFg0u8SsM6By+2mC2XGL8GDQ7LUmw1MaJvJ/M1GPi/S+Nbt/oSTK7KKEF0MJsYVk/m4eYn4gY3GegnQUqVvBZ6C/ZwMHtUb8cYArO4KBix+2bhSQCrIW+4vw1AzhLBka/qpX1bytvx+I+qIYrn+Jb+48xtqpny6mSSgWfR17dAh2pC8Cgglf5Hg2aneXkqxLQCf3vl+8sGZQsmOnmXZ8evVl8EJ+f6Ko+HcUyAfWpvQoRM5a/NjsjXdDkdyf0AxC29LY8GTS6D7MBI69389jKXPSOzX2XrRP6WyAo78HXjkmi9UzA/K8HPEmaLxFfVuA1SCZXt11u/yluZwMavl7qU3qXxX/AYrpdef3NChq6uZWUUKWguF+VZFC4J/01s4qnY3xsjwR3jfshZHxM5kzlUTe7a9hJ56//KdDk6IRFQfo8/BtFq1Ae+AX5bwAAAABJRU5ErkJggg=="},"8bda":function(e,t,s){"use strict";s("070db")},b7c9:function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"操作人","prop":"createuser","show":true},{"label":"操作时间","prop":"create_time","show":true},{"label":"变更日志","prop":"content","show":true}]}')},db7a:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"client-manage"}},[t("div",{staticClass:"left-wp"},[t("div",{staticClass:"tree-wp"},[t("div",{staticClass:"search-wrap"},[t("el-input",{staticClass:"search",attrs:{placeholder:"请输入项目名或编码","suffix-icon":"iconfont iconzu3664"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),t("el-scrollbar",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],staticStyle:{height:"calc(100% - 4.05rem)"}},[t("div",{staticClass:"tree-wrap"},[t("el-tree",{ref:"tree",staticClass:"filter-tree",attrs:{lazy:"",data:e.treeData,"node-key":"nodeid","show-checkbox":"","check-strictly":"",accordion:"",props:e.defaultProps,load:e.loadNode},on:{"node-click":e.nodeClick,check:e.nodeCheck,"node-expand":e.nodeExpand},scopedSlots:e._u([{key:"default",fn:function({node:s}){return t("span",{staticClass:"custom-tree-node"},["city"==s.data.type?t("i",{staticClass:"iconfont icondaqu"}):e._e(),"village"==s.data.type?t("i",{staticClass:"iconfont iconxiangmu"}):e._e(),t("span",{staticClass:"label"},[e._v(e._s(s.label))]),s.loading?t("span",[t("i",{staticClass:"el-icon-loading",staticStyle:{color:"#ccc","margin-right":"0.25rem","vertical-align":"middle","font-size":"0.7rem",position:"relative","z-index":"100"}}),t("span",{staticStyle:{"font-size":"0.6rem",color:"#ccc"}},[e._v("正在加载")])]):e._e()])}}])})],1)])],1),t("div",{staticClass:"btn-wp"},[e.$menu.getters.judgeRole("Btn-ElcHtFMJmqIyaYGeY0USR3Fz")?t("el-button",{attrs:{type:"primary",round:""},on:{click:e.openDialog}},[e._v(" 新增客户 ")]):e._e()],1)]),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],class:["right-wp",e.currentUser?"":"emp"]},[!e.currentUser||e.isLoading?t("div",{staticClass:"empty"},[e._v(" 请在左侧选择客户！ ")]):t("el-scrollbar",{staticStyle:{height:"100%"}},[t("div",{staticClass:"user-info"},[t("div",{staticClass:"title"},[t("img",{attrs:{src:s("8465"),alt:""}}),t("span",[e._v("客户信息")])]),t("el-button",{attrs:{type:"primary",round:""},on:{click:e.logHandle}},[e._v(" 变更日志 ")]),t("div",{staticClass:"info-wp"},[t("div",{staticClass:"info-left"},[t("el-avatar",{attrs:{size:80,shape:"square",src:""}},[t("img",{attrs:{src:"https://cube.elemecdn.com/e/fd/0fc7d20532fdaf769a25683617711png.png"}})]),t("div",{staticClass:"infos"},[t("div",{staticClass:"info-item"},[t("span",{staticClass:"u_name"},[e._v(e._s(e.userDetail.realname))]),t("span",{staticClass:"sex"},[e._v(e._s(e.userDetail.sex))])]),t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("联系电话")]),t("span",{staticClass:"value"},[e._v(e._s(e.userDetail.tel))])]),t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("身份证号")]),t("span",{staticClass:"value"},[e._v(e._s(e.userDetail.idcard))])])]),e.$menu.getters.judgeRole("Btn-PXw2uDRRjak9Xe0EZB0Ta9FF")?t("el-button",{staticClass:"empty",attrs:{icon:"el-icon-edit-outline",type:"primary",round:""},on:{click:e.editHandle}},[e._v(" 编辑 ")]):e._e()],1),t("div",{staticClass:"info-right"},[t("div",{staticClass:"total-wp"},[t("div",{staticClass:"total"},[t("div",{staticClass:"num"},[e._v(e._s(e.userDetail.buy_rooms.length))]),t("div",{staticClass:"info"},[e._v("绑定房产(套)")])])]),t("div",{staticClass:"rooms-wp"},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("ul",{class:[e.userDetail.buy_rooms.length<4?"noscroll":""]},e._l(e.userDetail.buy_rooms,(function(s,a){return t("li",{key:a},[e._v(" "+e._s((s.rooms.unit.building?s.rooms.unit.building.block:"")+" - "+(s.rooms.unit.unit?s.rooms.unit.unit:"")+" - "+s.rooms.roomnum)+" ")])})),0)])],1)])]),t("div",{staticClass:"info-content"},[t("div",{class:["info-itm",e.houseActive?"active":""],on:{click:function(t){e.houseActive=!e.houseActive}}},[t("div",{staticClass:"icon-wp"},[t("i",{staticClass:"iconfont iconzuyongfang"})]),t("div",{staticClass:"msg-wp"},[t("div",{staticClass:"num"},[e._v(e._s(e.userDetail.rent_rooms.length))]),t("div",{staticClass:"msg"},[e._v(" 租用房产(套) "),e.houseActive?t("i",{staticClass:"el-icon-caret-top"}):t("i",{staticClass:"el-icon-caret-bottom"})])]),t("ul",{directives:[{name:"show",rawName:"v-show",value:e.houseActive,expression:"houseActive"}]},[0==e.userDetail.rent_rooms.length?t("div",{staticStyle:{color:"#3ebb75","font-size":"0.7rem","text-align":"center"}},[e._v(" 暂无数据！ ")]):e._e(),e._l(e.userDetail.rent_rooms,(function(s,a){return t("li",{key:a},[e._v(" "+e._s((s.rooms.unit.building?s.rooms.unit.building.block:"")+" - "+(s.rooms.unit?s.rooms.unit.unit:"")+" - "+s.rooms.roomnum)+" ")])}))],2)]),t("div",{class:["info-itm",e.fixcarActive?"active":""],on:{click:function(t){e.fixcarActive=!e.fixcarActive}}},[t("div",{staticClass:"icon-wp"},[t("i",{staticClass:"iconfont iconcheche"})]),t("div",{staticClass:"msg-wp"},[t("div",{staticClass:"num"},[e._v(e._s(e.userDetail.car.length))]),t("div",{staticClass:"msg"},[e._v(" 绑定车位(个) "),e.fixcarActive?t("i",{staticClass:"el-icon-caret-top"}):t("i",{staticClass:"el-icon-caret-bottom"})])]),t("ul",{directives:[{name:"show",rawName:"v-show",value:e.fixcarActive,expression:"fixcarActive"}]},[0==e.userDetail.car.length?t("div",{staticStyle:{color:"#3ebb75","font-size":"0.7rem","text-align":"center"}},[e._v(" 暂无数据！ ")]):e._e(),e._l(e.userDetail.car,(function(s,a){return t("li",{key:a},[e._v(" "+e._s(s.carmotor.map(e=>e.plates).join("、"))+" ")])}))],2)]),t("div",{class:["info-itm",e.monthcarActive?"active":""],on:{click:function(t){e.monthcarActive=!e.monthcarActive}}},[t("div",{staticClass:"icon-wp"},[t("i",{staticClass:"iconfont iconcheche"})]),t("div",{staticClass:"msg-wp"},[t("div",{staticClass:"num"},[e._v(e._s(e.userDetail.carmonth.length))]),t("div",{staticClass:"msg"},[e._v(" 绑定月租车(辆) "),e.monthcarActive?t("i",{staticClass:"el-icon-caret-top"}):t("i",{staticClass:"el-icon-caret-bottom"})])]),t("ul",{directives:[{name:"show",rawName:"v-show",value:e.monthcarActive,expression:"monthcarActive"}]},[0==e.userDetail.carmonth.length?t("div",{staticStyle:{color:"#3ebb75","font-size":"0.7rem","text-align":"center"}},[e._v(" 暂无数据！ ")]):e._e(),e._l(e.userDetail.carmonth,(function(s,a){return t("li",{key:a},[e._v(" "+e._s(s.carmotor.map(e=>e.plates).join("、"))+" ")])}))],2)]),t("div",{class:["info-itm",e.novehicleActive?"active":""],on:{click:function(t){e.novehicleActive=!e.novehicleActive}}},[t("div",{staticClass:"icon-wp"},[t("i",{staticClass:"iconfont iconfeijidongche1"})]),t("div",{staticClass:"msg-wp"},[t("div",{staticClass:"num"},[e._v(e._s(e.userDetail.carnonmotor.length))]),t("div",{staticClass:"msg"},[e._v(" 绑定非机动车(辆) "),e.novehicleActive?t("i",{staticClass:"el-icon-caret-top"}):t("i",{staticClass:"el-icon-caret-bottom"})])]),t("ul",{directives:[{name:"show",rawName:"v-show",value:e.novehicleActive,expression:"novehicleActive"}]},[0==e.userDetail.carnonmotor.length?t("div",{staticStyle:{color:"#3ebb75","font-size":"0.7rem","text-align":"center"}},[e._v(" 暂无数据！ ")]):e._e(),e._l(e.userDetail.carnonmotor,(function(s,a){return t("li",{key:a},[e._v(" "+e._s(s.plates)+" ")])}))],2)])])],1),t("div",{staticClass:"table-wp"},[t("div",{staticClass:"title"},[e._v("亲属关系")]),t("cus-table",{ref:"cusTable",attrs:{title:"客户信息",datas:e.tableData,cusColums:e.columns,cusConf:e.conf,ispaging:!1}})],1)])],1),t("el-dialog",{attrs:{visible:e.isShow,title:"新增客户",width:"45%","close-on-click-modal":!1},on:{"update:visible":function(t){e.isShow=t}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("el-form",{ref:"addForm",attrs:{model:e.addForm,rules:e.addRules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"客户姓名",prop:"uname"}},[t("el-input",{attrs:{placeholder:"请输入客户姓名"},model:{value:e.addForm.uname,callback:function(t){e.$set(e.addForm,"uname",t)},expression:"addForm.uname"}})],1),t("el-form-item",{attrs:{label:"客户性别",prop:"sex"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择客户性别"},model:{value:e.addForm.sex,callback:function(t){e.$set(e.addForm,"sex",t)},expression:"addForm.sex"}},[t("el-option",{key:1,attrs:{label:"男",value:1}}),t("el-option",{key:2,attrs:{label:"女",value:2}})],1)],1),t("el-form-item",{attrs:{label:"联系电话",prop:"tel"}},[t("el-input",{attrs:{placeholder:"请输入联系电话"},model:{value:e.addForm.tel,callback:function(t){e.$set(e.addForm,"tel",t)},expression:"addForm.tel"}})],1),t("el-form-item",{attrs:{label:"身份证号",prop:"idcard"}},[t("el-input",{attrs:{placeholder:"请输入身份证号"},model:{value:e.addForm.idcard,callback:function(t){e.$set(e.addForm,"idcard",t)},expression:"addForm.idcard"}})],1),t("el-form-item",{attrs:{label:"所属大区",prop:"barea"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择所属大区"},on:{change:e.bareaChange},model:{value:e.addForm.barea,callback:function(t){e.$set(e.addForm,"barea",t)},expression:"addForm.barea"}},e._l(e.areaOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"所属项目",prop:"village"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择所属项目"},on:{change:e.villageChange},model:{value:e.addForm.village,callback:function(t){e.$set(e.addForm,"village",t)},expression:"addForm.village"}},e._l(e.villageOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"客户类型",prop:"otype"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择客户类型"},on:{change:e.otypeChange},model:{value:e.addForm.otype,callback:function(t){e.$set(e.addForm,"otype",t)},expression:"addForm.otype"}},e._l(e.typeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),4!=e.addForm.otype?t("el-form-item",{attrs:{label:"是否计费",prop:"charge"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择是否计费"},model:{value:e.addForm.charge,callback:function(t){e.$set(e.addForm,"charge",t)},expression:"addForm.charge"}},[t("el-option",{key:0,attrs:{label:"否",value:0}}),t("el-option",{key:1,attrs:{label:"是",value:1}})],1)],1):e._e(),4===e.addForm.otype?t("el-form-item",{attrs:{label:"与业主关系",prop:"relation"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择关系"},model:{value:e.addForm.relation,callback:function(t){e.$set(e.addForm,"relation",t)},expression:"addForm.relation"}},e._l(e.relationOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)],1):e._e(),t("div",{staticClass:"line"}),4!=e.addForm.otype?t("el-form-item",{attrs:{label:"选择楼栋",prop:"build"}},[t("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择楼栋"},on:{change:e.buildChange},model:{value:e.addForm.build,callback:function(t){e.$set(e.addForm,"build",t)},expression:"addForm.build"}},e._l(e.buildOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.block,value:e.id}})})),1)],1):e._e(),4!=e.addForm.otype?t("el-form-item",{attrs:{label:"选择单元",prop:"unit"}},[t("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择单元"},on:{change:e.unitChange},model:{value:e.addForm.unit,callback:function(t){e.$set(e.addForm,"unit",t)},expression:"addForm.unit"}},e._l(e.unitOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.unit,value:e.id}})})),1)],1):e._e(),4!=e.addForm.otype?t("el-form-item",{attrs:{label:"选择房号",prop:"room"}},[t("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择房号"},model:{value:e.addForm.room,callback:function(t){e.$set(e.addForm,"room",t)},expression:"addForm.room"}},e._l(e.roomOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.roomnum,value:e.id}})})),1)],1):e._e()],1),4===e.addForm.otype?t("div",{staticClass:"user-search"},[t("el-input",{staticClass:"search",attrs:{placeholder:"请输入业主姓名或手机号","suffix-icon":"iconfont iconzu3664"},on:{change:function(t){return e.getUserRooms(!1)}},model:{value:e.userSearch,callback:function(t){e.userSearch=t},expression:"userSearch"}}),t("ul",{directives:[{name:"loading",rawName:"v-loading",value:e.userLoading,expression:"userLoading"}]},[e._l(e.allUserList,(function(s,a){return t("li",{key:a,class:[s.active?"active":""],on:{click:function(t){return e.liClick(a)}}},[t("span",[e._v(e._s(s.realname+" - "+s.type))]),t("span",[e._v(e._s(s.tel))]),t("span",[e._v(e._s(s.village))]),t("span",[e._v(e._s(s.buildname+" - "+s.unit))]),t("span",[e._v(e._s(s.roomnum))])])})),e.allUserList.length>0&&!e.loadMore&&!e.nomore?t("div",{staticClass:"loadmore"},[t("span",{on:{click:function(t){return e.getUserRooms(!0)}}},[e._v("点击加载更多")])]):e._e(),e.allUserList.length>0&&e.nomore?t("div",{staticClass:"nomore"},[e._v(" 没有更多啦！ ")]):e._e(),e.allUserList.length>0&&e.loadMore?t("div",{staticClass:"status"},[t("span",{staticClass:"el-icon-loading"}),e._v(" 加载中... ")]):e._e(),0==e.allUserList.length?t("div",{staticClass:"empty"},[e._v("暂无数据！")]):e._e()],2)],1):e._e()],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.confirm}},[e._v(" 提交保存 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.isShow=!1}}},[e._v(" 取消 ")])],1)],1),t("el-dialog",{staticClass:"editDialog",attrs:{visible:e.showEditDialog,title:"编辑客户信息",width:"35%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showEditDialog=t}}},[t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"客户姓名",prop:"uname"}},[t("el-input",{attrs:{readonly:!e.$menu.getters.judgeRole("Btn-b884fRdAyqhSEuFfQG1257Sr"),placeholder:"请输入客户姓名"},model:{value:e.ruleForm.uname,callback:function(t){e.$set(e.ruleForm,"uname",t)},expression:"ruleForm.uname"}})],1),t("el-form-item",{attrs:{label:"客户性别",prop:"sex"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择客户性别"},model:{value:e.ruleForm.sex,callback:function(t){e.$set(e.ruleForm,"sex",t)},expression:"ruleForm.sex"}},[t("el-option",{key:1,attrs:{label:"男",value:1}}),t("el-option",{key:2,attrs:{label:"女",value:2}})],1)],1),t("el-form-item",{attrs:{label:"联系电话",prop:"tel"}},[t("el-input",{attrs:{placeholder:"请输入联系电话"},model:{value:e.ruleForm.tel,callback:function(t){e.$set(e.ruleForm,"tel",t)},expression:"ruleForm.tel"}})],1),t("el-form-item",{attrs:{label:"身份证号",prop:"idcard"}},[t("el-input",{attrs:{placeholder:"请输入身份证号"},model:{value:e.ruleForm.idcard,callback:function(t){e.$set(e.ruleForm,"idcard",t)},expression:"ruleForm.idcard"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.editSubmit}},[e._v(" 提交保存 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showEditDialog=!1}}},[e._v(" 取消 ")])],1)],1),t("el-dialog",{staticClass:"logDialog",attrs:{visible:e.isShowLog,title:"变更日志",width:"40%"},on:{close:function(t){e.isShowLog=!1}}},[t("div",{staticClass:"log-wp"},[t("cus-table",{ref:"cusTable",attrs:{title:"客户变更日志",datas:e.logTableData,cusColums:e.logColumns,cusConf:e.logConf,ispaging:!0},on:{sizeChange:e.logSizeChange,currentChange:e.logCurrentChange}})],1)])],1)},i=[],l=(s("5948"),s("e3dc")),o=s("b7c9"),r={name:"clientManage",data(){return{urlObj:{clientTree:this.$api.state.Means.clientTree.url,clientSearch:this.$api.state.Means.clientSearch.url,clientDetail:this.$api.state.Means.clientDetail.url,userType:this.$api.state.Means.userType.url,userRooms:this.$api.state.Means.userRooms.url,folkstype:this.$api.state.Means.folkstype.url,addClient:this.$api.state.Means.addClient.url,buildOfVillage:this.$api.state.Public.buildOfVillage.url,unitOfBuild:this.$api.state.Public.unitOfBuild.url,roomOfUnit:this.$api.state.Public.roomOfUnit.url,editowner:this.$api.state.Means.editowner.url,logData:this.$api.state.Means.logData.url},isShow:!1,treeLoading:!1,isLoading:!1,filterText:"",treeData:[],defaultProps:{children:"children",label:"label",isLeaf:"isLeaf"},userInfos:[],roomInfos:[],userSearch:"",selectUser:"",allUserList:[],userLoading:!1,loadMore:!1,nomore:!1,currentUser:"",houseActive:!1,fixcarActive:!1,monthcarActive:!1,novehicleActive:!1,userDetail:"",tableData:[],columns:l.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:10,dataTotal:0},isCommit:!1,root:"",resolve:"",expNode:null,showEditDialog:!1,ruleForm:{uname:"",sex:"",tel:"",idcard:""},rules:{uname:[{required:!!this.$menu.getters.judgeRole("Btn-b884fRdAyqhSEuFfQG1257Sr"),message:"请输入客户姓名",trigger:"blur"}],sex:[{required:!0,message:"请选择客户性别",trigger:"change"}],tel:[{required:!0,message:"请输入联系电话",trigger:"blur"}],idcard:[{required:!0,message:"请输入身份证号",trigger:"blur"}]},addForm:{uname:"",sex:"",tel:"",idcard:"",barea:"",village:"",otype:"",charge:"",relation:"",build:"",unit:"",room:""},addRules:{uname:[{required:!0,message:"请输入客户姓名",trigger:"blur"}],sex:[{required:!0,message:"请选择客户性别",trigger:"change"}],tel:[{required:!0,message:"请输入联系电话",trigger:"blur"}],idcard:[{required:!0,message:"请输入身份证号",trigger:"blur"}],barea:[{required:!0,message:"请选择所属大区",trigger:"change"}],village:[{required:!0,message:"请选择所属项目",trigger:"change"}],otype:[{required:!0,message:"请选择客户类型",trigger:"change"}],charge:[{required:!0,message:"请选择是否计费",trigger:"change"}],relation:[{required:!0,message:"请选择关系",trigger:"change"}],build:[{required:!1,message:"请选择楼栋",trigger:"change"}],unit:[{required:!1,message:"请选择单元",trigger:"change"}],room:[{required:!1,message:"请选择房号",trigger:"change"}]},areaOptions:[],villageOptions:[],typeOptions:[],relationOptions:[],buildOptions:[],unitOptions:[],roomOptions:[],isShowLog:!1,logTableData:[],logColumns:o.list,logConf:{loadStatus:!1,emptyText:"",curPage:1,limit:10,dataTotal:0}}},watch:{filterText(){if(this.expNode){let e=this.$refs.tree.getNode(this.expNode.nodeid);e.loaded=!1,e.expand()}}},methods:{async getTreeData(e){let t=await this.$axios.post(this.urlObj.clientTree);this.treeLoading=!1;let s=[];200==t.Code?(t.Data.forEach(e=>{e.nodeid=e.type+e.id,e.disabled=!0}),s=t.Data,this.treeData=t.Data):this.$message({message:"获取数据失败！",type:"error"}),e(s)},async getUserTree(e,t){let s={vid:e.data.id,page:1,limit:20,keywords:this.filterText},a=await this.$axios.post(this.urlObj.clientSearch,s),i=[];200==a.Code?(a.Data.data.forEach(e=>{e.nodeid=e.unique}),i=a.Data.data):this.$message({message:"获取数据失败！",type:"error"}),t(i),this.loadMoreUser(e)},loadMoreUser(e){this.$nextTick(()=>{setTimeout(()=>{let t=this.$refs.tree.$el,s=t.querySelector(".el-tree-node__children .el-tree-node.is-expanded .el-tree-node__children"),a=s.querySelector(".moreDom");a&&s.removeChild(a);let i=document.createElement("div");i.classList.add("moreDom"),i.innerText=e.childNodes.length<20?"没有更多啦！":"加载更多",i.style.textAlign="center",i.style.fontSize="14px",i.style.padding="10px",i.style.cursor="pointer",i.style.color=e.childNodes.length<20?"#ccc":"#333",s.appendChild(i);let l=this;function o(t){t.stopPropagation(),i.innerText="加载中...";let a={vid:e.data.id,page:Math.ceil(e.childNodes.length/20)+1,limit:20,keywords:this.filterText};l.$axios.post(l.urlObj.clientSearch,a).then(t=>{if(200===t.Code)if(t.Data.data.length>0){s.removeChild(i),t.Data.data.forEach(e=>{e.nodeid=e.unique});let a=e.childNodes.map(e=>e.data);a=a.concat(t.Data.data),l.$refs.tree.updateKeyChildren(e.data.nodeid,a),l.$nextTick(()=>{i.innerText="加载更多",s.appendChild(i)})}else i.innerText="没有更多啦！",i.style.color="#ccc",i.removeEventListener("click",o,!1),i.addEventListener("click",e=>{e.stopPropagation()},!1);else{let e=t.Message?t.Message:"数据获取失败！";l.$message({type:"error",message:e})}}).catch(()=>{l.$message({type:"error",message:"数据获取失败！"})})}e.childNodes.length<20?i.addEventListener("click",e=>{e.stopPropagation()},!1):i.addEventListener("click",o,!1)})})},nodeExpand(e){"village"===e.type?this.expNode={id:e.id,nodeid:e.nodeid}:this.expNode=null},getClientDetail(e){this.isLoading=!0,this.currentUser=e,this.houseActive=!1,this.fixcarActive=!1,this.monthcarActive=!1,this.novehicleActive=!1,this.$axios.post(this.urlObj.clientDetail,e).then(e=>{if(200===e.Code){let t=[],s=[];e.Data.data.owner_rooms.forEach(e=>{e.is_owner?t.push(e):s.push(e)}),e.Data.data.binds=t,e.Data.data.rents=s,this.userDetail=e.Data.data;let a=[];e.Data.folks.forEach(e=>{let t={name:e.folk_user.realname,sex:e.folk_user.sex,relation:e.type.name,tel:e.folk_user.tel,idcard:e.folk_user.idcard};a.push(t)}),this.tableData=a}else this.$message({type:"error",message:"客户详情数据获取失败！"});this.isLoading=!1}).catch(e=>{this.$message({type:"error",message:"客户详情数据获取失败！"}),this.isLoading=!1})},async loadNode(e,t){this.root=e,this.resolve=t,0==e.level?(this.treeLoading=!0,this.getTreeData(t)):2==e.level?this.getUserTree(e,t):(e.data.children.forEach(e=>{e.disabled=!0,e.nodeid=e.type+e.id}),t(e.data.children))},nodeClick(e){this.$nextTick(()=>{e.disabled||(this.$refs.tree.setCheckedNodes([e]),this.currentUser&&this.currentUser.id==e.id||this.getClientDetail(e))})},nodeCheck(e){e.disabled||(this.$refs.tree.setCheckedNodes([e]),this.currentUser&&this.currentUser.id==e.id||this.getClientDetail(e))},getUserType(){this.$axios.post(this.urlObj.userType).then(e=>{if(200===e.Code)e.Data.forEach(e=>{e.id=e.value}),this.typeOptions=e.Data;else{let t=e.Message?e.Message:"客户类别数据获取失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},getFolkstype(){this.$axios.post(this.urlObj.folkstype).then(e=>{if(200===e.Code)e.Data.forEach(e=>{e.id=e.value}),this.relationOptions=e.Data;else{let t=e.Message?e.Message:"亲属关系数据获取失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},openDialog(){this.$refs.addForm&&this.$refs.addForm.resetFields();let e=[];this.treeData.forEach(t=>{let s={label:t.label,value:t.id};e.push(s)}),this.areaOptions=e,this.userSearch="",this.selectUser="",this.allUserList=[],this.nomore=!1,this.isShow=!0,this.getUserType()},bareaChange(e){if(this.addForm.village="",this.villageOptions=[],this.userSearch="",this.allUserList=[],this.selectUser="",this.addForm.build="",this.buildOptions=[],this.addForm.unit="",this.unitOptions=[],this.addForm.room="",this.roomOptions=[],e){let t=this.treeData.find(t=>t.id==e);this.villageOptions=t.children}},villageChange(e){this.userSearch="",this.allUserList=[],this.selectUser="",this.addForm.build="",this.buildOptions=[],this.addForm.unit="",this.unitOptions=[],this.addForm.room="",this.roomOptions=[],e&&this.getBuildData()},getBuildData(){let e={vid:this.addForm.village};this.$axios.post(this.urlObj.buildOfVillage,e).then(e=>{if(200===e.Code)this.buildOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"楼栋数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},getUnitData(){let e={bid:this.addForm.build};this.$axios.post(this.urlObj.unitOfBuild,e).then(e=>{if(200===e.Code)this.unitOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"单元数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},getRoomData(){let e={unit:this.addForm.unit};this.$axios.post(this.urlObj.roomOfUnit,e).then(e=>{if(200===e.Code)this.roomOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"房屋数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},otypeChange(e){4==e&&this.getFolkstype()},buildChange(e){this.addForm.unit="",this.unitOptions=[],this.addForm.room="",this.roomOptions=[],e&&this.getUnitData()},unitChange(e){this.addForm.room="",this.roomOptions=[],e&&this.getRoomData()},getUserRooms(e){if(this.addForm.village){e?this.loadMore=!0:(this.nomore=!1,this.userLoading=!0);let t={keywords:this.userSearch.trim(),vid:this.addForm.village,page:e?Math.ceil(this.allUserList.length/20)+1:1,limit:20};this.$axios.post(this.urlObj.userRooms,t).then(t=>{if(200===t.Code)e||(this.selectUser=""),t.Data.data.length>0?(t.Data.data.forEach(e=>{e.active=!1}),this.allUserList=e?this.allUserList.concat(t.Data.data):t.Data.data):e?this.nomore=!0:this.allUserList=[];else{let e=t.Message?t.Message:"用户数据获取失败！";this.$message({type:"error",message:e})}this.userLoading=!1,this.loadMore=!1}).catch(e=>{this.userLoading=!1,this.loadMore=!1})}else this.$message({type:"warning",message:"请选择所属项目后再试一次！"})},liClick(e){let t=this.allUserList.slice(0);t.forEach(e=>{e.active=!1}),t[e].active=!0,this.selectUser=t[e],this.allUserList=t},close(){this.isShow=!1},confirm(){this.$refs.addForm.validate(e=>{if(e){let e={village_id:this.addForm.village,realname:this.addForm.uname,sex:this.addForm.sex,tel:this.addForm.tel,idcard:this.addForm.idcard,owner_type:this.addForm.otype};if(4===this.addForm.otype){if(!this.selectUser||!this.selectUser.oid)return void this.$message({type:"warning",message:"请选择业主"});e.bind_room=1,e.roomid=this.selectUser.roomid,e.bind_folks=1,e.bind_owner_id=this.selectUser.oid,e.bind_folk_id=this.addForm.relation}else e.bind_room=this.addForm.room?1:0,e.roomid=this.addForm.room,e.bind_folks=0,e.charge_type=this.addForm.charge;this.isCommit=!0,this.$axios.post(this.urlObj.addClient,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:"客户添加成功！"}),this.isShow=!1,this.loadNode(this.root,this.resolve);else{let t=e.Message?e.Message:"数据提交失败！";this.$message({type:"error",message:t})}this.isCommit=!1}).catch(e=>{this.$message({type:"error",message:"数据提交失败！"}),this.isCommit=!1})}})},editHandle(){this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.ruleForm.uname=this.userDetail.realname,this.ruleForm.sex="男"==this.userDetail.sex?1:2,this.ruleForm.tel=this.userDetail.tel,this.ruleForm.idcard=this.userDetail.idcard,this.showEditDialog=!0},editSubmit(){this.$refs.ruleForm.validate(e=>{if(e){this.isCommit=!0;let e={id:this.userDetail.id,sex:this.ruleForm.sex,idcard:this.ruleForm.idcard,tel:this.ruleForm.tel};this.$menu.getters.judgeRole("Btn-b884fRdAyqhSEuFfQG1257Sr")&&(e.realname=this.ruleForm.uname),this.$axios.post(this.urlObj.editowner,e).then(t=>{if(200===t.Code){this.$message({type:"success",message:"业主信息修改成功！"}),this.showEditDialog=!1,this.getClientDetail(this.currentUser);let t=this.$refs.tree.getNode(this.currentUser);t.data.label=e.realname}else{let e=t.Message?t.Message:"业主信息修改失败！";this.$message({type:"error",message:e})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},logHandle(){this.isShowLog=!0,this.getLogTableData()},getLogTableData(){this.logConf.loadStatus=!0;let e={page:this.logConf.curPage,limit:this.logConf.limit,id:this.currentUser.id,type:"owner"};this.$axios.post(this.urlObj.logData,e).then(e=>{if(200===e.Code){let t=[];e.Data.data.forEach(e=>{let s={createuser:e.createuser?e.createuser.realname:"",create_time:e.create_time,content:e.content};t.push(s)}),this.logTableData=t,this.logConf.loadStatus=!1,this.logConf.emptyText=""}else 204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.logTableData=[],this.logConf.emptyText=e.Message,this.logConf.dataTotal=0,this.logConf.loadStatus=!1)}).catch(()=>{this.logTableData=[],this.logConf.emptyText="服务器连接失败...",this.logConf.dataTotal=0,this.logConf.loadStatus=!1})},logSizeChange(e){this.logConf.limit=e,this.getLogTableData()},logCurrentChange(e){this.logConf.curPage=e,this.getLogTableData()}}},n=r,d=(s("8bda"),s("1805")),c=Object(d["a"])(n,a,i,!1,null,null,null);t["default"]=c.exports},e3dc:function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"客户名称","prop":"name","show":true},{"label":"性别","prop":"sex","show":true,"color":"#999"},{"label":"与客户关系","prop":"relation","show":true,"color":"#69da61"},{"label":"联系电话","prop":"tel","show":true,"color":"#999"},{"label":"身份证号码","prop":"idcard","show":true,"color":"#999"}]}')}}]);