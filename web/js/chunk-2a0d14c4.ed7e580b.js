(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2a0d14c4"],{"4da2":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"通告标题","prop":"name","show":true},{"label":"模板名称","prop":"bigareaname","show":true,"color":"#999"},{"label":"创建人","prop":"cname","show":true,"color":"#999"},{"label":"创建时间","prop":"create_time","show":true,"color":"#999"},{"label":"是否置顶","prop":"is_top","type":"checkbox","action":"totop","role":"totop","show":true,"token":"Btn-OCZ4pAtPpbet3GI4Cp4rcnga"},{"label":"是否开启","prop":"is_show","type":"checkbox","action":"open","role":"open","show":true,"token":"Btn-OCZ4pAtPpbet3GI4Cp4rcnga"},{"label":"操作","prop":"","width":200,"type":"button","show":true,"btns":[{"name":"编辑","type":"primary","size":"small","round":true,"action":"edit","role":"edit","token":"Btn-yLHizr3FGlCwcTcHDRr6toBf"},{"name":"删除","type":"danger","size":"small","round":true,"action":"delInvoice","role":"delInvoice","token":"Btn-VrSczfheKWLqyxuBFeno16kB"}]}]}')},"5d2e":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"housekeeper"}},[t("div",{staticClass:"top"},[t("div",{staticClass:"main"},[t("div",{staticClass:"common-left"},[t("span",{staticClass:"common-chose-info",on:{click:function(t){return e.$refs.showFilterVillage.showDialog()}}},[t("i",{staticClass:"iconfont icondaqu"}),e._v(" "+e._s(e.choseVillageInfo.name)+" ")]),t("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.tableLoad}},[e._v(" 查询 ")])],1)])]),t("div",{staticClass:"main-wp"},[t("div",{staticClass:"table-wp"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.conf.loadStatus,expression:"conf.loadStatus"}],ref:"tableRef",attrs:{data:e.tableData,"highlight-current-row":"","element-loading-text":"数据获取中...","empty-text":e.conf.emptyText,size:"small","row-key":"nodeid",height:"100%",indent:30,"cell-class-name":e.cellClass},on:{"selection-change":e.selectionChange,select:e.rowSelect,"select-all":e.selectAll}},[e._v(" > "),t("el-table-column",{attrs:{type:"selection",width:"100"}}),t("el-table-column",{attrs:{prop:"name",label:"楼栋单元"}}),t("el-table-column",{attrs:{prop:"steward",label:"楼栋管家"}}),t("el-table-column",{attrs:{prop:"phone",label:"管家电话"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(s){return[!s.row.block&&e.$menu.getters.judgeRole("Btn-HxWV81S6U0XFN9JahSOWoEdF")?t("el-button",{attrs:{type:"primary",plain:"",round:"",size:"small"},on:{click:function(t){return e.stewardChange(s.row)}}},[e._v(" 更换管家 ")]):e._e()]}}])})],1)],1),t("div",{staticClass:"btn-wp"},[e.$menu.getters.judgeRole("Btn-t0zTob0ivtfsqFycKJ7AUJt8")?t("el-button",{attrs:{disabled:0===e.tableSelected.length,type:"primary",round:""},on:{click:e.setBatch}},[e._v(" 批量设置管家 ")]):e._e()],1)]),t("filter-village",{ref:"showFilterVillage",attrs:{vid:e.choseVillageInfo.vid},on:{choseInfo:e.filterVillage}}),t("el-dialog",{staticClass:"editDialog",attrs:{visible:e.showDialog,title:"楼栋管家设置",width:"36%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showDialog=t}}},[t("el-autocomplete",{ref:"searchInput",staticClass:"house-search",attrs:{"popper-class":"my-autocomplete","fetch-suggestions":e.querySearchAsync,placeholder:"请输入管家姓名/手机号"},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function({item:s}){return[t("div",{staticClass:"tr-item"},[t("span",{staticClass:"td-item"},[e._v(e._s(s.realname))]),t("span",{staticClass:"td-item"},[e._v(e._s(s.mobile))]),t("span",{staticClass:"td-item"},[e._v(e._s(s.idcard))])]),e.allUserList.length<=1?t("div",{staticClass:"load-more"},[e._v(" 暂无数据！ ")]):e._e()]}}]),model:{value:e.autoValue,callback:function(t){e.autoValue=t},expression:"autoValue"}},[t("i",{staticClass:"iconfont iconzu3664 el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})]),t("div",{staticClass:"input-wp"},[t("div",{staticClass:"input-item"},[t("div",{staticClass:"name"},[e._v("管家姓名")]),t("el-input",{attrs:{readonly:"",placeholder:"用户姓名"},model:{value:e.currentUser.realname,callback:function(t){e.$set(e.currentUser,"realname",t)},expression:"currentUser.realname"}})],1),t("div",{staticClass:"input-item"},[t("div",{staticClass:"name"},[e._v("联系电话")]),t("el-input",{attrs:{placeholder:"联系电话"},model:{value:e.currentUser.mobile,callback:function(t){e.$set(e.currentUser,"mobile",t)},expression:"currentUser.mobile"}})],1)]),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.confirm}},[e._v(" 提交保存 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showDialog=!1}}},[e._v(" 取消 ")])],1)],1)],1)},a=[],l=(s("5948"),s("4da2")),o={name:"housekeeper",data(){return{urlObj:{buildings:this.$api.state.Custom.buildings.url,editunitsteward:this.$api.state.Custom.editunitsteward.url,getUsers:this.$api.state.Public.getUsers.url},choseVillageInfo:{name:"全部项目",vid:0},tableData:[],columns:l.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:10,dataTotal:0},tableSelected:[],currentObj:"",autoValue:"",allUserList:[],currentUser:{},showDialog:!1,isBatch:!1,isCommit:!1}},mounted(){let e=sessionStorage.getItem("vid"),t=sessionStorage.getItem("vname");e&&(this.choseVillageInfo.vid=e,this.choseVillageInfo.name=t),this.tableLoad()},methods:{filterVillage(e){this.choseVillageInfo.name=e.name,this.choseVillageInfo.vid=e.vid,this.tableLoad()},cellClass(e){if(1==e.columnIndex)return"unit"},tableLoad(){this.conf.loadStatus=!0;let e={vid:this.choseVillageInfo.vid};this.$axios.post(this.urlObj.buildings,e).then(e=>{200===e.Code?(e.Data&&e.Data.length>0&&e.Data.forEach(e=>{let t=[],s=[],i=[];e.unit.forEach(a=>{let l={id:a.id,pid:e.id,name:a.unit,steward:a.stewards?a.stewards.realname:"",phone:a.stewards_tel,uid:e.stewards_id,level:2,nodeid:"unit"+a.id};t.includes(l.steward)||t.push(l.steward),s.includes(l.phone)||s.push(l.phone),i.push(l)}),e.name=e.block,e.steward=t.join("/"),e.phone=s.join("/"),e.children=i,e.level=1,e.nodeid="build"+e.id}),this.tableData=e.Data?e.Data:[],this.conf.loadStatus=!1,this.conf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.datas=[],this.conf.emptyText=e.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.datas=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},toggleSelection(e,t){e?e.forEach(e=>{this.$refs.tableRef.toggleRowSelection(e,t)}):this.$refs.tableRef.clearSelection()},rowSelect(e,t){if(e.indexOf(t)>-1&&1===t.level&&this.toggleSelection(t.children,!0),-1===e.indexOf(t)&&1===t.level&&this.toggleSelection(t.children,!1),e.indexOf(t)>-1&&2===t.level){let s=this.tableData.filter(e=>{if(e.id===t.pid)return e}),i=!0;s[0].children.forEach(t=>{e.includes(t)||(i=!1)}),i?this.toggleSelection(s,!0):this.toggleSelection(s,"indeterminate")}if(-1===e.indexOf(t)&&2===t.level){let e=this.tableData.filter(e=>{if(e.id===t.pid)return e});this.toggleSelection(e,!1)}},selectAll(e){let t=!1;e.forEach(e=>{1===e.level&&(t=!0,this.toggleSelection(e.children,!0))}),t||this.toggleSelection()},selectionChange(){this.tableSelected=this.$refs.tableRef.selection},stewardChange(e){this.isBatch=!1,this.currentObj=e,this.currentUser={uid:e.uid,realname:e.steward,mobile:e.phone},this.showDialog=!0},setBatch(){this.isBatch=!0,this.showDialog=!0},async querySearchAsync(e,t){if(e){let s={keywords:e},i=await this.$axios.post(this.urlObj.getUsers,s);if(200===i.Code){let e={id:0,realname:"姓名",mobile:"电话号码",idcard:"身份证号"};i.Data.unshift(e),this.allUserList=i.Data,this.nomore=!1,t(i.Data)}else this.$refs.searchInput.$children[0].blur()}else t([])},handleSelect(e){this.currentUser=e},confirm(){if(this.currentUser.uid)if(this.currentUser.mobile){this.isCommit=!0;let e={uid:this.currentUser.uid,mobile:this.currentUser.mobile,unit_ids:[]};if(this.isBatch){let t=this.$refs.tableRef.selection;e.unit_ids=[],t.forEach(t=>{2==t.level&&e.unit_ids.push(t.id)})}else e.unit_ids=[this.currentObj.id];this.$axios.post(this.urlObj.editunitsteward,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:"楼栋管家设置成功！"}),this.showDialog=!1,this.tableLoad();else{let t=e.Message?e.Message:"楼栋管家信息提交失败！";this.$message({type:"error",message:t})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}else this.$message({type:"warning",message:"请输入联系电话！"});else this.$message({type:"warning",message:"请选择楼栋管家！"})}}},n=o,r=(s("c3fd"),s("1805")),c=Object(r["a"])(n,i,a,!1,null,null,null);t["default"]=c.exports},b64a:function(e,t,s){},c3fd:function(e,t,s){"use strict";s("b64a")}}]);