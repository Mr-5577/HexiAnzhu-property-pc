(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ef872e5e"],{"1b9b":function(e,t,a){},2108:function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"模板名称","prop":"title","show":true,"width":120},{"label":"收费模式","prop":"mode_text","show":true,"color":"#999","width":120},{"label":"收费标准","prop":"standard_text","show":true},{"label":"添加人","prop":"uname","show":true,"color":"#999","width":120},{"label":"添加时间","prop":"create_time","show":true,"color":"#999"},{"label":"资费说明","prop":"remark","show":true,"color":"#999"},{"label":"启用状态","prop":"status","width":120,"type":"checkbox","action":"setVal","role":"setVal","show":true,"token":"Btn-DCD6FA941A0BBED81532EB1A"},{"label":"应用车场","prop":"","width":200,"type":"button","show":true,"btns":[{"name":"详情","type":"primary","size":"small","round":true,"action":"detail","role":"detail","token":"empty"},{"name":"编辑","type":"primary empty","size":"small","round":true,"action":"edit","role":"edit","token":"Btn-DEFCD9C5A89FACC8C9452F8F"}]}]}')},"9f63":function(e,t,a){"use strict";a("1b9b")},d347:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"charge-temp"}},[t("div",{staticClass:"top"},[t("div",{staticClass:"main"},[t("div",{staticClass:"common-left"},[t("span",{staticClass:"common-chose-info",on:{click:function(t){return e.$refs.showFilterVillage.showDialog()}}},[t("i",{staticClass:"iconfont icondaqu"}),e._v(" "+e._s(e.choseVillageInfo.name)+" "),e.choseVillageInfo.vid?t("i",{staticClass:"close el-icon-circle-close",on:{click:function(t){return t.stopPropagation(),e.filterVillage({name:"全部项目",vid:""})}}}):e._e()]),t("el-select",{attrs:{clearable:"",placeholder:"请选择收费模式"},on:{change:e.tableLoad},model:{value:e.mode,callback:function(t){e.mode=t},expression:"mode"}},e._l(e.modeOptions,(function(e){return t("el-option",{key:e.mode,attrs:{label:e.mode_text,value:e.mode}})})),1),t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"输入添加入名字查询"},domProps:{value:e.searchVal},on:{input:function(t){t.target.composing||(e.searchVal=t.target.value)}}}),t("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.keySearch(!0)}}},[e._v(" 查询 ")])],1),t("div",{staticClass:"common-right"},[e.$menu.getters.judgeRole("Btn-DEFCD9C5A89FACC8C9452F8F")?t("el-button",{attrs:{type:"primary",round:"",plain:"",icon:"iconfont iconxinzeng"},on:{click:e.addCharge}},[e._v(" 新增收费标准 ")]):e._e()],1)])]),t("div",{staticClass:"main-wp"},[t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.tableData,cusColums:e.columns,cusConf:e.conf,ispaging:!0},on:{sizeChange:e.sizeChange,currentChange:e.currentChange,setVal:e.tableSetVal,detail:e.tableDetail,edit:e.tempEdit}})],1)]),t("el-dialog",{staticClass:"addDialog",attrs:{visible:e.showAddDialog,title:e.isEdit?"编辑收费标准":"新增收费标准",width:"40%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showAddDialog=t}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"模板名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入模板名称"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),t("el-form-item",{attrs:{label:"收费模式",prop:"mode"}},[t("el-select",{attrs:{placeholder:"请选择收费模式"},on:{change:e.modeChange},model:{value:e.ruleForm.mode,callback:function(t){e.$set(e.ruleForm,"mode",t)},expression:"ruleForm.mode"}},e._l(e.modeOptions,(function(e){return t("el-option",{key:e.mode,attrs:{label:e.mode_text,value:e.mode}})})),1)],1),t("el-form-item",{attrs:{label:`有效时间（${"day"==e.ruleForm.mode?"天":"小时"}）`,prop:"time"}},[t("el-input",{attrs:{disabled:"",placeholder:"请输入有效时间"},model:{value:e.ruleForm.time,callback:function(t){e.$set(e.ruleForm,"time",t)},expression:"ruleForm.time"}})],1),t("el-form-item",{attrs:{label:"收费金额",prop:"money"}},[t("el-input",{attrs:{type:"number",placeholder:"请输入收费金额"},model:{value:e.ruleForm.money,callback:function(t){e.$set(e.ruleForm,"money",t)},expression:"ruleForm.money"}})],1),t("el-form-item",{attrs:{label:"通行模式",prop:"type"}},[t("el-select",{attrs:{placeholder:"请选择通行模式"},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},[t("el-option",{attrs:{label:"限次",value:1}}),t("el-option",{attrs:{label:"不限次",value:2}})],1)],1),1==e.ruleForm.type?t("el-form-item",{attrs:{label:"通行次数",prop:"number"}},[t("el-input",{attrs:{type:"number",placeholder:"请输入通行次数"},model:{value:e.ruleForm.number,callback:function(t){e.$set(e.ruleForm,"number",t)},expression:"ruleForm.number"}})],1):e._e(),t("el-form-item",{staticClass:"remark",attrs:{label:"资费说明",prop:"remark"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入资费说明",resize:"none",rows:3},model:{value:e.ruleForm.remark,callback:function(t){e.$set(e.ruleForm,"remark",t)},expression:"ruleForm.remark"}})],1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.addSubmit}},[e._v(" "+e._s(e.isEdit?"确认修改":"确认新增")+" ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showAddDialog=!1}}},[e._v(" 取消 ")])],1)],1),t("el-dialog",{staticClass:"useDialog",attrs:{visible:e.showUseDialog,title:"应用车场",width:"60%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showUseDialog=t}}},[t("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:e.loadDetail,expression:"loadDetail"}],attrs:{"element-loading-text":"数据加载中"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.detailList,(function(a){return t("el-tab-pane",{key:a.deptid,attrs:{label:a.deptname,name:a.deptname}},[t("el-scrollbar",{staticStyle:{height:"100%"}},e._l(a.lowerDepartment,(function(a,s){return t("div",{key:s,staticClass:"content"},[t("div",{staticClass:"cname"},[e._v(" "+e._s(a.deptname)+" ")]),t("ul",[t("li",{class:[a.lowerDepartment.every(e=>e.checked)?"active":""],on:{click:function(t){return e.selectAll(a)}}},[e._v(" 全部 ")]),e._l(a.lowerDepartment,(function(a,s){return t("li",{key:s,class:[a.checked?"active":""],on:{click:function(e){a.checked=!a.checked}}},[e._v(" "+e._s(a.deptname)+" ")])}))],2)])})),0)],1)})),1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{disabled:!e.$menu.getters.judgeRole("Btn-F44614A8C5A89C0CD4AF0BE9"),loading:e.isCommit,type:"primary",round:""},on:{click:e.useSubmit}},[e._v(" 确认应用 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showUseDialog=!1}}},[e._v(" 取消 ")])],1)],1),t("filter-village",{ref:"showFilterVillage",attrs:{vid:e.choseVillageInfo.vid},on:{choseInfo:e.filterVillage}})],1)},i=[],l=(a("5948"),a("2108")),o={name:"chargeTemp",data(){return{urlObj:{charges:this.$api.state.ParkManage.charges.url,modes:this.$api.state.ParkManage.modes.url,chargestatus:this.$api.state.ParkManage.chargestatus.url,addcharge:this.$api.state.ParkManage.addcharge.url,applied:this.$api.state.ParkManage.applied.url,appliedcars:this.$api.state.ParkManage.appliedcars.url},choseVillageInfo:{name:"全部项目",vid:""},mode:"",modeOptions:[],searchVal:"",tableData:[],columns:l.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},showAddDialog:!1,ruleForm:{name:"",mode:"",money:"",time:"",type:"",number:"",remark:""},rules:{name:[{required:!0,message:"请输入模板名称",trigger:"blur"}],mode:[{required:!0,message:"请选择收费模式",trigger:"change"}],money:[{required:!0,message:"请输入收费金额",trigger:"blur"}],time:[{required:!1,message:"请输入有效时间",trigger:"blur"}],type:[{required:!0,message:"请选择通行模式",trigger:"change"}],number:[{required:!0,message:"请输入通行次数",trigger:"blur"}],remark:[{required:!1,message:"请输入资费说明",trigger:"blur"}]},isCommit:!1,showUseDialog:!1,detailList:[],activeName:"",cIndex:"",loadDetail:!1,isEdit:!1,editIndex:""}},mounted(){let e=sessionStorage.getItem("vid"),t=sessionStorage.getItem("vname");e&&(this.choseVillageInfo.vid=e,this.choseVillageInfo.name=t),this.getChargeData(),this.tableLoad()},methods:{filterVillage(e){this.choseVillageInfo.name=e.name,this.choseVillageInfo.vid=e.vid,this.searchVal="",this.mode="",this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad()},keySearch(){this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad()},getChargeData(){this.$axios.post(this.urlObj.modes,{mode:""}).then(e=>{if(200===e.Code)this.modeOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取收费模式数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},tableLoad(){this.conf.loadStatus=!0;let e={page:this.conf.curPage,limit:this.conf.limit,vid:this.choseVillageInfo.vid,mode:this.mode,keyword:this.searchVal};this.$axios.post(this.urlObj.charges,e).then(e=>{200===e.Code?(e.Data.data.forEach(e=>{e.uname=e.user?e.user.realname:""}),this.conf.dataTotal=e.Data.total,this.tableData=e.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.datas=[],this.conf.emptyText=e.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.datas=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},sizeChange(e){this.conf.limit=e,this.tableLoad()},currentChange(e){this.conf.curPage=e,this.tableLoad()},tableSetVal(e){let t=0==e.value?"关闭":"启用";this.$confirm(`确定要${t}当前收费模板吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let a=0==e.value?-1:1,s={id:this.tableData[e.index].id,status:a};this.$axios.post(this.urlObj.chargestatus,s).then(s=>{if(200===s.Code)this.$message({type:"success",message:`收费模板${t}成功！`}),this.$set(this.tableData[e.index],e.col_name,a);else{let e=s.Message?s.Message:`收费模板${e}失败！`;this.$message({type:"error",message:e})}}).catch(()=>{})}).catch(()=>{})},addCharge(){this.isEdit=!1,this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.ruleForm={name:"",mode:"",money:"",time:"",type:"",number:"",remark:""},this.showAddDialog=!0},modeChange(e){"day"==e?this.ruleForm.time=1:"hour"==e&&(this.ruleForm.time=24)},addSubmit(){this.$refs.ruleForm.validate(e=>{if(e){this.isCommit=!0;let e={title:this.ruleForm.name,mode:this.ruleForm.mode,money:this.ruleForm.money,type:this.ruleForm.type,remark:this.ruleForm.remark};this.isEdit&&(e.id=this.tableData[this.editIndex].id),1==this.ruleForm.type&&(e.times=this.ruleForm.number),this.$axios.post(this.urlObj.addcharge,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:this.isEdit?"收费模板修改成功！":"收费模板添加成功！"}),this.showAddDialog=!1,this.tableLoad();else{let t=e.Message?e.Message:this.isEdit?"收费模板修改失败！":"收费模板添加失败！";this.$message({type:"error",message:t})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},tableDetail(e){this.cIndex=e,this.showUseDialog=!0,this.getParkDatas()},tempEdit(e){this.isEdit=!0,this.editIndex=e,this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.ruleForm.name=this.tableData[e].title,this.ruleForm.mode=this.tableData[e].mode,this.ruleForm.time="day"===this.tableData[e].mode?1:"hour"===this.tableData[e].mode?24:"",this.ruleForm.money=this.tableData[e].money,this.ruleForm.type=this.tableData[e].type,this.ruleForm.number=this.tableData[e].times?this.tableData[e].times:"",this.ruleForm.remark=this.tableData[e].remark,this.showAddDialog=!0},getParkDatas(){this.loadDetail=!0,this.$axios.post(this.urlObj.appliedcars,{id:this.tableData[this.cIndex].id}).then(e=>{if(200===e.Code)this.activeName=e.Data&&e.Data.length>0?e.Data[0].deptname:"",this.detailList=e.Data&&e.Data.length>0?e.Data:[];else{let t=e.Message?e.Message:"应用车场数据获取失败！";this.$message({type:"error",message:t})}this.loadDetail=!1}).catch(()=>{this.loadDetail=!1})},selectAll(e){e.lowerDepartment.every(e=>e.checked)?e.lowerDepartment.forEach(e=>{e.checked=!1}):e.lowerDepartment.forEach(e=>{e.checked=!0})},useSubmit(){this.isCommit=!0;let e=[];this.detailList.forEach(t=>{t.lowerDepartment.forEach(t=>{t.lowerDepartment.forEach(t=>{t.checked&&e.push(t.vid)})})});let t={id:this.tableData[this.cIndex].id,vid:e};this.$axios.post(this.urlObj.applied,t).then(e=>{if(200===e.Code)this.$message({type:"success",dangerouslyUseHTMLString:!0,message:e.Message?e.Message:"车场应用成功！"}),this.showUseDialog=!1,this.tableLoad();else{let t=e.Message?e.Message:"车场应用失败！";this.$message({type:"error",message:t})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}}},r=o,n=(a("9f63"),a("1805")),m=Object(n["a"])(r,s,i,!1,null,null,null);t["default"]=m.exports}}]);