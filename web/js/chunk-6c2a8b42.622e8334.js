(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6c2a8b42"],{"193b":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"prestore"}},[t("div",{staticClass:"top"},[t("div",{staticClass:"main"},[t("div",{staticClass:"common-left"},[t("span",{staticClass:"common-chose-info",on:{click:function(t){return e.$refs.showFilterVillage.showDialog()}}},[t("i",{staticClass:"iconfont icondaqu"}),e._v(" "+e._s(e.choseVillageInfo.name)+" ")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"请输入业主姓名/手机号或房号"},domProps:{value:e.searchVal},on:{input:function(t){t.target.composing||(e.searchVal=t.target.value)}}}),t("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.keySearch(!0)}}},[e._v(" 查询 ")])],1)])]),t("div",{staticClass:"main-wp"},[t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.tableData,cusColums:e.columns,cusConf:e.conf,ispaging:!0},on:{sizeChange:e.sizeChange,currentChange:e.currentChange,checkRecord:e.checkRecord,balanceMove:e.balanceMove}})],1)]),t("filter-village",{ref:"showFilterVillage",attrs:{vid:e.choseVillageInfo.vid},on:{choseInfo:e.filterVillage}}),t("el-dialog",{staticClass:"recordDialog",attrs:{visible:e.showRecordDialog,title:"预存款记录",width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showRecordDialog=t}}},[t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.popTableData,cusColums:e.popColumns,cusConf:e.popConf}})],1)]),t("el-dialog",{staticClass:"moveDialog",attrs:{visible:e.showMoveDialog,title:"零钱转移",width:"36%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showMoveDialog=t}}},[t("el-autocomplete",{ref:"searchInput",staticClass:"prestore-search",attrs:{"popper-class":"my-autocomplete","fetch-suggestions":e.querySearchAsync,placeholder:"请输入业主姓名、手机号或房号"},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function({item:a}){return[t("div",{staticClass:"tr-item"},[t("span",{staticClass:"td-item"},[e._v(e._s(a.username))]),t("span",{staticClass:"td-item"},[e._v(e._s(a.tel))]),t("span",{staticClass:"td-item"},[e._v(e._s(a.title))])]),e.allUserList.length<=1?t("div",{staticClass:"load-more"},[e._v(" 暂无数据！ ")]):e._e()]}}]),model:{value:e.autoValue,callback:function(t){e.autoValue=t},expression:"autoValue"}},[t("i",{staticClass:"iconfont iconzu3664 el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})]),t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"项目名称",prop:"vname"}},[t("el-input",{attrs:{placeholder:"请输入项目名称",readonly:""},model:{value:e.ruleForm.vname,callback:function(t){e.$set(e.ruleForm,"vname",t)},expression:"ruleForm.vname"}})],1),t("el-form-item",{attrs:{label:"选择楼栋",prop:"build"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择楼栋"},on:{change:e.buildChange},model:{value:e.ruleForm.build,callback:function(t){e.$set(e.ruleForm,"build",t)},expression:"ruleForm.build"}},e._l(e.buildOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.block,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"选择单元",prop:"unit"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择单元"},on:{change:e.unitChange},model:{value:e.ruleForm.unit,callback:function(t){e.$set(e.ruleForm,"unit",t)},expression:"ruleForm.unit"}},e._l(e.unitOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.unit,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"选择房号",prop:"room"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择房号"},on:{change:e.roomChange},model:{value:e.ruleForm.room,callback:function(t){e.$set(e.ruleForm,"room",t)},expression:"ruleForm.room"}},e._l(e.roomOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.roomnum,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"选择客户",prop:"uid"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择客户"},model:{value:e.ruleForm.uid,callback:function(t){e.$set(e.ruleForm,"uid",t)},expression:"ruleForm.uid"}},e._l(e.userOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"转移金额",prop:"money"}},[t("span",{staticClass:"tip"},[e._v("(余额: "+e._s(e.bmoney)+")")]),t("el-input",{attrs:{type:"number",placeholder:"请输入转移金额"},model:{value:e.ruleForm.money,callback:function(t){e.$set(e.ruleForm,"money",t)},expression:"ruleForm.money"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.moveSubmit}},[e._v(" 提交保存 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showMoveDialog=!1}}},[e._v(" 取消 ")])],1)],1)],1)},o=[],i=(a("5948"),a("428b")),l=a("1e22"),r={name:"prestore",data(){return{urlObj:{balancelist:this.$api.state.Charge.balancelist.url,balancelog:this.$api.state.Charge.balancelog.url,searchdata:this.$api.state.Charge.searchdata.url,balancemove:this.$api.state.Charge.balancemove.url,buildOfVillage:this.$api.state.Public.buildOfVillage.url,unitOfBuild:this.$api.state.Public.unitOfBuild.url,roomOfUnit:this.$api.state.Public.roomOfUnit.url,userOfRoom:this.$api.state.Public.userOfRoom.url},searchVal:"",choseVillageInfo:{name:"全部项目",vid:0},tableData:[],columns:i.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},showRecordDialog:!1,popTableData:[],popColumns:l.list,popConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},showMoveDialog:!1,ruleForm:{vname:"",build:"",unit:"",room:"",uid:"",money:""},rules:{vname:[{required:!0,message:"请输入项目名称",trigger:"blur"}],build:[{required:!1,message:"请选择楼栋",trigger:"change"}],unit:[{required:!1,message:"请选择单元",trigger:"change"}],room:[{required:!1,message:"请选择房号",trigger:"change"}],uid:[{required:!0,message:"请选择客户",trigger:"change"}],money:[{required:!0,message:"请输入转移金额",trigger:"blur"}]},buildOptions:[],unitOptions:[],roomOptions:[],userOptions:[],autoValue:"",allUserList:[],currentUser:{},isCommit:!1,mindex:0,bmoney:0}},mounted(){let e=sessionStorage.getItem("vid"),t=sessionStorage.getItem("vname");e&&(this.choseVillageInfo.vid=e,this.choseVillageInfo.name=t),this.tableLoad()},methods:{tableLoad(){this.conf.loadStatus=!0;let e={page:this.conf.curPage,limit:this.conf.limit,vid:this.choseVillageInfo.vid,keywords:this.searchVal.trim()};this.$axios.post(this.urlObj.balancelist,e).then(e=>{200===e.Code?(e.Data.data&&e.Data.data.length>0&&e.Data.data.forEach(e=>{e.realname=e.owner?e.owner.realname:"--",e.tel=e.owner?e.owner.tel:"--",e.bmoney=e.owner&&e.owner.balance?e.owner.balance.money:"--",e.sex=e.owner?e.owner.sex:"--",e.utime=e.create_time?e.create_time:"--"}),this.conf.dataTotal=e.Data.total,this.tableData=e.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=e.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},popTableLoad(e){this.popConf.loadStatus=!0,this.$axios.post(this.urlObj.balancelog,e).then(e=>{200===e.Code?(e.Data&&e.Data.length>0&&e.Data.forEach(e=>{e.code=e.sn.sn?e.sn.sn:"--",e.transferUser=e.transferowner?e.transferowner.realname:"--",e.payname=e.sn.payment?e.sn.payment.name:""}),this.popTableData=e.Data?e.Data:[],this.popConf.loadStatus=!1,this.popConf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.popTableData=[],this.popConf.emptyText=e.Message,this.popConf.dataTotal=0,this.popConf.loadStatus=!1)}).catch(()=>{this.popTableData=[],this.popConf.emptyText="服务器连接失败...",this.popConf.dataTotal=0,this.popConf.loadStatus=!1})},keySearch(){this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad()},filterVillage(e){this.choseVillageInfo.name=e.name,this.choseVillageInfo.vid=e.vid,this.searchVal="",this.keySearch()},sizeChange(e){this.conf.limit=e,this.tableLoad()},currentChange(e){this.conf.curPage=e,this.tableLoad()},checkRecord(e){this.popTableLoad({oid:this.tableData[e].oid}),this.showRecordDialog=!0},balanceMove(e){this.mindex=e,this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.ruleForm.vname=this.choseVillageInfo.name,this.bmoney=this.tableData[e].owner.balance.money,this.showMoveDialog=!0,this.getBuildData()},async querySearchAsync(e,t){if(this.choseVillageInfo.vid)if(e){let a={keywords:e,vid:this.choseVillageInfo.vid},s=await this.$axios.post(this.urlObj.searchdata,a);if(200===s.Code){let e={id:0,username:"姓名",tel:"电话号码",title:"资源名称"};s.Data.returnData.unshift(e),this.allUserList=s.Data.returnData,t(s.Data.returnData)}else this.$refs.searchInput.$children[0].blur()}else t([]);else this.$refs.searchInput.close(),this.$message({type:"warning",message:"请选择项目后再搜索！"})},handleSelect(e){this.currentUser=e,this.ruleForm.build="",this.ruleForm.unit="",this.ruleForm.room="",this.unitOptions=[],this.roomOptions=[],this.ruleForm.uid=e.oid,this.userOptions=[{value:e.oid,label:e.username}]},getBuildData(){let e={vid:this.choseVillageInfo.vid};this.$axios.post(this.urlObj.buildOfVillage,e).then(e=>{if(200===e.Code)this.buildOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"楼栋数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},getUnitData(){let e={bid:this.ruleForm.build};this.$axios.post(this.urlObj.unitOfBuild,e).then(e=>{if(200===e.Code)this.unitOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"单元数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},getRoomData(){let e={unit:this.ruleForm.unit};this.$axios.post(this.urlObj.roomOfUnit,e).then(e=>{if(200===e.Code)this.roomOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"房屋数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},getUserData(){let e={id:this.ruleForm.room};this.$axios.post(this.urlObj.userOfRoom,e).then(e=>{if(200===e.Code)e.Data.forEach(e=>{e.label=e.owner?e.owner.realname:"",e.value=e.oid}),this.userOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"用户数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},buildChange(){this.ruleForm.unit="",this.ruleForm.room="",this.ruleForm.uid="",this.unitOptions=[],this.roomOptions=[],this.userOptions=[],this.ruleForm.build&&this.getUnitData()},unitChange(){this.ruleForm.room="",this.ruleForm.uid="",this.roomOptions=[],this.userOptions=[],this.ruleForm.unit&&this.getRoomData()},roomChange(){this.ruleForm.uid="",this.userOptions=[],this.ruleForm.room&&this.getUserData()},moveSubmit(){this.$refs.ruleForm.validate(e=>{if(e){this.isCommit=!0;let e={o_oid:this.tableData[this.mindex].oid,n_oid:this.ruleForm.uid,money:this.ruleForm.money};this.$axios.post(this.urlObj.balancemove,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:"零钱转移成功！"}),this.showMoveDialog=!1,this.tableLoad();else{let t=e.Message?e.Message:"零钱转移失败！";this.$message({type:"error",message:t})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})}}},n=r,u=(a("1a23"),a("1805")),c=Object(u["a"])(n,s,o,!1,null,null,null);t["default"]=c.exports},"1a23":function(e,t,a){"use strict";a("f396")},"1e22":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"订单号","prop":"code","show":true,"color":"#999","width":210},{"label":"类型","prop":"type_text","show":true,"color":"#999"},{"label":"付款方式","prop":"payname","show":true},{"label":"转移人","prop":"transferUser","show":true},{"label":"金额","prop":"money","show":true,"color":"#ffcb3c"},{"label":"时间","prop":"create_time","show":true,"color":"#999","width":180}]}')},"428b":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"客户姓名","prop":"realname","show":true},{"label":"性别","prop":"sex","show":true},{"label":"联系电话","prop":"tel","show":true,"color":"#999"},{"label":"预存余额","prop":"bmoney","show":true,"color":"#ffcb3c"},{"label":"最后更新时间","prop":"utime","show":true,"color":"#999","width":160},{"label":"操作","prop":"","type":"button","show":true,"width":260,"btns":[{"name":"转移零钱","type":"primary","size":"small","round":true,"class":"empty","action":"balanceMove","role":"balanceMove","token":"Btn-o3cpP0yW856t2MDLz7GaHxG5"},{"name":"查看记录","type":"primary","size":"small","round":true,"class":"sys-btn","action":"checkRecord","role":"checkRecord","token":"Btn-hEK6kdxNvEhrDZtf29SPkVMo"}]}]}')},f396:function(e,t,a){}}]);