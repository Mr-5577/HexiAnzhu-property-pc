(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5facf841"],{"45a5":function(e,t,a){"use strict";a("e918")},"4a7c":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"停车场名称","prop":"park_name","show":true,"color":"#999"},{"label":"车牌号码","prop":"plate_no","show":true},{"label":"应收","prop":"need_pay","show":true,"color":"#69da61"},{"label":"实收","prop":"pay_money","show":true,"color":"#ffcb3c"},{"label":"付款方式","prop":"pay_type","show":true,"color":"#999"},{"label":"入场时间","prop":"in_time","show":true,"color":"#999"},{"label":"缴费时间","prop":"pay_time","show":true,"color":"#999"},{"label":"操作人员","prop":"collector","show":true}]}')},e918:function(e,t,a){},fbc1:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isExport,expression:"isExport"}],attrs:{id:"car-record","element-loading-text":"正在导出，请稍等"}},[t("div",{staticClass:"top"},[t("div",{staticClass:"main"},[t("div",{staticClass:"common-left"},[t("span",{staticClass:"common-chose-info",on:{click:function(t){return e.$refs.showFilterVillage.showDialog()}}},[t("i",{staticClass:"iconfont icondaqu"}),e._v(" "+e._s(e.choseVillageInfo.name)+" "),e.choseVillageInfo.vid?t("i",{staticClass:"close el-icon-circle-close",on:{click:function(t){t.stopPropagation(),e.choseVillageInfo={name:"全部项目",vid:0},e.keySearch()}}}):e._e()]),t("el-select",{staticClass:"parkSelect",attrs:{clearable:"",placeholder:"请选择车场类型"},on:{change:function(t){return e.keySearch(!0)}},model:{value:e.parkVal,callback:function(t){e.parkVal=t},expression:"parkVal"}},e._l(e.parkOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.village_name,value:e.id}})})),1),t("el-date-picker",{attrs:{type:"date","picker-options":e.spickerOptions,placeholder:"缴费开始日期","value-format":"timestamp"},on:{change:function(t){return e.keySearch(!0)}},model:{value:e.startTime,callback:function(t){e.startTime=t},expression:"startTime"}}),e._v(" ~ "),t("el-date-picker",{attrs:{type:"date","picker-options":e.epickerOptions,placeholder:"缴费结束日期","value-format":"timestamp"},on:{change:function(t){return e.keySearch(!0)}},model:{value:e.endTime,callback:function(t){e.endTime=t},expression:"endTime"}})],1),t("div",{staticClass:"common-right"},[e.$menu.getters.judgeRole("Btn-fzZFTdJ0yYeRtQ5uyN9V825g")?t("el-button",{attrs:{type:"primary",round:"",plain:"",icon:"iconfont iconxinzeng"},on:{click:function(t){return e.dialogInit()}}},[e._v(" 生成临停费用 ")]):e._e(),t("span",{on:{click:e.getExportData}},[t("workIcon",{staticClass:"common-right-icon",attrs:{name:"export",title:"导出"}})],1)],1)])]),t("div",{staticClass:"main-wp"},[t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.tableData,cusColums:e.columns,cusConf:e.conf,ispaging:!0},on:{sizeChange:e.sizeChange,currentChange:e.currentChange}})],1)]),t("filter-village",{ref:"showFilterVillage",attrs:{vid:e.choseVillageInfo.vid},on:{choseInfo:e.filterVillage}}),t("el-dialog",{staticClass:"temporary",attrs:{visible:e.showDialog,title:"生成临停费用",width:"32%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showDialog=t}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"停车场",prop:"parkValue"}},[t("el-select",{attrs:{placeholder:"请选择停车场"},on:{change:e.parkChange},model:{value:e.ruleForm.parkValue,callback:function(t){e.$set(e.ruleForm,"parkValue",t)},expression:"ruleForm.parkValue"}},e._l(e.parkOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.village_name,value:e.id}})})),1)],1),t("el-form-item",{staticClass:"date-wp",attrs:{label:"临停周期",required:""}},[t("el-col",{attrs:{span:11}},[t("el-form-item",{attrs:{prop:"startDate"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",readonly:e.hasLast,placeholder:"选择入场时间","picker-options":e.pickerOptions,"value-format":"yyyy-MM-dd HH:mm:ss"},on:{change:e.startChange},model:{value:e.ruleForm.startDate,callback:function(t){e.$set(e.ruleForm,"startDate",t)},expression:"ruleForm.startDate"}})],1)],1),t("el-col",{staticClass:"line",attrs:{span:2}},[e._v("-")]),t("el-col",{attrs:{span:11}},[t("el-form-item",{attrs:{prop:"endDate"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择截止时间","picker-options":e.pickerOptions,"value-format":"yyyy-MM-dd HH:mm:ss"},on:{change:e.endChange},model:{value:e.ruleForm.endDate,callback:function(t){e.$set(e.ruleForm,"endDate",t)},expression:"ruleForm.endDate"}})],1)],1)],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.showMoney,expression:"showMoney"}],attrs:{label:"临停总金额",prop:"allMoney"}},[t("el-input",{attrs:{readonly:!0,placeholder:"请输入临停总金额"},model:{value:e.ruleForm.allMoney,callback:function(t){e.$set(e.ruleForm,"allMoney",t)},expression:"ruleForm.allMoney"}})],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.showMoney,expression:"showMoney"}],attrs:{label:"临停优惠金额",prop:"yhmoney"}},[t("el-input",{attrs:{readonly:!0,placeholder:"请输入临停优惠金额"},model:{value:e.ruleForm.yhmoney,callback:function(t){e.$set(e.ruleForm,"yhmoney",t)},expression:"ruleForm.yhmoney"}})],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.showMoney,expression:"showMoney"}],attrs:{label:"临停实收金额",prop:"ssmoney"}},[t("el-input",{attrs:{type:"number",readonly:!e.moneyEdit,placeholder:"请输入临停实收金额"},on:{input:e.moneyChange},model:{value:e.ruleForm.ssmoney,callback:function(t){e.$set(e.ruleForm,"ssmoney",t)},expression:"ruleForm.ssmoney"}})],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.showMoney,expression:"showMoney"}],attrs:{label:"是否生成发票",prop:"isreceipt"}},[t("el-select",{attrs:{placeholder:"请选择是否生成发票"},model:{value:e.ruleForm.isreceipt,callback:function(t){e.$set(e.ruleForm,"isreceipt",t)},expression:"ruleForm.isreceipt"}},e._l(e.receiptOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),3==e.receiptType&&e.showMoney?t("el-form-item",{attrs:{label:"收据类型",prop:"receiptType"}},[t("el-select",{attrs:{placeholder:"请选择收据类型",clearable:""},model:{value:e.ruleForm.receiptType,callback:function(t){e.$set(e.ruleForm,"receiptType",t)},expression:"ruleForm.receiptType"}},[t("el-option",{attrs:{label:"电子收据",value:1}}),t("el-option",{attrs:{label:"纸质收据",value:2}})],1)],1):e._e(),(2==e.receiptType||3==e.receiptType&&2==e.ruleForm.receiptType)&&e.showMoney?t("el-form-item",{attrs:{label:"是否生成纸质收据",prop:"isPaper"}},[t("el-select",{attrs:{placeholder:"请选择是否生成纸质收据",clearable:""},model:{value:e.ruleForm.isPaper,callback:function(t){e.$set(e.ruleForm,"isPaper",t)},expression:"ruleForm.isPaper"}},[t("el-option",{attrs:{label:"否",value:0}}),t("el-option",{attrs:{label:"是",value:1}})],1)],1):e._e()],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.formSubmit}},[e._v(" 确认生成 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showDialog=!1}}},[e._v(" 取消 ")])],1)],1)],1)},r=[],i=(a("5948"),a("4a7c")),o=a("4698"),l={name:"carRecord",components:{workIcon:o["a"]},data(){return{urlObj:{carparkdata:this.$api.state.Car.carparkdata.url,tempcarrecord:this.$api.state.Car.tempcarrecord.url,parklastcost:this.$api.state.Car.parklastcost.url,searchmoney:this.$api.state.Car.searchmoney.url,createtempcarsn:this.$api.state.Car.createtempcarsn.url,getreceipttype:this.$api.state.Charge.getreceipttype.url},choseVillageInfo:{name:"全部项目",vid:0},parkVal:"",parkOptions:[],startTime:"",endTime:"",tableData:[],columns:i.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},showDialog:!1,ruleForm:{parkValue:"",startDate:"",endDate:"",allMoney:"",yhmoney:"",ssmoney:"",isreceipt:"",receiptType:1,isPaper:""},rules:{parkValue:[{required:!0,message:"请选择停车场",trigger:"change"}],startDate:[{required:!0,message:"请选择入场时间",trigger:"change"}],endDate:[{required:!0,message:"请选择截止时间",trigger:"change"}],allMoney:[{required:!0,message:"请输入临停总金额",trigger:"blur"}],yhmoney:[{required:!0,message:"请输入临停优惠金额",trigger:"blur"}],ssmoney:[{required:!0,message:"请输入实收金额",trigger:"blur"}],isreceipt:[{required:!0,message:"请选择是否生成发票",trigger:"change"}],receiptType:[{required:!0,message:"请选择收据类型",trigger:"change"}],isPaper:[{required:!0,message:"请选择是否生成纸质收据",trigger:"change"}]},receiptOptions:[{value:0,label:"否"},{value:1,label:"是"}],showMoney:!1,isCommit:!1,hasLast:!1,moneyEdit:"",pickerOptions:{disabledDate:e=>{if(e)return e.getTime()>new Date}},receiptType:"",isExport:!1}},computed:{spickerOptions(){return{disabledDate:e=>{if(e)return!!this.endTime&&e.getTime()>this.endTime}}},epickerOptions(){return{disabledDate:e=>{if(e)return!!this.startTime&&e.getTime()<this.startTime}}}},mounted(){this.getParkList(),this.tableLoad()},methods:{filterVillage(e){this.choseVillageInfo.name=e.name,this.choseVillageInfo.vid=e.vid,this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.parkVal="",this.parkOptions=[],this.startTime="",this.endTime="",this.getParkList(),this.tableLoad()},getParkList(){this.$axios.post(this.urlObj.carparkdata,{vid:this.choseVillageInfo.vid}).then(e=>{if(200===e.Code)this.parkOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取停车场类型失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getLastOrder(e){this.$axios.post(this.urlObj.parklastcost,e).then(e=>{if(200===e.Code)if(e.Data&&1==e.Data.is_last){this.hasLast=!0;let t=new Date(1e3*e.Data.last_time),a=t.getFullYear(),s=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,r=t.getDate()<10?"0"+t.getDate():t.getDate(),i=t.getHours()<10?"0"+t.getHours():t.getHours(),o=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),l=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds();this.ruleForm.startDate=`${a}-${s}-${r} ${i}:${o}:${l}`,this.pickerOptions={disabledDate:e=>{if(e)return e.getTime()>new Date||e.getTime()<new Date(this.ruleForm.startDate).getTime()}}}else this.hasLast=!1;else{let t=e.Message?e.Message:"获取上一次停车场数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getFreeInfo(){let e={park_id:this.ruleForm.parkValue,starttime:this.ruleForm.startDate,endtime:this.ruleForm.endDate};this.$axios.post(this.urlObj.searchmoney,e).then(e=>{if(200===e.Code)this.ruleForm.allMoney=e.Data.all_money,this.ruleForm.yhmoney=e.Data.discount_money,this.ruleForm.ssmoney=e.Data.all_pay_money,this.moneyEdit=1==e.Data.editmoney_auth,this.showMoney=!0;else{let t=e.Message?e.Message:"查询临停费用失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},tableLoad(){this.conf.loadStatus=!0;let e={page:this.conf.curPage,limit:this.conf.limit,vid:this.choseVillageInfo.vid,park_id:this.parkVal,starttime:this.startTime?this.startTime/1e3:"",endtime:this.endTime?this.endTime/1e3:""};this.parkVal&&(e.park_id=this.parkVal),this.$axios.post(this.urlObj.tempcarrecord,e).then(e=>{200===e.Code?(this.conf.dataTotal=e.Data.total,this.tableData=e.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=e.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},keySearch(){this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad()},sizeChange(e){this.conf.limit=e,this.tableLoad()},currentChange(e){this.conf.curPage=e,this.tableLoad()},dialogInit(){this.ruleForm={parkValue:"",startDate:"",endDate:"",allMoney:"",yhmoney:"",ssmoney:"",isreceipt:""},this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.showMoney=!1,this.showDialog=!0},getReceiptType(e){this.$axios.post(this.urlObj.getreceipttype,{vid:e}).then(e=>{if(200===e.Code)this.receiptType=e.Data?e.Data.use_receipt_type:"";else{let t=e.Message?e.Message:"获取收据类型失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},parkChange(e){if(this.ruleForm.startDate="",this.ruleForm.endDate="",this.ruleForm.allMoney="",this.ruleForm.yhmoney="",this.ruleForm.isreceipt="",this.receiptType="",this.showMoney=!1,e){this.getLastOrder({park_id:e});let t=this.parkOptions.find(t=>t.id==e).vid;this.getReceiptType(t)}},startChange(e){this.showMoney=!1,this.ruleForm.allMoney="",this.ruleForm.yhmoney="",this.ruleForm.isreceipt="",e&&this.ruleForm.endDate&&this.ruleForm.parkValue&&this.getFreeInfo()},endChange(e){this.showMoney=!1,this.ruleForm.allMoney="",this.ruleForm.yhmoney="",this.ruleForm.isreceipt="",e&&this.ruleForm.startDate&&this.ruleForm.parkValue&&this.getFreeInfo()},moneyChange(){this.ruleForm.yhmoney=_.round(_.subtract(Number(this.ruleForm.allMoney),Number(this.ruleForm.ssmoney)),2)},formSubmit(){this.$refs.ruleForm.validate(e=>{e&&this.addRequest()})},addRequest(){this.isCommit=!0;let e={park_id:this.ruleForm.parkValue,starttime:this.ruleForm.startDate,endtime:this.ruleForm.endDate,is_bill:this.ruleForm.isreceipt,all_money:this.ruleForm.allMoney,discount_money:this.ruleForm.yhmoney,real_money:this.ruleForm.ssmoney};3==this.receiptType?(e.receipt_type=this.ruleForm.receiptType,2==this.ruleForm.receiptType&&(e.is_open_receiptpaper=this.ruleForm.isPaper)):2==this.receiptType&&(e.is_open_receiptpaper=this.ruleForm.isPaper),this.$axios.post(this.urlObj.createtempcarsn,e).then(e=>{if(200===e.Code)this.$message({message:"生成临停费用成功！",type:"success"}),this.showDialog=!1,this.tableLoad();else{let t=e.Message?e.Message:"生成临停费用失败！";this.$message({message:t,type:"error"})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})},getExportData(){let e={page:this.conf.curPage,limit:this.conf.limit,vid:this.choseVillageInfo.vid,park_id:this.parkVal,starttime:this.startTime?this.startTime/1e3:"",endtime:this.endTime?this.endTime/1e3:"",is_excel:1};this.parkVal&&(e.park_id=this.parkVal),e.vid?(this.isExport=!0,this.$axios.post(this.urlObj.tempcarrecord,e).then(e=>{if(200===e.Code)this.exportExcel(e.Data.data);else{let t=e.Message?e.Message:"临停车辆数据失败！";this.$message({type:"error",message:t})}this.isExport=!1}).catch(()=>{this.isExport=!1})):this.$message({type:"warning",message:"请选择一个项目再导出！"})},exportExcel(e){let t="临停车辆明细表",s=["停车场名称","车牌号码","应收","实收","付款方式","入场时间","缴费时间","操作人员"],r=e.map(e=>{let t=[e.park_name,e.plate_no,Number(e.need_pay)?Number(e.need_pay):0,Number(e.pay_money)?Number(e.pay_money):0,e.pay_type,e.in_time,e.pay_time,e.collector];return t});try{Promise.all([a.e("chunk-3a869cfb"),a.e("chunk-2a5081b0"),a.e("chunk-3a96421c")]).then((()=>{let{export_json_to_excel:e}=a("628d");e(s,r,t)}).bind(null,a)).catch(a.oe),this.$notify({type:"success",title:"温馨提示",message:"导出报表成功",duration:1500})}catch(i){this.$notify({type:"error",title:"温馨提示",message:"导出报表失败",duration:1500})}}}},n=l,c=(a("45a5"),a("1805")),p=Object(c["a"])(n,s,r,!1,null,null,null);t["default"]=p.exports}}]);