(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ff5fd6be"],{"1f23":function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"资源名称","prop":"resources_name","show":true,"color":"#999"},{"label":"业主姓名","prop":"oname","show":true},{"label":"欠费科目","prop":"subject_name","show":true,"color":"#999"},{"label":"欠费周期","prop":"time","show":true},{"label":"详情","prop":"use_info","show":true,"color":"#999"},{"label":"欠费金额","prop":"all_money","show":true,"color":"#ffcb3c"},{"label":"操作","prop":"","width":120,"type":"button","show":true,"btns":[{"name":"打印票据","type":"primary","size":"small","round":true,"action":"print","role":"print","token":"Btn-8T8pvt8682KusCWzwDjwGKke"}]}]}')},3740:function(t,e,a){"use strict";a("9c9b")},"39af":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{attrs:{id:"buy-ticket"}},[e("div",{staticClass:"top"},[e("div",{staticClass:"main"},[e("div",{staticClass:"common-left"},[e("span",{staticClass:"common-chose-info",on:{click:function(e){return t.$refs.showFilterVillage.showDialog()}}},[e("i",{staticClass:"iconfont icondaqu"}),t._v(" "+t._s(t.choseVillageInfo.name)+" ")]),e("el-select",{attrs:{placeholder:"请选择缴费科目"},on:{change:t.tableLoad},model:{value:t.subjectVal,callback:function(e){t.subjectVal=e},expression:"subjectVal"}},t._l(t.subOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1),e("el-select",{staticClass:"typeSelect",on:{change:t.typeChange},model:{value:t.typeVal,callback:function(e){t.typeVal=e},expression:"typeVal"}},t._l(t.typeOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),"1"==t.typeVal?e("el-date-picker",{staticStyle:{"margin-right":"20px"},attrs:{type:"month",placeholder:"欠费截止时间","value-format":"yyyyMM"},on:{change:t.tableChange},model:{value:t.ymonth,callback:function(e){t.ymonth=e},expression:"ymonth"}}):t._e(),e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"请输入业主姓名/房号查询"},domProps:{value:t.searchVal},on:{input:function(e){e.target.composing||(t.searchVal=e.target.value)}}}),e("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.tableLoad}},[t._v(" 查询 ")])],1)])]),e("div",{staticClass:"main-wp"},[e("div",{staticClass:"select-wp"},[e("el-select",{attrs:{multiple:"","collapse-tags":"",clearable:"",placeholder:"请选择楼栋"},on:{change:t.buildChange},model:{value:t.buildVal,callback:function(e){t.buildVal=e},expression:"buildVal"}},t._l(t.buildOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.block,value:t.id}})})),1),e("el-select",{attrs:{multiple:"","collapse-tags":"",clearable:"",placeholder:"请选择单元"},on:{change:t.tableLoad},model:{value:t.unitVal,callback:function(e){t.unitVal=e},expression:"unitVal"}},t._l(t.unitOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.block+"-"+t.unit,value:t.id}})})),1)],1),e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.tableData,cusColums:t.columns,cusConf:t.conf,ispaging:!0,check:!0},on:{sizeChange:t.sizeChange,currentChange:t.currentChange,print:t.tablePrint,selectionChange:t.selectionChange}}),e("div",{staticClass:"btn-wp"},[1==t.typeVal&&t.$menu.getters.judgeRole("Btn-8T8pvt8682KusCWzwDjwGKke")?e("el-button",{staticClass:"empty",attrs:{disabled:0===t.tableSelected.length,type:"primary",round:""},on:{click:t.batchPrint}},[t._v(" 打印票据已选("+t._s(t.tableSelected.length)+")本 ")]):t._e(),1!=t.typeVal&&t.$menu.getters.judgeRole("Btn-rqdb4JUalfbEi3TwmPn675NN")?e("el-button",{staticClass:"empty",attrs:{disabled:0===t.tableSelected.length,type:"primary",round:""},on:{click:t.batchPrint}},[t._v(" 确认收款已选("+t._s(t.tableSelected.length)+")本 ")]):t._e()],1)],1)]),e("filter-village",{ref:"showFilterVillage",attrs:{vid:t.choseVillageInfo.vid},on:{choseInfo:t.filterVillage}}),e("el-dialog",{staticClass:"gatheringDialog",attrs:{visible:t.showGatheringDialog,title:"确认收款",width:"30%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showGatheringDialog=e}}},[e("el-scrollbar",{staticStyle:{height:"100%"}},[e("div",{staticClass:"title"},[t._v("选择支付方式")]),e("div",{staticClass:"payments"},[e("el-radio-group",{model:{value:t.radioVal,callback:function(e){t.radioVal=e},expression:"radioVal"}},t._l(t.paymentList,(function(a){return e("el-radio",{key:a.id,attrs:{label:a.id}},[t._v(" "+t._s(a.name)+" ")])})),1)],1),e("div",{staticClass:"title"},[t._v("选择支付时间")]),e("el-date-picker",{attrs:{type:"datetime","value-format":"timestamp",placeholder:"请选择支付时间"},model:{value:t.dateVal,callback:function(e){t.dateVal=e},expression:"dateVal"}})],1),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.confirm}},[t._v(" 提交保存 ")]),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showGatheringDialog=!1}}},[t._v(" 取消 ")])],1)],1)],1)},i=[],l=(a("5948"),a("1f23")),o=a("a5e7"),n={name:"buyTicket",data(){return{urlObj:{subjectbytype:this.$api.state.Public.subjectbytype.url,buildOfVillage:this.$api.state.Public.buildOfVillage.url,searchUnit:this.$api.state.Public.searchUnit.url,resourcetypeid:this.$api.state.Assist.resourcetypeid.url,subjectarrears:this.$api.state.Assist.subjectarrears.url,batchopensn:this.$api.state.Assist.batchopensn.url,nopayorder:this.$api.state.Assist.nopayorder.url,batchcollectionsn:this.$api.state.Assist.batchcollectionsn.url,getpaymenttype:this.$api.state.Charge.getpaymenttype.url,issueReceipt:this.$api.state.Charge.issueReceipt.url},choseVillageInfo:{name:"全部项目",vid:0},subjectVal:"",subOptions:[],typeVal:1,typeOptions:[{label:"打印票据",value:1},{label:"确认收款",value:2}],searchVal:"",ymonth:"",tableData:[],conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},buildVal:[],buildOptions:[],unitVal:[],unitOptions:[],tableSelected:[],currentIndex:0,isBatch:!1,showGatheringDialog:!1,radioVal:"",paymentList:[],dateVal:"",isCommit:!1}},computed:{columns(){return 1==this.typeVal?l.list:o.list}},mounted(){let t=sessionStorage.getItem("vid"),e=sessionStorage.getItem("vname");t&&(this.choseVillageInfo.vid=t,this.choseVillageInfo.name=e),this.getSubjectList(),this.getBuildList()},methods:{filterVillage(t){this.choseVillageInfo.name=t.name,this.choseVillageInfo.vid=t.vid,this.subjectVal="",this.subOptions=[],this.typeVal=1,this.searchVal="",this.ymonth="",this.buildVal=[],this.buildOptions=[],this.unitVal=[],this.unitOptions=[],this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.getSubjectList(),this.getBuildList()},getSubjectList(){let t={vid:this.choseVillageInfo.vid};this.$axios.post(this.urlObj.subjectbytype,t).then(t=>{if(200===t.Code)this.subOptions=t.Data?t.Data:[],this.subjectVal=t.Data&&t.Data[0]?t.Data[0].id:"",this.subjectVal&&this.tableLoad();else{let e=t.Message?t.Message:"获取缴费科目失败！";this.$message({message:e,type:"error"})}}).catch(()=>{})},getBuildList(){let t={vid:this.choseVillageInfo.vid};this.$axios.post(this.urlObj.buildOfVillage,t).then(t=>{if(200===t.Code)this.buildOptions=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取楼栋数据失败！";this.$message({message:e,type:"error"})}}).catch(()=>{})},getUnitList(){let t={bids:this.buildVal};this.$axios.post(this.urlObj.searchUnit,t).then(t=>{if(200===t.Code)this.unitOptions=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取单元数据失败！";this.$message({message:e,type:"error"})}}).catch(()=>{})},buildChange(t){this.unitVal="",this.unitOptions=[],t.length>0&&this.getUnitList(),this.tableLoad()},tableLoad(){let t=1==this.typeVal?this.urlObj.subjectarrears:this.urlObj.nopayorder;this.conf.loadStatus=!0;let e={page:this.conf.curPage,limit:this.conf.limit,keywords:this.searchVal,ymonth:this.ymonth,vid:this.choseVillageInfo.vid,subject_id:this.subjectVal,bids:this.buildVal,units:this.unitVal};this.$axios.post(t,e).then(t=>{200===t.Code?(1==this.typeVal?t.Data.data.forEach(t=>{t.oname=t.owner.realname,t.subject_name=t.subject.name}):t.Data.data.forEach(t=>{t.status_text=0==t.status?"未交":"已交"}),this.conf.dataTotal=t.Data.total,this.tableData=t.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.datas=[],this.conf.emptyText=t.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)})},typeChange(){this.ymonth="",this.tableLoad()},sizeChange(t){this.conf.limit=t,this.tableLoad()},currentChange(t){this.conf.curPage=t,this.tableLoad()},tableChange(){this.conf.curPage=1,this.tableLoad()},selectionChange(t){this.tableSelected=t},tablePrint(t){this.currentIndex=t,1==this.typeVal?this.$confirm("确定要打印当前票据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let e={vid:this.choseVillageInfo.vid,ymonth:this.ymonth,data:[{resources_id:this.tableData[t].resourcesmodel_id,resources_type:this.tableData[t].resourcesmodel_type,oid:this.tableData[t].oid,subject_id:this.tableData[t].subject_village_id,time:this.tableData[t].time,use_info:this.tableData[t].use_info,resources_name:this.tableData[t].resources_name}]};this.printCommit(e)}).catch(()=>{}):(this.isBatch=!1,this.radioVal="",this.dateVal="",this.getPaymentType(),this.showGatheringDialog=!0)},batchPrint(){1==this.typeVal?this.$confirm("确定要打印当前选择的票据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let t=[];this.tableSelected.forEach(e=>{let a={resources_id:e.resourcesmodel_id,resources_type:e.resourcesmodel_type,oid:e.oid,subject_id:e.subject_village_id,time:e.time,use_info:e.use_info,resources_name:e.resources_name};t.push(a)});let e={vid:this.choseVillageInfo.vid,ymonth:this.ymonth,data:t};this.printCommit(e)}).catch(()=>{}):(this.isBatch=!0,this.radioVal="",this.dateVal="",this.getPaymentType(),this.showGatheringDialog=!0)},printCommit(t){this.$axios.post(this.urlObj.batchopensn,t).then(t=>{if(200===t.Code)this.$message({message:"打印票据成功！",type:"success"}),this.tableLoad();else{let e=t.Message?t.Message:"打印票据失败！";this.$message({message:e,type:"error"})}}).catch(()=>{})},getPaymentType(){let t={vid:this.choseVillageInfo.vid};this.$axios.post(this.urlObj.getpaymenttype,t).then(t=>{if(200===t.Code)this.paymentList=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取支付方式失败！";this.$message({message:e,type:"error"})}}).catch(()=>{})},confirm(){if(this.radioVal&&this.dateVal){this.isCommit=!0;let t=[];t=this.isBatch?this.tableSelected.map(t=>t.id):[this.tableData[this.currentIndex].id];let e={pay_type:this.radioVal,ymonth:this.ymonth,pay_time:this.dateVal/1e3,ids_arr:t};this.$axios.post(this.urlObj.batchcollectionsn,e).then(t=>{if(200===t.Code)this.$message({message:"确认收款成功！",type:"success"}),this.showGatheringDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:"确认收款失败！";this.$message({message:e,type:"error"})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}else this.radioVal||this.dateVal?this.radioVal?this.$message({type:"warning",message:"请选择支付时间！"}):this.$message({type:"warning",message:"请选择支付方式！"}):this.$message({type:"warning",message:"请选择支付方式和支付时间！"})}}},r=n,c=(a("3740"),a("1805")),h=Object(c["a"])(r,s,i,!1,null,null,null);e["default"]=h.exports},"9c9b":function(t,e,a){},a5e7:function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"订单号","prop":"sn","show":true,"color":"#999"},{"label":"订单状态","prop":"status_text","show":true,"color":"#69da61"},{"label":"房号","prop":"roomnum","show":true,"color":"#999"},{"label":"业主姓名","prop":"realname","show":true},{"label":"欠费周期","prop":"time","show":true,"width":170},{"label":"欠费科目","prop":"subject_name","show":true,"color":"#999"},{"label":"详情","prop":"remark","show":true,"color":"#999","width":200},{"label":"欠费金额","prop":"money","show":true,"color":"#ffcb3c"},{"label":"操作","prop":"","width":120,"type":"button","show":true,"btns":[{"name":"确认收款","type":"primary","size":"small","round":true,"action":"print","role":"print","token":"Btn-rqdb4JUalfbEi3TwmPn675NN"}]}]}')}}]);