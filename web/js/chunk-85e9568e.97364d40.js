(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-85e9568e"],{"1c04":function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"other"}},[t("div",{staticClass:"main-wp"},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("div",{staticClass:"main-ctn"},[t("div",{staticClass:"title"},[e._v("临时收费")]),t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"付款对象",prop:"uname"}},[t("el-input",{attrs:{placeholder:"请输入付款对象"},model:{value:e.ruleForm.uname,callback:function(t){e.$set(e.ruleForm,"uname",t)},expression:"ruleForm.uname"}})],1),t("el-form-item",{attrs:{label:"收费事项",prop:"matter"}},[t("el-input",{attrs:{placeholder:"请输入收费事项"},model:{value:e.ruleForm.matter,callback:function(t){e.$set(e.ruleForm,"matter",t)},expression:"ruleForm.matter"}})],1),t("el-form-item",{attrs:{label:"收费类型",prop:"type"}},[t("el-select",{attrs:{placeholder:"请选择收费类型",clearable:""},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},e._l(e.typeOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"收费金额",prop:"money"}},[t("el-input",{attrs:{type:"number",placeholder:"请输入收费金额"},model:{value:e.ruleForm.money,callback:function(t){e.$set(e.ruleForm,"money",t)},expression:"ruleForm.money"}})],1),t("el-form-item",{attrs:{label:"收费方式",prop:"method"}},[t("el-select",{attrs:{placeholder:"请选择收费方式",clearable:""},model:{value:e.ruleForm.method,callback:function(t){e.$set(e.ruleForm,"method",t)},expression:"ruleForm.method"}},e._l(e.methodOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"收费时间",prop:"time"}},[t("el-date-picker",{attrs:{disabled:e.dateRead,type:"datetime",align:"center","value-format":"timestamp",placeholder:"请选择收费时间"},model:{value:e.ruleForm.time,callback:function(t){e.$set(e.ruleForm,"time",t)},expression:"ruleForm.time"}})],1),e.ruleForm.method==e.freeId?t("el-form-item",{staticClass:"remark-wp",staticStyle:{"margin-top":"1.5rem"},attrs:{label:"上传附件",prop:"fileInfo"}},[e.qiniuDatas.domain?t("el-upload",{ref:"upload",attrs:{action:e.qiniuDatas.domain,"http-request":e.customUpload,"on-remove":e.handleRemove}},[t("el-button",{staticStyle:{width:"5rem",position:"absolute",top:"0",left:"6rem"},attrs:{type:"primary"}},[e._v(" 点击上传 ")])],1):e._e()],1):e._e(),t("el-form-item",{staticClass:"remark-wp",attrs:{label:"备注信息",prop:"remark"}},[t("el-input",{attrs:{type:"textarea",resize:"none",rows:4,placeholder:"请输入备注信息"},model:{value:e.ruleForm.remark,callback:function(t){e.$set(e.ruleForm,"remark",t)},expression:"ruleForm.remark"}})],1),t("el-checkbox",{model:{value:e.ruleForm.isreceipt,callback:function(t){e.$set(e.ruleForm,"isreceipt",t)},expression:"ruleForm.isreceipt"}},[e._v("生成发票")])],1),t("div",{staticClass:"btn-wp"},[e.$menu.getters.judgeRole("Btn-e9Q9SZZyarsFtI6PKzLz3soC")?t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.formSubmit}},[e._v(" 确认收费 ")]):e._e()],1)],1)])],1)])},i=[],a=(r("5948"),r("f31f")),l={name:"other",data(){return{urlObj:{getpaymenttype:this.$api.state.Charge.getpaymenttype.url,subjectList:this.$api.state.Public.subjectList.url,addtempsn:this.$api.state.Charge.addtempsn.url,getfreeid:this.$api.state.Charge.getfreeid.url,uploadToken:this.$api.state.Public.uploadToken.url,saveUploadInfo:this.$api.state.Public.saveUploadInfo.url,delFile:this.$api.state.Public.delFile.url},ruleForm:{uname:"",matter:"",type:"",money:"",method:"",time:"",remark:"",isreceipt:!1,fileInfo:[]},rules:{uname:[{required:!0,message:"请输入付款对象",trigger:"blur"}],matter:[{required:!0,message:"请输入收费事项",trigger:"blur"}],type:[{required:!0,message:"请选择收费类型",trigger:"change"}],money:[{required:!0,message:"请输入收费金额",trigger:"blur"}],method:[{required:!0,message:"请选择收费方式",trigger:"change"}],time:[{required:!0,message:"请选择收费时间",trigger:"change"}],fileInfo:[{type:"array",required:!0,message:"请上传附件！",trigger:"change"}]},typeOptions:[],methodOptions:[],isCommit:!1,dateRead:!1,qiniuDatas:{},freeId:null}},computed:{vid(){return this.$store.state.vid}},watch:{vid(){this.getPaymentType(),this.getSubject()}},mounted(){this.$menu.getters.judgeRole("Btn-2DHOrylYLGlWBvaT8By3Jf8d")?this.dateRead=!1:(this.dateRead=!0,this.ruleForm.time=new Date),this.getPaymentType(),this.getSubject(),this.getFreeId(),this.getUploadToken()},methods:{getPaymentType(){let e={vid:this.vid};this.$axios.post(this.urlObj.getpaymenttype,e).then(e=>{if(200===e.Code)this.methodOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取支付方式失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getSubject(){let e={vid:this.vid};this.$axios.post(this.urlObj.subjectList,e).then(e=>{if(200===e.Code)this.typeOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取科目数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},formSubmit(){this.$refs.ruleForm.validate(e=>{if(e){this.isCommit=!0;let e={vid:this.vid,realname:this.ruleForm.uname,describe:this.ruleForm.matter,subject_id:this.ruleForm.type,money:this.ruleForm.money,pay_type:this.ruleForm.method,pay_time:this.ruleForm.time/1e3,remark:this.ruleForm.remark,is_bill:this.ruleForm.isreceipt?1:0};this.ruleForm.method==this.freeId&&(e.md_file_ids=this.ruleForm.fileInfo.map(e=>e.id)),this.$axios.post(this.urlObj.addtempsn,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:"收费成功！"}),this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.ruleForm.remark="",this.ruleForm.isreceipt=!1;else{let t=e.Message?e.Message:"收费失败！";this.$message({type:"error",message:t})}this.isCommit=!1}).catch(e=>{this.isCommit=!1})}})},getFreeId(){this.$axios.post(this.urlObj.getfreeid).then(e=>{200===e.Code&&(this.freeId=e.Data.payment_id)})},getUploadToken(){this.$axios.post(this.urlObj.uploadToken).then(e=>{200===e.Code&&(this.qiniuDatas=e.Data)})},customUpload(e){e.url=this.$refs.upload.uploadFiles[0].url;let t=Object(a["a"])(e,this.qiniuDatas);t.observable.subscribe({next:e=>{},error:e=>{},complete:r=>{this.saveFile(t.fileInfo,e.file.uid)}})},handleRemove(e){let t=this.ruleForm.fileInfo.findIndex(t=>t.uid===e.uid);-1!=t&&(this.$axios.post(this.urlObj.delFile,{id:this.ruleForm.fileInfo[t].id}).then(e=>{if(200!=e.Code){let t=e.Message?e.Message:"文件删除失败！";this.$message({message:t,type:"error"})}}).catch(()=>{}),this.ruleForm.fileInfo.splice(t,1),this.$refs.ruleForm.validateField("fileInfo"))},saveFile(e,t){this.$axios.post(this.urlObj.saveUploadInfo,e).then(e=>{if(200===e.Code)this.ruleForm.fileInfo.push({id:e.Data.id,uid:t});else{let t=e.Message?e.Message:"文件信息保存失败！";this.$message({message:t,type:"error"})}this.$refs.ruleForm.validateField("fileInfo")})}}},o=l,m=(r("4bf3"),r("1805")),u=Object(m["a"])(o,s,i,!1,null,null,null);t["default"]=u.exports},"4bf3":function(e,t,r){"use strict";r("cabe")},cabe:function(e,t,r){}}]);