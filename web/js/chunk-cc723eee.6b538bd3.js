(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cc723eee"],{"01af":function(e,t,s){"use strict";s("502b")},"40a5":function(e,t,s){"use strict";s("e90e")},"502b":function(e,t,s){},"52d4":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"novehicle"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isRegister,expression:"!isRegister"}],staticClass:"pre-selection"},[t("area-village-select",{attrs:{title:"非机动车登记"},on:{registerPass:e.registerPass}})],1),e.isRegister&&e.isLoading?t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"loading"}):e._e(),e.isRegister&&!e.isLoading?t("div",{staticClass:"main-wp"},[t("el-button",{staticClass:"query",attrs:{icon:"el-icon-search"},on:{click:function(t){e.isRegister=!1}}},[e._v(" 重新查询 ")]),t("div",{staticClass:"left-wp"},[t("div",{staticClass:"title"},[e._v("非机动车登记")]),t("el-scrollbar",{staticStyle:{height:"calc(100% - 4.5rem)"}},[t("ul",{staticClass:"type-list"},[t("li",[t("div",{staticClass:"number-wp"},[t("div",{staticClass:"num-item"},[t("div",{staticClass:"num"},[e._v(e._s(e.nomotorNum))]),t("div",{staticClass:"explain"},[e._v("已登记非机动车(辆)")])])])])])])],1),t("div",{staticClass:"right-wp"},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("user-bind",{attrs:{vid:e.vid},on:{userSelected:e.userSelected}}),t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"客户姓名",prop:"uname"}},[t("el-input",{attrs:{placeholder:"请输入客户姓名",readonly:""},model:{value:e.ruleForm.uname,callback:function(t){e.$set(e.ruleForm,"uname",t)},expression:"ruleForm.uname"}})],1),t("el-form-item",{attrs:{label:"身份证号码",prop:"idcard"}},[t("el-input",{attrs:{placeholder:"请输入身份证号码",readonly:""},model:{value:e.ruleForm.idcard,callback:function(t){e.$set(e.ruleForm,"idcard",t)},expression:"ruleForm.idcard"}})],1),t("el-form-item",{attrs:{label:"客户类型",prop:"utype"}},[t("el-input",{attrs:{placeholder:"请输入客户类型",readonly:""},model:{value:e.ruleForm.utype,callback:function(t){e.$set(e.ruleForm,"utype",t)},expression:"ruleForm.utype"}})],1),t("el-form-item",{attrs:{label:"联系电话",prop:"utel"}},[t("el-input",{attrs:{placeholder:"请输入联系电话"},model:{value:e.ruleForm.utel,callback:function(t){e.$set(e.ruleForm,"utel",t)},expression:"ruleForm.utel"}})],1),t("el-form-item",{attrs:{label:"车牌号",prop:"plate"}},[t("el-input",{attrs:{placeholder:"请输入车牌号"},model:{value:e.ruleForm.plate,callback:function(t){e.$set(e.ruleForm,"plate",t)},expression:"ruleForm.plate"}})],1),t("el-form-item",{attrs:{label:"车辆类型",prop:"ctype"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择车辆类型"},on:{change:e.getSubjectData},model:{value:e.ruleForm.ctype,callback:function(t){e.$set(e.ruleForm,"ctype",t)},expression:"ruleForm.ctype"}},e._l(e.typeOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"收费科目",prop:"subject"}},[t("el-select",{attrs:{clearable:"",multiple:"","collapse-tags":"",placeholder:"请选择收费科目"},model:{value:e.ruleForm.subject,callback:function(t){e.$set(e.ruleForm,"subject",t)},expression:"ruleForm.subject"}},e._l(e.subOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"启用日期",prop:"stime"}},[t("el-date-picker",{attrs:{type:"date",align:"center","value-format":"timestamp",placeholder:"请选择启用日期"},model:{value:e.ruleForm.stime,callback:function(t){e.$set(e.ruleForm,"stime",t)},expression:"ruleForm.stime"}})],1),e.hasPark?t("div",{staticClass:"ic-wp"},[t("div",{staticClass:"line"}),t("div",{staticClass:"title"},[e._v("IC卡绑定")]),t("el-form-item",{attrs:{label:"IC卡卡号",prop:"iccode"}},[t("el-input",{attrs:{placeholder:"请输入IC卡卡号"},model:{value:e.ruleForm.iccode,callback:function(t){e.$set(e.ruleForm,"iccode",t)},expression:"ruleForm.iccode"}})],1),t("div",{staticClass:"tip"},[e._v(" 提示：请用鼠标点击IC卡ID输入框或IC卡卡号输入框后读卡绑定 ")])],1):e._e()],1),e.$menu.getters.judgeRole("Btn-rui2opy5OYH4zbotd7HEd95KHs")?t("div",{staticClass:"stall-title"},[e._v(" 已购车位绑定 ")]):e._e(),e.$menu.getters.judgeRole("Btn-rui2opy5OYH4zbotd7HEd95KHs")?t("el-radio-group",{model:{value:e.radioVal,callback:function(t){e.radioVal=t},expression:"radioVal"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.stallData,stripe:""}},[t("el-table-column",{attrs:{prop:"sort",label:"车位名称"}}),t("el-table-column",{attrs:{prop:"name",label:"姓名"}}),t("el-table-column",{attrs:{prop:"tel",label:"电话"}}),t("el-table-column",{attrs:{prop:"cycle",label:"使用周期"}}),t("el-table-column",{attrs:{prop:"",label:"同步周期"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-radio",{attrs:{label:s.row.id}},[e._v(" "+e._s("")+" ")])]}}],null,!1,3287885176)})],1)],1):e._e()],1),t("div",{staticClass:"btn-wp"},[e.$menu.getters.judgeRole("Btn-yLplxkcdFlPWbJycXZOoF8Ad")?t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.registerConfirm}},[e._v(" 确认登记 ")]):e._e()],1)],1)],1):e._e()])},i=[],l=s("5532"),r=s("b48e"),o={name:"novehicle",components:{userBind:l["a"],areaVillageSelect:r["a"]},data(){return{urlObj:{nomotorNum:this.$api.state.Means.nomotorNum.url,nomotorRegister:this.$api.state.Means.nomotorRegister.url,gettemporary:this.$api.state.Means.gettemporary.url,fixcarbyowner:this.$api.state.Means.fixcarbyowner.url},aid:"",vid:"",isRegister:!1,isLoading:!1,nomotorNum:0,isCommit:!1,ruleForm:{oid:"",uname:"",idcard:"",utype:"",plate:"",utel:"",ctype:"",subject:[],stime:"",icname:"",iccode:""},rules:{uname:[{required:!0,message:"请输入客户姓名",trigger:"change"}],idcard:[{required:!0,message:"请输入身份证号码",trigger:"change"}],utype:[{required:!0,message:"请输入客户类型",trigger:"change"}],plate:[{required:!0,message:"请输入车牌号",trigger:"blur"}],utel:[{required:!0,message:"请输入联系电话",trigger:"change"}],ctype:[{required:!0,message:"请选择车辆类型",trigger:"change"}],subject:[{required:!0,message:"请选择收费科目",trigger:"change"}],stime:[{required:!0,message:"请选择启用日期",trigger:"change"}],icname:[{required:!0,message:"请输入IC卡名称",trigger:"blur"}],iccode:[{required:!0,message:"请输入IC卡卡号",trigger:"blur"}]},typeOptions:[],subOptions:[],hasPark:!1,radioVal:"",stallData:[]}},watch:{isRegister(e){if(e){let e=document.getElementById("means");e.classList.add("register")}else{let e=document.getElementById("means");e.classList.remove("register")}}},created(){},methods:{registerPass(e){this.aid=e.aid,this.vid=e.vid,this.isRegister=!0,this.getNomotorNum(),this.getCarType(),this.getTemporary()},getCarType(){let e={type:"car_nonmotor"};this.$axios.post(this.$api.state.Means.carType.url,e).then(e=>{if(200===e.Code)this.typeOptions=e.Data;else{let t=e.Message?e.Message:"车辆类型数据获取失败！";this.$message({type:"error",message:t})}}).catch(e=>{this.$message({type:"error",message:"车辆类型数据获取失败！"})})},getTemporary(){this.$axios.post(this.$api.state.Means.gettemporary.url,{vid:this.vid}).then(e=>{if(200===e.Code)this.hasPark=1==e.Data.has_temporary;else{let t=e.Message?e.Message:"非机动车临停车场数据获取失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},getSubjectData(e){if(this.ruleForm.subject="",this.subOptions=[],e){let t={vid:this.vid,resource_type_id:e};this.$axios.post(this.$api.state.Public.subjectbytype.url,t).then(e=>{if(200===e.Code)this.subOptions=e.Data;else{let t=e.Message?e.Message:"科目数据获取失败！";this.$message({type:"error",message:t})}}).catch(e=>{this.$message({type:"error",message:"科目数据获取失败！"})})}},getNomotorNum(){this.isLoading=!0,this.$axios.post(this.urlObj.nomotorNum,{vid:this.vid}).then(e=>{if(200===e.Code)this.nomotorNum=e.Data.num;else{let t=e.Message?e.Message:"非机动车数量获取失败！";this.$message({type:"error",message:t})}this.isLoading=!1}).catch(e=>{this.$message({type:"error",message:"非机动车数量获取失败！"}),this.isLoading=!1})},userSelected(e){this.ruleForm.oid=e.id,this.ruleForm.uname=e.realname,this.ruleForm.idcard=e.idcard,this.ruleForm.utype=e.owner_type.name,this.ruleForm.utel=e.tel,this.radioVal="",this.$menu.getters.judgeRole("Btn-rui2opy5OYH4zbotd7HEd95KHs")&&this.getFixcarOwner()},getFixcarOwner(){let e={oid:this.ruleForm.oid};this.$axios.post(this.urlObj.fixcarbyowner,e).then(e=>{if(200===e.Code)e.Data.forEach(e=>{e.name=this.ruleForm.uname,e.tel=this.ruleForm.utel,e.cycle=(e.starttime?e.starttime:"")+(e.endtime?" - "+e.endtime:"")}),this.stallData=e.Data;else{let t=e.Message?e.Message:"绑定非机动车数据获取失败！";this.$message({type:"error",message:t})}}).catch(e=>{})},registerConfirm(){this.$refs.ruleForm.validate(e=>{if(e){this.isCommit=!0;let e={vid:this.vid,oid:this.ruleForm.oid,starttime:this.ruleForm.stime/1e3,non_owner_tel:this.ruleForm.utel,plates:this.ruleForm.plate,resources_type_id:this.ruleForm.ctype,subject_village_arr:this.ruleForm.subject};this.radioVal&&(e.car_id=this.radioVal),this.hasPark&&(e.ic_card_code=this.ruleForm.iccode),this.registerRequst(e)}})},registerRequst(e){this.$axios.post(this.urlObj.nomotorRegister,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:"登记成功！"}),this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.stallData=[],this.getNomotorNum();else{let t=e.Message?e.Message:"确认登记失败！";this.$message({type:"error",message:t})}this.isCommit=!1}).catch(e=>{this.$message({type:"error",message:"确认登记失败！"}),this.isCommit=!1})}}},n=o,u=(s("ac0e"),s("1805")),c=Object(u["a"])(n,a,i,!1,null,null,null);t["default"]=c.exports},5532:function(e,t,s){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"user-bind"}},[t("el-autocomplete",{ref:"searchInput",staticClass:"us-search",attrs:{"popper-class":"my-autocomplete",debounce:0,"fetch-suggestions":e.querySearchAsync,placeholder:"请输入姓名或电话号码搜索"},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function({item:s}){return[t("div",{staticClass:"tr-item"},[t("span",{staticClass:"td-item"},[e._v(e._s(s.realname))]),t("span",{staticClass:"td-item"},[e._v(e._s(s.sex?s.sex:"未知"))]),t("span",{staticClass:"td-item"},[e._v(e._s(s.tel))])]),e.allUserList.length>1&&s.id==e.allUserList[e.allUserList.length-1].id?t("div",{staticClass:"load-more",on:{click:function(t){return t.stopPropagation(),e.loadMore.apply(null,arguments)}}},[e._v(" "+e._s(e.nomore?"没有更多了":"点击加载更多")+" ")]):e._e(),e.allUserList.length<=1?t("div",{staticClass:"load-more",on:{click:function(t){return t.stopPropagation(),e.loadMore.apply(null,arguments)}}},[e._v(" 暂无数据！ ")]):e._e()]}}]),model:{value:e.autoValue,callback:function(t){e.autoValue=t},expression:"autoValue"}},[t("i",{staticClass:"iconfont iconzu3664 el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})])],1)},i=[],l={name:"UserBind",props:{vid:{type:[Number,String]}},data(){return{autoValue:"",currentUser:{},allUserList:[],nomore:!1}},mounted(){},methods:{async querySearchAsync(e,t){let s={keywords:e,page:1,limit:20,vid:this.vid},a=await this.$axios.post(this.$api.state.Means.userSearch.url,s);if(200===a.Code){let e={id:0,realname:"姓名",sex:"性别",tel:"电话号码"};a.Data.data.unshift(e),this.allUserList=a.Data.data,this.nomore=!1,t(a.Data.data)}else this.$refs.searchInput.$children[0].blur()},async loadMore(){if(!this.nomore){let e={keywords:this.autoValue,page:Math.ceil(this.allUserList.length/20)+1,limit:20,vid:this.vid},t=await this.$axios.post(this.$api.state.Means.userSearch.url,e);200===t.Code&&(t.Data.data.length>0?(this.allUserList=this.allUserList.concat(t.Data.data),this.$refs.searchInput.suggestions=this.allUserList):this.nomore=!0)}},handleSelect(e){this.currentUser=e,this.$emit("userSelected",e)}}},r=l,o=(s("01af"),s("1805")),n=Object(o["a"])(r,a,i,!1,null,null,null);t["a"]=n.exports},"6f2f":function(e,t,s){},ac0e:function(e,t,s){"use strict";s("6f2f")},b48e:function(e,t,s){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],attrs:{id:"area-village-select","element-loading-text":"数据加载中，请稍等"}},[t("div",{staticClass:"select-content"},[t("div",{staticClass:"title"},[e._v(e._s(e.title))]),t("div",{staticClass:"select-item"},[t("div",{staticClass:"name"},[e._v("选择大区")]),t("el-select",{attrs:{clearable:"",placeholder:"请选择大区"},on:{change:e.areaChange},model:{value:e.areaValue,callback:function(t){e.areaValue=t},expression:"areaValue"}},e._l(e.areaOptions,(function(e){return t("el-option",{key:e.deptid,attrs:{label:e.deptname,value:e.deptid}})})),1)],1),t("div",{staticClass:"select-item"},[t("div",{staticClass:"name"},[e._v("选择项目")]),t("el-select",{attrs:{clearable:"",multiple:e.multiple,placeholder:"请选择项目","no-data-text":e.villageLoading?"加载中...":"无数据"},model:{value:e.villageValue,callback:function(t){e.villageValue=t},expression:"villageValue"}},e._l(e.villageOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("div",{staticClass:"btn-wp"},[t("el-button",{attrs:{type:"primary",round:""},on:{click:e.registerStart}},[e._v(" "+e._s(e.btnName)+" ")])],1)])])},i=[],l={name:"AreaVillageSelect",props:{title:{type:String,default:""},btnName:{type:String,default:"开始登记"},multiple:{type:Boolean,default:!1}},data(){return{urlObj:{bigarea:this.$api.state.Public.bigarea.url,village:this.$api.state.Public.village.url},isRegister:!1,areaValue:"",areaOptions:[],villageLoading:!1,villageValue:this.multiple?[]:"",villageOptions:[],isLoading:!1}},created(){this.isLoading=!0,this.getAreaData()},methods:{getAreaData(){this.$axios.post(this.urlObj.bigarea,{vill_limit:!0}).then(e=>{if(200===e.Code){let t=sessionStorage.getItem("bid");t?(this.areaValue=Number(t),this.getVillageData(!0)):this.isLoading=!1,this.areaOptions=e.Data}else this.$message({type:"error",message:"大区数据获取失败！"}),this.isLoading=!1}).catch(e=>{this.$message({type:"error",message:"大区数据获取失败！"}),this.isLoading=!1})},areaChange(){this.villageOptions=[],this.villageValue=this.multiple?[]:"",this.areaValue&&this.getVillageData()},getVillageData(e){this.villageLoading=!0,this.$axios.post(this.urlObj.village,{id:this.areaValue}).then(t=>{if(200===t.Code){if(e){let e=sessionStorage.getItem("vid");e&&(this.villageValue=this.multiple?[Number(e)]:Number(e))}this.villageOptions=t.Data}else this.$message({type:"error",message:"项目数据获取失败！"});this.villageLoading=!1,this.isLoading=!1}).catch(e=>{this.$message({type:"error",message:"项目数据获取失败！"}),this.villageLoading=!1,this.isLoading=!1})},registerStart(){let e="",t=this.multiple?this.villageValue.length>0:this.villageValue;if(this.areaValue||t)if(this.areaValue){if(t){let e={aid:this.areaValue,vid:this.villageValue};return void this.$emit("registerPass",e)}e="请选择项目！"}else e="请选择大区！";else e="请选择大区和项目！";this.$message({type:"warning",message:e})}}},r=l,o=(s("40a5"),s("1805")),n=Object(o["a"])(r,a,i,!1,null,null,null);t["a"]=n.exports},e90e:function(e,t,s){}}]);