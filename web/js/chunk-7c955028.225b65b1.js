(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7c955028"],{"22b8":function(t,e,a){"use strict";a("b73a")},"6a51":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{attrs:{id:"bill-manage"}},[e("div",{staticClass:"top"},[e("div",{staticClass:"main"},[e("div",{staticClass:"common-left"},[e("span",{staticClass:"common-chose-info",on:{click:function(e){return t.$refs.showFilterVillage.showDialog()}}},[e("i",{staticClass:"iconfont icondaqu"}),t._v(" "+t._s(t.choseVillageInfo.name)+" ")]),e("el-select",{attrs:{multiple:"","collapse-tags":"",clearable:"",placeholder:"请选择科目"},on:{change:t.tableLoad},model:{value:t.subjectVal,callback:function(e){t.subjectVal=e},expression:"subjectVal"}},t._l(t.subOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1),e("el-date-picker",{attrs:{type:"daterange",align:"center","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:t.tableLoad},model:{value:t.dateValue,callback:function(e){t.dateValue=e},expression:"dateValue"}})],1),e("div",{staticClass:"common-right"},[e("span",{staticClass:"ico-wp",on:{click:t.exportExcel}},[e("workIcon",{staticClass:"common-right-icon",attrs:{name:"export",title:"导出"}})],1)])])]),e("div",{staticClass:"main-wp"},[e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.tableData,cusColums:t.columns,cusConf:t.conf,ispaging:!0},on:{sizeChange:t.sizeChange,currentChange:t.currentChange}})],1)]),e("filter-village",{ref:"showFilterVillage",attrs:{vid:t.choseVillageInfo.vid},on:{choseInfo:t.filterVillage}})],1)},i=[],l=(a("5948"),a("4698")),o=a("fce0"),c={name:"billManage",components:{workIcon:l["a"]},data(){return{urlObj:{villageend:this.$api.state.Charge.villageend.url,coststatistics:this.$api.state.Report.coststatistics.url},choseVillageInfo:{name:"全部项目",vid:0},subjectVal:[],subOptions:[],dateValue:[],tableData:[],columns:o.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0}}},computed:{vid(){return this.$store.state.vid}},created(){let t=sessionStorage.getItem("vid"),e=sessionStorage.getItem("vname");t&&(this.choseVillageInfo.vid=t,this.choseVillageInfo.name=e),this.getSubjectList(),this.tableLoad()},methods:{filterVillage(t){this.choseVillageInfo.name=t.name,this.choseVillageInfo.vid=t.vid,this.subjectVal=[],this.subOptions=[],this.dateValue=[],this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad(),this.getSubjectList()},getSubjectList(){let t={vid:this.choseVillageInfo.vid};this.$axios.post(this.urlObj.villageend,t).then(t=>{if(200===t.Code)this.subOptions=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取科目数据失败！";this.$message({message:e,type:"error"})}}).catch(()=>{})},tableLoad(){this.conf.loadStatus=!0;let t={page:this.conf.curPage,limit:this.conf.limit,vid:this.vid,subject_ids:this.subjectVal,starttime:this.dateValue&&this.dateValue[0]?this.dateValue[0]/1e3:"",endtime:this.dateValue&&this.dateValue[1]?this.dateValue[1]/1e3:"",is_excel:0};this.$axios.post(this.urlObj.coststatistics,t).then(t=>{200===t.Code?(this.conf.dataTotal=t.Data.total,this.tableData=t.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=t.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},sizeChange(t){this.conf.limit=t,this.tableLoad()},currentChange(t){this.conf.curPage=t,this.tableLoad()},exportExcel(){let t={page:this.conf.curPage,limit:this.conf.limit,vid:this.vid,subject_ids:this.subjectVal,starttime:this.dateValue&&this.dateValue[0]?this.dateValue[0]/1e3:"",endtime:this.dateValue&&this.dateValue[1]?this.dateValue[1]/1e3:"",is_excel:1};this.$axios.post(this.urlObj.coststatistics,t).then(t=>{if(200===t.Code){let e=t.Data&&t.Data.length>0?t.Data:[];this.exportDataHandle(e)}else{let e=t.Message?t.Message:"订单列表数据获取失败！";$message({type:"error",message:e})}})},exportDataHandle(t){try{Promise.all([a.e("chunk-3a869cfb"),a.e("chunk-2a5081b0"),a.e("chunk-3a96421c")]).then((()=>{let{export_json_to_excel:e}=a("628d"),s=["资源名称","客户姓名","计费科目","金额","费用描述","状态","应收日期","备注","计费方式","计费人"],i=[];t.forEach(t=>{let e=[t.model_text,t.realname,t.subject_text,t.money,t.describe,t.status_text,t.ymonth,t.remarks,t.formula_text,t.operator_text];i.push(e)}),e(s,i,"计费管理报表")}).bind(null,a)).catch(a.oe),this.$notify({type:"success",title:"温馨提示",message:"导出报表成功",duration:1500})}catch(e){this.$notify({type:"error",title:"温馨提示",message:"导出报表失败",duration:1500})}}}},n=c,r=(a("22b8"),a("1805")),h=Object(r["a"])(n,s,i,!1,null,null,null);e["default"]=h.exports},b73a:function(t,e,a){},fce0:function(t){t.exports=JSON.parse('{"list":[{"label":"资源名称","prop":"model_text","show":true},{"label":"客户姓名","prop":"realname","show":true,"color":"#999"},{"label":"计费科目","prop":"subject_text","show":true,"color":"#999"},{"label":"金额","prop":"money","show":true,"color":"#ffcb3c"},{"label":"费用描述","prop":"describe","show":true},{"label":"状态","prop":"status_text","show":true},{"label":"应收日期","prop":"ymonth","show":true,"color":"#999"},{"label":"计费方式","prop":"formula_text","show":true},{"label":"计费人","prop":"operator_text","show":true},{"label":"备注","prop":"remarks","show":true,"color":"#999"}]}')}}]);