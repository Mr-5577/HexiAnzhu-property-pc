(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-57d340a7"],{"20af":function(e,t,i){},"337e":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isSubmit,expression:"isSubmit"}],attrs:{id:"charging","element-loading-text":"数据提交中"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isRegister,expression:"!isRegister"}],staticClass:"pre-selection"},[t("area-village-select",{attrs:{title:"计费标准设置",btnName:"开始设置"},on:{registerPass:e.registerPass}})],1),e.isRegister?t("div",{staticClass:"main-ct"},[t("el-button",{staticClass:"query",attrs:{icon:"el-icon-search"},on:{click:function(t){e.isRegister=!1}}},[e._v(" 重新设置 ")]),t("div",{staticClass:"left-wp"},[t("subject-tree",{ref:"subjectTree",attrs:{vid:e.vid,showSearch:!1,treeType:"charge"},on:{checkChange:e.checkChange}})],1),e.currentSubject.id?t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"right-wp"},[t("div",{staticClass:"title"},[t("img",{staticStyle:{width:"1rem",height:"1rem","vertical-align":"middle","margin-right":"10px"},attrs:{src:i("897c"),alt:""}}),t("span",[e._v(e._s(e.subjectDetail.name))]),1==e.currentSubject.is_end&&e.$menu.getters.judgeRole("Btn-QfTIBlCpVq152jHbu6rmKoGY")?t("el-switch",{attrs:{"active-color":"#3ebb75","inactive-color":"#f2f2f2","inactive-text":"启用"},on:{change:e.switchChange},model:{value:e.switchVal,callback:function(t){e.switchVal=t},expression:"switchVal"}}):e._e()],1),t("el-scrollbar",{style:{height:1==e.currentSubject.is_end?"calc(100% - 8.5rem)":"calc(100% - 4.5rem)"}},[t("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.rules,"hide-required-asterisk":!0}},[e._l(e.editInfo,(function(i,a){return t("el-form-item",{key:a,attrs:{label:i.name,prop:i.value}},["cascader"==i.type?t("el-cascader",{attrs:{options:i.options,props:i.props,clearable:"","show-all-levels":!1,disabled:1!=e.currentSubject.is_end},model:{value:e.editForm[i.value],callback:function(t){e.$set(e.editForm,i.value,t)},expression:"editForm[item.value]"}}):"select"==i.type?t("el-select",{attrs:{clearable:"",disabled:i.readonly||1!=e.currentSubject.is_end,placeholder:"请选择"+i.name},model:{value:e.editForm[i.value],callback:function(t){e.$set(e.editForm,i.value,t)},expression:"editForm[item.value]"}},e._l(i.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):t("el-input",{attrs:{type:i.type,disabled:i.readonly||1!=e.currentSubject.is_end,placeholder:"请输入"+i.name},model:{value:e.editForm[i.value],callback:function(t){e.$set(e.editForm,i.value,t)},expression:"editForm[item.value]"}})],1)})),e.editForm&&e.editForm.isend?t("el-form-item",{attrs:{label:"科目类型",prop:"subType"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择科目类型"},model:{value:e.editForm.subType,callback:function(t){e.$set(e.editForm,"subType",t)},expression:"editForm.subType"}},e._l(e.subjects,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),e.editForm&&e.editForm.isend?t("el-form-item",{attrs:{label:"计量单位",prop:"unitVal"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择计量单位",disabled:1!=e.currentSubject.is_end},model:{value:e.editForm.unitVal,callback:function(t){e.$set(e.editForm,"unitVal",t)},expression:"editForm.unitVal"}},e._l(e.units,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),e.editForm&&e.editForm.isend?t("el-form-item",{attrs:{label:"计算公式",prop:"formulaVal"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择计算公式",disabled:1!=e.currentSubject.is_end},model:{value:e.editForm.formulaVal,callback:function(t){e.$set(e.editForm,"formulaVal",t)},expression:"editForm.formulaVal"}},e._l(e.formulas,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),e.editForm&&e.editForm.isend?t("el-form-item",{attrs:{label:"收费模式",prop:"pattern"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择收费模式"},model:{value:e.editForm.pattern,callback:function(t){e.$set(e.editForm,"pattern",t)},expression:"editForm.pattern"}},e._l(e.patterns,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),e.editForm&&e.editForm.isend&&e.$menu.getters.judgeRole("Btn-QfTIBlCpVq156KuH5PrmKoG6")?t("el-form-item",{attrs:{label:"绑定车场",prop:"carbind"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择车场"},model:{value:e.editForm.carbind,callback:function(t){e.$set(e.editForm,"carbind",t)},expression:"editForm.carbind"}},e._l(e.carOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),e.editForm&&e.editForm.isend?t("el-form-item",{attrs:{label:"是否在添加收费显示",prop:"show"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择是否在添加收费显示"},model:{value:e.editForm.show,callback:function(t){e.$set(e.editForm,"show",t)},expression:"editForm.show"}},[t("el-option",{key:0,attrs:{label:"不显示",value:0}}),t("el-option",{key:1,attrs:{label:"显示",value:1}})],1)],1):e._e(),e.editForm&&e.editForm.isend?t("el-form-item",{attrs:{label:"是否是装修科目",prop:"fitSub"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择是否是装修科目"},model:{value:e.editForm.fitSub,callback:function(t){e.$set(e.editForm,"fitSub",t)},expression:"editForm.fitSub"}},[t("el-option",{key:0,attrs:{label:"否",value:0}}),t("el-option",{key:1,attrs:{label:"是",value:1}})],1)],1):e._e(),e.editForm&&e.editForm.isend?t("el-form-item",{attrs:{label:"沪友开票名称",prop:"invoiceName"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择沪友开票名称"},model:{value:e.editForm.invoiceName,callback:function(t){e.$set(e.editForm,"invoiceName",t)},expression:"editForm.invoiceName"}},e._l(e.inameOptions,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1):e._e(),e.editForm&&e.editForm.isend?t("el-form-item",{attrs:{label:"是否允许多次退款",prop:"isrefund"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择是否允许多次退款"},model:{value:e.editForm.isrefund,callback:function(t){e.$set(e.editForm,"isrefund",t)},expression:"editForm.isrefund"}},[t("el-option",{attrs:{label:"是",value:1}}),t("el-option",{attrs:{label:"否",value:0}})],1)],1):e._e(),e.editForm&&e.editForm.isend?t("el-form-item",{attrs:{label:"是否允许编辑计算公式",prop:"isformedit"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择是否允许编辑计算公式"},model:{value:e.editForm.isformedit,callback:function(t){e.$set(e.editForm,"isformedit",t)},expression:"editForm.isformedit"}},[t("el-option",{attrs:{label:"是",value:1}}),t("el-option",{attrs:{label:"否",value:0}})],1)],1):e._e(),e.editForm&&e.editForm.isend?t("el-form-item",{attrs:{label:"是否允许自定义时间",prop:"is_custom_time"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择是否允许自定义开始时间"},model:{value:e.editForm.is_custom_time,callback:function(t){e.$set(e.editForm,"is_custom_time",t)},expression:"editForm.is_custom_time"}},[t("el-option",{attrs:{label:"是",value:1}}),t("el-option",{attrs:{label:"否",value:0}})],1)],1):e._e(),e.editForm&&e.editForm.isend?t("el-form-item",{attrs:{label:"是否允许选择目前欠费之前的时间",prop:"is_choice_before"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择是否允许选择目前欠费之前的时间"},model:{value:e.editForm.is_choice_before,callback:function(t){e.$set(e.editForm,"is_choice_before",t)},expression:"editForm.is_choice_before"}},[t("el-option",{attrs:{label:"是",value:1}}),t("el-option",{attrs:{label:"否",value:0}})],1)],1):e._e(),e.editForm&&e.editForm.isend?t("el-form-item",{attrs:{label:"是否允许跳交",prop:"expire_chose_starttime"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择是否允许跳交"},model:{value:e.editForm.expire_chose_starttime,callback:function(t){e.$set(e.editForm,"expire_chose_starttime",t)},expression:"editForm.expire_chose_starttime"}},[t("el-option",{attrs:{label:"是",value:1}}),t("el-option",{attrs:{label:"否",value:0}})],1)],1):e._e(),e.editForm&&e.editForm.isend?t("el-form-item",{attrs:{label:"计费周期",prop:"billing_rules"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择计费周期"},model:{value:e.editForm.billing_rules,callback:function(t){e.$set(e.editForm,"billing_rules",t)},expression:"editForm.billing_rules"}},[t("el-option",{attrs:{label:"按自然月",value:1}}),t("el-option",{attrs:{label:"按月",value:2}})],1)],1):e._e(),e.editForm&&e.editForm.isend?t("el-form-item",{staticClass:"priority",attrs:{label:"计费优先级"}},[t("el-form-item",{attrs:{prop:"priority1"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择计费优先级",disabled:1!=e.currentSubject.is_end},model:{value:e.editForm.priority1,callback:function(t){e.$set(e.editForm,"priority1",t)},expression:"editForm.priority1"}},e._l(e.priorityOptions1,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("span",{staticClass:"line",attrs:{span:1}},[e._v(">")]),t("el-form-item",{attrs:{prop:"priority2"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择计费优先级",disabled:1!=e.currentSubject.is_end},model:{value:e.editForm.priority2,callback:function(t){e.$set(e.editForm,"priority2",t)},expression:"editForm.priority2"}},e._l(e.priorityOptions2,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("span",{staticClass:"line",attrs:{span:1}},[e._v(">")]),t("el-form-item",{attrs:{prop:"priority3"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择计费优先级",disabled:1!=e.currentSubject.is_end},model:{value:e.editForm.priority3,callback:function(t){e.$set(e.editForm,"priority3",t)},expression:"editForm.priority3"}},e._l(e.priorityOptions3,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1):e._e()],2),t("div",{staticClass:"btn-wp"},[1==e.currentSubject.is_end?t("el-button",{staticClass:"add",attrs:{round:"",plain:"",icon:"iconfont iconxinzeng"},on:{click:e.addHandle}},[e._v(" 新增费率 ")]):e._e(),1==e.currentSubject.is_end?t("el-button",{staticClass:"detail",attrs:{round:"",plain:"",icon:"iconfont iconqingkuang"},on:{click:e.detailHandle}},[e._v(" 费率明细 ")]):e._e(),1==e.currentSubject.is_end&&e.$menu.getters.judgeRole("Btn-Hs0dINt8CDRmMnBePLozZ37c")?t("el-button",{attrs:{type:"warning",round:"",plain:"",icon:"iconfont iconfuzhi"},on:{click:e.copyDialogInit}},[e._v(" 复制收费标准 ")]):e._e(),t("el-button",{attrs:{type:"primary",plain:"",round:"",icon:"iconfont iconzu3638"},on:{click:e.logHandle}},[e._v(" 变更日志 ")])],1)],1),1==e.currentSubject.is_end?t("div",{staticClass:"bottom-btn"},[e.$menu.getters.judgeRole("Btn-oMl18sy2ZRxOhedGcfptD0WY")?t("el-button",{attrs:{type:"primary",round:""},on:{click:e.editSubmit}},[e._v(" 保存修改 ")]):e._e(),t("el-button",{attrs:{type:"info",round:""}},[e._v("取消")])],1):e._e()],1):t("div",{staticClass:"right-wp"},[t("div",{staticClass:"empty"},[e._v("请在左侧选择科目！")])])],1):e._e(),t("el-dialog",{staticClass:"copyDialog",attrs:{visible:e.showCopyPop,title:"复制收费标准",width:"56%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showCopyPop=t}}},[t("div",{staticClass:"select-wp"},[t("div",{staticClass:"select-ct"},[t("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择项目"},on:{change:e.tableLoad},model:{value:e.copyVillage,callback:function(t){e.copyVillage=t},expression:"copyVillage"}},e._l(e.copyOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.villagename,value:e.id}})})),1),t("span",{staticClass:"text"},[e._v("复制到")]),t("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择项目"},model:{value:e.copyToVillage,callback:function(t){e.copyToVillage=t},expression:"copyToVillage"}},e._l(e.copyOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.villagename,value:e.id}})})),1)],1),t("div",{staticClass:"btn-wp"},[t("el-button",{attrs:{type:"primary",round:"",plain:"",icon:"el-icon-refresh-right"},on:{click:e.tableLoad}},[e._v(" 刷新科目 ")])],1)]),t("div",{staticClass:"table-wp"},[t("el-scrollbar",{staticStyle:{height:"calc(100% - 2.5rem)"}},[t("cus-table",{attrs:{datas:e.tableData,cusColums:e.columns,cusConf:e.conf,check:!0},on:{selectionChange:e.selectionChange}})],1),t("div",{staticClass:"radio-wp"},[t("el-radio",{attrs:{label:0},model:{value:e.radioVal,callback:function(t){e.radioVal=t},expression:"radioVal"}},[e._v("保留原设置")]),t("el-radio",{attrs:{label:1},model:{value:e.radioVal,callback:function(t){e.radioVal=t},expression:"radioVal"}},[e._v("覆盖原设置")])],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.copyConfirm}},[e._v(" 开始复制 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showCopyPop=!1}}},[e._v(" 取消 ")])],1)]),t("el-dialog",{staticClass:"addDialog",attrs:{visible:e.showAddDialog,title:e.isEdit?"编辑费率":"新增费率",width:"35%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showAddDialog=t}}},[t("el-form",{ref:"addForm",attrs:{model:e.addForm,rules:e.addRules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"科目名称",prop:"sname"}},[t("el-input",{attrs:{readonly:"",placeholder:"请输入科目名称"},model:{value:e.addForm.sname,callback:function(t){e.$set(e.addForm,"sname",t)},expression:"addForm.sname"}})],1),t("el-form-item",{attrs:{label:"基本单价(元)",prop:"price"}},[t("el-input",{attrs:{placeholder:"请输入基本单价"},model:{value:e.addForm.price,callback:function(t){e.$set(e.addForm,"price",t)},expression:"addForm.price"}})],1),t("el-form-item",{attrs:{label:"生效时间",prop:"time"}},[t("el-date-picker",{attrs:{type:"date",align:"center","value-format":"timestamp",placeholder:"请选择生效时间"},model:{value:e.addForm.time,callback:function(t){e.$set(e.addForm,"time",t)},expression:"addForm.time"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.addSave}},[e._v(" 提交保存 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showAddDialog=!1}}},[e._v(" 取消 ")])],1)],1),t("el-dialog",{staticClass:"detailDialog",attrs:{visible:e.showDetailDialog,title:"费率明细记录",width:"60%"},on:{"update:visible":function(t){e.showDetailDialog=t}}},[t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.detailTableData,cusColums:e.detailColumns,cusConf:e.detailConf},on:{edit:e.rateEdit,ratedel:e.rateDel}})],1)]),t("el-dialog",{staticClass:"logDialog",attrs:{visible:e.showLogDialog,title:"变更日志",width:"50%","close-on-click-modal":!0},on:{"update:visible":function(t){e.showLogDialog=t}}},[t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.logTableData,cusColums:e.logColumns,cusConf:e.logConf,ispaging:!0},on:{sizeChange:e.logSizeChange,currentChange:e.logCurrentChange}})],1)])],1)},s=[],l=(i("5948"),i("58ea")),r=i("8eaa"),o=i("c414"),n=i("423f"),d=i("b48e"),c=i("f0a4"),u={name:"charging",components:{subjectTree:l["a"],areaVillageSelect:d["a"]},data(){return{urlObj:{subDetail:this.$api.state.Setting.subDetail.url,villages:this.$api.state.System.village.list.url,addRate:this.$api.state.Setting.addRate.url,rateDetail:this.$api.state.Setting.rateDetail.url,rateEdit:this.$api.state.Setting.rateEdit.url,rateDelete:this.$api.state.Setting.rateDelete.url,subOpenClose:this.$api.state.Setting.subOpenClose.url,uploadCharge:this.$api.state.Setting.uploadCharge.url,copySub:this.$api.state.Setting.copySub.url,endSubjects:this.$api.state.Setting.endSubjects.url,userVillage:this.$api.state.Public.userVillage.url,getpatterns:this.$api.state.Setting.getpatterns.url,chargeLog:this.$api.state.Setting.chargeLog.url,carlist:this.$api.state.Public.carlist.url,getinvoices:this.$api.state.Setting.getinvoices.url},aid:"",vid:"",isRegister:!1,isLoading:!1,editForm:{pid:"",code:"",subName:"",price:"",alias:"",isend:"",subType:"",isOpen:"",online:"",invoice_type:"",isRefund:"",isCharge:"",source:[],sort:"",tax_rate:"",unitVal:"",formulaVal:"",pattern:"",carbind:"",show:"",fitSub:"",invoiceName:"",isrefund:"",isformedit:"",is_custom_time:"",is_choice_before:"",expire_chose_starttime:"",billing_rules:"",priority1:"",priority2:"",priority3:""},rules:{pid:[{required:!0,message:"请选择上级节点",trigger:"change"}],code:[{required:!0,message:"请输入科目编码",trigger:"blur"}],subName:[{required:!0,message:"请输入科目名称",trigger:"blur"}],price:[{required:!1,message:"请输入价格",trigger:"blur"}],alias:[{required:!0,message:"请输入打印别名",trigger:"blur"}],isend:[{required:!1,message:"请选择是否为末级",trigger:"change"}],subType:[{required:!0,message:"请选择科目类型",trigger:"change"}],isOpen:[{required:!0,message:"请选择是否开启计费",trigger:"change"}],online:[{required:!0,message:"请选择是否线上缴费",trigger:"change"}],invoice_type:[{required:!0,message:"请选择是否开具发票",trigger:"change"}],isRefund:[{required:!0,message:"请选择是否允许退款",trigger:"change"}],isformedit:[{required:!0,message:"请选择是否允许编辑计算公式",trigger:"change"}],is_custom_time:[{required:!0,message:"请选择是否允许自定义开始时间",trigger:"change"}],is_choice_before:[{required:!0,message:"请选择是否允许选择目前欠费之前的时间",trigger:"change"}],expire_chose_starttime:[{required:!0,message:"请选择是否允许跳交",trigger:"change"}],billing_rules:[{required:!0,message:"请选择计费周期",trigger:"change"}],isCharge:[{required:!0,message:"请选择是否生成欠费",trigger:"change"}],source:[{required:!0,message:"请选择可用资源",trigger:"change"}],sort:[{required:!0,message:"请输入排序",trigger:"blur"}],tax_rate:[{required:!0,message:"请输入税率",trigger:"blur"}],unitVal:[{required:!0,message:"请选择计量单位",trigger:"change"}],formulaVal:[{required:!0,message:"请选择计算公式",trigger:"change"}],pattern:[{required:!0,message:"请选择收费模式",trigger:"change"}],carbind:[{required:!1,message:"请选择车场",trigger:"change"}],show:[{required:!0,message:"请选择是否在添加收费显示",trigger:"change"}],fitSub:[{required:!0,message:"请选择是否是装修科目",trigger:"change"}],invoiceName:[{required:!1,message:"请选择沪友开票名称",trigger:"change"}],isrefund:[{required:!0,message:"请选择是否允许多次退款",trigger:"change"}],priority1:[{required:!0,message:"请选择计费优先级1",trigger:"change"}],priority2:[{required:!0,message:"请选择计费优先级2",trigger:"change"}],priority3:[{required:!0,message:"请选择计费优先级3",trigger:"change"}]},currentSubject:{},subjectDetail:{},switchVal:"",showCopyPop:!1,tableData:[],columns:r.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},isCommit:!1,copyVillage:"",copyOptions:[],copyToVillage:"",radioVal:0,tableSelected:[],showAddDialog:!1,addForm:{sname:"",price:"",time:""},addRules:{sname:[{required:!0,message:"请输入项目",trigger:"change"}],price:[{required:!0,message:"请输入单价",trigger:"blur"}],time:[{required:!0,message:"请选择生效时间",trigger:"blur"}]},showDetailDialog:!1,detailTableData:[],detailColumns:o.list,detailConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},isEdit:!1,cindex:0,patterns:[],carOptions:[],showLogDialog:!1,logTableData:[],logColumns:n.list,logConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},isSubmit:!1,inameOptions:[]}},computed:{...Object(c["b"])(["resource","prioritys","units","formulas","subjects"]),editInfo(){let e=[{name:"科目编码",value:"code",type:"text",readonly:!1},{name:"科目名称",value:"subName",type:"text",readonly:!1},{name:"价格",value:"price",type:"number",readonly:!0},{name:"打印别名",value:"alias",type:"text",readonly:!1},{name:"是否为末级",value:"isend",type:"select",options:[{value:0,label:"否"},{value:1,label:"是"}],readonly:!0},{name:"是否开启计费",value:"isOpen",type:"select",options:[{value:0,label:"否"},{value:1,label:"是"}],readonly:!1},{name:"是否线上缴费",value:"online",type:"select",options:[{value:0,label:"否"},{value:1,label:"是"}],readonly:!1},{name:"是否开具发票",value:"invoice_type",type:"select",options:[{value:0,label:"否"},{value:1,label:"是"}],readonly:!1},{name:"可用资源",value:"source",type:"cascader",props:{checkStrictly:!0,label:"label",value:"id"},options:[],readonly:!1},{name:"排序",value:"sort",type:"text",options:[],readonly:!1},{name:"税率",value:"tax_rate",type:"text",options:[],readonly:!1}];return this.$menu.getters.judgeRole("Btn-NkxXgoLdf5rKVRT1Ve37D2oS")&&(e.push({name:"是否允许退款",value:"isRefund",type:"select",options:[{value:0,label:"否"},{value:1,label:"是"}],readonly:!1}),e.push({name:"是否生成欠费",value:"isCharge",type:"select",options:[{value:0,label:"否"},{value:1,label:"是"}],readonly:!1})),this.resource.length>0&&(e[8].options=this.resource),e},priorityOptions1(){let e=[this.editForm.priority2,this.editForm.priority3],t=[];return this.prioritys.forEach(i=>{e.includes(i.id)||t.push(i)}),t},priorityOptions2(){let e=[this.editForm.priority1,this.editForm.priority3],t=[];return this.prioritys.forEach(i=>{e.includes(i.id)||t.push(i)}),t},priorityOptions3(){let e=[this.editForm.priority1,this.editForm.priority2],t=[];return this.prioritys.forEach(i=>{e.includes(i.id)||t.push(i)}),t}},watch:{isRegister(e){if(e){let e=document.getElementById("setting");e.classList.add("register")}else{let e=document.getElementById("setting");e.classList.remove("register")}}},mounted(){},methods:{registerPass(e){this.aid=e.aid,this.vid=e.vid,this.isRegister=!0,this.getPatterns(),this.getCarList(),this.getInvoices()},checkChange(e){this.currentSubject.id&&e.id==this.currentSubject.id||(this.currentSubject=e,this.switchVal=1==e.is_setting,this.getSubjectDetail())},getPatterns(){this.$axios.post(this.urlObj.getpatterns).then(e=>{if(200===e.Code)this.patterns=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取收费模式失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},getInvoices(){this.$axios.post(this.urlObj.getinvoices).then(e=>{if(200===e.Code)this.inameOptions=e.Data;else{let t=e.Message?e.Message:"获取沪友开票名称数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},getCarList(){let e={vid:this.vid};this.$axios.post(this.urlObj.carlist,e).then(e=>{if(200===e.Code)this.carOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取车场数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},getSubjectDetail(){this.isLoading=!0;let e={id:this.currentSubject.id,vid:this.vid,is_setting:this.currentSubject.is_setting||0==this.currentSubject.is_setting?this.currentSubject.is_setting:""};this.$axios.post(this.urlObj.subDetail,e).then(e=>{if(200===e.Code){this.subjectDetail=e.Data;let t={pid:"",code:e.Data.code,subName:e.Data.name,price:e.Data.price,alias:e.Data.alias,isend:e.Data.is_end,subType:e.Data.subject_type?e.Data.subject_type:"",isOpen:e.Data.is_open,online:e.Data.is_online,invoice_type:e.Data.is_invoice,source:e.Data.resource_type_id,sort:e.Data.sort,tax_rate:e.Data.tax_rate};this.$menu.getters.judgeRole("Btn-NkxXgoLdf5rKVRT1Ve37D2oS")&&(t.isRefund=e.Data.is_refund,t.isCharge=e.Data.is_refund_create),this.$menu.getters.judgeRole("Btn-QfTIBlCpVq156KuH5PrmKoG6")&&(t.carbind=e.Data.car_park_id),1==e.Data.is_end&&(t.unitVal=e.Data.subjectBillTemplate?e.Data.subjectBillTemplate.unit:"",t.formulaVal=e.Data.subjectBillTemplate?e.Data.subjectBillTemplate.formula:"",t.pattern=e.Data.subjectBillTemplate?e.Data.subjectBillTemplate.patterns:"",e.Data.subjectFeesSort.length>0?(t.priority1=e.Data.subjectFeesSort[0].type,t.priority2=e.Data.subjectFeesSort[1].type,t.priority3=e.Data.subjectFeesSort[2].type):(t.priority1="",t.priority2="",t.priority3=""),t.show=e.Data.is_add_arrears,t.fitSub=e.Data.is_renovation,t.invoiceName=e.Data.invoice_name,t.isrefund=e.Data.is_many_refund,t.isformedit=e.Data.is_edit_template,t.is_custom_time=e.Data.is_custom_time,t.is_choice_before=e.Data.is_choice_before,t.expire_chose_starttime=e.Data.expire_chose_starttime,t.billing_rules=e.Data.billing_rules),this.editForm=t,this.$refs.editForm&&this.$refs.editForm.resetFields()}else{let t=e.Message?e.Message:"科目详情数据获取失败！";this.$message({type:"error",message:t})}this.isLoading=!1}).catch(e=>{this.isLoading=!1})},editSubmit(){this.$refs.editForm.validate(e=>{if(e){this.isSubmit=!0;let e={id:this.subjectDetail.id,vid:this.vid,resource_type_id:this.editForm.source[this.editForm.source.length-1],subject_type:this.editForm.subType,is_invoice:this.editForm.invoice_type,is_online:this.editForm.online,tax_rate:this.editForm.tax_rate,order:this.editForm.sort,name:this.editForm.subName,code:this.editForm.code,alias:this.editForm.alias,is_open:this.editForm.isOpen,is_end:this.editForm.isend,price:this.editForm.price};this.$menu.getters.judgeRole("Btn-NkxXgoLdf5rKVRT1Ve37D2oS")&&(e.is_refund=this.editForm.isRefund,e.is_refund_create=this.editForm.isCharge),this.$menu.getters.judgeRole("Btn-QfTIBlCpVq156KuH5PrmKoG6")&&(e.car_park_id=this.editForm.carbind),e.is_end&&(e.sort=[{id:this.subjectDetail.subjectFeesSort[0]?this.subjectDetail.subjectFeesSort[0].id:"",sort:3,type:this.editForm.priority1},{id:this.subjectDetail.subjectFeesSort[1]?this.subjectDetail.subjectFeesSort[1].id:"",sort:2,type:this.editForm.priority2},{id:this.subjectDetail.subjectFeesSort[2]?this.subjectDetail.subjectFeesSort[2].id:"",sort:1,type:this.editForm.priority3}],e.template={unit:parseInt(this.editForm.unitVal),formula:parseInt(this.editForm.formulaVal),patterns:this.editForm.pattern},e.is_add_arrears=this.editForm.show,e.is_renovation=this.editForm.fitSub,e.invoice_name=this.editForm.invoiceName,e.is_many_refund=this.editForm.isrefund,e.is_edit_template=this.editForm.isformedit,e.is_custom_time=this.editForm.is_custom_time,e.is_choice_before=this.editForm.is_choice_before,e.expire_chose_starttime=this.editForm.expire_chose_starttime,e.billing_rules=this.editForm.billing_rules),this.$axios.post(this.urlObj.uploadCharge,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:"科目修改成功！"});else{let t=e.Message?e.Message:"科目修改失败！";this.$message({type:"error",message:t})}this.isSubmit=!1}).catch(e=>{this.isSubmit=!1})}})},copyDialogInit(){this.copyVillage="",this.copyToVillage="",this.tableSelected=[],this.showCopyPop=!0,this.getVillageData(),this.tableLoad()},getVillageData(){this.$axios.post(this.urlObj.userVillage).then(e=>{if(200===e.Code)this.copyOptions=e.Data;else{let t=e.Message?e.Message:"项目数据获取失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},tableLoad(){this.conf.loadStatus=!0;let e={vid:this.copyVillage};this.$axios.post(this.urlObj.endSubjects,e).then(e=>{200===e.Code?(e.Data&&e.Data.length>0&&e.Data.forEach(e=>{e.for_text=e.subjectBillTemplate?e.subjectBillTemplate.formula_text:""}),this.tableData=e.Data?e.Data:[],this.conf.loadStatus=!1,this.conf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=e.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},selectionChange(e){this.tableSelected=e},copyConfirm(){let e=this.tableSelected.map(e=>e.id);if(this.copyToVillage&&e.length>0){this.isCommit=!0;let t={cover:this.radioVal,vid:this.copyToVillage,from_vid:this.copyVillage,subject_id:e};this.$axios.post(this.urlObj.copySub,t).then(e=>{if(200===e.Code)this.$message({type:"success",message:"收费标准复制成功！"}),this.showCopyPop=!1,this.getSubjectDetail();else{let t=e.Message?e.Message:"收费标准复制失败！";this.$message({type:"error",message:t})}this.isCommit=!1}).catch(e=>{this.$message({type:"error",message:msg}),this.isCommit=!1})}else this.copyToVillage||0!==e.length?this.copyToVillage?0===e.length&&this.$message({type:"warning",message:"请选择要复制的科目"}):this.$message({type:"warning",message:"请选择要复制到哪个项目！"}):this.$message({type:"warning",message:"请选择要复制的科目和复制到哪个项目！"})},addHandle(){this.$refs.addForm&&this.$refs.addForm.resetFields(),this.addForm.sname=this.currentSubject.name,this.isEdit=!1,this.showAddDialog=!0},addSave(){this.$refs.addForm.validate(e=>{if(e){this.isCommit=!0;let e={};e=this.isEdit?{id:this.detailTableData[this.cindex].id,price:this.addForm.price,time:this.addForm.time/1e3}:{subject_id:this.currentSubject.id,price:this.addForm.price,time:this.addForm.time/1e3};let t=this.isEdit?this.urlObj.rateEdit:this.urlObj.addRate;this.$axios.post(t,e).then(e=>{let t=this.isEdit?"编辑费率":"新增费率";if(200===e.Code)this.$message({type:"success",message:t+"成功！"}),this.showAddDialog=!1,this.isEdit?this.detailTableLoad():this.getSubjectDetail();else{let i=e.Message?e.Message:t+"失败！";this.$message({type:"error",message:i})}this.isCommit=!1}).catch(e=>{this.isCommit=!1})}})},detailHandle(){this.showDetailDialog=!0,this.detailTableLoad()},detailTableLoad(){this.detailConf.loadStatus=!0;let e={id:this.currentSubject.id};this.$axios.post(this.urlObj.rateDetail,e).then(e=>{200===e.Code?(e.Data.forEach(e=>{e.sname=this.currentSubject.name,e.cname=e.creater?e.creater.realname:""}),this.detailTableData=e.Data?e.Data:[],this.detailConf.loadStatus=!1,this.detailConf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.detailTableData=[],this.detailConf.emptyText=e.Message,this.detailConf.dataTotal=0,this.detailConf.loadStatus=!1)}).catch(()=>{this.detailTableData=[],this.detailConf.emptyText="服务器连接失败...",this.detailConf.dataTotal=0,this.detailConf.loadStatus=!1})},rateEdit(e){this.cindex=e,this.$refs.addForm&&this.$refs.addForm.resetFields(),this.isEdit=!0,this.addForm.sname=this.currentSubject.name,this.addForm.price=this.detailTableData[e].price,this.addForm.time=new Date(this.detailTableData[e].start_time).getTime(),this.showAddDialog=!0},rateDel(e){this.$confirm("确定要删除当前明细吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$axios.post(this.urlObj.rateDelete,{id:this.detailTableData[e].id}).then(e=>{if(200===e.Code)this.$message({type:"success",message:"记录删除成功！"}),this.detailTableLoad();else{let t=e.Message?e.Message:"记录删除失败！";this.$message({type:"error",message:t})}}).catch(()=>{})}).catch(()=>{})},switchChange(e){let t={id:this.subjectDetail.id,vid:this.vid,is_open:e?1:0,is_setting:this.currentSubject.is_setting};this.$axios.post(this.urlObj.subOpenClose,t).then(t=>{if(200===t.Code)this.$message({type:"success",message:e?"启用成功,请设置科目价格！":"关闭成功！"}),this.$refs.subjectTree.setDefaultChecked(t.Data.nodeid),this.$refs.subjectTree.typeVal=0,this.currentSubject.id=t.Data.id,this.currentSubject.nodeid=t.Data.nodeid,this.currentSubject.is_setting=1,this.$refs.subjectTree.getTreeData(),this.getSubjectDetail();else{let i=t.Message?t.Message:e?"启用失败！":"关闭失败！";this.$message({type:"error",message:i}),this.switchVal=!e}}).catch(t=>{this.switchVal=!e})},logHandle(){this.showLogDialog=!0,this.logTableLoad()},logTableLoad(){this.logConf.loadStatus=!0;let e={id:this.subjectDetail.id,vid:this.vid,page:this.logConf.curPage,limit:this.logConf.limit};this.$axios.post(this.urlObj.chargeLog,e).then(e=>{200===e.Code?(e.Data.data&&e.Data.data.length>0&&e.Data.data.forEach(e=>{e.cname=e.createuser.realname}),this.logConf.dataTotal=e.Data.total,this.logTableData=e.Data.data,this.logConf.loadStatus=!1,this.logConf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.logTableData=[],this.logConf.emptyText=e.Message,this.logConf.dataTotal=0,this.logConf.loadStatus=!1)}).catch(()=>{this.logTableData=[],this.logConf.emptyText="服务器连接失败...",this.logConf.dataTotal=0,this.logConf.loadStatus=!1})},logSizeChange(e){this.logConf.limit=e,this.logTableLoad()},logCurrentChange(e){this.logConf.curPage=e,this.logTableLoad()}}},h=u,p=(i("3838"),i("1805")),m=Object(p["a"])(h,a,s,!1,null,null,null);t["default"]=m.exports},3838:function(e,t,i){"use strict";i("7bb8")},"40a5":function(e,t,i){"use strict";i("e90e")},"423f":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"内容","prop":"content","show":true},{"label":"操作人","prop":"cname","show":true},{"label":"操作时间","prop":"create_time","show":true}]}')},"58ea":function(e,t,i){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"subject-tree"}},[t("div",{staticClass:"search-wrap"},[e.showSearch?t("el-input",{staticClass:"search",attrs:{placeholder:"请输入关键字搜索","suffix-icon":"iconfont iconzu3664"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}):t("div",{staticClass:"title"},[t("span",[e._v("科目列表")]),t("el-select",{on:{change:e.typeChange},model:{value:e.typeVal,callback:function(t){e.typeVal=t},expression:"typeVal"}},e._l(e.typeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-scrollbar",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],staticStyle:{height:"calc(100% - 4.05rem)"}},[t("div",{staticClass:"tree-wrap"},[t("el-tree",{ref:"subTree",staticClass:"filter-tree",attrs:{data:e.treeData,props:e.defaultProps,"node-key":e.treeType?"nodeid":"id",accordion:"","filter-node-method":e.filterNode,"show-checkbox":"","check-strictly":"","default-expanded-keys":e.defaultShowNodes,"default-checked-keys":e.defaultChecked},on:{"node-expand":e.handleNodeExpand,"node-collapse":e.handleNodeCollapse,"node-click":e.nodeClick,check:e.nodeCheck},scopedSlots:e._u([{key:"default",fn:function({node:i,data:a}){return t("span",{staticClass:"custom-tree-node"},[t("span",[e._v(e._s(i.label))]),"charge"==e.treeType&&!e.showSearch&&a.is_setting&&1==a.is_setting?t("span",{staticClass:"status",staticStyle:{color:"#3ebb75"}},[e._v(" 已设置 ")]):e._e(),"charge"!=e.treeType||e.showSearch||0!=a.is_setting?e._e():t("span",{staticClass:"status",staticStyle:{color:"#ccc"}},[e._v(" 未设置 ")])])}}])})],1)])],1)},s=[],l=(i("5948"),{name:"SubjectTree",props:{showSearch:{type:Boolean,default:!1},treeType:{type:String,default:""},vid:{type:[Number,String],default:0}},data(){return{urlObj:{treeData:this.$api.state.Setting.treeData.url,chargeTree:this.$api.state.Setting.chargeTree.url},treeLoading:!1,filterText:"",treeData:[],defaultProps:{children:"children",label:"name",isLeaf:"isLeaf"},typeVal:0,typeOptions:[{label:"全部科目",value:0},{label:"已设置",value:1},{label:"未设置",value:2}],defaultShowNodes:[],defaultChecked:[]}},watch:{filterText(e){this.$refs.subTree.filter(e)}},created(){this.getTreeData()},methods:{getTreeData(){this.treeLoading=!0;let e=this.urlObj.treeData,t={};"charge"==this.treeType?(e=this.urlObj.chargeTree,t.vid=this.vid):"relevance"==this.treeType&&(e=this.urlObj.chargeTree,t.vid=this.vid,t.charging_correlation=!0),this.$axios.post(e,t).then(e=>{if(200===e.Code)this.treeData=e.Data,this.$emit("setData",e.Data);else{let t=e.Message?e.Message:"数据获取失败！";this.$message({type:"error",message:t})}this.treeLoading=!1}).catch(e=>{this.$message({type:"error",message:"执行失败！"}),this.treeLoading=!1})},filterNode(e,t){return!e||("charge"!=this.treeType||this.showSearch?-1!==t.name.indexOf(e):1==e?1==t.is_setting:2!=e||0==t.is_setting)},nodeClick(e){this.$nextTick(()=>{e.disabled||(this.$refs.subTree.setCheckedNodes([e]),this.$emit("checkChange",e))})},nodeCheck(e){e.disabled||(this.$refs.subTree.setCheckedNodes([e]),this.$emit("checkChange",e))},typeChange(e){this.$refs.subTree.filter(e)},handleNodeExpand(e){let t="";t=this.treeType?e.nodeid:e.id;let i=this.defaultShowNodes.findIndex(e=>e==t);-1===i&&this.defaultShowNodes.push(t)},handleNodeCollapse(e){let t="";t=this.treeType?e.nodeid:e.id;let i=this.defaultShowNodes.findIndex(e=>e==t);this.defaultShowNodes.splice(i,1)},setDefaultChecked(e){this.defaultChecked=[e]}}}),r=l,o=(i("87a6"),i("1805")),n=Object(o["a"])(r,a,s,!1,null,null,null);t["a"]=n.exports},"7bb8":function(e,t,i){},"87a6":function(e,t,i){"use strict";i("20af")},"897c":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAA6tJREFUWEfNWU1uIlcQ/orunm18g+ATxLOLokBACmyHOUHsE5iR6Ci7eHajAcn4BGZOYGbbRDIy0Si7IScwOUFga9r+ovegGX66m/eajjVsu6reV1XvVX1VCDL+fgj8E1f4ipATIYoQnGyYIsYUTAQch5SPn+rtcZajxEbp+9vfil4YngulAUHRRhfEhML+3HWv/qq+m5jqGgGs3DaPHufepQhOTQ2nyZHoOd78zbDane6ztxdg6Y9fG8Kna0CO9hmz+84ppXA2+vl9P00vFWAp8K/ziloSCBXNUb19lvQ9FqBOaehdC9Cwi0o2aQJ9x52fxaU8FmBp4N88F7jIJQVyVGu/3nZxB+BzpDUxzsTVXb3dXP++AXDxIHiTLVH5aFHk9frDWQFU9+4pdO/zf622wDktuOFxdB9XAEtBqyciv9ia+z/kSX4Y1Tu65mqAqkO8CB/vDQ+bAewSOBHIKwMdW3lt8sF1jlXH0QDLgd+F4NzgMAB8e1frXChZg6jPQqIS9eHyoPWv8RVaPpgI4L1pbyU4HNU61ciZFJAb4BbkAp/NgqDigMldvX0s1opKd6v6x4CMAcdb4+gtvQiJl1IetC4A+d3Ys6XgDshBqymQSwC5gFPHEHwjpUGrb3jZd33YKqwqG0+eM12nU+XAN74+2wcQ/CjlwP+8QzYTwknybxGs2MeD6/b2cbslG1qQWcqR+WPUIRxLeeDTNL1PYPXPWmdoKh8nZ1cxACuA6k6Map1uVoALluTeCKRiasMKYEqTnzx4TjVKdynwT0V4aftq4+znA3D54qLolgJ/KIKfTKOUJieloDUWke8Mjc1IxExnnDhe2Iwa/I+DVkUoutts/nhkcRb0o7QpM9tUyNCpDTGr83SZsSjUuQC0YE26UNu1Ok6J3RQLMCy44VWUYmXTAc4h3JidZVEHNwf8lDToVqdZyaA1Eci3WVIW6ayXIJvin3QmwX9GtU4xA91KNLmiYTbFP6V06fkkC2FNaoS5AtwgrDrNFpc3HuEXIntwBNdIyNbQ5KmlzjfZ7iKnEDbJQuPAmXpWcOfFnaFJR/FrHjujqB2e6mzx11r7BvcVyENIbEZ8ipyOap2dXVDK8sjtZWbaliAVOMcNT42XR8+a7pi0rvtnuMBkL/vrTgznjCKnBy0wI9OLFbDbzW01QlwVvPlFLivgdf/1imT+2KSwYdu7VW8VSv/Bc7r7Bi2rFCclSDMWoZotKiCK20RUkU0IVOEfPlKGWf+G+A/Hgu+F6WilFAAAAABJRU5ErkJggg=="},"8eaa":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"科目名称","prop":"name","show":true},{"label":"单价","prop":"price","show":true,"color":"#ffcb3c"},{"label":"计费公式","prop":"for_text","show":true,"color":"#999"},{"label":"描述公式","prop":"desc","show":true,"color":"#999"}]}')},b48e:function(e,t,i){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],attrs:{id:"area-village-select","element-loading-text":"数据加载中，请稍等"}},[t("div",{staticClass:"select-content"},[t("div",{staticClass:"title"},[e._v(e._s(e.title))]),t("div",{staticClass:"select-item"},[t("div",{staticClass:"name"},[e._v("选择大区")]),t("el-select",{attrs:{clearable:"",placeholder:"请选择大区"},on:{change:e.areaChange},model:{value:e.areaValue,callback:function(t){e.areaValue=t},expression:"areaValue"}},e._l(e.areaOptions,(function(e){return t("el-option",{key:e.deptid,attrs:{label:e.deptname,value:e.deptid}})})),1)],1),t("div",{staticClass:"select-item"},[t("div",{staticClass:"name"},[e._v("选择项目")]),t("el-select",{attrs:{clearable:"",multiple:e.multiple,placeholder:"请选择项目","no-data-text":e.villageLoading?"加载中...":"无数据"},model:{value:e.villageValue,callback:function(t){e.villageValue=t},expression:"villageValue"}},e._l(e.villageOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("div",{staticClass:"btn-wp"},[t("el-button",{attrs:{type:"primary",round:""},on:{click:e.registerStart}},[e._v(" "+e._s(e.btnName)+" ")])],1)])])},s=[],l={name:"AreaVillageSelect",props:{title:{type:String,default:""},btnName:{type:String,default:"开始登记"},multiple:{type:Boolean,default:!1}},data(){return{urlObj:{bigarea:this.$api.state.Public.bigarea.url,village:this.$api.state.Public.village.url},isRegister:!1,areaValue:"",areaOptions:[],villageLoading:!1,villageValue:this.multiple?[]:"",villageOptions:[],isLoading:!1}},created(){this.isLoading=!0,this.getAreaData()},methods:{getAreaData(){this.$axios.post(this.urlObj.bigarea,{vill_limit:!0}).then(e=>{if(200===e.Code){let t=sessionStorage.getItem("bid");t?(this.areaValue=Number(t),this.getVillageData(!0)):this.isLoading=!1,this.areaOptions=e.Data}else this.$message({type:"error",message:"大区数据获取失败！"}),this.isLoading=!1}).catch(e=>{this.$message({type:"error",message:"大区数据获取失败！"}),this.isLoading=!1})},areaChange(){this.villageOptions=[],this.villageValue=this.multiple?[]:"",this.areaValue&&this.getVillageData()},getVillageData(e){this.villageLoading=!0,this.$axios.post(this.urlObj.village,{id:this.areaValue}).then(t=>{if(200===t.Code){if(e){let e=sessionStorage.getItem("vid");e&&(this.villageValue=this.multiple?[Number(e)]:Number(e))}this.villageOptions=t.Data}else this.$message({type:"error",message:"项目数据获取失败！"});this.villageLoading=!1,this.isLoading=!1}).catch(e=>{this.$message({type:"error",message:"项目数据获取失败！"}),this.villageLoading=!1,this.isLoading=!1})},registerStart(){let e="",t=this.multiple?this.villageValue.length>0:this.villageValue;if(this.areaValue||t)if(this.areaValue){if(t){let e={aid:this.areaValue,vid:this.villageValue};return void this.$emit("registerPass",e)}e="请选择项目！"}else e="请选择大区！";else e="请选择大区和项目！";this.$message({type:"warning",message:e})}}},r=l,o=(i("40a5"),i("1805")),n=Object(o["a"])(r,a,s,!1,null,null,null);t["a"]=n.exports},c414:function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"科目名称","prop":"sname","show":true,"color":"#999"},{"label":"生效时间","prop":"start_time","show":true},{"label":"结束时间","prop":"end_time","show":true},{"label":"创建时间","prop":"create_time","show":true,"color":"#999"},{"label":"价格","prop":"price","show":true,"color":"#69da61"},{"label":"操作人","prop":"cname","show":true,"color":"#ffcb3c"},{"label":"操作","prop":"","width":200,"type":"button","show":true,"btns":[{"name":"编辑","type":"primary","size":"small","round":true,"action":"edit","role":"edit","token":"empty"},{"name":"删除","type":"danger","size":"small","round":true,"action":"ratedel","role":"ratedel","token":"empty"}]}]}')},e90e:function(e,t,i){}}]);