(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5aa20d64"],{"0a6a":function(e,t,s){"use strict";s("4f24")},"4f24":function(e,t,s){},a08c:function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"小区ID","prop":"vid","width":100,"show":true},{"label":"大区","prop":"bigareaname","width":150,"show":true},{"label":"城市","prop":"cname","width":120,"show":true},{"label":"项目","prop":"villagename","width":150,"show":true},{"label":"税率","prop":"sl","width":100,"type":"number","action":"setVal","role":"edit","show":true},{"label":"开票类型","prop":"receipt_type_text","width":150,"show":true},{"label":"微信缴费","prop":"is_wechat_pay","width":120,"type":"checkbox","action":"setVal","role":"edit","show":true,"token":"empty"},{"label":"支付宝缴费","prop":"is_alipay","width":120,"type":"checkbox","action":"setVal","role":"edit","show":true,"token":"empty"},{"label":"开具发票","prop":"billstatus","width":120,"type":"checkbox","action":"setVal","role":"edit","show":true,"token":"empty"},{"label":"催费单","prop":"is_print_reminder","width":120,"type":"checkbox","action":"setVal","role":"edit","show":true,"token":"empty"},{"label":"催收短信","prop":"is_send_msg","width":120,"type":"checkbox","action":"setVal","role":"edit","show":true,"token":"empty"},{"label":"月租车位按自然月","prop":"pay_car_by_day","width":160,"type":"checkbox","action":"setVal","role":"edit","show":true,"token":"empty"},{"label":"项目经理","prop":"project_manager_name","width":100,"show":true},{"label":"客服经理","prop":"customer_manager_name","width":100,"show":true},{"label":"操作","prop":"","width":200,"type":"button","show":true,"btns":[{"name":"编辑","type":"primary","size":"small","round":true,"class":"sys-btn","action":"edit","role":"edit","token":"Btn-odDQ2FrfP5ah81LRPVN64jVi"},{"name":"续费二维码","type":"success","size":"small","round":true,"class":"sys-btn","action":"showQrcode","role":"showQrcode","token":"empty"}]}]}')},f97d:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-container",{attrs:{id:"system"}},[t("el-header",{staticClass:"top"},[t("div",{staticClass:"title"},[e._v("项目列表")]),t("div",{staticClass:"main"},[t("div",{staticClass:"common-left"},[t("span",{staticClass:"common-chose-info",on:{click:function(t){return e.$refs.showFilterVillage.showDialog()}}},[t("workIcon",{attrs:{name:"build"}}),e._v(" "+e._s(e.choseVillageInfo.name)+" "),e.choseVillageInfo.vid?t("i",{staticClass:"close el-icon-circle-close",on:{click:function(t){t.stopPropagation(),e.choseVillageInfo={name:"全部项目",vid:0}}}}):e._e()],1),t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"请输入项目名称"},domProps:{value:e.searchVal},on:{input:function(t){t.target.composing||(e.searchVal=t.target.value)}}}),t("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.keySearch(!0)}}},[e._v(" 查询 ")])],1),t("div",{staticClass:"common-right"},[e.$menu.getters.judgeRole("Btn-M8WrMI0dq0qhx72WW6IoPJYT")?t("el-button",{staticClass:"common-button",attrs:{type:"primary",plain:"",icon:"iconfont iconxinzeng"},on:{click:function(t){return e.$refs.showAddVillage.showDialog()}}},[e._v(" 新增项目 ")]):e._e(),e.$menu.getters.judgeRole("Btn-HNLr4v3QqsAQnJQJCXoR4wWY")||e.$menu.getters.judgeRole("Btn-atagY0s83JNSgiQq8Mseujzf")?t("span",{on:{click:e.importData}},[t("workIcon",{staticClass:"common-right-icon",attrs:{name:"import",title:"导入数据"}})],1):e._e(),e.$menu.getters.judgeRole("Btn-6Y9LM5wV9Vlje4Swz1e4wcov")?t("span",{on:{click:function(t){return e.tempDownload("house")}}},[t("workIcon",{staticClass:"common-right-icon",attrs:{name:"download",title:"下载房源模板"}})],1):e._e(),e.$menu.getters.judgeRole("Btn-8v8xHXu3bhyXtZ6Yq4Npplfz")?t("span",{on:{click:function(t){return e.tempDownload("car")}}},[t("workIcon",{staticClass:"common-right-icon",attrs:{name:"download",title:"下载车位模板"}})],1):e._e(),t("el-dropdown",{attrs:{trigger:"click","hide-on-click":!1}},[t("workIcon",{staticClass:"common-right-icon",attrs:{name:"filtr",title:"筛选"}}),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.columns,(function(s,a){return t("el-dropdown-item",{key:a},[t("el-checkbox",{on:{change:e.checkChange},model:{value:s.show,callback:function(t){e.$set(s,"show",t)},expression:"v.show"}},[e._v(" "+e._s(s.label)+" ")])],1)})),1)],1),t("span",{on:{click:function(t){return e.$refs.cusTable.exportExcel()}}},[t("workIcon",{staticClass:"common-right-icon",attrs:{name:"export",title:"导出"}})],1),t("span",{directives:[{name:"print",rawName:"v-print",value:{id:"#tablePrint",popTitle:"项目设置列表"},expression:"{ id: '#tablePrint', popTitle: '项目设置列表' }"}],staticClass:"print",on:{click:e.printHandle}},[t("workIcon",{staticClass:"common-right-icon",attrs:{name:"print",title:"打印"}})],1)],1)])]),t("el-main",{staticClass:"body"},[t("div",{staticClass:"content"},[t("cus-table",{ref:"cusTable",attrs:{title:"项目配置信息",datas:e.tableData,cusColums:e.columns,cusConf:e.conf,ispaging:!0,check:!1},on:{sizeChange:e.tablePageSize,currentChange:e.tableChosePage,setVal:e.tableSetVal,edit:e.clickEditCol,showQrcode:e.showQrcode}})],1)]),t("div",{staticClass:"dialog-page"},[t("filter-village",{ref:"showFilterVillage",attrs:{vid:e.choseVillageInfo.vid},on:{choseInfo:e.filterVillage}}),t("addVillage",{ref:"showAddVillage",on:{addSuc:e.tableLoad}}),t("editVillage",{ref:"showEditVillage",attrs:{qiniuDatas:e.qiniuDatas},on:{editSuc:e.tableLoad}}),t("el-dialog",{staticClass:"qrcodeDialog",attrs:{visible:e.showQrcodeDialog,title:"机动车续费二维码",width:"30%","close-on-click-modal":!0},on:{"update:visible":function(t){e.showQrcodeDialog=t}}},[e.showQrcodeDialog&&e.qrSrc?t("div",{attrs:{id:"qrcode"}},[t("img",{attrs:{src:e.qrSrc,alt:""}})]):t("div",{staticStyle:{color:"#ccc","margin-top":"2.5rem"}},[e._v(" 正在生成二维码，请稍等 ")]),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",round:""},on:{click:e.saveImage}},[e._v(" 保存图片 ")]),t("el-button",{attrs:{type:"info",round:""},on:{click:function(t){e.showQrcodeDialog=!1}}},[e._v(" 取消 ")])],1)])],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showPrint,expression:"showPrint"}],attrs:{id:"tablePrint"}},[t("table",[t("thead",{staticStyle:{display:"table-header-group","font-weight":"bold"}},[t("tr",[t("th",[e._v("小区ID")]),t("th",[e._v("大区")]),t("th",[e._v("城市")]),t("th",[e._v("项目")]),t("th",[e._v("税率")]),t("th",[e._v("微信缴费")]),t("th",[e._v("支付宝缴费")]),t("th",[e._v("开具收据")]),t("th",[e._v("开具发票")]),t("th",[e._v("催费单")]),t("th",[e._v("催收短信")]),t("th",[e._v("月租车位按自然月")]),t("th",[e._v("项目经理")]),t("th",[e._v("客户经理")])])]),t("tbody",e._l(e.tableData,(function(s,a){return t("tr",{key:a},[t("td",[e._v(e._s(s.vid))]),t("td",[e._v(e._s(s.bigareaname))]),t("td",[e._v(e._s(s.cname))]),t("td",[e._v(e._s(s.villagename))]),t("td",[e._v(e._s(s.sl))]),t("td",[e._v(e._s(1===s.is_wechat_pay?"开":"关"))]),t("td",[e._v(e._s(1===s.is_alipay?"开":"关"))]),t("td",[e._v(e._s(1===s.is_print_receipts?"开":"关"))]),t("td",[e._v(e._s(1===s.billstatus?"开":"关"))]),t("td",[e._v(e._s(1===s.is_print_reminder?"开":"关"))]),t("td",[e._v(e._s(1===s.is_send_msg?"开":"关"))]),t("td",[e._v(e._s(1===s.pay_car_by_day?"开":"关"))]),t("td",[e._v(e._s(s.project_manager_name))]),t("td",[e._v(e._s(s.customer_manager_name))])])})),0)]),e.tableData.length?e._e():t("div",{staticClass:"table-empty"},[t("span",[e._v("暂无数据!")])])]),t("el-dialog",{staticClass:"importDialog",attrs:{visible:e.showImportDialog,title:"导入数据",width:"36%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showImportDialog=t},close:function(t){e.showImportDialog=!1}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"所属大区",prop:"areaVal"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择所属大区"},on:{change:e.getCompanyData},model:{value:e.ruleForm.areaVal,callback:function(t){e.$set(e.ruleForm,"areaVal",t)},expression:"ruleForm.areaVal"}},e._l(e.areaOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"所属公司",prop:"companyVal"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择所属公司"},on:{change:e.getVillageData},model:{value:e.ruleForm.companyVal,callback:function(t){e.$set(e.ruleForm,"companyVal",t)},expression:"ruleForm.companyVal"}},e._l(e.companyOptions,(function(e){return t("el-option",{key:e.deptid,attrs:{label:e.deptname,value:e.deptid}})})),1)],1),t("el-form-item",{attrs:{label:"所属项目",prop:"village"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择所属项目"},model:{value:e.ruleForm.village,callback:function(t){e.$set(e.ruleForm,"village",t)},expression:"ruleForm.village"}},e._l(e.villOptions,(function(e){return t("el-option",{key:e.vid,attrs:{label:e.villagename,value:e.vid}})})),1)],1),t("el-form-item",{attrs:{label:"导入类型",prop:"type"}},[t("el-select",{attrs:{placeholder:"请选择导入类型"},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},[e.$menu.getters.judgeRole("Btn-HNLr4v3QqsAQnJQJCXoR4wWY")?t("el-option",{attrs:{label:"房源导入",value:1}}):e._e(),e.$menu.getters.judgeRole("Btn-atagY0s83JNSgiQq8Mseujzf")?t("el-option",{attrs:{label:"车位导入",value:2}}):e._e()],1)],1),t("el-form-item",{staticClass:"file",attrs:{label:"上传文件",prop:"fileInfo"}},[t("el-upload",{ref:"upload",attrs:{limit:1,action:"/village/importroomsbyexcel",accept:".xlsx","http-request":e.customUpload,"on-remove":e.handleRemove}},[t("el-button",{attrs:{type:"primary empty"}},[e._v(" 点击上传 ")])],1)],1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.importSubmit}},[e._v(" 提交保存 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showImportDialog=!1}}},[e._v(" 取消 ")])],1)],1)],1)},o=[],i=(s("5948"),s("4698")),r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"addVillage"}},[t("el-dialog",{staticClass:"dialog-addvillage",attrs:{title:"新增项目",visible:e.conf.show,"close-on-click-modal":!1,width:"50%"},on:{"update:visible":function(t){return e.$set(e.conf,"show",t)}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("el-form",{ref:"addForm",attrs:{model:e.form,rules:e.rules}},[t("el-row",[t("el-col",{attrs:{span:6,offset:1}},[t("el-form-item",{attrs:{prop:"area"}},[t("span",{staticClass:"form-title"},[e._v("所属大区")]),t("el-select",{attrs:{placeholder:"请选择所属大区",filterable:!0,loading:e.bigarea.isLoading},on:{"visible-change":e.getBgDatas,change:e.chBgSelect},model:{value:e.form.area,callback:function(t){e.$set(e.form,"area",t)},expression:"form.area"}},e._l(e.bigarea.datas,(function(e,s){return t("el-option",{key:s,attrs:{label:e.deptname,value:e.deptid}})})),1)],1)],1),t("el-col",{attrs:{span:6,offset:2}},[t("el-form-item",{attrs:{prop:"did"}},[t("span",{staticClass:"form-title"},[e._v("所属公司")]),t("el-select",{attrs:{placeholder:"请选择所属公司",filterable:!0,loading:e.company.isLoading},on:{"visible-change":e.getComDatas},model:{value:e.form.did,callback:function(t){e.$set(e.form,"did",t)},expression:"form.did"}},e._l(e.company.datas,(function(e,s){return t("el-option",{key:s,attrs:{label:e.deptname,value:e.deptid}})})),1)],1)],1),t("el-col",{attrs:{span:6,offset:2}},[t("el-form-item",{attrs:{prop:"villagename"}},[t("span",{staticClass:"form-title"},[e._v("项目名称")]),t("el-input",{attrs:{placeholder:"请输入项目名称"},model:{value:e.form.villagename,callback:function(t){e.$set(e.form,"villagename",t)},expression:"form.villagename"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:6,offset:1}},[t("el-form-item",{attrs:{prop:"villageaddr"}},[t("span",{staticClass:"form-title"},[e._v("楼盘地址")]),t("el-input",{attrs:{placeholder:"请输入楼盘地址"},model:{value:e.form.villageaddr,callback:function(t){e.$set(e.form,"villageaddr",t)},expression:"form.villageaddr"}})],1)],1),t("el-col",{attrs:{span:6,offset:2}},[t("el-form-item",{attrs:{prop:"allacreage"}},[t("span",{staticClass:"form-title"},[e._v("占地总面积(m²)")]),t("el-input",{attrs:{placeholder:"请输入占地总面积"},model:{value:e.form.allacreage,callback:function(t){e.$set(e.form,"allacreage",t)},expression:"form.allacreage"}})],1)],1),t("el-col",{attrs:{span:6,offset:2}},[t("el-form-item",{attrs:{prop:"buildacreage"}},[t("span",{staticClass:"form-title"},[e._v("总建筑面积(m²)")]),t("el-input",{attrs:{placeholder:"请输入总建筑面积"},model:{value:e.form.buildacreage,callback:function(t){e.$set(e.form,"buildacreage",t)},expression:"form.buildacreage"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:6,offset:1}},[t("el-form-item",{attrs:{prop:"parkingnum"}},[t("span",{staticClass:"form-title"},[e._v("车位数量")]),t("el-input",{attrs:{placeholder:"请输入车位数量"},model:{value:e.form.parkingnum,callback:function(t){e.$set(e.form,"parkingnum",t)},expression:"form.parkingnum"}})],1)],1),t("el-col",{attrs:{span:6,offset:2}},[t("el-form-item",{attrs:{prop:"useacreage"}},[t("span",{staticClass:"form-title"},[e._v("总使用面积(m²)")]),t("el-input",{attrs:{placeholder:"请输入总使用面积"},model:{value:e.form.useacreage,callback:function(t){e.$set(e.form,"useacreage",t)},expression:"form.useacreage"}})],1)],1),t("el-col",{attrs:{span:6,offset:2}},[t("el-form-item",{attrs:{prop:"far"}},[t("span",{staticClass:"form-title"},[e._v("容积率(%)")]),t("el-input",{attrs:{placeholder:"请输入容积率"},model:{value:e.form.far,callback:function(t){e.$set(e.form,"far",t)},expression:"form.far"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:6,offset:1}},[t("el-form-item",{attrs:{prop:"greenrate"}},[t("span",{staticClass:"form-title"},[e._v("绿化率(%)")]),t("el-input",{attrs:{placeholder:"请输入绿化率"},model:{value:e.form.greenrate,callback:function(t){e.$set(e.form,"greenrate",t)},expression:"form.greenrate"}})],1)],1),t("el-col",{attrs:{span:6,offset:2}},[t("el-form-item",{attrs:{prop:"publicareas"}},[t("span",{staticClass:"form-title"},[e._v("公共场所面积(m²)")]),t("el-input",{attrs:{placeholder:"请输入公共场所面积"},model:{value:e.form.publicareas,callback:function(t){e.$set(e.form,"publicareas",t)},expression:"form.publicareas"}})],1)],1),t("el-col",{attrs:{span:6,offset:2}},[t("el-form-item",{attrs:{prop:"house_num"}},[t("span",{staticClass:"form-title"},[e._v("房屋数量(套)")]),t("el-input",{attrs:{placeholder:"请输入房屋数量"},model:{value:e.form.house_num,callback:function(t){e.$set(e.form,"house_num",t)},expression:"form.house_num"}})],1)],1)],1),t("el-row",{staticStyle:{"font-size":"14px","font-weight":"700"}},[t("el-col",{attrs:{span:6,offset:1}},[e._v(" 月租车类型设置 ")])],1),e._l(e.form.car_num,(function(s,a){return t("el-row",{key:a},[t("el-col",{attrs:{span:6,offset:1}},[t("el-form-item",{attrs:{prop:"car_num."+a+".resources_type_id",rules:e.rules.resources_type_id}},[t("span",{staticClass:"form-title"},[e._v("车位类型")]),t("el-select",{attrs:{placeholder:"请选择车位类型",clearable:""},model:{value:s.resources_type_id,callback:function(t){e.$set(s,"resources_type_id",t)},expression:"item.resources_type_id"}},e._l(e.rtypeOptions,(function(e,s){return t("el-option",{key:s,attrs:{label:e.name,value:e.id}})})),1)],1)],1),t("el-col",{attrs:{span:6,offset:2}},[t("el-form-item",{attrs:{prop:"car_num."+a+".num",rules:e.rules.num}},[t("span",{staticClass:"form-title"},[e._v("月租车位数")]),t("el-input",{attrs:{type:"number",placeholder:"请输入月租车位数"},model:{value:s.num,callback:function(t){e.$set(s,"num",t)},expression:"item.num"}})],1)],1),t("el-col",{attrs:{span:6,offset:2}},[t("el-form-item",[t("span",{staticClass:"form-title",staticStyle:{display:"inline-block",width:"100%",height:"0.8rem"}}),a==e.form.car_num.length-1?t("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary empty",plain:""},on:{click:e.addCar}},[e._v(" 继续添加 ")]):t("el-button",{staticStyle:{width:"100%"},attrs:{type:"warning empty",plain:""},on:{click:function(t){return e.delCar(a)}}},[e._v(" 删除 ")])],1)],1)],1)}))],2)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.conf.isSubmitLoading,type:"primary",round:""},on:{click:e.onSubmit}},[e._v(" "+e._s(!0===e.conf.isSubmitLoading?"保存中，请稍等...":"提交保存")+" ")]),t("el-button",{attrs:{type:"info",round:""},on:{click:function(t){e.conf.show=!1}}},[e._v(" 取消 ")])],1)],1)],1)},l=[],n={name:"addVillage",data(){return{form:{area:"",did:"",villagename:"",villageaddr:"",allacreage:"",buildacreage:"",parkingnum:"",useacreage:"",far:"",greenrate:"",publicareas:"",house_num:"",token:this.$api.state.System.village.add.token,car_num:[{resources_type_id:"",num:""}]},bigarea:{datas:[],isLoading:!1},company:{datas:[],isLoading:!1},rules:{area:[{required:!0,message:"请选择所属大区",trigger:"blur"}],did:[{required:!0,message:"请选择所属公司",trigger:"blur"}],villagename:[{required:!0,message:"请输入项目名称",trigger:"blur"}],villageaddr:[{required:!0,message:"请输入楼盘地址",trigger:"blur"}],allacreage:[{required:!0,message:"请输入占地总面积",trigger:"blur"}],buildacreage:[{required:!0,message:"请输入总建筑面积",trigger:"blur"}],parkingnum:[{required:!0,message:"请输入车位数量",trigger:"blur"}],useacreage:[{required:!0,message:"请输入总使用面积",trigger:"blur"}],far:[{required:!0,message:"请输入容积率",trigger:"blur"}],greenrate:[{required:!0,message:"请输入绿化率",trigger:"blur"}],publicareas:[{required:!0,message:"请输入公共场所面积",trigger:"blur"}],house_num:[{required:!0,message:"请输入房屋数量",trigger:"blur"}],resources_type_id:[{required:!1,message:"请选择车位类型",trigger:"change"}],num:[{required:!1,message:"请输入月租车位数量",trigger:"blur"}]},conf:{show:!1,isSubmitLoading:!1},rtypeOptions:[]}},methods:{showDialog(){this.$refs.addForm&&this.$refs.addForm.resetFields(),this.conf.show=!0,this.getResourceTypes()},getBgDatas(e){let t=this;!0===e&&t.bigarea.datas.length<=0&&!1===t.bigarea.isLoading&&(t.bigarea.isLoading=!0,t.$axios({url:t.$api.state.Public.bigarea.url,method:"post",responseType:"json"}).then(e=>{200===e.Code?(t.bigarea.datas=e.Data,t.bigarea.isLoading=!1):204===e.Code?(t.$message({message:e.Message,type:"error",offset:150}),t.$router.push({path:t.$common.state.loginPath})):(t.$message({message:e.Message,type:"error",offset:150}),t.bigarea.isLoading=!1)}).catch(()=>{t.$message({message:"服务器连接失败",type:"error",offset:150}),t.bigarea.isLoading=!1}))},chBgSelect(e){this.form.did="",this.company.datas=[],this.company.isLoading=!1},getComDatas(e){let t=this;!0===e&&parseInt(t.form.area)>0&&t.company.datas.length<=0&&!1===t.company.isLoading&&(t.company.isLoading=!0,t.$axios({url:t.$api.state.Public.company.url,method:"post",responseType:"json",data:{bgid:t.form.area}}).then(e=>{200===e.Code?(t.company.datas=e.Data,t.company.isLoading=!1):204===e.Code?(t.$message({message:e.Message,type:"error",offset:150}),t.$router.push({path:t.$common.state.loginPath})):(t.$message({message:e.Message,type:"error",offset:150}),t.company.isLoading=!1)}).catch(()=>{t.$message({message:"服务器连接失败",type:"error",offset:150}),t.company.isLoading=!1}))},getResourceTypes(){this.$axios.post(this.$api.state.Means.carType.url,{type:"carmonth"}).then(e=>{if(200===e.Code)this.rtypeOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取月租车位类型数据失败！";this.$message({type:"error",massage:t})}}).catch(()=>{})},addCar(){this.form.car_num.push({resources_type_id:"",num:""})},delCar(e){this.form.car_num.splice(e,1)},onSubmit(){let e=this;e.$refs.addForm.validate(t=>{if(!1===t)return!1;e.conf.isSubmitLoading=!0,e.$axios({url:e.$api.state.System.village.add.url,method:"post",responseType:"json",data:e.form}).then(t=>{200===t.Code?(e.$refs["addForm"].resetFields(),e.company.datas=[],e.conf.isSubmitLoading=!1,e.conf.show=!1,e.$message({message:t.Message,type:"success",offset:150}),e.$emit("addSuc",!0)):204===t.Code?(e.$message({message:t.Message,type:"error",offset:150}),e.$router.push({path:e.$common.state.loginPath})):(e.conf.isSubmitLoading=!1,e.$message({message:t.Message,type:"error",offset:150}))}).catch(()=>{e.conf.isSubmitLoading=!1,e.$message({message:"服务器连接失败",type:"error",offset:150})})})}}},c=n,m=s("1805"),d=Object(m["a"])(c,r,l,!1,null,null,null),p=d.exports,u=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"editVillage"}},[t("el-dialog",{staticClass:"dialog-editvillage",attrs:{title:e.baseInfo.villagename+"-人员设置",visible:e.conf.show,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(t){return e.$set(e.conf,"show",t)},close:e.closeDialog}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("el-form",{ref:"editForm",attrs:{model:e.form,rules:e.rules}},[t("el-row",[t("el-col",{attrs:{span:11}},[t("el-form-item",{attrs:{prop:"pro_uid"}},[t("span",{staticClass:"form-title"},[e._v("项目负责人")]),t("el-select",{attrs:{placeholder:"请输入姓名、手机号",filterable:"",remote:"","remote-method":e.inputProUser,loading:e.proUser.isLoading},model:{value:e.form.pro_uid,callback:function(t){e.$set(e.form,"pro_uid",t)},expression:"form.pro_uid"}},e._l(e.proUser.datas,(function(e,s){return t("el-option",{key:s,attrs:{label:e.uname,value:e.uid}})})),1)],1)],1),t("el-col",{attrs:{span:11,offset:2}},[t("el-form-item",{attrs:{prop:"cus_uid"}},[t("span",{staticClass:"form-title"},[e._v("客服负责人")]),t("el-select",{attrs:{placeholder:"请输入姓名、手机号",filterable:"",remote:"","remote-method":e.inputCusUser,loading:e.cusUser.isLoading},model:{value:e.form.cus_uid,callback:function(t){e.$set(e.form,"cus_uid",t)},expression:"form.cus_uid"}},e._l(e.cusUser.datas,(function(e,s){return t("el-option",{key:s,attrs:{label:e.uname,value:e.uid}})})),1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:11}},[t("el-form-item",{attrs:{prop:"use_receipt_type"}},[t("span",{staticClass:"form-title"},[e._v("开票类型")]),t("el-select",{attrs:{placeholder:"请选择开票类型"},model:{value:e.form.use_receipt_type,callback:function(t){e.$set(e.form,"use_receipt_type",t)},expression:"form.use_receipt_type"}},[t("el-option",{attrs:{label:"电子收据",value:1}}),t("el-option",{attrs:{label:"纸质收据",value:2}}),t("el-option",{attrs:{label:"同时使用",value:3}})],1)],1)],1)],1),t("div",{staticClass:"file-upload"},[t("el-form-item",{attrs:{prop:"fileInfo"}},[t("div",{staticClass:"title"},[e._v("上传收据印章")]),t("el-upload",{ref:"upload",attrs:{action:e.qiniuDatas.domain,limit:1,"file-list":e.fileList,"list-type":"picture-card","http-request":e.customUpload,"on-preview":e.handlePictureCardPreview,"before-remove":e.handleRemove}},[t("i",{staticClass:"el-icon-plus"})])],1)],1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.conf.isSubmitLoading,type:"primary",round:""},on:{click:e.onSubmit}},[e._v(" "+e._s(!0===e.conf.isSubmitLoading?"保存中，请稍等...":"提交保存")+" ")]),t("el-button",{attrs:{type:"info",round:""},on:{click:function(t){e.conf.show=!1}}},[e._v(" 取消 ")])],1)],1),t("el-image",{ref:"preview",staticStyle:{height:"0",width:"0"},attrs:{src:e.imgSrc,"preview-src-list":e.imgList,"z-index":1e4}})],1)},h=[],g=s("f31f"),f={name:"editVillage",props:["qiniuDatas"],data(){return{baseInfo:[],form:{vid:"",pro_uid:"",cus_uid:"",fileInfo:"",sign:"more",token:this.$api.state.System.village.edit.token,use_receipt_type:1},rules:{pro_uid:[{required:!1,message:"请选择项目负责人",trigger:"blur"}],cus_uid:[{required:!1,message:"请选择客服负责人",trigger:"blur"}],use_receipt_type:[{required:!0,message:"请选择开票类型",trigger:"change"}],fileInfo:[{required:!1,message:"请上传收据印章",trigger:"change"}]},proUser:{datas:[],isLoading:!1},cusUser:{datas:[],isLoading:!1},conf:{show:!1,isSubmitLoading:!1},imgSrc:"",imgList:[],fileList:[]}},methods:{customUpload(e){e.url=this.$refs.upload.uploadFiles[0].url;let t=Object(g["a"])(e,this.qiniuDatas);t.observable.subscribe({next:e=>{},error:e=>{},complete:s=>{this.saveFile(t.fileInfo,e.file.uid)}})},saveFile(e,t){this.$axios.post(this.$api.state.Public.saveUploadInfo.url,e).then(e=>{if(200===e.Code)this.form.fileInfo={id:e.Data.id,uid:t},this.$refs.editForm.validateField("fileInfo");else{let t=e.Message?e.Message:"文件信息保存失败！";this.$message({message:t,type:"error"})}})},handleRemove(){return this.$confirm("此操作会删除印章，将导致打印票据印章丢失，确定继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$axios.post(this.$api.state.Public.delFile.url,{id:this.form.fileInfo.id}).then(e=>{if(200!=e.Code){let t=e.Message?e.Message:"文件删除失败！";this.$message({message:t,type:"error"})}}).catch(()=>{}),this.$refs.upload.clearFiles(),this.form.fileInfo="",this.$refs.editForm.validateField("fileInfo")}).catch(()=>{}),!1},handlePictureCardPreview(e){this.imgSrc=e.url,this.imgList=[e.url],this.$nextTick(()=>{this.$refs.preview.clickHandler()})},imgPreview(e){this.handlePictureCardPreview({url:e.image_host})},showDialog(e){this.$refs.editForm&&this.$refs.editForm.resetFields(),e.file&&e.file.id&&(this.form.fileInfo={id:e.file.id},this.fileList=[{name:e.file.filename,url:e.file.file_url}]),this.form.use_receipt_type=e.use_receipt_type,this.baseInfo=e,this.form.vid=this.baseInfo.vid,this.form.pro_uid="",this.proUser.datas=[],this.proUser.isLoading=!1,parseInt(this.baseInfo.project_uid)>0&&(this.form.pro_uid=this.baseInfo.project_uid,setTimeout(()=>{this.proUser.datas=[{uid:this.baseInfo.project_uid,uname:this.baseInfo.project_manager}]},100)),this.form.cus_uid="",this.cusUser.datas=[],this.cusUser.isLoading=!1,parseInt(this.baseInfo.customer_uid)>0&&(this.form.cus_uid=this.baseInfo.customer_uid,setTimeout(()=>{this.cusUser.datas=[{uid:this.baseInfo.customer_uid,uname:this.baseInfo.customer_manager}]},100)),this.conf.show=!0},inputProUser(e){let t=this;e?setTimeout(()=>{t.proUser.isLoading=!0,t.$axios({url:t.$api.state.Public.user.url,method:"post",responseType:"json",data:{keywords:e}}).then(e=>{200===e.Code?(t.proUser.datas=e.Data.datas,t.proUser.isLoading=!1):204===e.Code?(t.$message({message:e.Message,type:"error",offset:150}),t.$router.push({path:t.$common.state.loginPath})):(t.proUser.isLoading=!1,t.$message({message:e.Message,type:"error",offset:150}))}).catch(()=>{t.proUser.isLoading=!1,t.$message({message:"服务器连接失败",type:"error",offset:150})})},200):t.proUser.isLoading=!1},inputCusUser(e){let t=this;e?setTimeout(()=>{t.cusUser.isLoading=!0,t.$axios({url:t.$api.state.Public.user.url,method:"post",responseType:"json",data:{keywords:e}}).then(e=>{200===e.Code?(t.cusUser.datas=e.Data.datas,t.cusUser.isLoading=!1):204===e.Code?(t.$message({message:e.Message,type:"error",offset:150}),t.$router.push({path:t.$common.state.loginPath})):(t.cusUser.isLoading=!1,t.$message({message:e.Message,type:"error",offset:150}))}).catch(()=>{t.cusUser.isLoading=!1,t.$message({message:"服务器连接失败",type:"error",offset:150})})},200):t.cusUser.isLoading=!1},onSubmit(){let e=this;e.$refs.editForm.validate(t=>{if(!1===t)return!1;e.conf.isSubmitLoading=!0,e.form.input=[{field:"seal_image_file_id",val:e.form.fileInfo.id},{field:"use_receipt_type",val:e.form.use_receipt_type}],e.form.pro_uid&&e.form.input.push({field:"v_manager",val:e.form.pro_uid}),e.form.cus_uid&&e.form.input.push({field:"customer_manager",val:e.form.cus_uid}),e.$axios({url:e.$api.state.System.village.edit.url,method:"post",responseType:"json",data:e.form}).then(t=>{200===t.Code?(e.conf.isSubmitLoading=!1,e.conf.show=!1,e.$message({message:t.Message,type:"success",offset:150}),e.$emit("editSuc",!0)):204===t.Code?(e.$message({message:t.Message,type:"error",offset:150}),e.$router.push({path:e.$common.state.loginPath})):(e.conf.isSubmitLoading=!1,e.$message({message:t.Message,type:"error",offset:150}))}).catch(()=>{e.conf.isSubmitLoading=!1,e.$message({message:"服务器连接失败",type:"error",offset:150})})})},closeDialog(){this.fileList=[]}}},b=f,v=Object(m["a"])(b,u,h,!1,null,null,null),y=v.exports,_=s("a08c"),$={components:{workIcon:i["a"],addVillage:p,editVillage:y},data(){return{urlObj:{villages:this.$api.state.System.village.list.url,downloadtemp:this.$api.state.System.downloadtemp.url,importrooms:this.$api.state.System.importrooms.url,downloadcartemp:this.$api.state.System.downloadcartemp.url,importcars:this.$api.state.System.importcars.url,createpayqrcode:this.$api.state.System.createpayqrcode.url,getAreas:this.$api.state.Public.getAreas.url,getCompany:this.$api.state.Public.getCompany.url,getVillage:this.$api.state.Public.getVillage.url},searchVal:"",choseVillageInfo:{name:"全部项目",vid:0},tableData:[],columns:_.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},showPrint:!1,qiniuDatas:"",showImportDialog:!1,ruleForm:{areaVal:"",companyVal:"",village:"",type:"",fileInfo:""},rules:{areaVal:[{required:!0,message:"请选择所属大区",trigger:"change"}],companyVal:[{required:!0,message:"请选择所属公司",trigger:"change"}],village:[{required:!0,message:"请选择所属项目",trigger:"change"}],type:[{required:!0,message:"请选择导入类型",trigger:"change"}],fileInfo:[{required:!0,message:"请上传文件",trigger:"change"}]},areaOptions:[],companyOptions:[],villOptions:[],isCommit:!1,showQrcodeDialog:!1,qrSrc:""}},computed:{tabColumsChecked(){let e=[];return this.columns.forEach((t,s)=>{!0===t.show&&("button"===t.type?t.btns.forEach((e,s)=>{e.role&&!this.$global.btnRoleAuth(this.$api["state"]["System"]["village"][e.role]["token"],this.$menu.state.childRoleList)&&t.btns.splice(t.bi,1)}):t.type&&t.role&&(this.$global.btnRoleAuth(this.$api["state"]["System"]["village"][t.role]["token"],this.$menu.state.childRoleList)||this.$set(t,"disabled",!0)),e.push(t))}),e}},mounted(){this.tableLoad(),this.getUploadToken()},methods:{getUploadToken(){this.$axios.post(this.$api.state.Public.uploadToken.url).then(e=>{200===e.Code&&(this.qiniuDatas=e.Data)})},clickEditCol(e){this.$refs.showEditVillage.showDialog(this.tableData[e])},tablePageSize(e,t){this.conf.limit=e,(1===t||e*t<=this.conf.dataTotal)&&this.tableLoad()},tableChosePage(e){this.conf.curPage=e,this.tableLoad()},tableSetVal(e){let t=this;t.$axios({url:t.$api.state.System.village.edit.url,method:"post",responseType:"json",data:{token:t.$api.state.System.village.edit.token,sign:"single",vid:t.tableData[e.index].vid,field:e.col_name,val:e.value}}).then(s=>{200===s.Code?(t.$message({message:s.Message,type:"success"}),t.$set(t.tableData[e.index],e.col_name,e.value)):204===s.Code?(t.$message({message:s.Message,type:"error"}),t.$router.push({path:t.$common.state.loginPath})):t.$message({message:s.Message,type:"error"})}).catch(()=>{t.$message({message:"服务器连接失败",type:"error"})})},tableLoad(e=!1){!0===e&&this.$set(this.conf,"curPage",1),this.conf.loadStatus=!0;let t={page:this.conf.curPage,limit:this.conf.limit,token:this.$api.state.System.village.list.token,vid:this.choseVillageInfo.vid,keywords:this.searchVal};this.$axios.post(this.urlObj.villages,t).then(e=>{200===e.Code?(e.Data.data.forEach(e=>{e.check=!1}),this.conf.dataTotal=e.Data.total,this.tableData=e.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=e.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},keySearch(){this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad(!0)},filterVillage(e){this.choseVillageInfo.name=e.name,this.choseVillageInfo.vid=e.vid,this.searchVal="",this.keySearch(!0)},printHandle(){this.showPrint=!0,setTimeout(()=>{this.showPrint=!1},500)},checkChange(){let e=JSON.parse(JSON.stringify(this.columns));this.columns=e},getAreaData(){this.$axios.post(this.urlObj.getAreas).then(e=>{if(200===e.Code)this.areaOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取大区数据失败！";this.$message({type:"error",message:t})}})},getCompanyData(e){this.ruleForm.companyVal="",this.companyOptions=[],this.ruleForm.village="",this.villOptions=[],e&&this.$axios.post(this.urlObj.getCompany,{bgid:e}).then(e=>{if(200===e.Code)this.companyOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取公司数据失败！";this.$message({type:"error",message:t})}})},getVillageData(e){this.ruleForm.village="",this.villOptions=[],e&&this.$axios.post(this.urlObj.getVillage,{pid:e}).then(e=>{if(200===e.Code)this.villOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取项目数据失败！";this.$message({type:"error",message:t})}})},importData(){this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.ruleForm={areaVal:"",companyVal:"",village:"",type:"",fileInfo:""},this.areaOptions=[],this.companyOptions=[],this.villOptions=[],this.showImportDialog=!0,this.getAreaData()},tempDownload(e){"car"==e?this.$axios.post(this.urlObj.downloadcartemp).then(e=>{if(200===e.Code){const t=document.createElement("a"),s=document.querySelector("body");t.href=e.Data.path,t.download="车位导入模板.xlsx",t.style.display="none",s.appendChild(t),t.click(),s.removeChild(t)}else{let t=e.Message?e.Message:"车位模板下载失败！";this.$message({type:"error",message:t})}}):this.$axios.post(this.urlObj.downloadtemp).then(e=>{if(200===e.Code){const t=document.createElement("a"),s=document.querySelector("body");t.href=e.Data.path,t.download="房源导入模板.xlsx",t.style.display="none",s.appendChild(t),t.click(),s.removeChild(t)}else{let t=e.Message?e.Message:"房源模板下载失败！";this.$message({type:"error",message:t})}})},customUpload(e){this.ruleForm.fileInfo=e.file,this.$refs.ruleForm.validateField("fileInfo")},handleRemove(){this.ruleForm.fileInfo="",this.$refs.ruleForm.validateField("fileInfo")},importSubmit(){this.$refs.ruleForm.validate(e=>{if(e){this.isCommit=!0;let e=new FormData;e.append("excelfile",this.ruleForm.fileInfo),e.append("vid",this.ruleForm.village);let t="",s="";1==this.ruleForm.type?(t=this.urlObj.importrooms,s="房源"):(t=this.urlObj.importcars,s="车位"),this.$axios({method:"post",url:t,data:e,headers:{type:"upload"}}).then(e=>{if(200===e.Code)this.$message({type:"success",message:s+"数据导入成功！"}),this.$refs.upload.clearFiles(),this.showImportDialog=!1;else{let t=e.Message?e.Message:s+"数据导入失败！";this.$message({type:"error",message:t})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},showQrcode(e){this.qrSrc="",this.showQrcodeDialog=!0,this.$axios.post(this.urlObj.createpayqrcode,{vid:this.tableData[e].vid}).then(e=>{if(200===e.Code)this.qrSrc=e.Data;else{let t=e.Message?e.Message:"获取小程序二维码失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},saveImage(){let e=document.querySelector("#qrcode img"),t=e.src,s=document.createElement("a"),a=new MouseEvent("click");s.download="机动车续费二维码",s.href=t,s.dispatchEvent(a)}}},w=$,k=(s("0a6a"),Object(m["a"])(w,a,o,!1,null,null,null));t["default"]=k.exports}}]);