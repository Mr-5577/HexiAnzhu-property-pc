(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9f1b10aa"],{"072d":function(e,t,a){"use strict";a("4e16")},"4e16":function(e,t,a){},9313:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"akey-deposit"}},[t("div",{staticClass:"top"},[t("div",{staticClass:"main"},[t("div",{staticClass:"common-left"},[t("span",{staticClass:"common-chose-info",on:{click:function(t){return e.$refs.showFilterVillage.showDialog()}}},[t("i",{staticClass:"iconfont icondaqu"}),e._v(" "+e._s(e.choseVillageInfo.name)+" ")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"请输入关键字查询"},domProps:{value:e.searchVal},on:{input:function(t){t.target.composing||(e.searchVal=t.target.value)}}}),t("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.keySearch(!0)}}},[e._v(" 查询 ")])],1)])]),t("div",{staticClass:"main-wp"},[t("div",{staticClass:"select-wp"},[t("el-select",{attrs:{clearable:"",placeholder:"请选择科目"},on:{change:e.tableLoad},model:{value:e.subjectVal,callback:function(t){e.subjectVal=t},expression:"subjectVal"}},e._l(e.subOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),t("el-select",{attrs:{clearable:"",placeholder:"请选择预存款状态"},on:{change:e.tableLoad},model:{value:e.statusVal,callback:function(t){e.statusVal=t},expression:"statusVal"}},[t("el-option",{attrs:{label:"预存款充足",value:1}}),t("el-option",{attrs:{label:"预存款不足",value:2}})],1),t("el-date-picker",{attrs:{type:"daterange",align:"center","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:e.tableLoad},model:{value:e.dateValue,callback:function(t){e.dateValue=t},expression:"dateValue"}})],1),t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.tableData,cusColums:e.columns,cusConf:e.conf,ispaging:e.ispaging,check:!0},on:{sizeChange:e.sizeChange,currentChange:e.currentChange,selectionChange:e.selectionChange}}),e.$menu.getters.judgeRole("Btn-PZliaaUDuDq7fJSQuh7c6HGK")?t("el-button",{attrs:{disabled:0===e.tableSelected.length,loading:e.isCommit,type:"primary",round:""},on:{click:e.remitAccount}},[e._v(" 一键划账 ")]):e._e()],1)]),t("filter-village",{ref:"showFilterVillage",attrs:{vid:e.choseVillageInfo.vid},on:{choseInfo:e.filterVillage}})],1)},l=[],i=(a("5948"),a("e2da")),o={name:"akeyDeposit",data(){return{urlObj:{villageend:this.$api.state.Charge.villageend.url,transferarrears:this.$api.state.Charge.transferarrears.url,batchbalancepaycost:this.$api.state.Charge.batchbalancepaycost.url},choseVillageInfo:{name:"全部项目",vid:0},subjectVal:"",subOptions:[],statusVal:"",dateValue:[],searchVal:"",ispaging:!1,tableData:[],columns:i.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},tableSelected:[],isCommit:!1}},computed:{vid(){return this.$store.state.vid}},created(){let e=sessionStorage.getItem("vid"),t=sessionStorage.getItem("vname");e&&(this.choseVillageInfo.vid=e,this.choseVillageInfo.name=t),this.getSubjectList(),this.tableLoad()},methods:{filterVillage(e){this.choseVillageInfo.name=e.name,this.choseVillageInfo.vid=e.vid,this.searchVal="",this.subjectVal="",this.subOptions=[],this.dateValue=[],this.keySearch(),this.getSubjectList()},keySearch(){this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad()},getSubjectList(){let e={vid:this.choseVillageInfo.vid};this.$axios.post(this.urlObj.villageend,e).then(e=>{if(200===e.Code)this.subOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取科目数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},tableLoad(){this.conf.loadStatus=!0;let e={page:this.conf.curPage,limit:this.conf.limit,vid:this.vid,keywords:this.searchVal.trim(),subject_id:this.subjectVal,balance_money:this.statusVal,stime:this.dateValue&&this.dateValue[0]?this.dateValue[0]/1e3:"",etime:this.dateValue&&this.dateValue[1]?this.dateValue[1]/1e3:""};this.$axios.post(this.urlObj.transferarrears,e).then(e=>{200===e.Code?(this.statusVal?(e.Data&&e.Data.length>0&&e.Data.forEach(e=>{e.select_text=1==e.select?"是":"否"}),this.ispaging=!1,this.tableData=e.Data):(e.Data.data&&e.Data.data.length>0&&e.Data.data.forEach(e=>{e.select_text=1==e.select?"是":"否"}),this.ispaging=!0,this.conf.dataTotal=e.Data.total,this.tableData=e.Data.data),this.conf.loadStatus=!1,this.conf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=e.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},sizeChange(e){this.conf.limit=e,this.tableLoad()},currentChange(e){this.conf.curPage=e,this.tableLoad()},selectionChange(e){this.tableSelected=e},remitAccount(){let e=!1;this.tableSelected.forEach(t=>{0!=t.select||(e=!0)}),e?this.$message({type:"warning",message:"存在预存款不充足的资源，请重新选择！"}):this.$confirm("确定要对当前选择数据进行划账吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.isCommit=!0;let e=[];this.tableSelected.forEach(t=>{let a={cost_ids:t.cost_ids,owner_id:t.owner_id};e.push(a)});let t={vid:this.vid,data:e};this.$axios.post(this.urlObj.batchbalancepaycost,t).then(e=>{if(200===e.Code)e.Data.error_num>0?this.$message({message:`划账成功条数：${e.Data.success_num}；划账失败条数：${e.Data.error_num}；错误信息：【${e.Data.error_msg.join(";")}】`,type:"error"}):(this.$message({message:`批量划账成功！划账成功条数：${e.Data.success_num}；划账失败条数：${e.Data.error_num}；`,type:"success"}),this.tableLoad());else{let t=e.Message?e.Message:"批量划账失败！";this.$message({message:t,type:"error"})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}).catch(()=>{})}}},c=o,n=(a("072d"),a("1805")),r=Object(n["a"])(c,s,l,!1,null,null,null);t["default"]=r.exports},e2da:function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"资源名称","prop":"resources_name","show":true,"color":"#69da61"},{"label":"科目名称","prop":"subject_name","show":true,"color":"#999"},{"label":"客户姓名","prop":"owner_name","show":true},{"label":"联系电话","prop":"owner_tel","show":true,"color":"#999"},{"label":"欠费周期","prop":"cycle","show":true,"color":"#999"},{"label":"欠费金额","prop":"money","show":true,"color":"#ffcb3c"},{"label":"预存款金额","prop":"balance","show":true,"color":"#ffcb3c"},{"label":"预存款是否充足","prop":"select_text","show":true}]}')}}]);