(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0fb6ebfa"],{5053:function(t,e,a){"use strict";a("9c44")},"8a13":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{attrs:{id:"paper-receipt"}},[e("div",{staticClass:"top"},[e("div",{staticClass:"main"},[e("div",{staticClass:"common-left"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchVal,expression:"searchVal"}],staticClass:"common-input",attrs:{type:"text",placeholder:"请输入票据单号查询"},domProps:{value:t.searchVal},on:{input:function(e){e.target.composing||(t.searchVal=e.target.value)}}}),e("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(e){return t.keySearch(!0)}}},[t._v(" 查询 ")])],1),e("div",{staticClass:"common-right"},[this.$menu.getters.judgeRole("Btn-uqWieVe7m32wKriBWaItkTG6")?e("el-button",{attrs:{type:"primary",round:"",plain:"",icon:"iconfont iconxiugai"},on:{click:t.entryHandle}},[t._v(" 录入收据 ")]):t._e()],1)])]),e("div",{staticClass:"main-wp"},[e("div",{staticClass:"select-wp"},[e("el-select",{attrs:{clearable:"",placeholder:"请选择大区"},on:{change:t.tableLoad},model:{value:t.areaVal,callback:function(e){t.areaVal=e},expression:"areaVal"}},t._l(t.areaOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1),e("el-select",{attrs:{clearable:"",placeholder:"请选择票据状态"},on:{change:t.tableLoad},model:{value:t.statusVal,callback:function(e){t.statusVal=e},expression:"statusVal"}},t._l(t.statusOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.tableData,cusColums:t.columns,cusConf:t.conf,ispaging:!0},on:{sizeChange:t.sizeChange,currentChange:t.currentChange,detail:t.showDetail,grant:t.showGrant}})],1)]),e("el-dialog",{staticClass:"entryDialog",attrs:{visible:t.showEntryDialog,title:"录入收据",width:"32%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showEntryDialog=e}}},[e("el-scrollbar",{staticStyle:{height:"100%"}},[e("div",{staticClass:"form-wp"},[e("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"hide-required-asterisk":!0}},[e("el-form-item",{attrs:{label:"首张单号",prop:"first"}},[e("el-input",{attrs:{placeholder:"请输入首张单号"},model:{value:t.ruleForm.first,callback:function(e){t.$set(t.ruleForm,"first",e)},expression:"ruleForm.first"}})],1),e("el-form-item",{attrs:{label:"末张单号",prop:"last"}},[e("el-input",{attrs:{placeholder:"请输入末张单号"},model:{value:t.ruleForm.last,callback:function(e){t.$set(t.ruleForm,"last",e)},expression:"ruleForm.last"}})],1)],1)],1)]),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.entrySubmit}},[t._v(" 提交保存 ")]),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showEntryDialog=!1}}},[t._v(" 取消 ")])],1)],1),e("el-dialog",{staticClass:"recordDialog",attrs:{visible:t.showRecordDialog,title:"收据发放详情",width:"80%","close-on-click-modal":!0},on:{"update:visible":function(e){t.showRecordDialog=e}}},[e("div",{staticClass:"table-wp"},[e("cus-table",{attrs:{datas:t.popTableData,cusColums:t.popColumns,cusConf:t.popConf,ispaging:!1},on:{move:t.moveReceipt,resolution:t.resolution}})],1)]),e("el-dialog",{staticClass:"grantDialog",attrs:{visible:t.showGrantDialog,title:t.grantTitle,width:"32%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showGrantDialog=e}}},[e("el-scrollbar",{staticStyle:{height:"100%"}},[e("div",{staticClass:"form-wp"},[e("el-form",{ref:"grantForm",attrs:{model:t.grantForm,rules:t.grantRules,"hide-required-asterisk":!0}},["发放到大区"===t.grantTitle?e("el-form-item",{attrs:{label:"选择大区",prop:"area"}},[e("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择发放大区"},model:{value:t.grantForm.area,callback:function(e){t.$set(t.grantForm,"area",e)},expression:"grantForm.area"}},t._l(t.areaOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1):t._e(),"发放到个人"===t.grantTitle?e("el-form-item",{attrs:{label:"首张单号",prop:"first"}},[e("el-input",{attrs:{placeholder:"请输入首张单号"},model:{value:t.grantForm.first,callback:function(e){t.$set(t.grantForm,"first",e)},expression:"grantForm.first"}})],1):t._e(),"发放到个人"===t.grantTitle?e("el-form-item",{attrs:{label:"末张单号",prop:"last"}},[e("el-input",{attrs:{placeholder:"请输入末张单号"},model:{value:t.grantForm.last,callback:function(e){t.$set(t.grantForm,"last",e)},expression:"grantForm.last"}})],1):t._e(),"发放到个人"===t.grantTitle?e("el-form-item",{attrs:{label:"发放项目",prop:"village"}},[e("el-select",{attrs:{filterable:"",remote:"","remote-method":t.villageRemote,loading:t.loading,placeholder:"请选择发放项目"},on:{change:t.villageChange},model:{value:t.grantForm.village,callback:function(e){t.$set(t.grantForm,"village",e)},expression:"grantForm.village"}},t._l(t.grantVillages,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1):t._e(),"发放到个人"===t.grantTitle?e("el-form-item",{attrs:{label:"发放人员",prop:"user"}},[e("el-select",{attrs:{filterable:"",placeholder:"请选择发放人员"},model:{value:t.grantForm.user,callback:function(e){t.$set(t.grantForm,"user",e)},expression:"grantForm.user"}},t._l(t.grantUsers,(function(t){return e("el-option",{key:t.uid,attrs:{label:t.realname,value:t.uid}})})),1)],1):t._e()],1)],1)]),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.grantSubmit}},[t._v(" 提交保存 ")]),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showGrantDialog=!1}}},[t._v(" 取消 ")])],1)],1),e("el-dialog",{staticClass:"moveDialog",attrs:{visible:t.showMoveDialog,title:t.isMove?"移交收据":"拆分收据",width:"32%","close-on-click-modal":!1},on:{"update:visible":function(e){t.showMoveDialog=e}}},[e("el-scrollbar",{staticStyle:{height:"100%"}},[e("div",{staticClass:"form-wp"},[e("el-form",{ref:"moveForm",attrs:{model:t.moveForm,rules:t.moveRules,"hide-required-asterisk":!0}},[t.isMove?t._e():e("el-form-item",{attrs:{label:"首张单号",prop:"first"}},[e("el-input",{attrs:{placeholder:"请输入首张单号"},model:{value:t.moveForm.first,callback:function(e){t.$set(t.moveForm,"first",e)},expression:"moveForm.first"}})],1),t.isMove?t._e():e("el-form-item",{attrs:{label:"末张单号",prop:"last"}},[e("el-input",{attrs:{placeholder:"请输入末张单号"},model:{value:t.moveForm.last,callback:function(e){t.$set(t.moveForm,"last",e)},expression:"moveForm.last"}})],1),e("el-form-item",{attrs:{label:"选择项目",prop:"village"}},[e("el-select",{attrs:{filterable:"",remote:"","remote-method":t.villageRemote,loading:t.loading,placeholder:"请选择项目"},on:{change:t.villageChange},model:{value:t.moveForm.village,callback:function(e){t.$set(t.moveForm,"village",e)},expression:"moveForm.village"}},t._l(t.grantVillages,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),e("el-form-item",{attrs:{label:"选择人员",prop:"user"}},[e("el-select",{attrs:{filterable:"",placeholder:"请选择人员"},model:{value:t.moveForm.user,callback:function(e){t.$set(t.moveForm,"user",e)},expression:"moveForm.user"}},t._l(t.grantUsers,(function(t){return e("el-option",{key:t.uid,attrs:{label:t.realname,value:t.uid}})})),1)],1)],1)],1)]),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{loading:t.isCommit,type:"primary",round:""},on:{click:t.moveSubmit}},[t._v(" 提交保存 ")]),e("el-button",{attrs:{loading:t.isCommit,type:"info",round:""},on:{click:function(e){t.showMoveDialog=!1}}},[t._v(" 取消 ")])],1)],1)],1)},i=[],r=(a("5948"),a("f238")),l=a("ba74"),o={name:"receipt",data(){return{urlObj:{paperreceiptlist:this.$api.state.Setting.paperreceiptlist.url,addreceipt:this.$api.state.Setting.addreceipt.url,grantdetails:this.$api.state.Setting.grantdetails.url,getAreas:this.$api.state.Public.getAreas.url,searchvillage:this.$api.state.Public.searchvillage.url,receiptgrant:this.$api.state.Setting.receiptgrant.url,receiptmember:this.$api.state.Setting.receiptmember.url,getmember:this.$api.state.Setting.getmember.url,moveReceipt:this.$api.state.Setting.moveReceipt.url,receipttransfer:this.$api.state.Setting.receipttransfer.url},searchVal:"",tableData:[],columns:r.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},areaVal:"",areaOptions:[],statusVal:"",statusOptions:[{label:"未领用",value:0},{label:"已领用",value:1},{label:"已作废",value:2}],ruleForm:{first:"",last:""},rules:{first:[{required:!0,message:"请输入首张单号",trigger:"blur"}],last:[{required:!0,message:"请输入末张单号",trigger:"blur"}]},showEntryDialog:!1,isCommit:!1,showRecordDialog:!1,popTableData:[],popColumns:l.list,popConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},showGrantDialog:!1,grantTitle:"发放到大区",grantForm:{area:"",first:"",last:"",user:"",village:""},grantRules:{area:[{required:!0,message:"请选择发放大区",trigger:"change"}],first:[{required:!0,message:"请输入首张单号",trigger:"blur"}],last:[{required:!0,message:"请输入末张单号",trigger:"blur"}],user:[{required:!0,message:"请选择发放人员",trigger:"change"}],village:[{required:!0,message:"请选择发放项目",trigger:"change"}]},grantVillages:[],grantUsers:[],showMoveDialog:!1,moveForm:{first:"",last:"",user:"",village:""},moveRules:{first:[{required:!0,message:"请输入首张单号",trigger:"blur"}],last:[{required:!0,message:"请输入末张单号",trigger:"blur"}],user:[{required:!0,message:"请选择人员",trigger:"change"}],village:[{required:!0,message:"请选择项目",trigger:"change"}]},villgeOptions:[],userOptions:[],loading:!1,currentGrantId:"",detailId:"",isMove:!0,cmindex:""}},mounted(){this.getAreaData(),this.tableLoad()},methods:{keySearch(){this.conf={loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},this.tableLoad()},getAreaData(){this.$axios.post(this.urlObj.getAreas).then(t=>{if(200===t.Code)this.areaOptions=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取大区数据失败！";this.$message({type:"error",message:e})}}).catch(()=>{})},tableLoad(){this.conf.loadStatus=!0;let t={page:this.conf.curPage,limit:this.conf.limit,kwd:this.searchVal,status:this.statusVal,area:this.areaVal};this.$axios.post(this.urlObj.paperreceiptlist,t).then(t=>{200===t.Code?(t.Data.data&&t.Data.data.length>0&&t.Data.data.forEach(t=>{t.uname=t.user?t.user.realname:"",t.deptname=t.department?t.department.deptname:"",0==t.status&&this.$menu.getters.judgeRole("Btn-kDQNa5cnphwi284KgeuRI9TF")||1==t.status&&this.$menu.getters.judgeRole("Btn-iBdj2to9sgb6nrmYIFxa5N4K")?t.ffhide=!1:t.ffhide=!0}),this.conf.dataTotal=t.Data.total,this.tableData=t.Data.data?t.Data.data:[],this.conf.loadStatus=!1,this.conf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=t.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},sizeChange(t){this.conf.limit=t,this.tableLoad()},currentChange(t){this.conf.curPage=t,this.tableLoad()},grantReceipt(t){this.$confirm("确定要发放当前票据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let e={id:this.tableData[t].id};this.$axios.post(this.urlObj.receiptcancel,e).then(t=>{if(200===t.Code)this.$message({type:"success",message:"票据发放成功！"}),this.tableLoad();else{let e=t.Message?t.Message:"票据发放失败！";this.$message({type:"error",message:e})}}).catch(()=>{})}).catch(()=>{})},entryHandle(){this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.showEntryDialog=!0},entrySubmit(){this.$refs.ruleForm.validate(t=>{if(t){this.isCommit=!0;let t={first:this.ruleForm.first,last:this.ruleForm.last};this.$axios.post(this.urlObj.addreceipt,t).then(t=>{if(200===t.Code)this.$message({type:"success",message:"收据录入成功！"}),this.showEntryDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:"录入收据失败！";this.$message({type:"error",message:e})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},showGrant(t){this.currentGrantId=this.tableData[t].id,0==this.tableData[t].status?this.grantTitle="发放到大区":1==this.tableData[t].status&&(this.grantTitle="发放到个人"),this.$refs.grantForm&&this.$refs.grantForm.resetFields(),this.showGrantDialog=!0},villageRemote(t){""!==t?(this.loading=!0,this.$axios.post(this.urlObj.searchvillage,{name:t}).then(t=>{if(200===t.Code)this.grantVillages=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取发放项目数据失败！";this.$message({message:e,type:"error"})}this.loading=!1}).catch(()=>{this.loading=!1})):this.grantVillages=[]},villageChange(t){this.grantForm.user="",this.grantUsers=[],this.moveForm.user="",t&&this.getUserData(t)},getUserData(t){this.$axios.post(this.urlObj.getmember,{vid:t}).then(t=>{if(200===t.Code)this.grantUsers=t.Data?t.Data:[];else{let e=t.Message?t.Message:"获取发放人员数据失败！";this.$message({message:e,type:"error"})}this.loading=!1}).catch(()=>{this.loading=!1})},grantSubmit(){this.$refs.grantForm.validate(t=>{if(t){this.isCommit=!0;let t={id:this.currentGrantId},e="";"发放到大区"===this.grantTitle?(t.area=this.grantForm.area,e=this.urlObj.receiptgrant):(t.first=this.grantForm.first,t.last=this.grantForm.last,t.vid=this.grantForm.village,t.uid=this.grantForm.user,e=this.urlObj.receiptmember),this.$axios.post(e,t).then(t=>{if(200===t.Code)this.$message({type:"success",message:"收据发放成功！"}),this.showGrantDialog=!1,this.tableLoad();else{let e=t.Message?t.Message:"收据发放失败！";this.$message({type:"error",message:e})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},showDetail(t){this.detailId=this.tableData[t].id,this.showRecordDialog=!0,this.RecordTableLoad()},RecordTableLoad(){this.popConf.loadStatus=!0,this.$axios.post(this.urlObj.grantdetails,{id:this.detailId}).then(t=>{200===t.Code?(t.Data.forEach(t=>{t.vname=t.village?t.village.villagename:"",t.uname=t.user?t.user.realname:"",t.status_text=0==t.status?"未领用":1==t.status?"已领用":2==t.status?"已作废":"",t.yjhide=1==t.is_runout,t.cfhide=1==t.is_runout}),this.popConf.dataTotal=t.Data.total,this.popTableData=t.Data?t.Data:[],this.popConf.loadStatus=!1,this.popConf.emptyText=""):204===t.Code?(this.$message({message:t.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.popTableData=[],this.popConf.emptyText=t.Message,this.popConf.dataTotal=0,this.popConf.loadStatus=!1)}).catch(()=>{this.popTableData=[],this.popConf.emptyText="服务器连接失败...",this.popConf.dataTotal=0,this.popConf.loadStatus=!1})},moveReceipt(t){this.cmindex=t,this.$refs.moveForm&&this.$refs.moveForm.resetFields(),this.grantUsers=[],this.grantVillages=[],this.isMove=!0,this.showMoveDialog=!0},resolution(t){this.cmindex=t,this.$refs.moveForm&&this.$refs.moveForm.resetFields(),this.grantUsers=[],this.grantVillages=[],this.isMove=!1,this.showMoveDialog=!0},moveSubmit(){this.$refs.moveForm.validate(t=>{if(t){this.isCommit=!0;let t={id:this.popTableData[this.cmindex].id,vid:this.moveForm.village,uid:this.moveForm.user},e="";this.isMove?e=this.urlObj.moveReceipt:(t.first=this.moveForm.first,t.last=this.moveForm.last,e=this.urlObj.receipttransfer),this.$axios.post(e,t).then(t=>{if(200===t.Code){let t=this.isMove?"收据移交成功！":"收据拆分成功！";this.$message({type:"success",message:t}),this.showMoveDialog=!1,this.RecordTableLoad()}else{let e=t.Message?t.Message:this.isMove?"收据移交失败！":"收据拆分失败！";this.$message({type:"error",message:e})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})}}},n=o,m=(a("5053"),a("1805")),h=Object(m["a"])(n,s,i,!1,null,null,null);e["default"]=h.exports},"9c44":function(t,e,a){},ba74:function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"领用项目","prop":"vname","show":true,"color":"#999"},{"label":"首张单号","prop":"first","show":true,"width":140},{"label":"末张单号","prop":"last","show":true,"width":140},{"label":"实时单号","prop":"now_one","show":true,"width":140},{"label":"数量","prop":"num","show":true,"color":"#999"},{"label":"剩余","prop":"surplus","show":true,"color":"#999"},{"label":"状态","prop":"status_text","show":true,"color":"#999"},{"label":"领用人","prop":"uname","show":true,"color":"#999"},{"label":"领用时间","prop":"create_time","show":true,"color":"#999","width":150},{"label":"操作","prop":"","width":180,"type":"button","show":true,"btns":[{"name":"移交","type":"primary","size":"small","round":true,"action":"move","role":"move","token":"Btn-mfbA52BkHDn8sMzyIKuFdLlU","hide":"yjhide"},{"name":"拆分","type":"primary empty","size":"small","round":true,"action":"resolution","role":"resolution","token":"Btn-Q2HFfIUGqcNbjoRVTWkyiAta","hide":"cfhide"}]}]}')},f238:function(t){t.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"首张单号","prop":"first","show":true,"color":"#999","width":140},{"label":"末张单号","prop":"last","show":true,"color":"#999","width":140},{"label":"数量","prop":"num","show":true,"color":"rgb(105, 218, 97)"},{"label":"状态","prop":"status_text","show":true},{"label":"领用大区","prop":"deptname","show":true,"width":150},{"label":"领用时间","prop":"create_time","show":true,"color":"#999","width":150},{"label":"录入人","prop":"uname","show":true},{"label":"录入时间","prop":"recordtime","show":true,"color":"#999","width":150},{"label":"剩余未发","prop":"surplus","show":true},{"label":"操作","prop":"","width":240,"type":"button","show":true,"btns":[{"name":"查看明细","type":"primary","size":"small","round":true,"action":"detail","role":"detail","token":"empty"},{"name":"发放","type":"primary empty","size":"small","hide":"ffhide","round":true,"action":"grant","role":"grant","token":"empty"}]}]}')}}]);