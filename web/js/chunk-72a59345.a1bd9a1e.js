(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-72a59345"],{"01af":function(e,t,a){"use strict";a("502b")},"502b":function(e,t,a){},5532:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"user-bind"}},[t("el-autocomplete",{ref:"searchInput",staticClass:"us-search",attrs:{"popper-class":"my-autocomplete",debounce:0,"fetch-suggestions":e.querySearchAsync,placeholder:"请输入姓名或电话号码搜索"},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function({item:a}){return[t("div",{staticClass:"tr-item"},[t("span",{staticClass:"td-item"},[e._v(e._s(a.realname))]),t("span",{staticClass:"td-item"},[e._v(e._s(a.sex?a.sex:"未知"))]),t("span",{staticClass:"td-item"},[e._v(e._s(a.tel))])]),e.allUserList.length>1&&a.id==e.allUserList[e.allUserList.length-1].id?t("div",{staticClass:"load-more",on:{click:function(t){return t.stopPropagation(),e.loadMore.apply(null,arguments)}}},[e._v(" "+e._s(e.nomore?"没有更多了":"点击加载更多")+" ")]):e._e(),e.allUserList.length<=1?t("div",{staticClass:"load-more",on:{click:function(t){return t.stopPropagation(),e.loadMore.apply(null,arguments)}}},[e._v(" 暂无数据！ ")]):e._e()]}}]),model:{value:e.autoValue,callback:function(t){e.autoValue=t},expression:"autoValue"}},[t("i",{staticClass:"iconfont iconzu3664 el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})])],1)},i=[],l={name:"UserBind",props:{vid:{type:[Number,String]}},data(){return{autoValue:"",currentUser:{},allUserList:[],nomore:!1}},mounted(){},methods:{async querySearchAsync(e,t){let a={keywords:e,page:1,limit:20,vid:this.vid},s=await this.$axios.post(this.$api.state.Means.userSearch.url,a);if(200===s.Code){let e={id:0,realname:"姓名",sex:"性别",tel:"电话号码"};s.Data.data.unshift(e),this.allUserList=s.Data.data,this.nomore=!1,t(s.Data.data)}else this.$refs.searchInput.$children[0].blur()},async loadMore(){if(!this.nomore){let e={keywords:this.autoValue,page:Math.ceil(this.allUserList.length/20)+1,limit:20,vid:this.vid},t=await this.$axios.post(this.$api.state.Means.userSearch.url,e);200===t.Code&&(t.Data.data.length>0?(this.allUserList=this.allUserList.concat(t.Data.data),this.$refs.searchInput.suggestions=this.allUserList):this.nomore=!0)}},handleSelect(e){this.currentUser=e,this.$emit("userSelected",e)}}},r=l,o=(a("01af"),a("1805")),n=Object(o["a"])(r,s,i,!1,null,null,null);t["a"]=n.exports},"58f6":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.starting,expression:"starting"}],attrs:{id:"carport","element-loading-text":"车位启用中"}},[t("div",{staticClass:"left-wp"},[t("div",{staticClass:"title"},[e._v("选择启用车位")]),t("div",{staticClass:"search-wrap"},[t("el-input",{staticClass:"search",attrs:{placeholder:"请输入项目名或编码","suffix-icon":"iconfont iconzu3664"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),t("el-scrollbar",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticStyle:{height:"calc(100% - 6.25rem)"}},[t("div",{staticClass:"tree-wrap"},[t("el-tree",{ref:"tree",staticClass:"filter-tree",attrs:{lazy:"",data:e.treeData,"node-key":"nodeid",accordion:"","show-checkbox":"","check-strictly":"",props:e.defaultProps,"filter-node-method":e.filterNode,load:e.loadNode},on:{"node-click":e.nodeClick,check:e.nodeCheck},scopedSlots:e._u([{key:"default",fn:function({node:a}){return t("span",{staticClass:"custom-tree-node"},["city"==a.data.type?t("i",{staticClass:"iconfont icondaqu"}):e._e(),"village"==a.data.type?t("i",{staticClass:"iconfont iconxiangmu"}):e._e(),"type"==a.data.type?t("i",{staticClass:"iconfont iconcheku"}):e._e(),t("span",{staticClass:"label"},[e._v(e._s(a.label))]),a.loading?t("span",[t("i",{staticClass:"el-icon-loading",staticStyle:{color:"#ccc","margin-right":"0.25rem","vertical-align":"middle","font-size":"0.7rem",position:"relative","z-index":"100"}}),t("span",{staticStyle:{"font-size":"0.6rem",color:"#ccc"}},[e._v("正在加载")])]):e._e()])}}])})],1)])],1),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.infoLoading,expression:"infoLoading"}],staticClass:"right-wp"},[!e.currentCarport||e.infoLoading?t("div",{staticClass:"empty"},[e._v(" 请在左侧选择具体车位！ ")]):t("div",{staticClass:"right-main"},[t("div",{staticClass:"top-wp"},[e._m(0),t("ul",{staticClass:"info-wp"},e._l(e.carportInfo,(function(a,s){return t("li",{key:s},[t("span",{staticClass:"name"},[e._v(e._s(a.name))]),t("span",{staticClass:"value"},[e._v(e._s(a.value))])])})),0)]),t("div",{staticClass:"bottom-wp"},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("user-bind",{attrs:{vid:e.cvid},on:{userSelected:e.userSelected}}),t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"客户姓名",prop:"uname"}},[t("el-input",{attrs:{placeholder:"请输入客户姓名",readonly:""},model:{value:e.ruleForm.uname,callback:function(t){e.$set(e.ruleForm,"uname",t)},expression:"ruleForm.uname"}})],1),t("el-form-item",{attrs:{label:"身份证号码",prop:"idcard"}},[t("el-input",{attrs:{placeholder:"请输入身份证号码",readonly:""},model:{value:e.ruleForm.idcard,callback:function(t){e.$set(e.ruleForm,"idcard",t)},expression:"ruleForm.idcard"}})],1),t("el-form-item",{attrs:{label:"客户类型",prop:"utype"}},[t("el-input",{attrs:{placeholder:"请输入客户类型",readonly:""},model:{value:e.ruleForm.utype,callback:function(t){e.$set(e.ruleForm,"utype",t)},expression:"ruleForm.utype"}})],1),t("el-form-item",{attrs:{label:"使用方式",prop:"method"}},[t("el-input",{attrs:{placeholder:"请输入使用方式",readonly:""},model:{value:e.ruleForm.method,callback:function(t){e.$set(e.ruleForm,"method",t)},expression:"ruleForm.method"}})],1),t("el-form-item",{attrs:{label:"联系电话",prop:"utel"}},[t("el-input",{attrs:{placeholder:"请输入联系电话"},model:{value:e.ruleForm.utel,callback:function(t){e.$set(e.ruleForm,"utel",t)},expression:"ruleForm.utel"}})],1),t("el-form-item",{attrs:{label:"启用日期",prop:"stime"}},[t("el-date-picker",{attrs:{type:"date",align:"center","value-format":"timestamp",placeholder:"请选择启用日期"},model:{value:e.ruleForm.stime,callback:function(t){e.$set(e.ruleForm,"stime",t)},expression:"ruleForm.stime"}})],1),t("el-form-item",{staticClass:"file-upload",attrs:{label:"上传合同文件",prop:"fileInfo"}},[t("el-upload",{ref:"upload",attrs:{action:e.qiniuDatas.domain,"list-type":"picture-card","http-request":e.customUpload,limit:1,"on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove}},[t("i",{staticClass:"el-icon-plus"})]),t("el-dialog",{attrs:{visible:e.dialogVisible,top:"5vh"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1),t("div",{staticClass:"title"},[e._v("绑定车牌")]),t("ul",{staticClass:"info-wp"},[e._l(e.ruleForm.plateInfo,(function(a,s){return t("li",{key:s},[t("el-form-item",{attrs:{label:"车牌号",prop:"plateInfo."+s+".plates",rules:{required:!0,message:"请输入车牌号",trigger:"blur"}}},[t("el-input",{attrs:{placeholder:"请输入车牌号"},model:{value:a.plates,callback:function(t){e.$set(a,"plates",t)},expression:"item.plates"}})],1),t("el-form-item",{attrs:{label:"车主姓名",prop:"plateInfo."+s+".name",rules:{required:!0,message:"请输入车主姓名",trigger:"blur"}}},[t("el-input",{attrs:{placeholder:"请输入车主姓名"},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"item.name"}})],1),t("el-form-item",{attrs:{label:"联系电话",prop:"plateInfo."+s+".tel",rules:{required:!0,message:"请输入联系电话",trigger:"blur"}}},[t("el-input",{attrs:{placeholder:"请输入联系电话"},model:{value:a.tel,callback:function(t){e.$set(a,"tel",t)},expression:"item.tel"}})],1),e.ruleForm.plateInfo.length>1?t("div",{staticClass:"info-item"},[t("div",{staticClass:"name"}),t("i",{staticClass:"el-icon-delete-solid",on:{click:function(t){return e.deletePlate(s)}}})]):e._e()],1)})),t("li",{staticClass:"ico-wp"},[t("div",{staticClass:"info-item"},[t("i",{staticClass:"iconfont iconxinzeng",on:{click:e.addPlate}})])])],2)],1),t("div",{staticClass:"btn-wp"},[e.$menu.getters.judgeRole("Btn-yDhyCBkmkyzD0xSdyNLKYfME")?t("el-button",{attrs:{type:"primary",round:""},on:{click:e.useConfirm}},[e._v(" 确认启用 ")]):e._e()],1)],1)],1)])])])},i=[function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"title"},[t("i",{staticClass:"iconfont iconcheku"}),t("span",[e._v("车位启用")])])}],l=(a("5948"),a("5532")),r=a("f31f"),o={name:"carport",components:{userBind:l["a"]},data(){return{urlObj:{treeData:this.$api.state.Means.treeData.url,parkingTree:this.$api.state.Means.parkingTree.url,carportInfo:this.$api.state.Means.carportInfo.url,bindUser:this.$api.state.Means.bindUser.url,uploadToken:this.$api.state.Public.uploadToken.url,saveUploadInfo:this.$api.state.Public.saveUploadInfo.url,delFile:this.$api.state.Public.delFile.url},isLoading:!1,infoLoading:!1,starting:!1,filterText:"",treeData:[],defaultProps:{children:"children",label:"label",isLeaf:"isLeaf"},currentCarport:null,filterText:"",carportInfo:[],qiniuDatas:"",dialogImageUrl:"",dialogVisible:!1,ruleForm:{oid:"",uname:"",idcard:"",utype:"",method:"",utel:"",stime:"",fileInfo:"",plateInfo:[{plates:"",name:"",tel:""}]},rules:{uname:[{required:!0,message:"请输入客户姓名",trigger:"change"}],idcard:[{required:!0,message:"请输入身份证号码",trigger:"change"}],utype:[{required:!0,message:"请输入客户类型",trigger:"change"}],method:[{required:!0,message:"请输入使用方式",trigger:"change"}],utel:[{required:!0,message:"请输入联系电话",trigger:"change"}],stime:[{required:!0,message:"请选择启用日期",trigger:"change"}],fileInfo:[{required:!0,message:"请上传合同文件",trigger:"change"}]},cvid:""}},watch:{filterText(e){this.$refs.tree.filter(e)}},created(){this.getUploadToken()},methods:{getUploadToken(){this.$axios.post(this.urlObj.uploadToken).then(e=>{200===e.Code&&(this.qiniuDatas=e.Data)})},async getTreeData(e,t){let a=await this.$axios.post(this.urlObj.treeData,e);this.isLoading=!1;let s=[];200==a.Code?(a.Data.forEach(t=>{e.vid?t.disabled=!1:(t.disabled=!0,t.children.forEach(e=>{e.isLeaf=!1})),t.nodeid=t.type+t.id}),s=a.Data):this.$message({message:"获取数据失败！",type:"error"}),t(s)},filterNode(e,t){return!e||-1!==t.label.indexOf(e)},async loadNode(e,t){if(0==e.level){let e={secondData:0};this.isLoading=!0,this.getTreeData(e,t)}else if(2==e.level){let a=await this.$axios.post(this.urlObj.parkingTree,{vid:e.data.id});if(200===a.Code){let e=[];a.Data.forEach(t=>{let a={id:t.id,type:"type",nodeid:"type"+t.id,isLeaf:!(t.car&&t.car.length>0),label:t.name,disabled:!0,children:t.car?t.car:[]};e.push(a)}),t(e)}else this.$message({message:"获取数据失败！",type:"error"}),t([])}else 3==e.level?(e.data.children.forEach(e=>{e.disabled=!1,e.type="carnum",e.nodeid=e.type+e.id,e.label=e.sort,e.isLeaf=!0}),t(e.data.children)):(e.data.children.forEach(e=>{e.disabled=!0,e.nodeid=e.type+e.id}),t(e.data.children))},nodeClick(e){this.$nextTick(()=>{e.disabled||(this.$refs.tree.setCheckedNodes([e]),this.checkChange(e))})},nodeCheck(e){e.disabled||(this.$refs.tree.setCheckedNodes([e]),this.checkChange(e))},checkChange(e){this.currentCarport&&this.currentCarport.id==e.id||(this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.ruleForm={oid:"",uname:"",idcard:"",utype:"",method:"",utel:"",stime:"",fileInfo:"",plateInfo:[{plates:"",name:"",tel:""}]},this.currentCarport=e,this.infoLoading=!0,this.$axios.post(this.urlObj.carportInfo,{id:e.id}).then(e=>{if(200===e.Code){this.cvid=e.Data.vid;let t=e.Data.subject_arr.map(e=>e.name),a=e.Data.subject_arr.map(e=>e.money),s=[{name:"车位编号",value:e.Data.sort?e.Data.sort:"--"},{name:"资源类型",value:e.Data.resourcestype?e.Data.resourcestype.name:"--"},{name:"收费科目",value:t.length>0?t.join("、"):"--"},{name:"车位面积",value:e.Data.area?e.Data.area+"m²":"--"},{name:"每月费用",value:a.length>0?a.join("、")+"元":"--"}];this.carportInfo=s}else this.$message({message:"获取数据失败！",type:"error"});this.infoLoading=!1}).catch(e=>{this.$message({message:"获取数据失败！",type:"error"}),this.infoLoading=!1}))},userSelected(e){this.ruleForm.oid=e.id,this.ruleForm.uname=e.realname,this.ruleForm.idcard=e.idcard,this.ruleForm.utype=e.owner_type.name,this.ruleForm.method="购买",this.ruleForm.utel=e.tel,this.ruleForm.plateInfo[0].name=e.realname,this.ruleForm.plateInfo[0].tel=e.tel},customUpload(e){e.url=this.$refs.upload.uploadFiles[0].url;let t=Object(r["a"])(e,this.qiniuDatas);t.observable.subscribe({next:e=>{},error:e=>{},complete:a=>{this.saveFile(t.fileInfo,e.file.uid)}})},saveFile(e,t){this.$axios.post(this.urlObj.saveUploadInfo,e).then(e=>{if(200===e.Code)this.ruleForm.fileInfo={id:e.Data.id,uid:t},this.$refs.ruleForm.validateField("fileInfo");else{let t=e.Message?e.Message:"文件信息保存失败！";this.$message({message:t,type:"error"})}})},handleRemove(){this.$axios.post(this.urlObj.delFile,{id:this.ruleForm.fileInfo.id}).then(e=>{if(200!=e.Code){let t=e.Message?e.Message:"文件删除失败！";this.$message({message:t,type:"error"})}}).catch(()=>{}),this.ruleForm.fileInfo="",this.$refs.ruleForm.validateField("fileInfo")},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},addPlate(){let e={name:"",phone:"",plate:""};this.ruleForm.plateInfo.push(e)},deletePlate(e){this.ruleForm.plateInfo.splice(e,1)},useConfirm(){this.$refs.ruleForm.validate(e=>{if(e){this.starting=!0;let e={id:this.currentCarport.id,oid:this.ruleForm.oid,non_owner_tel:this.ruleForm.utel,starttime:this.ruleForm.stime/1e3,plates:this.ruleForm.plateInfo,ht_file_id:this.ruleForm.fileInfo.id};this.registerRequst(e)}})},registerRequst(e){this.$axios.post(this.urlObj.bindUser,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:"车位启用成功！"}),this.$refs.tree.remove(this.currentCarport),this.currentCarport=null,this.filterText="",this.carportInfo=[],this.dialogImageUrl="";else{let t=e.Message?e.Message:"车位启用失败！";this.$message({type:"error",message:t})}this.starting=!1}).catch(e=>{this.$message({type:"error",message:"车位启用失败！"}),this.starting=!1})}}},n=o,d=(a("bf63"),a("1805")),c=Object(d["a"])(n,s,i,!1,null,null,null);t["default"]=c.exports},"9e2f":function(e,t,a){},bf63:function(e,t,a){"use strict";a("9e2f")}}]);