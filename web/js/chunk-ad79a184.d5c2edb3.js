(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ad79a184"],{"0a61":function(e,t,s){},"15f3":function(e,t,s){},"1da6":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"资源名称","prop":"title","show":true},{"label":"类型","prop":"type_name","show":true},{"label":"科目名称","prop":"subName","show":true,"color":"#999"},{"label":"应收月份","prop":"ymonth","show":true,"color":"#69da61"},{"label":"描述","prop":"describe","show":true,"color":"#999","width":200},{"label":"生成人","prop":"cname","show":true},{"label":"本次应收","prop":"money","show":true,"color":"#ffcb3c"},{"label":"审批类型","prop":"apply_type","show":true,"width":100},{"label":"操作","prop":"","width":120,"type":"button","show":true,"btns":[{"name":"修改金额","type":"primary","size":"small","round":true,"class":"sys-btn","action":"moneyEdit","role":"moneyEdit","disabled":"is_apply","token":"empty"}]}]}')},"29a0":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"科目名称","prop":"subject_name","show":true,"color":"#999"},{"label":"实收金额","prop":"real_money","show":true},{"label":"收款人","prop":"payee","show":true,"color":"#999"},{"label":"类型","prop":"resources_model_type_name","show":true,"color":"#999"},{"label":"收款时间","prop":"pay_time","show":true,"color":"#999","width":150},{"label":"退款状态","prop":"refund_status_text","show":true,"color":"#69da61"},{"label":"可退金额","prop":"ktmoney","show":true,"color":"#ffcb3c"},{"label":"已退金额","prop":"refund_money","show":true},{"label":"退款时间","prop":"last_refund_cost_time","show":true,"width":160},{"label":"票据号","prop":"sn","show":true,"color":"#999","width":210},{"label":"缴费内容","prop":"describe","show":true,"color":"#999","width":200},{"label":"操作","prop":"","width":100,"type":"button","show":true,"btns":[{"name":"退款","type":"primary","size":"small","round":true,"disabled":"disabled","class":"sys-btn","action":"refund","role":"refund","token":"empty"}]}]}')},"2a54":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"附件名称","prop":"filename","show":true},{"label":"附件大小","prop":"size","show":true,"color":"#999"},{"label":"上传日期","prop":"time","show":true,"color":"#999"},{"label":"操作","prop":"","type":"button","show":true,"btns":[{"name":"删除","type":"error","size":"small","round":true,"action":"delete","role":"delete","token":"empty"}]}]}')},"4e95":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"费用名称","prop":"subject_name","show":true},{"label":"缴费内容","prop":"describe","show":true,"color":"#999","width":200},{"label":"实收金额","prop":"real_money","show":true},{"label":"退款金额","prop":"ktmoney","show":true,"color":"#ffcb3c"}]}')},"4f66":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"交款客户","prop":"realname","show":true},{"label":"订单号","prop":"sn","show":true,"color":"#999","width":150},{"label":"收费时间","prop":"pay_time","show":true,"color":"#999","width":150},{"label":"总金额","prop":"allmoney","show":true,"color":"#ffcb3c"},{"label":"实缴金额","prop":"money","show":true,"color":"#ffcb3c"},{"label":"付款方式","type":"select","prop":"type","show":true,"color":"#999","placeholder":"请选择付款方式","options":"options","width":150,"action":"selectChange"},{"label":"票据号","prop":"fphm","show":true,"color":"#999"},{"label":"收费员","prop":"cname","show":true,"color":"#999"},{"label":"状态","prop":"status_text","show":true,"color":"#999"},{"label":"缴费内容","prop":"remark","show":true,"color":"#999","width":200},{"label":"操作时间","prop":"create_time","show":true,"color":"#999","width":160},{"label":"详情","width":"100","type":"icon","icon":"detail","show":true,"action":"detail","token":"Btn-qo8Iv6QW1E87pcb4LWAzgib1"},{"label":"打印","width":"60","type":"icon","icon":"print","show":true,"action":"print","token":"Btn-EQZwdMDo96McSceAy2nfIlUc"},{"label":"操作","width":"150","type":"button","show":true,"btns":[{"name":"返销","type":"warning","size":"small","round":true,"action":"buyBack","role":"buyBack","disabled":"disabled","token":"Btn-Ca4BnJLT1Yl51cx9f0icJESk"}]}]}')},"547e":function(e,t,s){},"59f6":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"add-charge"}},[t("div",{staticClass:"tree-wp"},[t("tree-search",{ref:"treeSearch",attrs:{type:"charge"},on:{checkChange:e.checkChange}})],1),t("div",{staticClass:"main-wp"},[e.currentUser.id?e._e():t("div",{staticClass:"empty-tip"},[e._v(" 请在左侧选择具体资源查询！ ")]),e.currentUser.id?t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"left-wp"},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("div",{staticClass:"room-info"},[t("div",{staticClass:"top-wp"},[t("span",{staticClass:"title"},[e._v("房源信息")]),"rooms"==e.currentUser.type?t("el-select",{attrs:{placeholder:"请选择用户"},on:{change:e.pageInit},model:{value:e.typeVal,callback:function(t){e.typeVal=t},expression:"typeVal"}},e._l(e.typeOptions,(function(e){return t("el-option",{key:e.oid,attrs:{label:e.name,value:e.oid}})})),1):e._e()],1),t("div",{staticClass:"bottom-wp"},[t("div",{staticClass:"wallet"},[t("div",{staticClass:"money"},[e._v(e._s(e.ownerBalance))]),t("div",{staticClass:"name"},[e._v("零钱包(元)")])]),t("div",{staticClass:"btn-wp"},[t("div",{staticClass:"btn-top"},[t("el-button",{attrs:{type:"primary",round:""},on:{click:e.recharge}},[e._v(" 预存款 ")]),t("el-button",{attrs:{type:"primary empty",round:""},on:{click:e.balanceMove}},[e._v(" 零钱转移 ")])],1),e.$menu.getters.judgeRole("Btn-Swd5D5XQWGmHHLrAbMYgReoU")?t("el-button",{staticClass:"vip-btn",attrs:{type:"warning",round:""},on:{click:e.vipRefund}},[e._v(" VIP退款 ")]):e._e()],1),t("div",{staticClass:"resource-icon"},[t("i",{class:["iconfont","iconzu3663",e.ownresources.includes("house")?"active":""]}),t("i",{class:["iconfont","icona-lujing443",e.ownresources.includes("car")?"active":""]}),t("i",{class:["iconfont","iconcheku",e.ownresources.includes("carmonth")?"active":""]}),t("i",{class:["iconfont","icona-zu4213",e.ownresources.includes("water_ele_gas")?"active":""]}),t("i",{class:["iconfont","iconqitaziyuan",e.ownresources.includes("virtual")?"active":""]})]),"rooms"==e.currentUser.type&&e.resourceInfo?t("div",{staticClass:"rooms-wp"},[t("div",{staticClass:"title"},[t("i",{staticClass:"iconfont iconzu3663"}),t("span",{staticClass:"value"},[e._v("房号 "+e._s(e.resourceInfo.name))])]),t("div",{staticClass:"content"},[t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("产权面积")]),t("span",{staticClass:"value"},[e._v(e._s(e.resourceInfo.buildareas)+"m²")])]),t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("联系人")]),t("span",{staticClass:"value"},[e._v(e._s(e.resourceInfo.realname))])]),t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("联系电话")]),t("el-tooltip",{attrs:{effect:"dark",content:e.resourceInfo.tel,placement:"top"}},[t("span",{staticClass:"value"},[e._v(e._s(e.resourceInfo.tel))])])],1),t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("居住关系")]),t("span",{staticClass:"value"},[e._v(e._s(e.resourceInfo.type_name))])]),t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("交房日期")]),t("span",{staticClass:"value"},[e._v(" "+e._s(e.resourceInfo.delivery_date?e.resourceInfo.delivery_date:"--")+" ")])]),t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("开始缴费")]),t("span",{staticClass:"value"},[e._v(" "+e._s(e.resourceInfo.turned?e.resourceInfo.turned:"--")+" ")])]),t("div",{staticClass:"info-item btn"},[t("span",{staticClass:"name"},[e._v("是否装修")]),0==e.resourceInfo.isdecorate?t("span",{staticClass:"value",on:{click:function(t){return e.showFitment(0)}}},[e._v(" 未装修 ")]):1==e.resourceInfo.isdecorate?t("span",{staticClass:"value yet",on:{click:function(t){return e.showFitment(1)}}},[e._v(" 已装修 ")]):2==e.resourceInfo.isdecorate?t("span",{staticClass:"value being",on:{click:function(t){return e.showFitment(2)}}},[e._v(" 装修中 ")]):e._e()]),e.resourceInfo.approach_time?t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("入场时间")]),t("span",{staticClass:"value"},[e._v(" "+e._s(e.resourceInfo.approach_time)+" ")])]):t("div",{staticClass:"info-item btn"},[t("span",{staticClass:"name"},[e._v("入场时间")]),t("el-date-picker",{attrs:{type:"date",clearable:!1,"value-format":"timestamp",placeholder:"添加入场时间"},on:{change:e.dateChange},model:{value:e.dateVal,callback:function(t){e.dateVal=t},expression:"dateVal"}})],1),t("div",{staticClass:"info-item"},[t("span",{staticClass:"name",staticStyle:{"line-height":"29px"}},[e._v("是否交房")]),1==e.resourceInfo.check?t("span",{staticClass:"status-text bg-green"},[e._v(" 已交房 ")]):t("span",{staticClass:"status-text bg-red",on:{click:function(t){return e.onDeliveryHouse("room")}}},[e._v(" 未交房 ")])]),e._l(e.resourceInfo.subject,(function(s,a){return t("div",{key:a,staticClass:"info-item"},[s.name.length>4?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:s.name,placement:"top"}},[t("span",{staticClass:"name"},[e._v(e._s(s.name))])]):t("span",{staticClass:"name"},[e._v(e._s(s.name))]),t("span",{staticClass:"value"},[e._v(e._s(s.money)+"元")])],1)})),t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("销售状态")]),t("span",{staticClass:"value"},[e._v(" "+e._s(0==e.resourceInfo.isvacancy?"已售":"未售")+" ")])])],2)]):"owner"!=e.currentUser.type&&e.resourceInfo?t("div",{staticClass:"stall-wp"},[t("div",{staticClass:"title"},[t("i",{staticClass:"iconfont iconcheku"}),t("span",{staticClass:"value"},[e._v(" "+e._s(("car"==e.currentUser.type?"固定车位":"carmonth"==e.currentUser.type?"月租车":"car_nonmotor"==e.currentUser.type?"非机动车":"其他资源")+" "+e.resourceInfo.name)+" ")])]),t("div",{staticClass:"content"},["car"==e.currentUser.type?t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("车位面积")]),t("span",{staticClass:"value"},[e._v(e._s(e.resourceInfo.area)+"m²")])]):e._e(),t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("联系人")]),t("span",{staticClass:"value"},[e._v(" "+e._s(e.resourceInfo.realname?e.resourceInfo.realname:"--")+" ")])]),t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("联系电话")]),e.resourceInfo.tel?t("el-tooltip",{attrs:{effect:"dark",content:e.resourceInfo.tel,placement:"top"}},[t("span",{staticClass:"value"},[e._v(" "+e._s(e.resourceInfo.tel)+" ")])]):t("span",{staticClass:"value"},[e._v(" -- ")])],1),e._l(e.resourceInfo.subject,(function(s,a){return t("div",{key:a,staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v(e._s(s.name))]),t("span",{staticClass:"value"},[e._v(e._s(s.money)+"元")])])})),"car"==e.currentUser.type?t("div",{staticClass:"info-item"},[t("span",{staticClass:"name",staticStyle:{"line-height":"29px"}},[e._v("是否交房")]),1==e.resourceInfo.check?t("span",{staticClass:"status-text bg-green"},[e._v(" 已交房 ")]):t("span",{staticClass:"status-text bg-red",on:{click:function(t){return e.onDeliveryHouse("car")}}},[e._v(" 未交房 ")])]):e._e()],2)]):e._e()])]),"owner"!=e.currentUser.type?t("div",{staticClass:"other-info"},[t("div",{staticClass:"top-wp"},[t("span",{staticClass:"title"},[e._v("查看其它资源")]),t("el-switch",{attrs:{"active-color":"#3ebb75","inactive-color":"#f2f2f2"},model:{value:e.switchVal,callback:function(t){e.switchVal=t},expression:"switchVal"}})],1),e.switchVal?t("div",{staticClass:"bottom-wp"},[0===e.otherResourceInfo.length?t("div",{staticClass:"other-empty"},[e._v(" 暂无其它资源 ")]):e._e(),e._l(e.otherResourceInfo,(function(s,a){return t("div",{key:a,staticClass:"rooms-wp"},[t("div",{staticClass:"title",on:{click:function(t){return e.toOther(s)}}},["rooms"==s.type?t("i",{staticClass:"iconfont iconzu3663"}):"car"==s.type||"carmonth"==s.type||"car_nonmotor"==s.type?t("i",{staticClass:"iconfont iconcheku"}):t("i",{staticClass:"iconfont iconqitaziyuan"}),"carmonth"==s.type?t("span",{staticClass:"value"},[e._v(" 月租车 "+e._s(s.name.join("、"))+" ")]):t("span",{staticClass:"value"},[e._v(" "+e._s(("car"==s.type?"固定车位":"car_nonmotor"==s.type?"非机动车":"rooms"==s.type?"房号":"虚拟资源")+" "+s.name)+" ")])]),t("div",{staticClass:"content"},[t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("联系人")]),t("span",{staticClass:"value"},[e._v(e._s(s.realname))])]),t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("联系电话")]),t("el-tooltip",{attrs:{effect:"dark",content:s.tel,placement:"top"}},[t("span",{staticClass:"value"},[e._v(e._s(s.tel))])])],1),"rooms"==s.type?t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("产权面积")]),t("span",{staticClass:"value"},[e._v(e._s(s.buildareas)+"m²")])]):e._e(),"rooms"==s.type?t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("居住关系")]),t("span",{staticClass:"value"},[e._v(e._s(s.type_name))])]):e._e(),"rooms"==s.type?t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("交房日期")]),t("span",{staticClass:"value"},[e._v(" "+e._s(s.delivery_date?s.delivery_date:"--")+" ")])]):e._e(),"rooms"==s.type?t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("开始缴费")]),t("span",{staticClass:"value"},[e._v(" "+e._s(s.turned?s.turned:"--")+" ")])]):e._e(),"rooms"==s.type?t("div",{staticClass:"info-item btn"},[t("span",{staticClass:"name"},[e._v("是否装修")]),0==s.isdecorate?t("span",{staticClass:"value",on:{click:function(t){return e.showOtherFitment(0,s)}}},[e._v(" 未装修 ")]):1==s.isdecorate?t("span",{staticClass:"value yet",on:{click:function(t){return e.showOtherFitment(1,s)}}},[e._v(" 已装修 ")]):2==s.isdecorate?t("span",{staticClass:"value being",on:{click:function(t){return e.showOtherFitment(2,s)}}},[e._v(" 装修中 ")]):e._e()]):e._e(),"rooms"==s.type?t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("是否交房")]),t("span",{staticClass:"value"},[e._v(" "+e._s(1==s.check?"已交房":"未交房")+" ")])]):e._e(),"car"==s.type?t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("车位面积")]),t("span",{staticClass:"value"},[e._v(e._s(s.area)+"m²")])]):e._e(),e._l(s.subject,(function(s,a){return t("div",{key:a,staticClass:"info-item"},[s.name.length>4?t("el-tooltip",{attrs:{effect:"dark",content:s.name,placement:"top"}},[t("span",{staticClass:"name"},[e._v(e._s(s.name))])]):t("span",{staticClass:"name"},[e._v(e._s(s.name))]),t("span",{staticClass:"value"},[e._v(e._s(s.money)+"元")])],1)}))],2)])}))],2):e._e()]):e._e()])],1):e._e(),e.currentUser.id?t("div",{staticClass:"right-wp"},[t("div",{staticClass:"charge-interface"},[t("div",{staticClass:"main-content"},["owner"!=e.currentUser.type?t("ul",{staticClass:"option-wp"},[t("li",{class:["option-item",0===e.opIndex?"active":""],on:{click:e.gotoPay}},[t("i",{staticClass:"iconfont iconjiaofei"}),e._v(" 进行缴费 ")]),e.$menu.getters.judgeRole("Btn-U7SVJ7YDbQono4HQoeM7pFgf")?t("li",{class:["option-item",1===e.opIndex?"active":""],on:{click:function(t){e.opIndex=1}}},[t("i",{staticClass:"iconfont iconxinzeng"}),e._v(" 添加费用 ")]):e._e(),e.$menu.getters.judgeRole("Btn-BzocvXddvs7dmwZr6CX8IPzD")?t("li",{class:["option-item",2===e.opIndex?"active":""],on:{click:function(t){e.opIndex=2}}},[t("i",{staticClass:"iconfont iconjiaofei"}),e._v(" 历史缴费 ")]):e._e(),e.$menu.getters.judgeRole("Btn-rgLeclNJYzoPftjBSAyHPr1r")?t("li",{class:["option-item",3===e.opIndex?"active":""],on:{click:function(t){e.opIndex=3}}},[t("i",{staticClass:"iconfont iconbianji"}),e._v(" 欠费调整 ")]):e._e(),e.$menu.getters.judgeRole("Btn-Rry9xPZqclbeo9oXkl3nXcAu")?t("li",{class:["option-item",4===e.opIndex?"active":""],on:{click:function(t){e.opIndex=4}}},[t("i",{staticClass:"iconfont icontuikuan"}),e._v(" 退款管理 ")]):e._e(),0===e.opIndex?t("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择资源名称"},on:{change:e.recordNameChange},model:{value:e.nameVal,callback:function(t){e.nameVal=t},expression:"nameVal"}},e._l(e.recordNames,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):e._e()],1):e._e(),1==e.opIndex?t("ChargeAdd",{attrs:{vid:e.currentVid,currentUser:e.currentUser}}):2==e.opIndex?t("PaymentHistory",{attrs:{vid:e.currentVid,oid:e.currentUser.oid}}):3==e.opIndex?t("ChargeAdjust",{attrs:{currentUser:e.currentUser}}):4==e.opIndex?t("RefundManage",{ref:"refundManage",attrs:{vid:e.currentVid,oid:e.currentUser.oid}}):e._e(),t("div",{staticClass:"charge-record"},[t("div",{staticClass:"table-wp"},[t("vxe-table",{directives:[{name:"loading",rawName:"v-loading",value:e.recordConf.loadStatus,expression:"recordConf.loadStatus"}],ref:"recordTable",attrs:{stripe:"","auto-resize":"",height:"auto","show-overflow":"","highlight-hover-row":"",align:"center",data:e.recordTable,"element-loading-text":"数据获取中..."},on:{"checkbox-all":e.selectAllEvent,"checkbox-change":e.selectChangeEvent}},[t("vxe-column",{attrs:{type:"checkbox",width:"60"}}),e._l(e.recordColumns,(function(s,a){return t("vxe-table-column",{key:a,attrs:{field:s.prop,title:s.label,"show-overflow":""},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",{style:{color:s.color?s.color:"#333"}},[e._v(" "+e._s(a[s.prop])+" ")])]}}],null,!0)})}))],2)],1),t("div",{staticClass:"total-ct"},[t("div",{staticClass:"total-wp"},[t("span",{staticClass:"name"},[e._v("已选总合计")]),t("span",{staticClass:"value yellow"},[e._v(e._s(e.inventAmount)+"元")])]),t("div",{staticClass:"total"},[e._v("欠费总合计： "+e._s(e.recordTotal)+"元")])])]),t("div",{staticClass:"charge-btn"},[t("el-button",{attrs:{type:"warning empty",round:""},on:{click:e.tempClear}},[e._v(" 清空临时欠费 ")]),t("el-button",{attrs:{disabled:0===e.recordSelected.length,type:"primary",round:""},on:{click:e.paymentInit}},[e._v(" 确认缴费 ")])],1)],1)])]):e._e()]),t("el-dialog",{staticClass:"moveDialog",attrs:{visible:e.showMoveDialog,title:"零钱转移",width:"36%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showMoveDialog=t}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("el-autocomplete",{ref:"searchInput",staticClass:"prestore-search",attrs:{"popper-class":"my-autocomplete","fetch-suggestions":e.querySearchAsync,placeholder:"请输入业主姓名、手机号或房号"},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function({item:s}){return[t("div",{staticClass:"tr-item"},[t("span",{staticClass:"td-item"},[e._v(e._s(s.username))]),t("span",{staticClass:"td-item"},[e._v(e._s(s.tel))]),t("span",{staticClass:"td-item"},[e._v(e._s(s.title))])]),e.allUserList.length<=1?t("div",{staticClass:"load-more"},[e._v(" 暂无数据！ ")]):e._e()]}}]),model:{value:e.autoValue,callback:function(t){e.autoValue=t},expression:"autoValue"}},[t("i",{staticClass:"iconfont iconzu3664 el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})]),t("el-form",{ref:"moveForm",attrs:{model:e.moveForm,rules:e.moveRules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"项目名称",prop:"vname"}},[t("el-input",{attrs:{placeholder:"请输入项目名称",readonly:""},model:{value:e.moveForm.vname,callback:function(t){e.$set(e.moveForm,"vname",t)},expression:"moveForm.vname"}})],1),t("el-form-item",{attrs:{label:"选择楼栋",prop:"build"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择楼栋"},on:{change:e.buildChange},model:{value:e.moveForm.build,callback:function(t){e.$set(e.moveForm,"build",t)},expression:"moveForm.build"}},e._l(e.buildOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.block,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"选择单元",prop:"unit"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择单元"},on:{change:e.unitChange},model:{value:e.moveForm.unit,callback:function(t){e.$set(e.moveForm,"unit",t)},expression:"moveForm.unit"}},e._l(e.unitOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.unit,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"选择房号",prop:"room"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择房号"},on:{change:e.roomChange},model:{value:e.moveForm.room,callback:function(t){e.$set(e.moveForm,"room",t)},expression:"moveForm.room"}},e._l(e.roomOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.roomnum,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"选择客户",prop:"uid"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择客户"},model:{value:e.moveForm.uid,callback:function(t){e.$set(e.moveForm,"uid",t)},expression:"moveForm.uid"}},e._l(e.userOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"转移金额",prop:"money"}},[t("span",{staticClass:"tip"},[e._v("(余额: "+e._s(e.ownerBalance)+")")]),t("el-input",{attrs:{type:"number",placeholder:"请输入转移金额"},model:{value:e.moveForm.money,callback:function(t){e.$set(e.moveForm,"money",t)},expression:"moveForm.money"}})],1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.moveSubmit}},[e._v(" 确认转移 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showMoveDialog=!1}}},[e._v(" 取消 ")])],1)],1),t("el-dialog",{staticClass:"vipDialog",attrs:{visible:e.showVipDialog,title:"VIP退款",width:"35%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showVipDialog=t}}},[t("el-form",{ref:"vipForm",attrs:{model:e.vipForm,rules:e.vipRules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"退款科目",prop:"subject"}},[t("el-select",{attrs:{placeholder:"请选择退款科目"},on:{change:e.subChange},model:{value:e.vipForm.subject,callback:function(t){e.$set(e.vipForm,"subject",t)},expression:"vipForm.subject"}},e._l(e.subOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"资源名称",prop:"name"}},[t("el-input",{attrs:{readonly:!0,placeholder:"请输入资源名称"},model:{value:e.vipForm.name,callback:function(t){e.$set(e.vipForm,"name",t)},expression:"vipForm.name"}})],1),t("el-form-item",{attrs:{label:"资源面积",prop:"area"}},[t("el-input",{attrs:{readonly:!0,placeholder:"请输入资源面积"},model:{value:e.vipForm.area,callback:function(t){e.$set(e.vipForm,"area",t)},expression:"vipForm.area"}})],1),t("el-form-item",{attrs:{label:"资源单价",prop:"price"}},[t("el-input",{attrs:{readonly:!0,placeholder:"请输入资源单价"},model:{value:e.vipForm.price,callback:function(t){e.$set(e.vipForm,"price",t)},expression:"vipForm.price"}})],1),t("el-form-item",{attrs:{label:"截止日期",prop:"etime"}},[t("el-date-picker",{attrs:{readonly:!0,type:"date",align:"center","value-format":"timestamp",placeholder:"请选择截止日期"},model:{value:e.vipForm.etime,callback:function(t){e.$set(e.vipForm,"etime",t)},expression:"vipForm.etime"}})],1),t("el-form-item",{attrs:{label:"退款时间",prop:"rtime"}},[t("el-date-picker",{attrs:{type:"date",align:"center","picker-options":e.pickerOptions,"value-format":"timestamp",placeholder:"请选择退款时间"},model:{value:e.vipForm.rtime,callback:function(t){e.$set(e.vipForm,"rtime",t)},expression:"vipForm.rtime"}})],1)],1),t("div",{staticClass:"tip"},[e._v(" 注意：VIP退费操作会删除从退款日期开始到VIP截止日之间的交费记录！ ")]),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.vipSubmit}},[e._v(" 确认退款 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showVipDialog=!1}}},[e._v(" 取消 ")])],1)],1),t("Fitment",{ref:"fitment",attrs:{vid:e.currentVid,balance:e.ownerBalance},on:{getBasicInfo:e.getBasicInfo}}),t("el-dialog",{staticClass:"paymentDialog",attrs:{visible:e.showPaymentDialog,title:e.isRecharge?"预存款":"开始缴费",width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showPaymentDialog=t}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("a",{ref:"adom",staticStyle:{display:"none"},attrs:{href:e.downloadUrl,target:"_blank"}}),t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"hide-required-asterisk":!0}},[e._l(e.infoList,(function(s,a){return t("el-form-item",{key:a,attrs:{label:s.name,prop:s.value}},["select"==s.type?t("el-select",{attrs:{clearable:"",placeholder:"请选择"+s.name},model:{value:e.ruleForm[s.value],callback:function(t){e.$set(e.ruleForm,s.value,t)},expression:"ruleForm[item.value]"}},e._l(s.options,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1):"time"===s.type?t("el-date-picker",{attrs:{type:"datetime",placeholder:"选择收款时间","value-format":"timestamp",disabled:s.readonly},model:{value:e.ruleForm[s.value],callback:function(t){e.$set(e.ruleForm,s.value,t)},expression:"ruleForm[item.value]"}}):t("el-input",{attrs:{type:s.type,readonly:s.readonly,placeholder:"请输入"+s.name},on:{change:function(t){return e.moneyChange(s)}},model:{value:e.ruleForm[s.value],callback:function(t){e.$set(e.ruleForm,s.value,t)},expression:"ruleForm[item.value]"}}),!e.isRecharge&&s.useBalance?t("div",{staticClass:"balance"},[e._v(" 使用预存(余额:￥"+e._s(e.ownerBalance)+") "),t("el-checkbox",{attrs:{disabled:Number(e.ownerBalance)<Number(e.ruleForm.reality)},model:{value:e.useBalance,callback:function(t){e.useBalance=t},expression:"useBalance"}})],1):e._e()],1)})),3==e.receiptType?t("el-form-item",{attrs:{label:"收据类型",prop:"receiptType"}},[t("el-select",{attrs:{placeholder:"请选择收据类型",clearable:""},model:{value:e.ruleForm.receiptType,callback:function(t){e.$set(e.ruleForm,"receiptType",t)},expression:"ruleForm.receiptType"}},[t("el-option",{attrs:{label:"电子收据",value:1}}),t("el-option",{attrs:{label:"纸质收据",value:2}})],1)],1):e._e(),2==e.receiptType||3==e.receiptType&&2==e.ruleForm.receiptType?t("el-form-item",{attrs:{label:"是否生成纸质收据",prop:"isPaper"}},[t("el-select",{attrs:{placeholder:"请选择是否生成纸质收据",clearable:""},model:{value:e.ruleForm.isPaper,callback:function(t){e.$set(e.ruleForm,"isPaper",t)},expression:"ruleForm.isPaper"}},[t("el-option",{attrs:{label:"否",value:0}}),t("el-option",{attrs:{label:"是",value:1}})],1)],1):e._e(),e.isRecharge?e._e():t("div",{staticClass:"tips"},[e._v(" 1.余额不足时，不能选择划账！ "),t("br")]),e.ruleForm.method==e.freeId?t("el-form-item",{staticClass:"remark",attrs:{label:"上传附件",prop:"fileInfo"}},[e.qiniuDatas.domain?t("el-upload",{ref:"upload",attrs:{action:e.qiniuDatas.domain,"http-request":e.customUpload,"on-remove":e.handleRemove}},[t("el-button",{attrs:{type:"primary"}},[e._v(" 点击上传 ")])],1):e._e()],1):e._e(),t("el-form-item",{staticClass:"remark",attrs:{label:"备注说明",prop:"remark"}},[t("el-input",{attrs:{type:"textarea",resize:"none",rows:3},model:{value:e.ruleForm.remark,callback:function(t){e.$set(e.ruleForm,"remark",t)},expression:"ruleForm.remark"}})],1)],2)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.paymentConfirm}},[e._v(" 确认缴费 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showPaymentDialog=!1}}},[e._v(" 取消 ")])],1)],1)],1)},i=[],r=(s("5948"),s("db3c")),o=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"fitment"}},[t("el-dialog",{staticClass:"unfurnished",attrs:{visible:e.showUnfurnished,title:e.isCharge?"添加收费":"录入装修资料",width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showUnfurnished=t},close:e.dialogClose}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("div",{staticClass:"basic-info"},[t("div",{staticClass:"info-item"},[t("div",{staticClass:"name"},[e._v("业主姓名")]),t("div",{staticClass:"value black"},[e._v(e._s(e.fitmentInfo.owner_name))])]),t("div",{staticClass:"info-item"},[t("div",{staticClass:"name"},[e._v("房间编号")]),t("div",{staticClass:"value black"},[e._v(e._s(e.fitmentInfo.name))])]),t("div",{staticClass:"info-item"},[t("div",{staticClass:"name"},[e._v("联系电话")]),t("div",{staticClass:"value"},[e._v(e._s(e.fitmentInfo.tel))])]),t("div",{staticClass:"info-item"},[t("div",{staticClass:"name"},[e._v("身份证号")]),t("div",{staticClass:"value"},[e._v(e._s(e.fitmentInfo.idcard))])]),t("div",{staticClass:"info-item"},[t("div",{staticClass:"name"},[e._v("建筑面积")]),t("div",{staticClass:"value green"},[e._v(e._s(e.fitmentInfo.area))])])]),t("div",{staticClass:"entry-info"},[t("div",{staticClass:"title"},[e._v("装修信息录入")]),t("el-form",{ref:"entryForm",attrs:{model:e.entryForm,rules:e.entryRules,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"装修日期",prop:"ftime"}},[t("el-date-picker",{attrs:{type:"date",align:"center","value-format":"timestamp",placeholder:"请选择装修日期",disabled:e.isCharge},model:{value:e.entryForm.ftime,callback:function(t){e.$set(e.entryForm,"ftime",t)},expression:"entryForm.ftime"}})],1),t("el-form-item",{attrs:{label:"订单时间",prop:"otime"}},[t("el-date-picker",{attrs:{type:"datetime",align:"center","value-format":"timestamp",placeholder:"请选择订单时间",disabled:!e.$menu.getters.judgeRole("Btn-AW0xMrF2Y8BbUJHMIzt0iOCL")},model:{value:e.entryForm.otime,callback:function(t){e.$set(e.entryForm,"otime",t)},expression:"entryForm.otime"}})],1),t("el-form-item",{attrs:{label:"零钱包费用"}},[t("el-input",{attrs:{placeholder:"请输入收费总金额"},model:{value:e.entryForm.lmoney,callback:function(t){e.$set(e.entryForm,"lmoney",t)},expression:"entryForm.lmoney"}})],1),!e.entryForm.lmoney&&Number(e.balance)>=Number(e.allMoney)?t("el-form-item",{attrs:{label:`是否使用预存(余额:￥${e.balance})`,prop:"balance"}},[t("el-select",{attrs:{placeholder:"请选择是否使用预存"},model:{value:e.entryForm.balance,callback:function(t){e.$set(e.entryForm,"balance",t)},expression:"entryForm.balance"}},[t("el-option",{attrs:{label:"是",value:1}}),t("el-option",{attrs:{label:"否",value:0}})],1)],1):e._e(),t("el-form-item",{attrs:{label:"是否生成发票",prop:"isreceipt"}},[t("el-select",{attrs:{placeholder:"请选择是否生成发票",clearable:""},model:{value:e.entryForm.isreceipt,callback:function(t){e.$set(e.entryForm,"isreceipt",t)},expression:"entryForm.isreceipt"}},e._l(e.receiptOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"收费方式",prop:"method"}},[t("el-select",{attrs:{placeholder:"请选择收费方式",clearable:""},model:{value:e.entryForm.method,callback:function(t){e.$set(e.entryForm,"method",t)},expression:"entryForm.method"}},e._l(e.methodOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),3==e.receiptType?t("el-form-item",{attrs:{label:"收据类型",prop:"receiptType"}},[t("el-select",{attrs:{placeholder:"请选择收据类型",clearable:""},model:{value:e.entryForm.receiptType,callback:function(t){e.$set(e.entryForm,"receiptType",t)},expression:"entryForm.receiptType"}},[t("el-option",{attrs:{label:"电子收据",value:1}}),t("el-option",{attrs:{label:"纸质收据",value:2}})],1)],1):e._e(),2==e.receiptType||3==e.receiptType&&2==e.entryForm.receiptType?t("el-form-item",{attrs:{label:"是否生成纸质收据",prop:"isPaper"}},[t("el-select",{attrs:{placeholder:"请选择是否生成纸质收据",clearable:""},model:{value:e.entryForm.isPaper,callback:function(t){e.$set(e.entryForm,"isPaper",t)},expression:"entryForm.isPaper"}},[t("el-option",{attrs:{label:"否",value:0}}),t("el-option",{attrs:{label:"是",value:1}})],1)],1):e._e(),t("div",{staticClass:"tip"},[e._v("注意：不设找零，零头自动转入零钱包！")]),t("el-form-item",{staticClass:"subjects",attrs:{label:"选择收费科目",prop:"subjects"}},[0===e.subList.length?t("div",{staticClass:"empty"},[e._v("暂无收费科目")]):t("el-checkbox-group",{on:{change:e.subChange},model:{value:e.entryForm.subjects,callback:function(t){e.$set(e.entryForm,"subjects",t)},expression:"entryForm.subjects"}},e._l(e.subList,(function(s,a){return t("div",{key:a,staticClass:"check-item"},[t("el-checkbox",{attrs:{label:s.id,name:"subjects",disabled:!e.isCharge}},[e._v(" "+e._s(s.name+" "+s.price+"/"+s.formula_text)+" ")]),t("div",{staticClass:"input-wp"},[3===s.formula?t("span",[t("el-input",{attrs:{type:"number",disabled:0==s.is_edit_template,placeholder:"请输入时间"},on:{input:function(t){return e.dayChange(s)}},model:{value:s.day,callback:function(t){e.$set(s,"day",t)},expression:"item.day"}}),t("span",{staticStyle:{"font-size":"0.6rem"}},[e._v("(天)")]),t("span",{staticClass:"text"},[e._v("x")])],1):e._e(),1===s.formula||3===s.formula?t("span",[t("el-input",{attrs:{type:"number",disabled:0==s.is_edit_template,placeholder:"请输入面积"},on:{input:function(t){return e.areaChange(s)}},model:{value:s.area,callback:function(t){e.$set(s,"area",t)},expression:"item.area"}}),t("span",{staticStyle:{"font-size":"0.6rem"}},[e._v("(m²)")]),t("span",{staticClass:"text"},[e._v("x")])],1):e._e(),1===s.formula||2===s.formula||3===s.formula?t("span",[t("el-input",{attrs:{type:"number",disabled:0==s.is_edit_template,placeholder:"请输入单价"},on:{input:function(t){return e.priceChange(s)}},model:{value:s.price,callback:function(t){e.$set(s,"price",t)},expression:"item.price"}}),t("span",{staticStyle:{"font-size":"0.6rem"}},[e._v("(元)")])],1):e._e()]),t("div",{staticClass:"sub-total"},[e._v(" 共计 "),t("span",{staticStyle:{color:"#333","font-size":"0.75rem","font-weight":"700"}},[e._v(" "+e._s(s.total)+" ")])])],1)})),0)],1),t("div",{staticClass:"total"},[e._v(" 合计 "),t("span",{staticClass:"money"},[e._v(e._s(e.allMoney)+"元")])]),t("el-form-item",{staticClass:"upload",attrs:{label:"上传附件",prop:"fileInfo"}},[e.qiniuDatas.domain?t("el-upload",{ref:"upload",attrs:{action:e.qiniuDatas.domain,"http-request":e.customUpload,"on-remove":e.handleRemove}},[t("el-button",{staticStyle:{width:"5rem",position:"absolute",top:"0",left:"6rem"},attrs:{type:"primary"}},[e._v(" 点击上传 ")])],1):e._e()],1),t("el-form-item",{staticClass:"remark-wp",attrs:{label:"费用说明",prop:"remark"}},[t("el-input",{attrs:{type:"textarea",resize:"none",rows:3,placeholder:"请输入费用说明"},model:{value:e.entryForm.remark,callback:function(t){e.$set(e.entryForm,"remark",t)},expression:"entryForm.remark"}})],1)],1)],1)]),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.formSubmit}},[e._v(" "+e._s(e.isCharge?"确认添加":"提交保存")+" ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showUnfurnished=!1}}},[e._v(" 取消 ")])],1)],1),t("el-dialog",{staticClass:"decorated",attrs:{visible:e.showDecorated,title:1==e.type?"装修信息":"装修结算",width:"60%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showDecorated=t}}},[t("el-scrollbar",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticStyle:{height:"100%"}},[t("div",{staticClass:"basic-info"},[t("div",{staticClass:"info-item"},[t("div",{staticClass:"name"},[e._v("业主姓名")]),t("div",{staticClass:"value black"},[e._v(e._s(e.fitmentInfo.owner_name))])]),t("div",{staticClass:"info-item"},[t("div",{staticClass:"name"},[e._v("房间编号")]),t("div",{staticClass:"value black"},[e._v(e._s(e.fitmentInfo.name))])]),t("div",{staticClass:"info-item"},[t("div",{staticClass:"name"},[e._v("联系电话")]),t("div",{staticClass:"value"},[e._v(e._s(e.fitmentInfo.tel))])]),t("div",{staticClass:"info-item"},[t("div",{staticClass:"name"},[e._v("身份证号")]),t("div",{staticClass:"value"},[e._v(e._s(e.fitmentInfo.idcard))])]),t("div",{staticClass:"info-item"},[t("div",{staticClass:"name"},[e._v("建筑面积")]),t("div",{staticClass:"value green"},[e._v(e._s(e.fitmentInfo.area))])])]),t("div",{staticClass:"table-wp"},[t("div",{staticClass:"title"},[e._v(" 装修记录 "),e._l(e.fitmentList,(function(s,a){return t("span",{key:a,class:["label",s.active?"active":""],on:{click:function(t){return e.labelCheck(s,a)}}},[e._v(" 第"+e._s(s.num)+"次 ")])})),e.$menu.getters.judgeRole("Btn-QNE5wLtedtksnUjiYq9Mzby4")&&2==e.type&&this.cIndex==this.fitmentList.length-1?t("span",{staticClass:"label active",on:{click:e.addCharge}},[e._v(" 添加收费 ")]):e._e()],2),t("el-scrollbar",{staticStyle:{width:"100%"}},[t("div",{staticClass:"table-content"},[e.fitmentRecord.subject_pay&&e.fitmentRecord.subject_pay.length>0?t("div",{staticClass:"content"},[t("div",{staticClass:"td-wp"},[t("span",{staticClass:"name"},[e._v("装修时间")]),t("span",{staticClass:"value black"},[t("span",[e._v(e._s(e.fitmentRecord.startime))])])]),e._l(e.fitmentRecord.subject_pay,(function(s,a){return t("div",{key:a,staticClass:"td-wp"},[t("span",{staticClass:"name"},[e._v(e._s(s.subject_name))]),t("span",{staticClass:"value"},[t("span",[e._v(e._s(s.money))])])])})),t("div",{staticClass:"td-wp desc"},[t("span",{staticClass:"name"},[e._v("费用说明")]),t("span",{staticClass:"value"},[t("span",[e._v(e._s(e.fitmentRecord.remark))])])]),t("div",{staticClass:"td-wp total"},[t("span",{staticClass:"name"},[e._v("收费总额")]),t("span",{staticClass:"value yellow"},[t("span",[e._v(e._s(e.fitmentRecord.money))])])])],2):t("div",{staticClass:"content"},[t("div",{staticClass:"tip"},[e._v("暂无装修数据！")])])])])],1),t("div",{staticClass:"table-wp file"},[t("div",{staticClass:"title"},[e._v("相关附件")]),t("div",{staticClass:"table-content"},[e.fitmentRecord.file&&e.fitmentRecord.file.length>0?t("div",{staticClass:"content file"},[t("div",{staticClass:"td-wp"},[t("span",{staticClass:"name"},[e._v("文件名称")]),t("span",{staticClass:"value"},e._l(e.fitmentRecord.file,(function(s,a){return t("span",{key:a,staticStyle:{display:"block"}},[e._v(" "+e._s(s.filename)+" ")])})),0)]),t("div",{staticClass:"td-wp"},[t("span",{staticClass:"name"},[e._v("文件大小")]),t("span",{staticClass:"value"},e._l(e.fitmentRecord.file,(function(s,a){return t("span",{key:a,staticStyle:{display:"block"}},[e._v(" "+e._s((s.size/1024).toFixed(2))+"Kb ")])})),0)]),t("div",{staticClass:"td-wp"},[t("span",{staticClass:"name"},[e._v("操作")]),e._l(e.fitmentRecord.file,(function(s,a){return t("span",{key:a,staticClass:"value",staticStyle:{display:"block"}},[t("a",{staticStyle:{display:"block"},attrs:{href:s.file_url,target:"_blank"}},[t("el-button",{attrs:{size:"small",type:"primary",round:"",plain:""}},[e._v(" 下载文件 ")])],1)])}))],2)]):t("div",{staticClass:"content"},[t("div",{staticClass:"tip"},[e._v("暂无附件！")])])])]),1==e.type||this.cIndex!=this.fitmentList.length-1?t("div",{staticClass:"table-wp"},[t("div",{staticClass:"title"},[e._v("退款记录")]),t("div",{staticClass:"table-content"},[e.fitmentRecord.subject_refund&&e.fitmentRecord.subject_refund.length>0?t("div",{staticClass:"content"},[t("div",{staticClass:"td-wp"},[t("span",{staticClass:"name"},[e._v("退款时间")]),t("span",{staticClass:"value black"},[t("span",[e._v(e._s(e.fitmentRecord.endtime))])])]),e._l(e.fitmentRecord.subject_refund,(function(s,a){return t("div",{key:a,staticClass:"td-wp"},[t("span",{staticClass:"name"},[e._v(e._s(s.subject_name))]),t("span",{staticClass:"value"},[t("span",[e._v(e._s(s.money))])])])})),t("div",{staticClass:"td-wp",staticStyle:{width:"10rem"}},[t("span",{staticClass:"name"},[e._v("退款说明")]),t("span",{staticClass:"value"},[t("span",[e._v(e._s(e.fitmentRecord.refund_remarks))])])]),t("div",{staticClass:"td-wp"},[t("span",{staticClass:"name"},[e._v("退款金额")]),t("span",{staticClass:"value yellow"},[t("span",[e._v(e._s(e.fitmentRecord.refundMoney))])])])],2):t("div",{staticClass:"content"},[t("div",{staticClass:"tip"},[e._v("暂无退款记录！")])])])]):e._e(),1==e.type?t("div",{staticClass:"standard-wp"},[t("div",{staticClass:"title"},[e._v("收费标准")]),t("div",{staticClass:"content"},e._l(e.subList,(function(s,a){return t("div",{key:a,staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v(e._s(s.name))]),t("span",{staticClass:"value"},[e._v(e._s(s.price))])])})),0)]):e._e(),2==e.type&&this.cIndex===this.fitmentList.length-1?t("div",{staticClass:"form-wp"},[t("div",{staticClass:"title"},[e._v("装修完成")]),t("div",{staticClass:"input-item"},[t("div",{staticClass:"name"},[e._v("完成时间")]),t("el-date-picker",{attrs:{type:"date",align:"center","value-format":"timestamp",placeholder:"请选择完成日期"},model:{value:e.finishTime,callback:function(t){e.finishTime=t},expression:"finishTime"}})],1),t("div",{staticClass:"input-item"},[t("div",{staticClass:"name"},[e._v("备注说明")]),t("el-input",{attrs:{type:"textarea",resize:"none",rows:3,placeholder:"请输入备注说明"},model:{value:e.desc,callback:function(t){e.desc=t},expression:"desc"}})],1)]):e._e()]),t("span",{attrs:{slot:"footer"},slot:"footer"},[1==e.type?t("el-button",{attrs:{disabled:!e.$menu.getters.judgeRole("Btn-78oi6mDGaHh4xE000ywAbS3A"),loading:e.isCommit,type:"primary",round:""},on:{click:e.fitmentAgain}},[e._v(" 再次装修 ")]):t("el-button",{attrs:{loading:e.isCommit,type:"primary",disabled:this.cIndex!=this.fitmentList.length-1,round:""},on:{click:e.fitmentFinish}},[e._v(" 完成装修 ")]),t("el-button",{attrs:{type:"info",round:""},on:{click:function(t){e.showDecorated=!1}}},[e._v(" 取消 ")])],1)],1)],1)},l=[],n=s("f31f"),c={name:"fitment",props:["vid","balance"],data(){return{urlObj:{getpaymenttype:this.$api.state.Charge.getpaymenttype.url,fitmentInfo:this.$api.state.Charge.fitmentInfo.url,fitmentSub:this.$api.state.Charge.fitmentSub.url,fitmentStart:this.$api.state.Charge.fitmentStart.url,appendren:this.$api.state.Charge.appendren.url,fitmentResource:this.$api.state.Charge.fitmentResource.url,fitmentEnd:this.$api.state.Charge.fitmentEnd.url,uploadToken:this.$api.state.Public.uploadToken.url,saveUploadInfo:this.$api.state.Public.saveUploadInfo.url,delFile:this.$api.state.Public.delFile.url,getpaymenttype:this.$api.state.Charge.getpaymenttype.url,getreceipttype:this.$api.state.Charge.getreceipttype.url},type:0,currentUser:{},isLoading:!1,showUnfurnished:!1,showDecorated:!1,fitmentInfo:{},fitmentList:[],cIndex:0,fitmentRecord:{},entryForm:{ftime:"",otime:"",lmoney:"",balance:0,isreceipt:0,method:"",receiptType:1,isPaper:"",subjects:[],fileInfo:[],remark:""},entryRules:{ftime:[{required:!0,message:"请选择装修日期",trigger:"change"}],otime:[{required:!0,message:"请选择订单时间",trigger:"change"}],balance:[{required:!0,message:"请选择是否使用预存",trigger:"change"}],isreceipt:[{required:!0,message:"请选择是否生成发票",trigger:"change"}],method:[{required:!0,message:"请选择收费方式",trigger:"change"}],receiptType:[{required:!0,message:"请选择收据类型",trigger:"change"}],isPaper:[{required:!0,message:"请选择是否生成纸质收据",trigger:"change"}],subjects:[{type:"array",required:!0,message:"请选择科目！",trigger:"change"}],fileInfo:[{type:"array",required:!1,message:"请上传附件！",trigger:"change"}],remark:[{required:!0,message:"请填写费用说明",trigger:"blur"}]},receiptOptions:[{id:0,name:"否"},{id:1,name:"是"}],methodOptions:[],subList:[],subjectIds:[],total:"0.0",isCommit:!1,finishTime:"",desc:"",qiniuDatas:{},receiptType:"",isCharge:!1}},computed:{allMoney(){return _.round(_.add(Number(this.total),Number(this.entryForm.lmoney)),1).toFixed(1)}},methods:{init(e,t){this.currentUser=t,this.type=e,this.subjectIds=[],this.subList=[],this.fitmentInfo={},this.getFitmentInfo(),0==e?(this.$refs.entryForm&&this.$refs.entryForm.resetFields(),this.$menu.getters.judgeRole("Btn-AW0xMrF2Y8BbUJHMIzt0iOCL")||(this.entryForm.otime=new Date),this.entryForm.lmoney="",this.total="0.0",this.isCharge=!1,this.getReceiptType(),this.getPaymentType(),this.getUploadToken(),this.showUnfurnished=!0):(this.finishTime="",this.desc="",this.getFitmentRecord(),this.showDecorated=!0)},dialogClose(){this.$refs.upload.clearFiles(),this.isCharge=!1},getReceiptType(){let e={vid:this.vid};this.$axios.post(this.urlObj.getreceipttype,e).then(e=>{if(200===e.Code)this.receiptType=e.Data?e.Data.use_receipt_type:"";else{let t=e.Message?e.Message:"获取收据类型失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getPaymentType(){let e={vid:this.vid};this.$axios.post(this.urlObj.getpaymenttype,e).then(e=>{if(200===e.Code)this.methodOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取支付方式失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getFitmentInfo(){let e={type:this.currentUser.type,id:this.currentUser.id,oid:this.currentUser.oid};this.$axios.post(this.urlObj.fitmentInfo,e).then(e=>{if(200===e.Code)this.fitmentInfo=e.Data,this.subList.length>0&&this.subList.forEach(e=>{3==e.formula?(e.day=1,e.area=this.fitmentInfo.area?this.fitmentInfo.area:0,e.total=_.round(this.accMul(Number(e.day),this.accMul(Number(e.area),Number(e.price))),1).toFixed(1)):1==e.formula?(e.area=this.fitmentInfo.area?this.fitmentInfo.area:0,e.total=_.round(this.accMul(Number(e.area),Number(e.price)),1).toFixed(1)):2==e.formula&&(e.total=_.round(Number(e.price),1).toFixed(1))}),(1==this.type||0==this.type||2==this.type&&this.isCharge)&&this.getSubjects();else{let t=e.Message?e.Message:"获取装修信息失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getFitmentRecord(){this.isLoading=!0;let e={resources_id:this.currentUser.id,resources_type:this.currentUser.type};this.$axios.post(this.urlObj.fitmentResource,e).then(e=>{if(200===e.Code)e.Data&&e.Data.length>0&&e.Data.forEach((t,s)=>{if(s===e.Data.length-1?(t.active=!0,this.cIndex=s):t.active=!1,t.subject_refund&&t.subject_refund.length>0){let e=0;t.subject_refund.forEach(t=>{t.money=Math.abs(t.money),e=_.round(_.add(Number(e),Number(t.money)),2).toFixed(2)}),t.refundMoney=e}}),this.fitmentList=e.Data?e.Data:[],this.fitmentRecord=e.Data&&e.Data.length>0?e.Data[this.cIndex]:{};else{let t=e.Message?e.Message:"装修记录、退款记录数据获取失败！";this.$message({type:"error",message:t})}this.isLoading=!1}).catch(()=>{this.isLoading=!1})},getSubjects(){let e={vid:this.vid,roomid:this.currentUser.id};this.$axios.post(this.urlObj.fitmentSub,e).then(e=>{if(200===e.Code){let t=[],s=0;e.Data&&e.Data.length>0&&e.Data.forEach(e=>{e.check=!0,t.push(e.id),this.fitmentInfo.area&&(3==e.formula?(e.day=1,e.area=this.fitmentInfo.area?this.fitmentInfo.area:0,e.total=_.round(this.accMul(Number(e.day),this.accMul(Number(e.area),Number(e.price))),1).toFixed(1)):1==e.formula?(e.area=this.fitmentInfo.area?this.fitmentInfo.area:0,e.total=_.round(this.accMul(Number(e.area),Number(e.price)),1).toFixed(1)):2==e.formula&&(e.total=_.round(Number(e.price),1).toFixed(1))),s=_.round(_.add(Number(s),Number(e.total)),1)}),this.subList=e.Data,this.entryForm.subjects=t,this.subjectIds=t,this.total=s}else{let t=e.Message?e.Message:"获取科目信息失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},dayChange(e){""==e.day||e.day<=0?(this.$message({type:"warning",message:"天数不能为空或小于等于0"}),e.day=""):this.totalCount(e)},areaChange(e){""==e.area||e.area<=0?(this.$message({type:"warning",message:"面积不能为空或小于等于0"}),e.area=""):this.totalCount(e)},priceChange(e){""===e.price||void 0===e.price||null===e.price?(this.$message({type:"warning",message:"单价不能为空"}),e.price=0,e.total="0.0",this.totalCount(e)):this.totalCount(e)},accMul(e,t){var s=0,a=e.toString(),i=t.toString();try{s+=a.split(".")[1].length}catch(r){}try{s+=i.split(".")[1].length}catch(r){}return Number(a.replace(".",""))*Number(i.replace(".",""))/Math.pow(10,s)},totalCount(e){if(3==e.formula?e.total=_.round(this.accMul(Number(e.day),this.accMul(Number(e.area),Number(e.price))),1).toFixed(1):1==e.formula?e.total=_.round(this.accMul(Number(e.area),Number(e.price)),1).toFixed(1):2==e.formula&&(e.total=_.round(Number(e.price),1).toFixed(1)),this.subjectIds.includes(e.id)){let e=0;this.subList.forEach(t=>{this.subjectIds.includes(t.id)&&(e=_.round(_.add(Number(e),Number(t.total)),1))}),this.total=e}},subChange(e){if(this.subjectIds=e,e.length>0){let e=0;this.subList.forEach(t=>{this.subjectIds.includes(t.id)&&(e=_.round(_.add(Number(e),Number(t.total)),1))}),this.total=e}else this.total="0.0"},getUploadToken(){this.$axios.post(this.urlObj.uploadToken).then(e=>{200===e.Code&&(this.qiniuDatas=e.Data)})},customUpload(e){e.url=this.$refs.upload.uploadFiles[0].url;let t=Object(n["a"])(e,this.qiniuDatas);t.observable.subscribe({next:e=>{},error:e=>{},complete:s=>{this.saveFile(t.fileInfo,e.file.uid)}})},handleRemove(e){let t=this.entryForm.fileInfo.findIndex(t=>t.uid===e.uid);-1!=t&&(this.$axios.post(this.urlObj.delFile,{id:this.entryForm.fileInfo[t].id}).then(e=>{if(200!=e.Code){let t=e.Message?e.Message:"文件删除失败！";this.$message({message:t,type:"error"})}}).catch(()=>{}),this.entryForm.fileInfo.splice(t,1),this.$refs.entryForm.validateField("fileInfo"))},saveFile(e,t){this.$axios.post(this.urlObj.saveUploadInfo,e).then(e=>{if(200===e.Code)this.entryForm.fileInfo.push({id:e.Data.id,uid:t});else{let t=e.Message?e.Message:"文件信息保存失败！";this.$message({message:t,type:"error"})}this.$refs.entryForm.validateField("fileInfo")})},formSubmit(){this.$refs.entryForm.validate(e=>{let t=[];if(this.subList.forEach(e=>{if(this.entryForm.subjects.includes(e.id)){let s={id:e.id,price:e.price,area:e.area?e.area:"",day_num:e.day?e.day:""};t.push(s)}}),e){this.isCommit=!0;let e={vid:this.vid,oid:this.currentUser.oid,resources_id:this.currentUser.id,resources_type:this.currentUser.type,desc:this.entryForm.remark,subject_data:t,pay_time:this.entryForm.otime/1e3,pay_type:this.entryForm.method,balance:this.entryForm.lmoney?1:0,balance_money:this.entryForm.lmoney,is_bill:this.entryForm.isreceipt};this.entryForm.fileInfo.length>0&&(e.file_ids=this.entryForm.fileInfo.map(e=>e.id)),3==this.receiptType?(e.receipt_type=this.entryForm.receiptType,2==this.entryForm.receiptType&&(e.is_open_receiptpaper=this.entryForm.isPaper)):2==this.receiptType&&(e.is_open_receiptpaper=this.entryForm.isPaper),!this.entryForm.lmoney&&Number(this.balance)>=Number(this.allMoney)?e.use_balance=this.entryForm.balance:e.use_balance=0;let s="",a="";this.isCharge?(s=this.urlObj.appendren,a="添加收费"):(e.startime=this.entryForm.ftime/1e3,s=this.urlObj.fitmentStart,a="装修信息录入"),this.$axios.post(s,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:a+"成功！"}),this.showUnfurnished=!1,this.isCharge?this.init(this.type,this.currentUser):this.$emit("getBasicInfo");else{let t=e.Message?e.Message:a+"失败！";this.$message({type:"error",message:t})}this.isCommit=!1}).catch(e=>{this.isCommit=!1})}})},labelCheck(e,t){this.cIndex=t,e.active||(this.fitmentList.forEach(e=>{e.active=!1}),e.active=!0,this.fitmentRecord=e)},fitmentAgain(){this.showDecorated=!1,this.init(0,this.currentUser)},fitmentFinish(){if(this.finishTime||this.desc.trim())if(this.finishTime)if(this.desc.trim()){this.isCommit=!0;let e={oid:this.currentUser.oid,resources_id:this.currentUser.id,resources_type:this.currentUser.type,endtime:this.finishTime/1e3,desc:this.desc.trim()};this.$axios.post(this.urlObj.fitmentEnd,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:"装修已完成！"}),this.showDecorated=!1,this.$emit("getBasicInfo");else{let t=e.Message?e.Message:"装修完成失败！";this.$message({type:"error",message:t})}this.isCommit=!1}).catch(e=>{this.isCommit=!1})}else this.$message({type:"warning",message:"备注说明不能为空"});else this.$message({type:"warning",message:"完成时间不能为空"});else this.$message({type:"warning",message:"完成时间和备注说明不能为空"})},addCharge(){this.subjectIds=[],this.subList=[],this.fitmentInfo={},this.getFitmentInfo(),this.$refs.entryForm&&this.$refs.entryForm.resetFields(),this.$menu.getters.judgeRole("Btn-AW0xMrF2Y8BbUJHMIzt0iOCL")||(this.entryForm.otime=new Date),this.entryForm.ftime=new Date(this.fitmentList[this.cIndex].startime).getTime(),this.entryForm.lmoney="",this.isCharge=!0,this.total="0.0",this.getReceiptType(),this.getPaymentType(),this.getUploadToken(),this.showUnfurnished=!0}}},d=c,u=(s("f359"),s("1805")),h=Object(u["a"])(d,o,l,!1,null,null,null),m=h.exports,p=s("8bde"),g=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"payment-history"}},[t("div",{staticClass:"top"},[t("div",{staticClass:"main"},[t("div",{staticClass:"common-left"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchVal,expression:"searchVal"}],staticClass:"common-input",staticStyle:{"margin-left":"0"},attrs:{type:"text",placeholder:"请输入票据/订单号"},domProps:{value:e.searchVal},on:{input:function(t){t.target.composing||(e.searchVal=t.target.value)}}}),t("el-button",{staticClass:"common-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.tableLoad}},[e._v(" 查询 ")])],1)])]),t("div",{staticClass:"main-wp"},[t("div",{staticClass:"select-wp"},[t("el-select",{attrs:{clearable:"",placeholder:"请选择付款方式"},on:{change:e.tableLoad},model:{value:e.payMethods,callback:function(t){e.payMethods=t},expression:"payMethods"}},e._l(e.methodOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),t("el-select",{attrs:{clearable:"",placeholder:"请选择缴费状态"},on:{change:e.tableLoad},model:{value:e.statusVal,callback:function(t){e.statusVal=t},expression:"statusVal"}},e._l(e.statusOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-date-picker",{attrs:{type:"datetimerange",align:"center","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:e.tableLoad},model:{value:e.dateValue,callback:function(t){e.dateValue=t},expression:"dateValue"}})],1),t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.tableData,cusColums:e.columns,cusConf:e.conf,ispaging:!0},on:{sizeChange:e.sizeChange,currentChange:e.currentChange,detail:e.showDetial,print:e.print,buyBack:e.buyBack,selectChange:e.selectChange}})],1)]),t("el-dialog",{attrs:{visible:e.showDetailPop,title:"订单缴费详情",width:"60%","close-on-click-modal":!0},on:{"update:visible":function(t){e.showDetailPop=t}}},[t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.popTableData,cusColums:e.popColumns,cusConf:e.popConf}}),t("div",{staticClass:"total"},[e._v(" 费用合计： "),t("span",{staticClass:"name"},[e._v("实收")]),t("span",{staticClass:"value"},[e._v(e._s(e.realityMoney)+"元")]),t("span",{staticClass:"name"},[e._v("应收")]),t("span",{staticClass:"value ys"},[e._v(e._s(e.receivableMoney)+"元")])])],1)])],1)},f=[],y=s("4f66"),v=s("0a18"),b=s("cae3"),C={name:"paymentHistory",props:["vid","oid"],data(){return{urlObj:{getpaymenttype:this.$api.state.Charge.getpaymenttype.url,historycost:this.$api.state.Charge.historycost.url,sndetail:this.$api.state.Charge.sndetail.url,changepaytype:this.$api.state.Charge.changepaytype.url,resalesn:this.$api.state.Charge.resalesn.url,issueReceipt:this.$api.state.Charge.issueReceipt.url},searchVal:"",payMethods:"",methodOptions:[],statusVal:"",statusOptions:[{value:1,label:"未缴纳"},{value:2,label:"已缴纳"}],dateValue:[],tableData:[],columns:y.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:10,dataTotal:0},showDetailPop:!1,popTableData:[],popColumns:v.list,popConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},realityMoney:"",receivableMoney:""}},mounted(){this.getPaymentType()},methods:{getPaymentType(){let e={vid:this.vid};this.$axios.post(this.urlObj.getpaymenttype,e).then(e=>{if(200===e.Code)this.methodOptions=e.Data?e.Data:[],this.tableLoad();else{let t=e.Message?e.Message:"获取支付方式失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},tableLoad(){this.conf.loadStatus=!0;let e={is_page:1,page:this.conf.curPage,limit:this.conf.limit,oid:this.oid,status:this.statusVal,pay_type:this.payMethods,keywords:this.searchVal};this.dateValue&&this.dateValue[0]&&this.dateValue[1]&&(e.stime=this.dateValue[0]/1e3,e.etime=this.dateValue[1]/1e3),this.$axios.post(this.urlObj.historycost,e).then(e=>{if(200===e.Code){if(this.conf.dataTotal=e.Data.list.total,e.Data.list.data&&e.Data.list.data.length>0){let t=this.methodOptions.map(e=>e.id);e.Data.list.data.forEach(e=>{e.cname=e.creater?e.creater.realname:"",e.status_text=0==e.status?"未缴纳":"已缴纳",e.disabled=1!=e.pstatus,e.options=this.methodOptions,e.type=t.includes(e.type)?e.type:e.payment?e.payment.name:""})}this.tableData=e.Data.list.data,this.conf.loadStatus=!1,this.conf.emptyText=""}else 204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=e.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},sizeChange(e){this.conf.limit=e,this.tableLoad()},currentChange(e){this.conf.curPage=e,this.tableLoad()},selectChange(e){let t={id:this.tableData[e].id,pay_type:this.tableData[e].type};this.$axios.post(this.urlObj.changepaytype,t).then(e=>{if(200===e.Code)this.$message({message:"支付方式修改成功！",type:"success"});else{let t=e.Message?e.Message:"支付方式修改失败！";this.$message({message:t,type:"error"})}this.tableLoad()}).catch(()=>{})},getDialogTable(e){this.popConf.loadStatus=!0,this.$axios.post(this.urlObj.sndetail,e).then(e=>{200===e.Code?(this.realityMoney=e.Data.allmoney?e.Data.allmoney:"0.00",this.receivableMoney=e.Data.money?e.Data.money:"0.00",e.Data.deatil&&e.Data.deatil.length>0&&e.Data.deatil.forEach(e=>{e.subname=e.subject.name}),this.popTableData=e.Data.deatil,this.popConf.loadStatus=!1,this.popConf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.popTableData=[],this.popConf.emptyText=e.Message,this.popConf.dataTotal=0,this.popConf.loadStatus=!1)}).catch(()=>{this.popTableData=[],this.popConf.emptyText="服务器连接失败...",this.popConf.dataTotal=0,this.popConf.loadStatus=!1})},showDetial(e){this.showDetailPop=!0,this.getDialogTable({id:this.tableData[e].id})},print(e){let t={id:this.tableData[e].id};this.$axios.post(this.urlObj.issueReceipt,t).then(e=>{if(200===e.Code)e.Data.id=t.id,b["a"].startLodop(e.Data);else{let t=e.Message?e.Message:"获取打印收据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},buyBack(e){this.$confirm("此操作将返销当前订单，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let t={id:this.tableData[e].id};this.$axios.post(this.urlObj.resalesn,t).then(e=>{if(200===e.Code)this.$message({message:"订单返销成功！",type:"success"}),this.tableLoad();else{let t=e.Message?e.Message:"订单返销失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})}).catch(()=>{})}}},w=C,k=(s("9efb"),Object(u["a"])(w,g,f,!1,null,null,null)),F=k.exports,$=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"charge-adjust"}},[t("div",{staticClass:"title"},[e._v("欠费列表")]),t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.tableData,cusColums:e.columns,cusConf:e.conf,ispaging:!0,check:!0},on:{sizeChange:e.sizeChange,currentChange:e.currentChange,moneyEdit:e.moneyEdit,selectionChange:e.selectionChange}})],1),t("div",{staticClass:"btn-wp"},[t("el-button",{attrs:{disabled:0==e.tableSelected.length,type:"primary",round:""},on:{click:e.chargeTransfer}},[e._v(" 转移欠费 ")]),t("el-button",{attrs:{disabled:0==e.tableSelected.length,type:"primary empty",round:""},on:{click:e.deleteCharge}},[e._v(" 删除欠费("+e._s(e.tableSelected.length)+") ")])],1),t("el-dialog",{staticClass:"editDialog",attrs:{visible:e.showEditDialog,title:e.dialogTitle,width:"38%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showEditDialog=t}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},["transfer"==e.type?t("div",{staticClass:"header"},[t("div",{staticClass:"msg-item"},[t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("欠费资源")]),t("span",{staticClass:"value"},[e._v(e._s(e.currentArrea.resource))])]),t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("总欠金额")]),t("span",{staticClass:"value money"},[e._v(e._s(e.currentArrea.money)+"元")])])]),t("div",{staticClass:"msg-item"},[t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("资源类型")]),t("span",{staticClass:"value"},[e._v(e._s(e.currentArrea.resourceType))])]),t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("欠费笔数")]),t("span",{staticClass:"value"},[e._v(e._s(e.currentArrea.num)+"笔")])])]),t("div",{staticClass:"msg-item"},[t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v("原欠费人")]),t("span",{staticClass:"value"},[e._v(e._s(e.currentArrea.user))])])])]):t("div",{staticClass:"header"},["editmoney"==e.type?t("div",{staticClass:"left"},[t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("科目名称")]),t("span",{staticClass:"value"},[e._v(e._s(e.currentArrea.subName))])]),t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("收费对象")]),t("span",{staticClass:"value"},[e._v(e._s(e.currentArrea.user))])]),t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("修改前金额")]),t("span",{staticClass:"value money"},[e._v(e._s(e.currentArrea.money)+"元")])])]):e._e(),"delete"==e.type?t("div",{staticClass:"left"},[t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("科目名称")]),t("span",{staticClass:"value"},[e._v(e._s(e.currentArrea.subjects))])]),t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("合计条数")]),t("span",{staticClass:"value"},[e._v(e._s(e.currentArrea.num))])]),t("div",{staticClass:"info-item"},[t("span",{staticClass:"name"},[e._v("合计金额")]),t("span",{staticClass:"value money"},[e._v(e._s(e.currentArrea.money)+"元")])])]):e._e(),t("div",{staticClass:"right"},[t("div",{staticClass:"name"},[e._v("欠费描述")]),t("div",{staticClass:"value"},[e._v(e._s(e.currentArrea.des))])])]),"editmoney"==e.type?t("div",{staticClass:"money-edit"},[t("div",{staticClass:"title"},[e._v("修改金额(元)")]),t("el-input",{attrs:{type:"number",placeholder:"请输入修改后金额"},model:{value:e.moneyVal,callback:function(t){e.moneyVal=t},expression:"moneyVal"}})],1):e._e(),"transfer"==e.type?t("div",{staticClass:"select-wp"},[t("div",{staticClass:"name"},[e._v("转移给")]),t("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择人员"},model:{value:e.movePeople,callback:function(t){e.movePeople=t},expression:"movePeople"}},e._l(e.moveOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.realname,value:e.id}})})),1),t("i",{staticClass:"upload el-icon-upload",on:{click:e.showUpload}})],1):e._e(),t("div",{staticClass:"remark-wp"},[t("div",{staticClass:"title"},[e._v("备注说明")]),t("el-input",{attrs:{type:"textarea",rows:3,resize:"none",placeholder:"请输入备注信息"},model:{value:e.remarkVal,callback:function(t){e.remarkVal=t},expression:"remarkVal"}})],1),"transfer"!=e.type?t("div",{staticClass:"audit-wp"},[t("i",{staticClass:"upload el-icon-upload",on:{click:e.showUpload}}),t("div",{staticClass:"title"},[e._v("审批人员设置")]),t("ul",[e._l(e.userList,(function(s,a){return t("li",{key:a},[e.userList.length>1?t("i",{staticClass:"del el-icon-circle-close",on:{click:function(t){return e.delAuditor(a)}}}):e._e(),t("div",{staticClass:"name"},[e._v("审批人"+e._s(a+1))]),t("el-select",{ref:"remoteSelect"+a,refInFor:!0,attrs:{filterable:"",remote:"",placeholder:"输入姓名、手机号搜索","remote-method":e.remoteMethod,loading:e.loading},model:{value:s.value,callback:function(t){e.$set(s,"value",t)},expression:"item.value"}},e._l(e.userOptions,(function(e){return t("el-option",{key:e.uid,attrs:{label:`${e.company.shortname?e.company.shortname:e.company.deptname} - ${e.realname} -${e.position.posname}`,value:e.uid}})})),1)],1)})),t("li",{staticClass:"add"},[t("div",{staticClass:"name"}),t("div",{staticClass:"label",on:{click:e.addAuditor}},[t("i",{staticClass:"iconfont iconxinzeng"}),e._v(" 添加审批人员 ")])])],2)]):e._e()]),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.confirm}},[e._v(" 提交保存 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showEditDialog=!1}}},[e._v(" 取消 ")])],1)],1),t("el-dialog",{staticClass:"uploadDialog",attrs:{visible:e.showUploadDialog,title:"上传附件",width:"60%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showUploadDialog=t}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.fileInfos,cusColums:e.popColumns,cusConf:e.popConf},on:{delete:e.fileDelete}})],1)]),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-upload",{ref:"upload",staticClass:"upload",attrs:{action:e.qiniuDatas?e.qiniuDatas.domain:"","http-request":e.customUpload,"show-file-list":!1}},[t("el-button",{attrs:{type:"primary",round:""}},[e._v(" 上传新附件 ")])],1),t("el-button",{attrs:{type:"info",round:""},on:{click:function(t){e.showUploadDialog=!1}}},[e._v(" 返回 ")])],1)],1)],1)},D=[],x=s("1da6"),I=s("2a54"),O={name:"chargeAdjust",props:["currentUser"],data(){return{urlObj:{getArrearages:this.$api.state.Charge.getArrearages.url,resourceOwner:this.$api.state.Charge.resourceOwner.url,getUsers:this.$api.state.Public.getUsers.url,arrearagesEdit:this.$api.state.Charge.arrearagesEdit.url,uploadToken:this.$api.state.Public.uploadToken.url,delFile:this.$api.state.Public.delFile.url,saveUploadInfo:this.$api.state.Public.saveUploadInfo.url},tableData:[],columns:x.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},tableSelected:[],currentArrea:{},popColumns:I.list,popConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},showEditDialog:!1,showUploadDialog:!1,isCommit:!1,type:"editmoney",moneyVal:"",movePeople:"",moveOptions:[],remarkVal:"",loading:!1,userList:[{value:""}],userOptions:[],qiniuDatas:"",fileInfos:[],fileKeys:[]}},computed:{dialogTitle(){let e="修改欠费金额";switch(this.type){case"editmoney":e="修改欠费金额";break;case"delete":e="删除欠费";break;case"transfer":e="转移欠费";break}return e}},mounted(){this.tableLoad(),this.getUploadToken()},methods:{getUploadToken(){this.$axios.post(this.urlObj.uploadToken).then(e=>{200===e.Code&&(this.qiniuDatas=e.Data)})},tableLoad(){this.conf.loadStatus=!0;let e={resources_id:this.currentUser.id,type:this.currentUser.type,oid:this.currentUser.oid};this.$axios.post(this.urlObj.getArrearages,e).then(e=>{if(200===e.Code){if(e.Data&&e.Data.length>0){let t=0;e.Data.forEach(e=>{e.subName=e.subject?e.subject.name:"--",e.cname=e.creater?e.creater.realname:"--",t+=Number(e.money),e.is_apply=1==e.is_apply,e.apply_type=e.apply_type?e.apply_type:"--"})}this.tableData=e.Data?e.Data:[],this.conf.loadStatus=!1,this.conf.emptyText=""}else 204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=e.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},sizeChange(e){this.conf.limit=e,this.tableLoad()},currentChange(e){this.conf.curPage=e,this.tableLoad()},selectionChange(e){this.tableSelected=e},getTransferList(){let e={id:this.currentUser.id,type:this.currentUser.type};this.$axios.post(this.urlObj.resourceOwner,e).then(e=>{if(200===e.Code)this.moveOptions=e.Data;else{let t=e.Message?e.Message:"获取转交人列表数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},remoteMethod(e){if(""!==e){this.loading=!0;let t={keywords:e};this.$axios.post(this.urlObj.getUsers,t).then(e=>{if(200===e.Code)this.userOptions=e.Data;else{let t=e.Message?e.Message:"获取转交人列表数据失败！";this.$message({message:t,type:"error"})}this.loading=!1}).catch(()=>{this.loading=!1})}else this.userOptions=[]},moneyEdit(e){this.type="editmoney",this.currentArrea={id:this.tableData[e].id,subName:this.tableData[e].subject?this.tableData[e].subject.name:"--",user:this.tableData[e].owner?this.tableData[e].owner.realname:"--",money:this.tableData[e].money,des:this.tableData[e].describe},this.moneyVal="",this.remarkVal="",this.userList=[{value:""}],this.userOptions=[],this.showEditDialog=!0},chargeTransfer(){let e=this.tableSelected.some(e=>1==e.is_apply);if(e)this.$message({type:"warning",message:"存在审批中的数据，不能批量转移！"});else{this.type="transfer";let e=0;this.tableSelected.forEach(t=>{e+=Number(t.money)}),this.currentArrea={resource:this.tableSelected[0].title,resourceType:this.tableSelected[0].resources_model_type,user:this.tableData[0].owner?this.tableData[0].owner.realname:"--",money:_.round(e,2),num:this.tableSelected.length},this.movePeople="",this.moveOptions=[],this.remarkVal="",this.userList=[{value:""}],this.userOptions=[],this.showEditDialog=!0,this.getTransferList()}},deleteCharge(){let e=this.tableSelected.some(e=>1==e.is_apply);if(e)this.$message({type:"warning",message:"存在审批中的数据，不能批量删除！"});else{this.type="delete";let e=0,t=[];this.tableSelected.forEach(s=>{e+=Number(s.money),t.includes(s.subject.name)||t.push(s.subject.name)}),this.currentArrea={subjects:t.join("、"),des:this.tableSelected[0].describe,money:_.round(e,2),num:this.tableSelected.length},this.remarkVal="",this.userList=[{value:""}],this.userOptions=[],this.showEditDialog=!0}},addAuditor(){this.userList.push({value:""})},delAuditor(e){this.userList.splice(e,1)},showUpload(){this.showUploadDialog=!0},customUpload(e){e.url=this.$refs.upload.uploadFiles[0].url;let t=Object(n["a"])(e,this.qiniuDatas);t.observable.subscribe({next:e=>{},error:e=>{},complete:e=>{this.fileSave(t.fileInfo);let s=new Date,a=s.getFullYear(),i=s.getMonth()+1<10?"0"+(s.getMonth()+1):s.getMonth()+1,r=s.getDate()<10?"0"+s.getDate():s.getDate();t.fileInfo.time=a+"-"+i+"-"+r,t.fileInfo.size=_.round(_.divide(t.fileInfo.size,1024),2)+"kb",this.fileInfos.push(t.fileInfo)}})},fileSave(e){this.$axios.post(this.urlObj.saveUploadInfo,e).then(e=>{if(200===e.Code)this.fileKeys.push(e.Data.id);else{let t=e.Message?e.Message:"文件保存失败！";this.$message({message:t,type:"error"})}})},fileDelete(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let t={id:this.fileKeys[e]};this.$axios.post(this.urlObj.delFile,t).then(e=>{if(200===e.Code)this.$message({message:"文件删除成功！",type:"success"});else{let t=e.Message?e.Message:"文件删除失败！";this.$message({message:t,type:"error"})}}),this.fileInfos.splice(e,1),this.fileKeys.splice(e,1)}).catch(()=>{})},confirm(){let e=[],t=[];this.tableSelected.forEach(t=>{e.push(t.id)}),this.userList.forEach(e=>{e.value&&!t.includes(e.value)&&t.push(e.value)});let s={ids:e,op_type:this.type,bz:this.remarkVal,file:this.fileKeys,approval_uids:t};"editmoney"==this.type?(s.money=this.moneyVal,s.ids=[this.currentArrea.id]):"transfer"==this.type&&(s.transfer_oid=this.movePeople);let a=!1,i="";switch(this.type){case"editmoney":s.money||0!=s.approval_uids.length?s.money?0==s.approval_uids.length&&(i="请选择审批人",a=!0):(i="请填写修改金额",a=!0):(i="请填写修改金额并选择审批人",a=!0);break;case"transfer":s.transfer_oid||(i="请选择转交人",a=!0),0==s.file.length&&(i="请上传附件",a=!0);break;case"delete":0==s.approval_uids.length&&(i="请选择审批人",a=!0);break}a?this.$message({type:"warning",message:i}):this.commitRequest(s)},commitRequest(e){this.isCommit=!0,this.$axios.post(this.urlObj.arrearagesEdit,e).then(e=>{if(200===e.Code){let e="delete"==this.type?"欠费删除成功！":"transfer"==this.type?"欠费转移成功！":"欠费编辑成功！";this.$message({message:e,type:"success"}),this.showEditDialog=!1,this.tableLoad()}else{let t=e.Message?e.Message:"数据提交失败！";this.$message({message:t,type:"error"})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}}},T=O,j=(s("bd11"),Object(u["a"])(T,$,D,!1,null,null,null)),M=j.exports,S=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"refund-manage"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.showDetail,expression:"!showDetail"}],staticClass:"main-wp"},[t("div",{staticClass:"title"},[e._v(" 退款管理 ")]),t("div",{staticClass:"query-wp"},[t("el-select",{attrs:{clearable:"",placeholder:"请选择退款科目"},on:{change:e.tableLoad},model:{value:e.subjectVal,callback:function(t){e.subjectVal=t},expression:"subjectVal"}},e._l(e.subjectOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),t("el-select",{attrs:{clearable:"",placeholder:"请选择退款状态"},on:{change:e.tableLoad},model:{value:e.statusVal,callback:function(t){e.statusVal=t},expression:"statusVal"}},e._l(e.statusOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),t("el-date-picker",{attrs:{type:"daterange","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:e.tableLoad},model:{value:e.dateVal,callback:function(t){e.dateVal=t},expression:"dateVal"}})],1),t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.tableData,cusColums:e.columns,cusConf:e.conf,ispaging:!0,check:!0},on:{sizeChange:e.sizeChange,currentChange:e.currentChange,selectionChange:e.selectionChange,refund:e.tableRefund}})],1),t("div",{staticClass:"btn-wp"},[t("el-button",{attrs:{disabled:0===e.tableSelected.length,type:"primary",round:""},on:{click:e.goRefund}},[e._v(" 去退款 ")])],1)]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showDetail,expression:"showDetail"}],staticClass:"detail-wp"},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("div",{staticClass:"refund-detial"},[t("div",{staticClass:"title"},[e._v("退款明细")]),t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.detailTable,cusColums:e.detailColumns,cusConf:e.detailConf,check:!0},on:{selectionChange:e.detailSelectChange,textChange:e.moneyChange}})],1),t("div",{staticClass:"total"},[e._v(" 合计退款 "),t("span",[e._v(e._s(e.refundTotal)+"元")])])]),t("div",{staticClass:"inventory"},[t("div",{staticClass:"title"},[e._v("退款清单")]),t("div",{staticClass:"table-wp"},[t("cus-table",{attrs:{datas:e.inventoryTable,cusColums:e.inventoryColumns,cusConf:e.inventoryConf}})],1),t("div",{staticClass:"btn-wp"},[t("el-button",{attrs:{disabled:0===e.inventoryTable.length,type:"primary",round:""},on:{click:e.refundConfirm}},[e._v(" 确认退款 ")]),t("el-button",{attrs:{type:"info",round:""},on:{click:function(t){e.showDetail=!1}}},[e._v(" 取消 ")])],1)])])],1),t("el-dialog",{attrs:{visible:e.showDialog,title:"退款确认",width:"36%","close-on-click-modal":!1},on:{close:function(t){e.showDialog=!1}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"hide-required-asterisk":!0}},[e._l(e.ruleForm.refunds,(function(s,a){return t("div",{key:a,staticClass:"refunds"},[t("el-form-item",{attrs:{label:"退款金额",prop:"refunds."+a+".money",rules:e.rules.money}},[t("el-input",{attrs:{type:"number",readonly:e.isBatch,placeholder:"请输入退款金额"},model:{value:s.money,callback:function(t){e.$set(s,"money",t)},expression:"item.money"}})],1),t("el-form-item",{attrs:{label:"退款方式",prop:"refunds."+a+".method",rules:e.rules.method}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择退款方式"},model:{value:s.method,callback:function(t){e.$set(s,"method",t)},expression:"item.method"}},e._l(e.methodOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),0!=a?t("i",{staticClass:"el-icon-circle-close",on:{click:function(t){return e.delRefund(a)}}}):e._e()],1)})),!e.isBatch&&e.showDate?t("el-form-item",{attrs:{label:"退款时间",prop:"dateVal"}},[t("el-date-picker",{attrs:{type:"daterange","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions,"default-value":e.defaultValue},model:{value:e.ruleForm.dateVal,callback:function(t){e.$set(e.ruleForm,"dateVal",t)},expression:"ruleForm.dateVal"}})],1):e._e(),e.isBatch?e._e():t("el-form-item",{staticClass:"add-content"},[t("div",{staticClass:"add-more",on:{click:e.addMore}},[e._v("继续添加")])]),"carmonth"==e.currentType?t("el-form-item",{attrs:{label:"截止日期",prop:"endTime"}},[t("el-date-picker",{attrs:{type:"date","value-format":"timestamp"},model:{value:e.ruleForm.endTime,callback:function(t){e.$set(e.ruleForm,"endTime",t)},expression:"ruleForm.endTime"}})],1):e._e(),t("el-form-item",{staticClass:"remark",attrs:{label:"退款原因",prop:"remarkVal"}},[t("el-input",{attrs:{type:"textarea",rows:3,resize:"none",placeholder:"请输入退款原因"},model:{value:e.ruleForm.remarkVal,callback:function(t){e.$set(e.ruleForm,"remarkVal",t)},expression:"ruleForm.remarkVal"}})],1)],2)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{loading:e.isCommit,type:"primary",round:""},on:{click:e.formSubmit}},[e._v(" 提交保存 ")]),t("el-button",{attrs:{loading:e.isCommit,type:"info",round:""},on:{click:function(t){e.showDialog=!1}}},[e._v(" 取消 ")])],1)],1)],1)},U=[],R=s("29a0"),V=s("960d"),L=s("4e95"),N={name:"refundManage",props:["vid","oid"],data(){return{urlObj:{refundList:this.$api.state.Charge.refundList.url,refundCost:this.$api.state.Charge.refundCost.url,getpaymenttype:this.$api.state.Charge.getpaymenttype.url,refundsubject:this.$api.state.Charge.refundsubject.url},statusVal:"",statusOptions:[{id:1,name:"未退款"},{id:2,name:"退款中"},{id:3,name:"已退款"}],subjectVal:"",subjectOptions:[],dateVal:[],tableData:[],columns:R.list,conf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},currentType:"",currentIndex:0,tableSelected:[],detailTable:[],detailColumns:V.list,detailConf:{loadStatus:!1,emptyText:"",curPage:1,limit:10,dataTotal:0},inventoryTable:[],inventoryColumns:L.list,inventoryConf:{loadStatus:!1,emptyText:"",curPage:1,limit:10,dataTotal:0},showDetail:!1,refundTotal:"0.00",showDialog:!1,isBatch:!1,ruleForm:{refunds:[{money:"",method:""}],dateVal:[],endTime:"",remarkVal:""},rules:{money:[{required:!0,message:"请输入金额",trigger:"blur"}],method:[{required:!0,message:"请选择退款方式",trigger:"change"}],dateVal:[{required:!0,message:"请选择退款时间",trigger:"change"}],endTime:[{required:!0,message:"请选择截止日期",trigger:"change"}]},methodOptions:[],printOptions:[],pickerOptions:{},defaultValue:"",isCommit:!1,showDate:!0}},mounted(){this.getRefundSubjects(),this.tableLoad()},methods:{getRefundSubjects(){let e={vid:this.vid};this.$axios.post(this.urlObj.refundsubject,e).then(e=>{if(200===e.Code)this.subjectOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取退款科目数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getPaymentType(){let e={vid:this.vid};this.$axios.post(this.urlObj.getpaymenttype,e).then(e=>{if(200===e.Code)this.methodOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取退款方式失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},tableLoad(){this.conf.loadStatus=!0;let e={page:this.conf.curPage,limit:this.conf.limit,owner_id:this.oid,subject_id:this.subjectVal,refund_status:this.statusVal,create_time:this.dateVal[0]?this.dateVal[0]/1e3:"",end_time:this.dateVal[1]?this.dateVal[1]/1e3:""};this.$axios.post(this.urlObj.refundList,e).then(e=>{200===e.Code?(e.Data.data&&e.Data.data.length>0&&e.Data.data.forEach(e=>{e.payee=e.creater?e.creater.realname:"",e.refund_status_text=1==e.refund_status?"退款中":2==e.refund_status?"已退款":"未退款",e.disabled=2==e.refund_status||0==e.open_refund,e.ktmoney=_.round(_.subtract(e.real_money,e.refund_money),2);let t=new Date(1e3*e.pay_time),s=t.getFullYear(),a=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,i=t.getDate()<10?"0"+t.getDate():t.getDate();e.pay_time=s+"-"+a+"-"+i}),this.conf.dataTotal=e.Data.total,this.tableData=e.Data.data,this.conf.loadStatus=!1,this.conf.emptyText=""):204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.tableData=[],this.conf.emptyText=e.Message,this.conf.dataTotal=0,this.conf.loadStatus=!1)}).catch(()=>{this.tableData=[],this.conf.emptyText="服务器连接失败...",this.conf.dataTotal=0,this.conf.loadStatus=!1})},sizeChange(e){this.conf.limit=e,this.tableLoad()},currentChange(e){this.conf.curPage=e,this.tableLoad()},selectionChange(e){this.tableSelected=e},tableRefund(e){this.currentIndex=e,this.currentType=this.tableData[e].resources_model_type,this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.ruleForm.refunds=[{money:"",method:""}],this.isBatch=!1,this.ruleForm.refunds[0].money=this.tableData[e].ktmoney,this.tableData[e].previewCostRepair.stime&&this.tableData[e].previewCostRepair.etime?(this.showDate=!0,this.defaultValue=1e3*this.tableData[e].previewCostRepair.stime,this.pickerOptions={disabledDate:t=>{if(t){let s=t.getTime()<1e3*this.tableData[e].previewCostRepair.stime||t.getTime()>1e3*this.tableData[e].previewCostRepair.etime;return s}}}):this.showDate=!1,this.showDialog=!0,this.getPaymentType()},goRefund(){let e=[],t=JSON.parse(JSON.stringify(this.tableSelected)),s=0,a=!1;t.forEach(t=>{2!=t.refund_status&&0!=t.open_refund||(a=!0),e.includes(t.resources_model_type)||e.push(t.resources_model_type),t.stime=t.previewCostRepair.stime?1e3*t.previewCostRepair.stime:"",t.etime=t.previewCostRepair.etime?1e3*t.previewCostRepair.etime:"",s=_.round(_.add(Number(s),Number(t.ktmoney)),2)}),e.length>1?this.$message({type:"warning",message:"存在多种类型，请选择同一类型退款！"}):a?this.$message({type:"warning",message:"存在不能退款的订单,请重新选择！"}):(this.currentType=e[0],this.detailTable=t,this.refundTotal=s,this.showDetail=!0)},moneyChange(){let e=0;this.detailTable.forEach(t=>{e=_.round(_.add(Number(e),Number(t.ktmoney)),2)}),this.refundTotal=e},detailSelectChange(e){this.inventoryTable=e},addMore(){this.ruleForm.refunds.push({money:"",method:""})},delRefund(e){this.ruleForm.refunds.splice(e,1)},refundConfirm(){this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.ruleForm.refunds=[{money:"",method:""}];let e=0;this.inventoryTable.forEach(t=>{e=_.round(_.add(Number(e),Number(t.ktmoney)),2)}),this.isBatch=!0,this.ruleForm.refunds[0].money=e,this.showDialog=!0,this.getPaymentType()},formSubmit(){this.$refs.ruleForm.validate(e=>{if(e){this.isCommit=!0;let e={list:[]};this.isBatch?this.inventoryTable.forEach(t=>{let s={id:t.id,money:t.ktmoney,stime:t.stime/1e3,etime:t.etime/1e3,payment_id:this.ruleForm.refunds[0].method,remark:this.ruleForm.remarkVal};e.list.push(s)}):(e.list=[{id:this.tableData[this.currentIndex].id,many_paytype:[],remark:this.ruleForm.remarkVal}],this.showDate&&(e.list[0].stime=this.ruleForm.dateVal[0]/1e3,e.list[0].etime=this.ruleForm.dateVal[0]/1e3),this.ruleForm.refunds.forEach(t=>{e.list[0].many_paytype.push({money:t.money,payment_id:t.method})})),"carmonth"==this.currentType&&(e.car_endtime=this.ruleForm.endTime/1e3),this.$axios.post(this.urlObj.refundCost,e).then(e=>{if(200===e.Code){let t="",s="";e.Data.success_num>0?(0==e.Data.error_num?(t="退款成功！",s="success"):(t=`退款成功条数：${e.Data.success_num}；失败条数：${e.Data.error_num}；错误信息：【${e.Data.error_msg.join(";")}】`,s="warning"),this.showDialog=!1,this.showDetail=!1,this.tableLoad()):(t=`退款成功条数：${e.Data.success_num}；失败条数：${e.Data.error_num}；错误信息：【${e.Data.error_msg.join(";")}】`,s="error"),this.$message({type:s,message:t})}else{let t=e.Message?e.Message:"退款失败！";this.$message({type:"error",message:t})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})}}},P=N,B=(s("66cd"),Object(u["a"])(P,S,U,!1,null,null,null)),q=B.exports,E=s("6a9f"),z=s("b029"),A={name:"addCharge",components:{treeSearch:r["a"],Fitment:m,ChargeAdd:p["a"],PaymentHistory:F,ChargeAdjust:M,RefundManage:q},data(){return{urlObj:{searchdata:this.$api.state.Charge.searchdata.url,getroomsowner:this.$api.state.Charge.getroomsowner.url,getownerbalance:this.$api.state.Charge.getownerbalance.url,userusereceipt:this.$api.state.Charge.userusereceipt.url,getresourcesarrears:this.$api.state.Charge.getresourcesarrears.url,getcarlastcost:this.$api.state.Charge.getcarlastcost.url,sourcesprepayment:this.$api.state.Charge.sourcesprepayment.url,getownerarrears:this.$api.state.Charge.getownerarrears.url,getpaymenttype:this.$api.state.Charge.getpaymenttype.url,addsn:this.$api.state.Charge.addsn.url,getResource:this.$api.state.Charge.getResource.url,getOtherResource:this.$api.state.Charge.getOtherResource.url,vipSubject:this.$api.state.Charge.vipSubject.url,vipChargeInfo:this.$api.state.Charge.vipChargeInfo.url,vipRefund:this.$api.state.Charge.vipRefund.url,getfreeid:this.$api.state.Charge.getfreeid.url,uploadToken:this.$api.state.Public.uploadToken.url,saveUploadInfo:this.$api.state.Public.saveUploadInfo.url,delFile:this.$api.state.Public.delFile.url,issueReceipt:this.$api.state.Charge.issueReceipt.url,getinvoiceinfo:this.$api.state.Charge.getinvoiceinfo.url,balancemove:this.$api.state.Charge.balancemove.url,buildOfVillage:this.$api.state.Public.buildOfVillage.url,unitOfBuild:this.$api.state.Public.unitOfBuild.url,roomOfUnit:this.$api.state.Public.roomOfUnit.url,userOfRoom:this.$api.state.Public.userOfRoom.url,getreceipttype:this.$api.state.Charge.getreceipttype.url,ownresources:this.$api.state.Means.ownresources.url,getadvanceformat:this.$api.state.Charge.getadvanceformat.url,settime:this.$api.state.Charge.settime.url,setRoomCheck:this.$api.state.Charge.setRoomCheck.url},currentVid:"",currentVname:"",currentUser:{},opIndex:0,ownerBalance:"0.00",resourceInfo:null,otherResourceInfo:null,typeVal:"",typeOptions:[],switchVal:!1,recordTable:[],recordColumns:E.list,recordConf:{loadStatus:!1,emptyText:"",curPage:1,limit:20,dataTotal:0},recordSelected:[],recordTotal:"0.00",showPaymentDialog:!1,infoList:[],useBalance:!1,ruleForm:{vname:"",buyer:"",code:"",identify:"",bank:"",method:"",amount:"",discounts:"",reality:"",gathering:"",isReceipt:"",receiptType:"",isPaper:"",fileInfo:[],remark:""},rules:{vname:[{required:!0,message:"请输入小区名称",trigger:"blur"}],buyer:[{required:!0,message:"请输入购买方名称",trigger:"blur"}],code:[{required:!1,message:"请输入房号/电话",trigger:"blur"}],identify:[{required:!1,message:"请输入纳税人识别号",trigger:"blur"}],bank:[{required:!1,message:"请输入开户行账号",trigger:"blur"}],method:[{required:!0,message:"请选择收费方式",trigger:"change"}],amount:[{required:!0,message:"请输入应收金额",trigger:"blur"}],discounts:[{required:!0,message:"请输入优惠金额",trigger:"blur"}],reality:[{required:!0,message:"请输入实收金额",trigger:"blur"}],gathering:[{required:!0,message:"请选择收款时间",trigger:"change"}],isReceipt:[{required:!0,message:"请选择是否生成发票",trigger:"change"}],receiptType:[{required:!0,message:"请选择收据类型",trigger:"change"}],isPaper:[{required:!0,message:"请选择是否生成纸质收据",trigger:"change"}],fileInfo:[{type:"array",required:!0,message:"请上传附件！",trigger:"change"}]},showVipDialog:!1,vipForm:{subject:"",name:"",area:"",price:"",etime:"",rtime:""},vipRules:{subject:[{required:!0,message:"请选择科目",trigger:"change"}],name:[{required:!0,message:"请输入资源名称",trigger:"change"}],area:[{required:!0,message:"请输入资源面积",trigger:"change"}],price:[{required:!0,message:"请输入资源单价",trigger:"change"}],etime:[{required:!0,message:"请选择截止日期",trigger:"change"}],rtime:[{required:!0,message:"请选择退款日期",trigger:"change"}]},isCommit:!1,subOptions:[],pickerOptions:{},qiniuDatas:{},freeId:null,downloadUrl:"",showMoveDialog:!1,moveForm:{vname:"",build:"",unit:"",room:"",uid:"",money:""},moveRules:{vname:[{required:!0,message:"请输入项目名称",trigger:"blur"}],build:[{required:!1,message:"请选择楼栋",trigger:"change"}],unit:[{required:!1,message:"请选择单元",trigger:"change"}],room:[{required:!1,message:"请选择房号",trigger:"change"}],uid:[{required:!0,message:"请选择客户",trigger:"change"}],money:[{required:!0,message:"请输入转移金额",trigger:"blur"}]},buildOptions:[],unitOptions:[],roomOptions:[],userOptions:[],autoValue:"",allUserList:[],currentMoveUser:{},isRecharge:!1,receiptType:"",ownresources:[],loading:!1,roundMethod:"",dateVal:"",oldRecords:[],recordNames:[],nameVal:""}},computed:{inventAmount(){let e=0;return this.recordSelected.forEach(t=>{e=z["_"].add(Number(e),Number(t.money))}),z["_"].round(e,2).toFixed(2)}},watch:{"ruleForm.discounts"(e){this.ruleForm.reality=z["_"].round(z["_"].subtract(this.ruleForm.amount,e),2)}},created(){},methods:{checkChange(e){"village"===e.type&&(this.currentVid=e.id,this.currentVname=e.label),e.id!=this.currentUser.id&&(sessionStorage.removeItem("tempArr"),sessionStorage.removeItem("preArr"),this.switchVal=!1,e.search?(this.currentUser=e,this.pageInit()):"owner"===e.type?(this.currentUser={id:e.roomid,oid:e.id,tel:"",title:"",type:"rooms",type_name:"房屋",username:e.label},this.pageInit()):"car"===e.type?(this.currentUser={id:e.id,oid:e.oid,tel:"",title:"",type:"car",type_name:"固定车",username:e.non_owner_name},this.pageInit()):"carmonth"===e.type?(this.currentUser={id:e.id,oid:e.oid,tel:"",title:"",type:"carmonth",type_name:"月租车",username:e.label},this.pageInit()):"car_nonmotor"===e.type?(this.currentUser={id:e.id,oid:e.oid,tel:"",title:"",type:"car_nonmotor",type_name:"非机动车",username:e.label},this.pageInit()):"lastvirtual"===e.type?(this.currentUser={id:e.id,oid:e.oid,tel:"",title:"",type:"virtual_resource",type_name:"其他资源",username:e.name},this.pageInit()):this.currentUser={})},tempClear(){sessionStorage.removeItem("tempArr"),sessionStorage.removeItem("preArr"),this.pageInit()},pageInit(){this.recordSelected=[],this.opIndex=0,this.recordTotal="0.00",this.ownresources=[],this.getOwnerBalance(),this.getChargeRecord(),this.getOwnresources(),"owner"!=this.currentUser.type&&(this.getResourceInfo(),this.getOtherResource(),"rooms"==this.currentUser.type&&(this.typeVal=this.currentUser.oid,this.getRoomsOwner()))},recharge(){this.isRecharge=!0,this.getFreeId(),this.getUploadToken(),this.getPaymentType(1),this.getReceiptType(),this.getRoundMethod(),this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.ruleForm.vname=this.currentVname,this.ruleForm.buyer=this.currentUser.username,this.ruleForm.method="",this.ruleForm.amount="",this.ruleForm.isReceipt=0,this.ruleForm.gathering=new Date,this.ruleForm.receiptType=1;let e=[{name:"小区名称",value:"vname",type:"text",readonly:!0},{name:"购买方名称",value:"buyer",type:"text",readonly:!1},{name:"收费方式",value:"method",type:"select",options:[],readonly:!1},{name:"应收金额",value:"amount",type:"number",readonly:!1},{name:"收款时间",value:"gathering",type:"time",options:[],readonly:!this.$menu.getters.judgeRole("Btn-AW0xMrF2Y8BbUJHMIzt0iOCL")},{name:"是否生成发票",value:"isReceipt",type:"select",options:[{id:0,name:"否"},{id:1,name:"是"}],readonly:!1}];this.infoList=e,this.useBalance=!1,this.showPaymentDialog=!0},balanceMove(){this.$refs.moveForm&&this.$refs.moveForm.resetFields(),this.moveForm.vname=this.currentVname,this.showMoveDialog=!0,this.getBuildData()},async querySearchAsync(e,t){if(this.currentVid)if(e){let s={keywords:e,vid:this.currentVid},a=await this.$axios.post(this.urlObj.searchdata,s);if(200===a.Code){let e={id:0,username:"姓名",tel:"电话号码",title:"资源名称"};a.Data.returnData.unshift(e),this.allUserList=a.Data.returnData,t(a.Data.returnData)}else this.$refs.searchInput.$children[0].blur()}else t([]);else this.$refs.searchInput.close(),this.$message({type:"warning",message:"请选择项目后再搜索！"})},handleSelect(e){this.currentMoveUser=e,this.moveForm.build="",this.moveForm.unit="",this.moveForm.room="",this.unitOptions=[],this.roomOptions=[],this.moveForm.uid=e.oid,this.userOptions=[{value:e.oid,label:e.username}]},getBuildData(){let e={vid:this.currentVid};this.$axios.post(this.urlObj.buildOfVillage,e).then(e=>{if(200===e.Code)this.buildOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"楼栋数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},getUnitData(){let e={bid:this.moveForm.build};this.$axios.post(this.urlObj.unitOfBuild,e).then(e=>{if(200===e.Code)this.unitOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"单元数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},getRoomData(){let e={unit:this.moveForm.unit};this.$axios.post(this.urlObj.roomOfUnit,e).then(e=>{if(200===e.Code)this.roomOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"房屋数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},getUserData(){let e={id:this.moveForm.room};this.$axios.post(this.urlObj.userOfRoom,e).then(e=>{if(200===e.Code)e.Data.forEach(e=>{e.label=e.owner?e.owner.realname:"",e.value=e.oid}),this.userOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"用户数据失败！";this.$message({type:"error",message:t})}}).catch(()=>{})},buildChange(){this.moveForm.unit="",this.moveForm.room="",this.moveForm.uid="",this.unitOptions=[],this.roomOptions=[],this.userOptions=[],this.moveForm.build&&this.getUnitData()},unitChange(){this.moveForm.room="",this.moveForm.uid="",this.roomOptions=[],this.userOptions=[],this.moveForm.unit&&this.getRoomData()},roomChange(){this.moveForm.uid="",this.userOptions=[],this.moveForm.room&&this.getUserData()},moveSubmit(){this.$refs.moveForm.validate(e=>{if(e){this.isCommit=!0;let e={o_oid:this.currentUser.oid,n_oid:this.moveForm.uid,money:this.moveForm.money};this.$axios.post(this.urlObj.balancemove,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:"零钱转移成功！"}),this.showMoveDialog=!1,this.getOwnerBalance();else{let t=e.Message?e.Message:"零钱转移失败！";this.$message({type:"error",message:t})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},gotoPay(){0!=this.opIndex&&this.pageInit()},toOther(e){let t={id:e.id,oid:this.currentUser.oid,tel:e.tel,title:e.name,type:e.type,type_name:e.type_name,username:e.realname};this.currentUser=t,this.pageInit()},getBasicInfo(){this.getOwnerBalance(),"owner"!=this.currentUser.type&&(this.getResourceInfo(),this.getOtherResource())},getRoomsOwner(){let e={roomid:this.currentUser.id};this.$axios.post(this.urlObj.getroomsowner,e).then(e=>{if(200===e.Code)e.Data&&e.Data.length>0&&e.Data.forEach(e=>{e.name=e.type.name+"-"+e.owner.realname}),this.typeOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取房源用户失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getOwnerBalance(){let e={oid:this.currentUser.oid};this.$axios.post(this.urlObj.getownerbalance,e).then(e=>{if(200===e.Code)this.ownerBalance=e.Data.money?e.Data.money:"0.00";else{let t=e.Message?e.Message:"获取用户余额失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getOwnresources(){this.loading=!0;let e={id:this.currentUser.oid};this.$axios.post(this.urlObj.ownresources,e).then(e=>{if(200===e.Code)this.ownresources=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取用户拥有资源数据失败！";this.$message({message:t,type:"error"})}this.loading=!1}).catch(()=>{this.loading=!1})},getResourceInfo(){let e={oid:this.currentUser.oid,id:this.currentUser.id,type:this.currentUser.type};this.$axios.post(this.urlObj.getResource,e).then(e=>{if(200===e.Code){if(e.Data.approach_time){let t=new Date(1e3*e.Data.approach_time),s=t.getFullYear(),a=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,i=t.getDate()<10?"0"+t.getDate():t.getDate();e.Data.approach_time=s+"-"+a+"-"+i}this.resourceInfo=e.Data}else{let t=e.Message?e.Message:"获取资源信息失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getOtherResource(){let e={oid:this.currentUser.oid,vid:this.currentVid,exclude_id:this.currentUser.id,exclude_type:this.currentUser.type};this.$axios.post(this.urlObj.getOtherResource,e).then(e=>{if(200===e.Code)this.otherResourceInfo=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取其他资源信息失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getChargeRecord(){this.recordConf.loadStatus=!0;let e={oid:this.currentUser.oid,vid:this.currentVid};this.$axios.post(this.urlObj.getownerarrears,e).then(e=>{if(200===e.Code){let t=0;e.Data&&e.Data.length>0&&e.Data.forEach(e=>{e.subName=e.subject?e.subject.name:"",e.cname=e.creater?e.creater.realname:"",t+=Number(e.money)});let s=[];sessionStorage.getItem("tempArr")&&(s=JSON.parse(sessionStorage.getItem("tempArr"))),s.forEach((e,s)=>{e.title=e.resources_name,e.type_name=e.resources_type_name,e.subName=e.subject_text,e.describe=e.remarks,e.cname=e.creater_name,e.istemp=!0,e.index=s,t+=Number(e.money)}),e.Data=s.concat(e.Data),this.recordTotal=z["_"].round(t,2).toFixed(2),this.recordTable=e.Data?e.Data:[],this.oldRecords=JSON.parse(JSON.stringify(this.recordTable)),this.nameVal="",this.recordNames=[];let a=[];this.oldRecords.forEach(e=>{a.includes(e.title)||(a.push(e.title),this.recordNames.push({value:e.title,label:e.title}))}),this.recordConf.loadStatus=!1,this.recordConf.emptyText=""}else 204===e.Code?(this.$message({message:e.Message,type:"error"}),this.$router.push({path:this.$common.state.loginPath})):(this.recordTable=[],this.recordConf.emptyText=e.Message,this.recordConf.dataTotal=0,this.recordConf.loadStatus=!1)}).catch(()=>{this.recordTable=[],this.recordConf.emptyText="服务器连接失败...",this.recordConf.dataTotal=0,this.recordConf.loadStatus=!1})},recordNameChange(e){this.recordSelected=[],this.recordTable=e?this.oldRecords.filter(t=>t.title==e):JSON.parse(JSON.stringify(this.oldRecords))},selectAllEvent({records:e}){this.recordSelected=e},selectChangeEvent({records:e}){this.recordSelected=e},getSubjects(){let e={vid:this.currentVid};this.$axios.post(this.urlObj.vipSubject,e).then(e=>{if(200===e.Code)this.subOptions=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取科目数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},vipRefund(){this.$refs.vipForm&&this.$refs.vipForm.resetFields(),this.subOptions=[],this.pickerOptions={disabledDate:()=>!1},this.getSubjects(),this.showVipDialog=!0},subChange(){let e={resources_id:this.currentUser.id,resources_type:this.currentUser.type,subject_id:this.vipForm.subject};this.$axios.post(this.urlObj.vipChargeInfo,e).then(e=>{if(200===e.Code)this.vipForm.name=e.Data.name,this.vipForm.area=e.Data.area,this.vipForm.price=e.Data.price,this.vipForm.etime=1e3*e.Data.end_time,this.pickerOptions={disabledDate:e=>{if(e)return e.getTime()>this.vipForm.etime}};else{let t=e.Message?e.Message:"获取缴费数据失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},vipSubmit(){this.$refs.vipForm.validate(e=>{if(e){this.isCommit=!0;let e={resources_id:this.currentUser.id,resources_type:this.currentUser.type,subject_id:this.vipForm.subject,refund_start_time:this.vipForm.rtime/1e3};this.$axios.post(this.urlObj.vipRefund,e).then(e=>{if(200===e.Code)this.$message({message:"退款成功！",type:"success"}),this.showVipDialog=!1;else{let t=e.Message?e.Message:"退款失败！";this.$message({message:t,type:"error"})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},paymentInit(){this.isRecharge=!1,this.getFreeId(),this.getUploadToken(),this.getPaymentType(),this.getReceiptType(),this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.ruleForm.vname=this.currentVname,this.ruleForm.buyer=this.currentUser.username,this.ruleForm.code=this.resourceInfo.name+(this.resourceInfo.tel?"/"+this.resourceInfo.tel:""),this.ruleForm.identify="",this.ruleForm.bank="",this.ruleForm.method="",this.ruleForm.amount=this.inventAmount,this.ruleForm.reality=this.inventAmount,this.ruleForm.discounts=0,this.ruleForm.isReceipt=0,this.ruleForm.gathering=new Date,this.ruleForm.receiptType=1,this.ruleForm.isPaper="",this.ruleForm.fileInfo=[],this.ruleForm.remark="";let e=!0,t=[];this.recordSelected.forEach(e=>{t.includes(e.subName)||t.push(e.subName)}),e=!(t.length>1);let s=[{name:"小区名称",value:"vname",type:"text",readonly:!0},{name:"购买方名称",value:"buyer",type:"text",readonly:!1},{name:"房号/电话",value:"code",type:"text",readonly:!0},{name:"纳税人识别号",value:"identify",type:"text",readonly:!1},{name:"开户行账号",value:"bank",type:"text",readonly:!1},{name:"收费方式",value:"method",type:"select",options:[],readonly:!1},{name:"应收金额",value:"amount",type:"number",readonly:!0,useBalance:!0},{name:"优惠金额",value:"discounts",type:"number",readonly:!e},{name:"实收金额",value:"reality",type:"number",readonly:!0},{name:"收款时间",value:"gathering",type:"time",options:[],readonly:!this.$menu.getters.judgeRole("Btn-AW0xMrF2Y8BbUJHMIzt0iOCL")},{name:"是否生成发票",value:"isReceipt",type:"select",options:[{id:0,name:"否"},{id:1,name:"是"}],readonly:!1}];this.infoList=s,this.useBalance=!1,this.showPaymentDialog=!0},getRoundMethod(){let e={oid:this.currentUser.oid};this.$axios.post(this.urlObj.getadvanceformat,e).then(e=>{if(200===e.Code)this.roundMethod=e.Data?e.Data:"";else{let t=e.Message?e.Message:"获取预存款格式化规则失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getReceiptType(){let e={vid:this.currentVid};this.$axios.post(this.urlObj.getreceipttype,e).then(e=>{if(200===e.Code)this.receiptType=e.Data?e.Data.use_receipt_type:"";else{let t=e.Message?e.Message:"获取收据类型失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},getPaymentType(e){let t={vid:this.currentVid};e&&(t.receipts=e,t.is_pre=1),this.$axios.post(this.urlObj.getpaymenttype,t).then(e=>{if(200===e.Code)this.isRecharge?this.infoList[2].options=e.Data?e.Data:[]:this.infoList[5].options=e.Data?e.Data:[];else{let t=e.Message?e.Message:"获取支付方式失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},moneyChange(e){this.isRecharge&&"amount"==e.value&&(1==this.roundMethod.patterns?this.ruleForm.amount=z["_"].round(Number(this.ruleForm.amount)).toFixed(0):2==this.roundMethod.patterns?this.ruleForm.amount=z["_"].round(Number(this.ruleForm.amount),1).toFixed(1):this.ruleForm.amount=z["_"].round(Number(this.ruleForm.amount),2).toFixed(2))},paymentConfirm(){this.$refs.ruleForm.validate(e=>{if(e){this.isCommit=!0;let e=[],t=[],s=[],a=JSON.parse(sessionStorage.getItem("preArr"))?JSON.parse(sessionStorage.getItem("preArr")):[],i=[];this.recordSelected.forEach(a=>{a.istemp?(t.push({subject_id:a.subject_id,oid:a.owner_id,resources_model_id:a.resources_model_id,resources_model_type:a.resources_model_type,money:a.money,price:a.price,unit:a.unit,remarks:a.remarks}),"temp"==a.cost_type?s.push({subject_id:a.subject_id,oid:a.owner_id,resources_model_id:a.resources_model_id,resources_model_type:a.resources_model_type,money:a.money,price:a.price,unit:a.unit,remarks:a.remarks}):i.includes(a.uuid)||i.push(a.uuid)):e.push(a.id)});let r=a.filter(e=>i.includes(e.uuid)),o=null;o=this.isRecharge?{vid:this.currentVid,oid:this.currentUser.oid,realname:this.ruleForm.buyer,pay_type:this.ruleForm.method,bz:this.ruleForm.remark,allmoney:this.ruleForm.amount,discount_money:"",use_balance:0,nsrsbh:"",khhzh:"",is_bill:this.ruleForm.isReceipt,pay_time:this.ruleForm.gathering/1e3,balance:1,balance_money:this.ruleForm.amount}:{vid:this.currentVid,oid:this.currentUser.oid,realname:this.ruleForm.buyer,pay_type:this.ruleForm.method,cost_ids:e,tempdata:s,prepayment:r,bz:this.ruleForm.remark,allmoney:this.ruleForm.amount,discount_money:this.ruleForm.discounts,use_balance:this.useBalance?1:0,nsrsbh:this.ruleForm.identify,khhzh:this.ruleForm.bank,is_bill:this.ruleForm.isReceipt,pay_time:this.ruleForm.gathering/1e3},3==this.receiptType?(o.receipt_type=this.ruleForm.receiptType,2==this.ruleForm.receiptType&&(o.is_open_receiptpaper=this.ruleForm.isPaper)):2==this.receiptType&&(o.is_open_receiptpaper=this.ruleForm.isPaper),this.ruleForm.method==this.freeId&&(o.md_file_ids=this.ruleForm.fileInfo.map(e=>e.id)),this.$axios.post(this.urlObj.addsn,o).then(e=>{if(200===e.Code){if(t.length>0){let e=this.recordSelected.map(e=>e.index),t=JSON.parse(sessionStorage.getItem("tempArr")),s=t.filter((t,s)=>!e.includes(s));sessionStorage.setItem("tempArr",JSON.stringify(s))}this.$message({type:"success",message:"缴费成功！"}),e.Data.fp_num>0?this.$confirm("确定要下载发票吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.invoiceDownload(e.Data.sn_id)}).catch(()=>{}):e.Data.re_num>0&&this.$confirm("确定要打印收据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.printOrder(e.Data.sn_id)}).catch(()=>{}),this.showPaymentDialog=!1,this.pageInit()}else{let t=e.Message?e.Message:"缴费失败！";this.$message({type:"error",message:t})}this.isCommit=!1}).catch(()=>{this.isCommit=!1})}})},printOrder(e){let t={id:e,type:2};this.$axios.post(this.urlObj.issueReceipt,t).then(t=>{if(200===t.Code)t.Data.id=e,b["a"].startLodop(t.Data);else{let e=t.Message?t.Message:"获取打印数据失败！";this.$message({message:e,type:"error"})}}).catch(()=>{})},invoiceDownload(e){this.$axios.post(this.urlObj.getinvoiceinfo,{id:e}).then(e=>{if(200===e.Code)this.downloadUrl=e.Data.pdf_url,this.$nextTick(()=>{let e=this.$refs.adom;e.click()});else{let t=e.Message?e.Message:"获取发票链接失败！";this.$message({message:t,type:"error"})}}).catch(()=>{})},showFitment(e){(this.$menu.getters.judgeRole("Btn-78oi6mDGaHh4xE000ywAbS3A")||1==e)&&this.$refs.fitment.init(e,this.currentUser)},onDeliveryHouse(e){if(this.$menu.getters.judgeRole("Btn-q1WPuhfALwUEjeO00baQDlHS9Y")){const t=this.$createElement;this.$msgbox({title:"温馨提示",message:t("p",null,[t("span",null,"是否确认修改交房状态为"),t("span",{style:"font-weight: bold"},"【已交房】"),t("span",null,"，状态修改为已交房后不可再修改")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(()=>{this.isCommit=!0,this.$axios.post(this.urlObj.setRoomCheck,{id:this.resourceInfo.id,type:e}).then(e=>{200===e.Code?(this.$message({type:"success",message:"修改成功！"}),this.getResourceInfo()):this.$message({message:e.Message,type:"error"}),this.isCommit=!1}).catch(()=>{this.isCommit=!1})}).catch(()=>{})}},showOtherFitment(e,t){t.oid=this.currentUser.oid,this.$refs.fitment.init(e,t)},getFreeId(){this.$axios.post(this.urlObj.getfreeid).then(e=>{200===e.Code&&(this.freeId=e.Data.payment_id)})},getUploadToken(){this.$axios.post(this.urlObj.uploadToken).then(e=>{200===e.Code&&(this.qiniuDatas=e.Data)})},customUpload(e){e.url=this.$refs.upload.uploadFiles[0].url;let t=Object(n["a"])(e,this.qiniuDatas);t.observable.subscribe({next:e=>{},error:e=>{},complete:s=>{this.saveFile(t.fileInfo,e.file.uid)}})},handleRemove(e){let t=this.ruleForm.fileInfo.findIndex(t=>t.uid===e.uid);-1!=t&&(this.$axios.post(this.urlObj.delFile,{id:this.ruleForm.fileInfo[t].id}).then(e=>{if(200!=e.Code){let t=e.Message?e.Message:"文件删除失败！";this.$message({message:t,type:"error"})}}).catch(()=>{}),this.ruleForm.fileInfo.splice(t,1),this.$refs.ruleForm.validateField("fileInfo"))},saveFile(e,t){this.$axios.post(this.urlObj.saveUploadInfo,e).then(e=>{if(200===e.Code)this.ruleForm.fileInfo.push({id:e.Data.id,uid:t});else{let t=e.Message?e.Message:"文件信息保存失败！";this.$message({message:t,type:"error"})}this.$refs.ruleForm.validateField("fileInfo")})},dateChange(){let e=new Date(this.dateVal),t=e.getFullYear(),s=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,a=e.getDate()<10?"0"+e.getDate():e.getDate(),i=t+"-"+s+"-"+a;this.$confirm(`此操作将把入场时间设置为：${i}，设置后不能修改，是否继续？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let e={id:this.resourceInfo.id,type:this.resourceInfo.type,approach_time:this.dateVal/1e3};this.$axios.post(this.urlObj.settime,e).then(e=>{if(200===e.Code)this.$message({type:"success",message:"入场时间设置成功！"}),this.getResourceInfo();else{let t=e.Message?e.Message:"设置入场时间失败！";this.$message({type:"error",message:t})}})}).catch(()=>{})}}},J=A,H=(s("c1e0"),Object(u["a"])(J,a,i,!1,null,null,null));t["default"]=H.exports},"66cd":function(e,t,s){"use strict";s("b9d6")},"6a9f":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"资源名称","prop":"title","show":true},{"label":"类型","prop":"type_name","show":true},{"label":"科目名称","prop":"subName","show":true,"color":"#999"},{"label":"应收月份","prop":"ymonth","show":true,"color":"#69da61"},{"label":"描述","prop":"describe","show":true,"color":"#999"},{"label":"生成人","prop":"cname","show":true},{"label":"本次应收","prop":"money","show":true,"color":"#ffcb3c"}]}')},"74fa5":function(e,t,s){},"953a":function(e,t,s){"use strict";s("a598")},"960d":function(e){e.exports=JSON.parse('{"commonet":{"label":"列名称","prop":"字段名称","width":"列宽度","type":"text/number/checkbox(0,1)/button","action":"抛出的方法名称","role":"type存在时使用操作加载对应的权限名","show":"显示/隐藏列","btns":{"name":"按钮名称","type":"按钮样式","size":"按钮大小","round":"是否圆角","class":"自定义class","action":"抛出的方法名称"}},"list":[{"label":"费用名称","prop":"subject_name","show":true,"color":"#999"},{"label":"缴费内容","prop":"describe","show":true,"color":"#999","width":200},{"label":"实收金额","prop":"real_money","show":true},{"label":"已退金额","prop":"refund_money","show":true,"color":"#69da61"},{"label":"退款金额","prop":"ktmoney","type":"input","inputType":"number","width":100,"color":"#ffcb3c","show":true},{"label":"退款开始时间","type":"date","dateType":"date","prop":"stime","show":true,"width":120},{"label":"退款结束时间","type":"date","dateType":"date","prop":"etime","show":true,"width":120}]}')},"9efb":function(e,t,s){"use strict";s("15f3")},a598:function(e,t,s){},b9d6:function(e,t,s){},bd11:function(e,t,s){"use strict";s("547e")},c1e0:function(e,t,s){"use strict";s("74fa5")},db3c:function(e,t,s){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"tree-search"}},[t("div",{staticClass:"search-wrap"},[t("el-input",{staticClass:"search",attrs:{placeholder:"请输入项目名或编码","suffix-icon":"iconfont iconzu3664"},on:{change:e.searchHandle},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),t("el-scrollbar",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticStyle:{height:"calc(100% - 4.05rem)"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.showSearch,expression:"!showSearch"}],staticClass:"tree-wrap"},[t("el-tree",{ref:"tree",staticClass:"filter-tree",attrs:{lazy:"","node-key":"nodeid",accordion:"","show-checkbox":"","check-strictly":"",props:e.defaultProps,load:e.loadNode,indent:12},on:{"node-click":e.nodeClick,check:e.nodeCheck},scopedSlots:e._u([{key:"default",fn:function({node:s}){return t("span",{staticClass:"custom-tree-node"},["city"==s.data.type?t("i",{staticClass:"iconfont icondaqu"}):e._e(),"village"==s.data.type?t("i",{staticClass:"iconfont iconxiangmu"}):e._e(),"building"==s.data.type||"resources_type"==s.data.type?t("i",{staticClass:"iconfont iconloudong"}):e._e(),"unit"==s.data.type?t("i",{staticClass:"iconfont icondanyuan"}):e._e(),"parking"==s.data.type||"monthpark"==s.data.type||"inside"==s.data.type?t("i",{staticClass:"iconfont iconcheku"}):e._e(),"novehicle"==s.data.type?t("i",{staticClass:"iconfont iconfeijidongche"}):e._e(),"other"==s.data.type?t("i",{staticClass:"iconfont iconqitaziyuan"}):e._e(),"house"==s.data.type?t("i",{staticClass:"iconfont iconzu3663"}):e._e(),"insideitem"==s.data.type?t("span",{staticClass:"label"},[e._v(" "+e._s(s.data.non_owner_name)+" ")]):t("span",{staticClass:"label"},[e._v(e._s(s.label))]),s.loading?t("span",[t("i",{staticClass:"el-icon-loading",staticStyle:{color:"#ccc","margin-right":"0.25rem","vertical-align":"middle","font-size":"0.7rem",position:"relative","z-index":"100"}}),t("span",{staticStyle:{"font-size":"0.6rem",color:"#ccc"}},[e._v("加载中")])]):e._e()])}}])})],1),t("ul",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],staticClass:"search-list"},[0===e.searchList.length?t("li",{staticStyle:{color:"#ccc","text-align":"center","font-size":"0.7rem"}},[e._v(" 暂无数据！ ")]):e._e(),e._l(e.searchList,(function(s,a){return t("li",{key:a,class:[s.checked?"checked":""],on:{click:function(t){return e.checkHandle(s)}}},[t("span",{staticClass:"text1"},[e._v(e._s(s.title))]),t("span",{staticClass:"text2"},[e._v(e._s(s.type_name))]),t("span",{staticClass:"text3"},[e._v(e._s(s.username))]),t("i",{staticClass:"el-icon-check"})])}))],2)])],1)},i=[],r={name:"TreeSearch",props:["type"],data(){return{urlObj:{treeData:this.$api.state.Means.treeData.url,parking:this.$api.state.Means.parking.url,monthParking:this.$api.state.Means.monthParking.url,novehicle:this.$api.state.Means.novehicle.url,insideVehicle:this.$api.state.Means.insideVehicle.url,virtuaList:this.$api.state.Means.virtuaList.url,getbasedata:this.$api.state.Means.getbasedata.url,searchbasedata:this.$api.state.Means.searchbasedata.url},isLoading:!1,filterText:"",treeData:[],defaultProps:{children:"children",label:"label",isLeaf:"isLeaf"},showSearch:!1,checkedVid:null,checkedId:"",searchList:[]}},watch:{filterText(e){e||(this.showSearch=!1)}},mounted(){},methods:{searchHandle(){let e={vid:this.checkedVid,keywords:this.filterText.trim()};e.vid&&e.keywords?(this.isLoading=!0,this.searchList=[],this.$axios.post(this.urlObj.searchbasedata,e).then(e=>{if(200===e.Code)e.Data&&e.Data.length>0&&e.Data.forEach(e=>{e.vid=this.checkedVid,this.checkedId&&this.checkedId==e.id?e.checked=!0:e.checked=!1}),this.searchList=e.Data?e.Data:[];else{let t=e.Message?e.Message:"搜索失败！";this.$message({type:"error",message:t})}this.isLoading=!1,this.showSearch=!0})):e.vid||(this.filterText="",this.$message({type:"warning",message:"请选择一个项目后搜索！"}))},async getTreeData(e,t){let s=await this.$axios.post(this.urlObj.treeData,e);this.isLoading=!1;let a=[];200==s.Code?(s.Data.forEach(t=>{e.vid||(t.disabled=!0,t.children.forEach(e=>{e.isLeaf=!1,e.nodeid=e.type+e.id})),t.nodeid=t.type+t.id}),a=s.Data):this.$message({message:"获取数据失败！",type:"error"}),t(a)},getBaseData(e,t){this.$axios.post(this.urlObj.getbasedata,e).then(s=>{let a=[];200===s.Code?(s.Data&&s.Data.length>0&&s.Data.forEach(t=>{t.vid=e.vid,"charge"==this.type&&"owner"!=e.type&&(t.disabled=!0)}),a=s.Data?s.Data:[]):this.$message({message:"获取数据失败！",type:"error"}),t(a)})},async getCarportData(e,t){let s=null,a="";if("parking"===e.type)a="car",s=await this.$axios.post(this.urlObj.parking,{vid:e.vid});else if("monthpark"===e.type){a="monthitem";let t={vid:e.vid};"charge"==this.type&&(t.type="charge"),s=await this.$axios.post(this.urlObj.monthParking,t)}else"novehicle"===e.type?(a="car_nonmotor",s=await this.$axios.post(this.urlObj.novehicle,{vid:e.vid})):"inside"===e.type?(a="insideitem",s=await this.$axios.post(this.urlObj.insideVehicle,{vid:e.vid})):"other"===e.type&&(a="virtual_resource",s=await this.$axios.post(this.urlObj.virtuaList,{vid:e.vid,is_page:0}));if(200===s.Code){let i=0,r="parking"===e.type?s.Data.data:s.Data;r&&r.length>0&&("parking"===e.type?r.forEach(e=>{e.disabled="charge"==this.type,e.nodeid=e.type+e.id,i+=e.children.length}):r.forEach(t=>{"charge"==this.type&&"inside"===e.type?t.disabled=!0:"other"!=e.type&&(t.disabled=!1),"other"!=e.type&&(t.isLeaf=!("monthpark"===e.type&&t.children.length>0)),t.type=a,t.nodeid=a+t.id}),"monthpark"===e.type?r.forEach(e=>{"charge"==this.type&&(e.disabled=!0),i+=e.children.length}):"parking"!=e.type&&(i=r.length)),this.$emit("setNumber",i),t(r)}else t([])},loadNode(e,t){if(0===e.level){let e={secondData:0};this.isLoading=!0,this.getTreeData(e,t)}else if(2===e.level){let s=[{id:6,nodeid:"house"+e.data.id,isLeaf:!1,label:"房屋",type:"house",vid:e.data.id,disabled:!0,children:[]},{id:1,nodeid:"parking"+e.data.id,isLeaf:!1,label:"固定车位",type:"parking",vid:e.data.id,disabled:"charge"==this.type,children:[]},{id:2,nodeid:"monthpark"+e.data.id,isLeaf:!1,label:"月租车位",type:"monthpark",vid:e.data.id,disabled:"charge"==this.type,children:[]},{id:3,nodeid:"inside"+e.data.id,isLeaf:!1,label:"内部车辆",type:"inside",vid:e.data.id,disabled:"charge"==this.type,children:[]},{id:4,nodeid:"novehicle"+e.data.id,isLeaf:!1,label:"非机动车",type:"novehicle",vid:e.data.id,disabled:"charge"==this.type,children:[]},{id:5,nodeid:"other"+e.data.id,isLeaf:!1,label:"其他资源",type:"other",vid:e.data.id,disabled:"charge"==this.type,children:[]}];t(s)}else if(3===e.level)if("house"==e.data.type){let s={vid:e.data.vid,type:"rooms_type"};this.getBaseData(s,t)}else this.getCarportData(e.data,t);else if("resources_type"==e.data.type){let s={vid:e.data.vid,type:"building",type_id:e.data.id};this.getBaseData(s,t)}else if("building"==e.data.type){let s={vid:e.data.vid,type:"unit",bid:e.data.id};this.getBaseData(s,t)}else if("unit"==e.data.type){let s={vid:e.data.vid,type:"rooms",unit:e.data.id};this.getBaseData(s,t)}else if("rooms"==e.data.type){let s={vid:e.data.vid,type:"owner",rooms_id:e.data.id};this.getBaseData(s,t)}else e.data.type.includes("virtual")&&e.data.children.forEach(e=>{e.isLeaf&&(e.type="lastvirtual",e.nodeid="lastvirtual"+e.id)}),t(e.data.children)},nodeClick(e,t){this.$nextTick(()=>{e.disabled||("village"===e.type&&(this.checkedVid=e.id),this.$refs.tree.setCheckedNodes([e]),"monthitem"==e.type||"novehicle"==e.type||"inside"==e.type||"other"==e.type?e.number=t.childNodes.length:("monthpark"==e.type||"parking"==e.type)&&(e.number=0,t.childNodes.forEach(t=>{e.number=e.number+t.data.children.length})),e.loading=t.loading,this.$emit("checkChange",e))})},nodeCheck(e){e.disabled||("village"===e.type&&(this.checkedVid=e.id),this.$refs.tree.setCheckedNodes([e]),this.$emit("checkChange",e))},delNode(e){this.showSearch?this.searchHandle():this.$refs.tree.remove(e)},nodeUpdate(e,t){if(this.showSearch)this.searchHandle();else{let s=this.$refs.tree.getNode(e);s.data.label=t.label}},checkHandle(e){this.searchList.forEach(e=>{e.checked=!1}),e.checked=!0,e.search=!0,this.checkedId=e.id,this.$emit("checkChange",e)}}},o=r,l=(s("953a"),s("1805")),n=Object(l["a"])(o,a,i,!1,null,null,null);t["a"]=n.exports},f359:function(e,t,s){"use strict";s("0a61")}}]);